(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{0:function(t,e,n){t.exports=n("zUnb")},1:function(t,e){},2:function(t,e){},3:function(t,e){},crnd:function(t,e){function n(t){return Promise.resolve().then(function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e})}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id="crnd"},zUnb:function(t,e,n){"use strict";n.r(e);var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function o(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var i=function(){return(i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function a(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(i<3?o(a):i>3?o(e,n,a):o(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a}function s(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function u(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{u(r.next(t))}catch($f){i($f)}}function s(t){try{u(r.throw(t))}catch($f){i($f)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function l(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch($f){i=[6,$f],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function c(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function p(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function h(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(p(arguments[e]));return t}var f=Array.isArray||function(t){return t&&"number"==typeof t.length};function d(t){return null!=t&&"object"==typeof t}function m(t){return"function"==typeof t}var g,v={e:{}};function y(){try{return g.apply(this,arguments)}catch($f){return v.e=$f,v}}function b(t){return g=t,y}function w(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}w.prototype=Object.create(Error.prototype);var x=w,S=function(){function t(t){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}var e;return t.prototype.unsubscribe=function(){var t,e=!1;if(!this.closed){var n=this._parent,r=this._parents,o=this._unsubscribe,i=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var a=-1,s=r?r.length:0;n;)n.remove(this),n=++a<s&&r[a]||null;if(m(o)&&b(o).call(this)===v&&(e=!0,t=t||(v.e instanceof x?C(v.e.errors):[v.e])),f(i))for(a=-1,s=i.length;++a<s;){var u=i[a];if(d(u)&&b(u.unsubscribe).call(u)===v){e=!0,t=t||[];var l=v.e;l instanceof x?t=t.concat(C(l.errors)):t.push(l)}}if(e)throw new x(t)}},t.prototype.add=function(e){if(!e||e===t.EMPTY)return t.EMPTY;if(e===this)return this;var n=e;switch(typeof e){case"function":n=new t(e);case"object":if(n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if("function"!=typeof n._addParent){var r=n;(n=new t)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(n),n._addParent(this),n},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},t.prototype._addParent=function(t){var e=this._parent,n=this._parents;e&&e!==t?n?-1===n.indexOf(t)&&n.push(t):this._parents=[t]:this._parent=t},t.EMPTY=((e=new t).closed=!0,e),t}();function C(t){return t.reduce(function(t,e){return t.concat(e instanceof x?e.errors:e)},[])}var E=!1,N={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){E=t},get useDeprecatedSynchronousErrorHandling(){return E}};function _(t){setTimeout(function(){throw t})}var I={closed:!0,next:function(t){},error:function(t){if(N.useDeprecatedSynchronousErrorHandling)throw t;_(t)},complete:function(){}},T="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),A=function(t){function e(n,r,o){var i=t.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,i._parentSubscription=null,arguments.length){case 0:i.destination=I;break;case 1:if(!n){i.destination=I;break}if("object"==typeof n){n instanceof e?(i.syncErrorThrowable=n.syncErrorThrowable,i.destination=n,n.add(i)):(i.syncErrorThrowable=!0,i.destination=new k(i,n));break}default:i.syncErrorThrowable=!0,i.destination=new k(i,n,r,o)}return i}return o(e,t),e.prototype[T]=function(){return this},e.create=function(t,n,r){var o=new e(t,n,r);return o.syncErrorThrowable=!1,o},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parent,e=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=e,this._parentSubscription=null,this},e}(S),k=function(t){function e(e,n,r,o){var i,a=t.call(this)||this;a._parentSubscriber=e;var s=a;return m(n)?i=n:n&&(i=n.next,r=n.error,o=n.complete,n!==I&&(m((s=Object.create(n)).unsubscribe)&&a.add(s.unsubscribe.bind(s)),s.unsubscribe=a.unsubscribe.bind(a))),a._context=s,a._next=i,a._error=r,a._complete=o,a}return o(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;N.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,n=N.useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):_(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;_(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};N.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(n){if(this.unsubscribe(),N.useDeprecatedSynchronousErrorHandling)throw n;_(n)}},e.prototype.__tryOrSetError=function(t,e,n){if(!N.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(r){return N.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=r,t.syncErrorThrown=!0,!0):(_(r),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(A),R="function"==typeof Symbol&&Symbol.observable||"@@observable";function O(){}function D(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return M(t)}function M(t){return t?1===t.length?t[0]:function(e){return t.reduce(function(t,e){return e(t)},e)}:O}var P=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r=this.operator,o=function(t,e,n){if(t){if(t instanceof A)return t;if(t[T])return t[T]()}return t||e||n?new A(t,e,n):new A(I)}(t,e,n);if(r?r.call(o,this.source):o.add(this.source||N.useDeprecatedSynchronousErrorHandling&&!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),N.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){N.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),function(t){for(;t;){var e=t.destination;if(t.closed||t.isStopped)return!1;t=e&&e instanceof A?e:null}return!0}(t)?t.error(e):console.warn(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=L(e))(function(e,r){var o;o=n.subscribe(function(e){try{t(e)}catch(n){r(n),o&&o.unsubscribe()}},r,e)})},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[R]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:M(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=L(t))(function(t,n){var r;e.subscribe(function(t){return r=t},function(t){return n(t)},function(){return t(r)})})},t.create=function(e){return new t(e)},t}();function L(t){if(t||(t=N.Promise||Promise),!t)throw new Error("no Promise impl found");return t}function F(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}F.prototype=Object.create(Error.prototype);var z=F,B=function(t){function e(e,n){var r=t.call(this)||this;return r.subject=e,r.subscriber=n,r.closed=!1,r}return o(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}},e}(S),U=function(t){function e(e){var n=t.call(this,e)||this;return n.destination=e,n}return o(e,t),e}(A),V=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return o(e,t),e.prototype[T]=function(){return new U(this)},e.prototype.lift=function(t){var e=new j(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new z;if(!this.isStopped)for(var e=this.observers,n=e.length,r=e.slice(),o=0;o<n;o++)r[o].next(t)},e.prototype.error=function(t){if(this.closed)throw new z;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,n=e.length,r=e.slice(),o=0;o<n;o++)r[o].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new z;this.isStopped=!0;for(var t=this.observers,e=t.length,n=t.slice(),r=0;r<e;r++)n[r].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new z;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new z;return this.hasError?(t.error(this.thrownError),S.EMPTY):this.isStopped?(t.complete(),S.EMPTY):(this.observers.push(t),new B(this,t))},e.prototype.asObservable=function(){var t=new P;return t.source=this,t},e.create=function(t,e){return new j(t,e)},e}(P),j=function(t){function e(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return o(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):S.EMPTY},e}(V);function W(t){return t&&"function"==typeof t.schedule}var H=function(t){function e(e,n,r){var o=t.call(this)||this;return o.parent=e,o.outerValue=n,o.outerIndex=r,o.index=0,o}return o(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(A),q=function(t){return function(e){for(var n=0,r=t.length;n<r&&!e.closed;n++)e.next(t[n]);e.closed||e.complete()}},G=function(t){return function(e){return t.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,_),e}};function K(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var $=K(),X=function(t){return function(e){for(var n=t[$]();;){var r=n.next();if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof n.return&&e.add(function(){n.return&&n.return()}),e}},Z=function(t){return function(e){var n=t[R]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(e)}},Y=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function Q(t){return t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var J=function(t){if(t instanceof P)return function(e){return t._isScalar?(e.next(t.value),void e.complete()):t.subscribe(e)};if(t&&"function"==typeof t[R])return Z(t);if(Y(t))return q(t);if(Q(t))return G(t);if(t&&"function"==typeof t[$])return X(t);var e=d(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function tt(t,e,n,r,o){if(void 0===o&&(o=new H(t,n,r)),!o.closed)return J(e)(o)}var et=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.notifyNext=function(t,e,n,r,o){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(A);function nt(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new rt(t,e))}}var rt=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new ot(t,this.project,this.thisArg))},t}(),ot=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.project=n,o.count=0,o.thisArg=r||o,o}return o(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(e)},e}(A);function it(t,e){return new P(e?function(n){var r=new S,o=0;return r.add(e.schedule(function(){o!==t.length?(n.next(t[o++]),n.closed||r.add(this.schedule())):n.complete()})),r}:q(t))}function at(t,e){if(!e)return t instanceof P?t:new P(J(t));if(null!=t){if(function(t){return t&&"function"==typeof t[R]}(t))return function(t,e){return new P(e?function(n){var r=new S;return r.add(e.schedule(function(){var o=t[R]();r.add(o.subscribe({next:function(t){r.add(e.schedule(function(){return n.next(t)}))},error:function(t){r.add(e.schedule(function(){return n.error(t)}))},complete:function(){r.add(e.schedule(function(){return n.complete()}))}}))})),r}:Z(t))}(t,e);if(Q(t))return function(t,e){return new P(e?function(n){var r=new S;return r.add(e.schedule(function(){return t.then(function(t){r.add(e.schedule(function(){n.next(t),r.add(e.schedule(function(){return n.complete()}))}))},function(t){r.add(e.schedule(function(){return n.error(t)}))})})),r}:G(t))}(t,e);if(Y(t))return it(t,e);if(function(t){return t&&"function"==typeof t[$]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new P(e?function(n){var r,o=new S;return o.add(function(){r&&"function"==typeof r.return&&r.return()}),o.add(e.schedule(function(){r=t[$](),o.add(e.schedule(function(){if(!n.closed){var t,e;try{var o=r.next();t=o.value,e=o.done}catch(i){return void n.error(i)}e?n.complete():(n.next(t),this.schedule())}}))})),o}:X(t))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function st(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof e?function(r){return r.pipe(st(function(n,r){return at(t(n,r)).pipe(nt(function(t,o){return e(n,t,r,o)}))},n))}:("number"==typeof e&&(n=e),function(e){return e.lift(new ut(t,n))})}var ut=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new lt(t,this.project,this.concurrent))},t}(),lt=function(t){function e(e,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var o=t.call(this,e)||this;return o.project=n,o.concurrent=r,o.hasCompleted=!1,o.buffer=[],o.active=0,o.index=0,o}return o(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(e,t,n)},e.prototype._innerSub=function(t,e,n){var r=new H(this,void 0,void 0);this.destination.add(r),tt(this,t,e,n,r)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t,e,n,r,o){this.destination.next(e)},e.prototype.notifyComplete=function(t){var e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(et);function ct(t){return t}function pt(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),st(ct,t)}function ht(){return function(t){return t.lift(new ft(t))}}var ft=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,e){var n=this.connectable;n._refCount++;var r=new dt(t,n),o=e.subscribe(r);return r.closed||(r.connection=n.connect()),o},t}(),dt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.connectable=n,r}return o(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var n=this.connection,r=t._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},e}(A),mt=function(t){function e(e,n){var r=t.call(this)||this;return r.source=e,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return o(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new S).add(this.source.subscribe(new vt(this.getSubject(),this))),t.closed?(this._connection=null,t=S.EMPTY):this._connection=t),t},e.prototype.refCount=function(){return ht()(this)},e}(P).prototype,gt={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:mt._subscribe},_isComplete:{value:mt._isComplete,writable:!0},getSubject:{value:mt.getSubject},connect:{value:mt.connect},refCount:{value:mt.refCount}},vt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.connectable=n,r}return o(e,t),e.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},e}(U);function yt(){return new V}function bt(t){for(var e in t)if(t[e]===bt)return e;throw Error("Could not find renamed property on target object.")}var wt=bt({ngInjectableDef:bt});function xt(t){return{providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function St(t){return t&&t.hasOwnProperty(wt)?t[wt]:null}var Ct=function(){function t(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.ngInjectableDef=void 0!==e?xt({providedIn:e.providedIn||"root",factory:e.factory}):void 0}return t.prototype.toString=function(){return"InjectionToken "+this._desc},t}(),Et="__parameters__";function Nt(t,e,n){var r=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(t){var r=t.apply(void 0,h(e));for(var o in r)this[o]=r[o]}}}(e);function o(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(this instanceof o)return r.apply(this,e),this;var i=new((t=o).bind.apply(t,h([void 0],e)));return a.annotation=i,a;function a(t,e,n){for(var r=t.hasOwnProperty(Et)?t[Et]:Object.defineProperty(t,Et,{value:[]})[Et];r.length<=n;)r.push(null);return(r[n]=r[n]||[]).push(i),t}}return n&&(o.prototype=Object.create(n.prototype)),o.prototype.ngMetadataName=t,o.annotationCls=o,o}var _t=new Ct("AnalyzeForEntryComponents"),It="undefined"!=typeof window&&window,Tt="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,At="undefined"!=typeof global&&global||It||Tt,kt=Promise.resolve(0),Rt=null;function Ot(){if(!Rt){var t=At.Symbol;if(t&&t.iterator)Rt=t.iterator;else for(var e=Object.getOwnPropertyNames(Map.prototype),n=0;n<e.length;++n){var r=e[n];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(Rt=r)}}return Rt}function Dt(t){"undefined"==typeof Zone?kt.then(function(){t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}function Mt(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)}function Pt(t){if("string"==typeof t)return t;if(t instanceof Array)return"["+t.map(Pt).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return""+t.overriddenName;if(t.name)return""+t.name;var e=t.toString();if(null==e)return""+e;var n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}var Lt=bt({__forward_ref__:bt});function Ft(t){return t.__forward_ref__=Ft,t.toString=function(){return Pt(this())},t}function zt(t){var e=t;return"function"==typeof e&&e.hasOwnProperty(Lt)&&e.__forward_ref__===Ft?e():t}var Bt,Ut=function(t){return t[t.Emulated=0]="Emulated",t[t.Native=1]="Native",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}({}),Vt=Nt("Inject",function(t){return{token:t}}),jt=Nt("Optional"),Wt=Nt("Self"),Ht=Nt("SkipSelf"),qt=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}({}),Gt=void 0;function Kt(t){var e=Gt;return Gt=t,e}function $t(t,e){return void 0===e&&(e=qt.Default),(Bt||function(t,e){if(void 0===e&&(e=qt.Default),void 0===Gt)throw new Error("inject() must be called from an injection context");return null===Gt?function(t,e,n){var r=St(t);if(r&&"root"==r.providedIn)return void 0===r.value?r.value=r.factory():r.value;if(n&qt.Optional)return null;throw new Error("Injector: NOT_FOUND ["+Pt(t)+"]")}(t,0,e):Gt.get(t,e&qt.Optional?null:void 0,e)})(t,e)}var Xt=/([A-Z])/g;function Zt(t){try{return null!=t?t.toString().slice(0,30):t}catch($f){return"[ERROR] Exception while trying to serialize the value"}}function Yt(t,e){var n=te(t),r=te(e);return n&&r?function(t,e,n){for(var r=t[Ot()](),o=e[Ot()]();;){var i=r.next(),a=o.next();if(i.done&&a.done)return!0;if(i.done||a.done)return!1;if(!n(i.value,a.value))return!1}}(t,e,Yt):!(n||!t||"object"!=typeof t&&"function"!=typeof t||r||!e||"object"!=typeof e&&"function"!=typeof e)||Mt(t,e)}var Qt=function(){function t(t){this.wrapped=t}return t.wrap=function(e){return new t(e)},t.unwrap=function(e){return t.isWrapped(e)?e.wrapped:e},t.isWrapped=function(e){return e instanceof t},t}(),Jt=function(){function t(t,e,n){this.previousValue=t,this.currentValue=e,this.firstChange=n}return t.prototype.isFirstChange=function(){return this.firstChange},t}();function te(t){return!!ee(t)&&(Array.isArray(t)||!(t instanceof Map)&&Ot()in t)}function ee(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function ne(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}var re="__source",oe=new Object,ie=new Ct("INJECTOR"),ae=function(){function t(){}return t.prototype.get=function(t,e){if(void 0===e&&(e=oe),e===oe)throw new Error("NullInjectorError: No provider for "+Pt(t)+"!");return e},t}(),se=function(){function t(){}return t.create=function(t,e){return Array.isArray(t)?new ve(t,e):new ve(t.providers,t.parent,t.name||null)},t.THROW_IF_NOT_FOUND=oe,t.NULL=new ae,t.ngInjectableDef=xt({providedIn:"any",factory:function(){return $t(ie)}}),t.__NG_ELEMENT_ID__=function(){return ue()},t}(),ue=ne,le=function(t){return t},ce=[],pe=le,he=function(){return Array.prototype.slice.call(arguments)},fe=bt({provide:String,useValue:bt}),de=se.NULL,me=/\n/gm,ge="\u0275",ve=function(){function t(t,e,n){void 0===e&&(e=de),void 0===n&&(n=null),this.parent=e,this.source=n;var r=this._records=new Map;r.set(se,{token:se,fn:le,deps:ce,value:this,useNew:!1}),r.set(ie,{token:ie,fn:le,deps:ce,value:this,useNew:!1}),function t(e,n){if(n)if((n=zt(n))instanceof Array)for(var r=0;r<n.length;r++)t(e,n[r]);else{if("function"==typeof n)throw we("Function/Class not supported",n);if(!n||"object"!=typeof n||!n.provide)throw we("Unexpected provider",n);var o=zt(n.provide),i=function(t){var e=function(t){var e=ce,n=t.deps;if(n&&n.length){e=[];for(var r=0;r<n.length;r++){var o=6;if((u=zt(n[r]))instanceof Array)for(var i=0,a=u;i<a.length;i++){var s=a[i];s instanceof jt||s==jt?o|=1:s instanceof Ht||s==Ht?o&=-3:s instanceof Wt||s==Wt?o&=-5:u=s instanceof Vt?s.token:zt(s)}e.push({token:u,options:o})}}else if(t.useExisting){var u;e=[{token:u=zt(t.useExisting),options:6}]}else if(!(n||fe in t))throw we("'deps' required",t);return e}(t),n=le,r=ce,o=!1,i=zt(t.provide);if(fe in t)r=t.useValue;else if(t.useFactory)n=t.useFactory;else if(t.useExisting);else if(t.useClass)o=!0,n=zt(t.useClass);else{if("function"!=typeof i)throw we("StaticProvider does not have [useValue|useFactory|useExisting|useClass] or [provide] is not newable",t);o=!0,n=i}return{deps:e,fn:n,useNew:o,value:r}}(n);if(!0===n.multi){var a=e.get(o);if(a){if(a.fn!==he)throw ye(o)}else e.set(o,a={token:n.provide,deps:[],useNew:!1,fn:he,value:ce});a.deps.push({token:o=n,options:6})}var s=e.get(o);if(s&&s.fn==he)throw ye(o);e.set(o,i)}}(r,t)}return t.prototype.get=function(t,e,n){void 0===n&&(n=qt.Default);var r=this._records.get(t);try{return function t(e,n,r,o,i,a){try{return function(e,n,r,o,i,a){var s,u;if(!n||a&qt.SkipSelf)a&qt.Self||(u=o.get(e,i,qt.Default));else{if((u=n.value)==pe)throw Error(ge+"Circular dependency");if(u===ce){n.value=pe;var l=n.useNew,c=n.fn,p=n.deps,f=ce;if(p.length){f=[];for(var d=0;d<p.length;d++){var m=p[d],g=m.options,v=2&g?r.get(m.token):void 0;f.push(t(m.token,v,r,v||4&g?o:de,1&g?null:se.THROW_IF_NOT_FOUND,qt.Default))}}n.value=u=l?new((s=c).bind.apply(s,h([void 0],f))):c.apply(void 0,f)}}return u}(e,n,r,o,i,a)}catch($f){throw $f instanceof Error||($f=new Error($f)),($f.ngTempTokenPath=$f.ngTempTokenPath||[]).unshift(e),n&&n.value==pe&&(n.value=ce),$f}}(t,r,this._records,this.parent,e,n)}catch($f){var o=$f.ngTempTokenPath;throw t[re]&&o.unshift(t[re]),$f.message=be("\n"+$f.message,o,this.source),$f.ngTokenPath=o,$f.ngTempTokenPath=null,$f}},t.prototype.toString=function(){var t=[];return this._records.forEach(function(e,n){return t.push(Pt(n))}),"StaticInjector["+t.join(", ")+"]"},t}();function ye(t){return we("Cannot mix multi providers and regular providers",t)}function be(t,e,n){void 0===n&&(n=null),t=t&&"\n"===t.charAt(0)&&t.charAt(1)==ge?t.substr(2):t;var r=Pt(e);if(e instanceof Array)r=e.map(Pt).join(" -> ");else if("object"==typeof e){var o=[];for(var i in e)if(e.hasOwnProperty(i)){var a=e[i];o.push(i+":"+("string"==typeof a?JSON.stringify(a):Pt(a)))}r="{"+o.join(", ")+"}"}return"StaticInjectorError"+(n?"("+n+")":"")+"["+r+"]: "+t.replace(me,"\n  ")}function we(t,e){return new Error(be(t,e))}var xe=new Ct("The presence of this token marks an injector as being the root injector."),Se=function(){return function(){}}(),Ce=function(){return function(){}}();function Ee(t){var e=Error("No component factory found for "+Pt(t)+". Did you add it to @NgModule.entryComponents?");return e[Ne]=t,e}var Ne="ngComponent",_e=function(){function t(){}return t.prototype.resolveComponentFactory=function(t){throw Ee(t)},t}(),Ie=function(){function t(){}return t.NULL=new _e,t}(),Te=function(){function t(t,e,n){this._parent=e,this._ngModule=n,this._factories=new Map;for(var r=0;r<t.length;r++){var o=t[r];this._factories.set(o.componentType,o)}}return t.prototype.resolveComponentFactory=function(t){var e=this._factories.get(t);if(!e&&this._parent&&(e=this._parent.resolveComponentFactory(t)),!e)throw Ee(t);return new Ae(e,this._ngModule)},t}(),Ae=function(t){function e(e,n){var r=t.call(this)||this;return r.factory=e,r.ngModule=n,r.selector=e.selector,r.componentType=e.componentType,r.ngContentSelectors=e.ngContentSelectors,r.inputs=e.inputs,r.outputs=e.outputs,r}return o(e,t),e.prototype.create=function(t,e,n,r){return this.factory.create(t,e,n,r||this.ngModule)},e}(Ce),ke=function(){return function(){}}(),Re=function(){return function(){}}(),Oe=function(){function t(t){this.nativeElement=t}return t.__NG_ELEMENT_ID__=function(){return De(t)},t}(),De=ne,Me=function(){return function(){}}(),Pe=function(){return function(){}}(),Le=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}({}),Fe=function(){function t(){}return t.__NG_ELEMENT_ID__=function(){return ze()},t}(),ze=ne,Be=function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t}({}),Ue=function(){return function(){}}(),Ve=new(function(){return function(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}())("7.2.8"),je=!0,We=!1;function He(){return We=!0,je}var qe=function(){function t(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),this.inertBodyElement=this.inertDocument.body,null==this.inertBodyElement){var e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e),this.inertBodyElement=this.inertDocument.createElement("body"),e.appendChild(this.inertBodyElement)}this.inertBodyElement.innerHTML='<svg><g onload="this.parentNode.remove()"></g></svg>',!this.inertBodyElement.querySelector||this.inertBodyElement.querySelector("svg")?(this.inertBodyElement.innerHTML='<svg><p><style><img src="</style><img src=x onerror=alert(1)//">',this.getInertBodyElement=this.inertBodyElement.querySelector&&this.inertBodyElement.querySelector("svg img")&&function(){try{return!!window.DOMParser}catch(t){return!1}}()?this.getInertBodyElement_DOMParser:this.getInertBodyElement_InertDocument):this.getInertBodyElement=this.getInertBodyElement_XHR}return t.prototype.getInertBodyElement_XHR=function(t){t="<body><remove></remove>"+t+"</body>";try{t=encodeURI(t)}catch(r){return null}var e=new XMLHttpRequest;e.responseType="document",e.open("GET","data:text/html;charset=utf-8,"+t,!1),e.send(void 0);var n=e.response.body;return n.removeChild(n.firstChild),n},t.prototype.getInertBodyElement_DOMParser=function(t){t="<body><remove></remove>"+t+"</body>";try{var e=(new window.DOMParser).parseFromString(t,"text/html").body;return e.removeChild(e.firstChild),e}catch(n){return null}},t.prototype.getInertBodyElement_InertDocument=function(t){var e=this.inertDocument.createElement("template");return"content"in e?(e.innerHTML=t,e):(this.inertBodyElement.innerHTML=t,this.defaultDoc.documentMode&&this.stripCustomNsAttrs(this.inertBodyElement),this.inertBodyElement)},t.prototype.stripCustomNsAttrs=function(t){for(var e=t.attributes,n=e.length-1;0<n;n--){var r=e.item(n).name;"xmlns:ns1"!==r&&0!==r.indexOf("ns1:")||t.removeAttribute(r)}for(var o=t.firstChild;o;)o.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(o),o=o.nextSibling},t}(),Ge=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:\/?#]*(?:[\/?#]|$))/gi,Ke=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function $e(t){return(t=String(t)).match(Ge)||t.match(Ke)?t:(He()&&console.warn("WARNING: sanitizing unsafe URL value "+t+" (see http://g.co/ng/security#xss)"),"unsafe:"+t)}function Xe(t){var e,n,r={};try{for(var o=c(t.split(",")),i=o.next();!i.done;i=o.next())r[i.value]=!0}catch(a){e={error:a}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r}function Ze(){for(var t,e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o={};try{for(var i=c(n),a=i.next();!a.done;a=i.next()){var s=a.value;for(var u in s)s.hasOwnProperty(u)&&(o[u]=!0)}}catch(l){t={error:l}}finally{try{a&&!a.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return o}var Ye,Qe=Xe("area,br,col,hr,img,wbr"),Je=Xe("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),tn=Xe("rp,rt"),en=Ze(tn,Je),nn=Ze(Qe,Ze(Je,Xe("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Ze(tn,Xe("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),en),rn=Xe("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),on=Xe("srcset"),an=Ze(rn,on,Xe("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width")),sn=Xe("script,style,template"),un=function(){function t(){this.sanitizedSomething=!1,this.buf=[]}return t.prototype.sanitizeChildren=function(t){for(var e=t.firstChild,n=!0;e;)if(e.nodeType===Node.ELEMENT_NODE?n=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,n&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);var r=this.checkClobberedElement(e,e.nextSibling);if(r){e=r;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")},t.prototype.startElement=function(t){var e,n=t.nodeName.toLowerCase();if(!nn.hasOwnProperty(n))return this.sanitizedSomething=!0,!sn.hasOwnProperty(n);this.buf.push("<"),this.buf.push(n);for(var r=t.attributes,o=0;o<r.length;o++){var i=r.item(o),a=i.name,s=a.toLowerCase();if(an.hasOwnProperty(s)){var u=i.value;rn[s]&&(u=$e(u)),on[s]&&(e=u,u=(e=String(e)).split(",").map(function(t){return $e(t.trim())}).join(", ")),this.buf.push(" ",a,'="',pn(u),'"')}else this.sanitizedSomething=!0}return this.buf.push(">"),!0},t.prototype.endElement=function(t){var e=t.nodeName.toLowerCase();nn.hasOwnProperty(e)&&!Qe.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))},t.prototype.chars=function(t){this.buf.push(pn(t))},t.prototype.checkClobberedElement=function(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error("Failed to sanitize html because the element is clobbered: "+t.outerHTML);return e},t}(),ln=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,cn=/([^\#-~ |!])/g;function pn(t){return t.replace(/&/g,"&amp;").replace(ln,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(cn,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function hn(t){return"content"in t&&function(t){return t.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===t.nodeName}(t)?t.content:null}var fn=function(t){function e(e){void 0===e&&(e=!1);var n=t.call(this)||this;return n.__isAsync=e,n}return o(e,t),e.prototype.emit=function(e){t.prototype.next.call(this,e)},e.prototype.subscribe=function(e,n,r){var o,i=function(t){return null},a=function(){return null};e&&"object"==typeof e?(o=this.__isAsync?function(t){setTimeout(function(){return e.next(t)})}:function(t){e.next(t)},e.error&&(i=this.__isAsync?function(t){setTimeout(function(){return e.error(t)})}:function(t){e.error(t)}),e.complete&&(a=this.__isAsync?function(){setTimeout(function(){return e.complete()})}:function(){e.complete()})):(o=this.__isAsync?function(t){setTimeout(function(){return e(t)})}:function(t){e(t)},n&&(i=this.__isAsync?function(t){setTimeout(function(){return n(t)})}:function(t){n(t)}),r&&(a=this.__isAsync?function(){setTimeout(function(){return r()})}:function(){r()}));var s=t.prototype.subscribe.call(this,o,i,a);return e instanceof S&&e.add(s),s},e}(V),dn=function(){function t(){}return t.__NG_ELEMENT_ID__=function(){return mn(t,Oe)},t}(),mn=ne,gn=new RegExp("^([-,.\"'%_!# a-zA-Z0-9]+|(?:(?:matrix|translate|scale|rotate|skew|perspective)(?:X|Y|3d)?|(?:rgb|hsl)a?|(?:repeating-)?(?:linear|radial)-gradient|(?:calc|attr))\\([-0-9.%, #a-zA-Z]+\\))$","g"),vn=/^url\(([^)]+)\)$/,yn=function(){return function(){}}(),bn="ngDebugContext",wn="ngOriginalError",xn="ngErrorLogger";function Sn(t){return t[bn]}function Cn(t){return t[wn]}function En(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t.error.apply(t,h(e))}var Nn=function(){function t(){this._console=console}return t.prototype.handleError=function(t){var e=this._findOriginalError(t),n=this._findContext(t),r=function(t){return t[xn]||En}(t);r(this._console,"ERROR",t),e&&r(this._console,"ORIGINAL ERROR",e),n&&r(this._console,"ERROR CONTEXT",n)},t.prototype._findContext=function(t){return t?Sn(t)?Sn(t):this._findContext(Cn(t)):null},t.prototype._findOriginalError=function(t){for(var e=Cn(t);e&&Cn(e);)e=Cn(e);return e},t}();function _n(t){return!!t&&"function"==typeof t.then}function In(t){return!!t&&"function"==typeof t.subscribe}var Tn=new Ct("Application Initializer"),An=function(){function t(t){var e=this;this.appInits=t,this.initialized=!1,this.done=!1,this.donePromise=new Promise(function(t,n){e.resolve=t,e.reject=n})}return t.prototype.runInitializers=function(){var t=this;if(!this.initialized){var e=[],n=function(){t.done=!0,t.resolve()};if(this.appInits)for(var r=0;r<this.appInits.length;r++){var o=this.appInits[r]();_n(o)&&e.push(o)}Promise.all(e).then(function(){n()}).catch(function(e){t.reject(e)}),0===e.length&&n(),this.initialized=!0}},t}(),kn=new Ct("AppId");function Rn(){return""+On()+On()+On()}function On(){return String.fromCharCode(97+Math.floor(25*Math.random()))}var Dn=new Ct("Platform Initializer"),Mn=new Ct("Platform ID"),Pn=new Ct("appBootstrapListener"),Ln=function(){function t(){}return t.prototype.log=function(t){console.log(t)},t.prototype.warn=function(t){console.warn(t)},t}();function Fn(){throw new Error("Runtime compiler is not loaded")}var zn,Bn,Un=Fn,Vn=Fn,jn=Fn,Wn=Fn,Hn=function(){function t(){this.compileModuleSync=Un,this.compileModuleAsync=Vn,this.compileModuleAndAllComponentsSync=jn,this.compileModuleAndAllComponentsAsync=Wn}return t.prototype.clearCache=function(){},t.prototype.clearCacheFor=function(t){},t.prototype.getModuleId=function(t){},t}(),qn=function(){return function(){}}();function Gn(){var t=At.wtf;return!(!t||!(zn=t.trace)||(Bn=zn.events,0))}var Kn=Gn();function $n(t,e){return null}var Xn=Kn?function(t,e){return void 0===e&&(e=null),Bn.createScope(t,e)}:function(t,e){return $n},Zn=Kn?function(t,e){return zn.leaveScope(t,e),e}:function(t,e){return e},Yn=function(){function t(t){var e,n=t.enableLongStackTrace,r=void 0!==n&&n;if(this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new fn(!1),this.onMicrotaskEmpty=new fn(!1),this.onStable=new fn(!1),this.onError=new fn(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched(),this._nesting=0,this._outer=this._inner=Zone.current,Zone.wtfZoneSpec&&(this._inner=this._inner.fork(Zone.wtfZoneSpec)),Zone.TaskTrackingZoneSpec&&(this._inner=this._inner.fork(new Zone.TaskTrackingZoneSpec)),r&&Zone.longStackTraceZoneSpec&&(this._inner=this._inner.fork(Zone.longStackTraceZoneSpec)),(e=this)._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:function(t,n,r,o,i,a){try{return er(e),t.invokeTask(r,o,i,a)}finally{nr(e)}},onInvoke:function(t,n,r,o,i,a,s){try{return er(e),t.invoke(r,o,i,a,s)}finally{nr(e)}},onHasTask:function(t,n,r,o){t.hasTask(r,o),n===r&&("microTask"==o.change?(e.hasPendingMicrotasks=o.microTask,tr(e)):"macroTask"==o.change&&(e.hasPendingMacrotasks=o.macroTask))},onHandleError:function(t,n,r,o){return t.handleError(r,o),e.runOutsideAngular(function(){return e.onError.emit(o)}),!1}})}return t.isInAngularZone=function(){return!0===Zone.current.get("isAngularZone")},t.assertInAngularZone=function(){if(!t.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")},t.assertNotInAngularZone=function(){if(t.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")},t.prototype.run=function(t,e,n){return this._inner.run(t,e,n)},t.prototype.runTask=function(t,e,n,r){var o=this._inner,i=o.scheduleEventTask("NgZoneEvent: "+r,t,Jn,Qn,Qn);try{return o.runTask(i,e,n)}finally{o.cancelTask(i)}},t.prototype.runGuarded=function(t,e,n){return this._inner.runGuarded(t,e,n)},t.prototype.runOutsideAngular=function(t){return this._outer.run(t)},t}();function Qn(){}var Jn={};function tr(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(function(){return t.onStable.emit(null)})}finally{t.isStable=!0}}}function er(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function nr(t){t._nesting--,tr(t)}var rr,or=function(){function t(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new fn,this.onMicrotaskEmpty=new fn,this.onStable=new fn,this.onError=new fn}return t.prototype.run=function(t){return t()},t.prototype.runGuarded=function(t){return t()},t.prototype.runOutsideAngular=function(t){return t()},t.prototype.runTask=function(t){return t()},t}(),ir=function(){function t(t){var e=this;this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(function(){e.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}return t.prototype._watchAngularEvents=function(){var t=this;this._ngZone.onUnstable.subscribe({next:function(){t._didWork=!0,t._isZoneStable=!1}}),this._ngZone.runOutsideAngular(function(){t._ngZone.onStable.subscribe({next:function(){Yn.assertNotInAngularZone(),Dt(function(){t._isZoneStable=!0,t._runCallbacksIfReady()})}})})},t.prototype.increasePendingRequestCount=function(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount},t.prototype.decreasePendingRequestCount=function(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount},t.prototype.isStable=function(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks},t.prototype._runCallbacksIfReady=function(){var t=this;if(this.isStable())Dt(function(){for(;0!==t._callbacks.length;){var e=t._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(t._didWork)}t._didWork=!1});else{var e=this.getPendingTasks();this._callbacks=this._callbacks.filter(function(t){return!t.updateCb||!t.updateCb(e)||(clearTimeout(t.timeoutId),!1)}),this._didWork=!0}},t.prototype.getPendingTasks=function(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(function(t){return{source:t.source,creationLocation:t.creationLocation,data:t.data}}):[]},t.prototype.addCallback=function(t,e,n){var r=this,o=-1;e&&e>0&&(o=setTimeout(function(){r._callbacks=r._callbacks.filter(function(t){return t.timeoutId!==o}),t(r._didWork,r.getPendingTasks())},e)),this._callbacks.push({doneCb:t,timeoutId:o,updateCb:n})},t.prototype.whenStable=function(t,e,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/dist/task-tracking.js" loaded?');this.addCallback(t,e,n),this._runCallbacksIfReady()},t.prototype.getPendingRequestCount=function(){return this._pendingCount},t.prototype.findProviders=function(t,e,n){return[]},t}(),ar=function(){function t(){this._applications=new Map,sr.addToWindow(this)}return t.prototype.registerApplication=function(t,e){this._applications.set(t,e)},t.prototype.unregisterApplication=function(t){this._applications.delete(t)},t.prototype.unregisterAllApplications=function(){this._applications.clear()},t.prototype.getTestability=function(t){return this._applications.get(t)||null},t.prototype.getAllTestabilities=function(){return Array.from(this._applications.values())},t.prototype.getAllRootElements=function(){return Array.from(this._applications.keys())},t.prototype.findTestabilityInTree=function(t,e){return void 0===e&&(e=!0),sr.findTestabilityInTree(this,t,e)},a([s("design:paramtypes",[])],t)}(),sr=new(function(){function t(){}return t.prototype.addToWindow=function(t){},t.prototype.findTestabilityInTree=function(t,e,n){return null},t}()),ur=new Ct("AllowMultipleToken"),lr=function(){return function(t,e){this.name=t,this.token=e}}();function cr(t,e,n){void 0===n&&(n=[]);var r="Platform: "+e,o=new Ct(r);return function(e){void 0===e&&(e=[]);var i=pr();if(!i||i.injector.get(ur,!1))if(t)t(n.concat(e).concat({provide:o,useValue:!0}));else{var a=n.concat(e).concat({provide:o,useValue:!0});!function(t){if(rr&&!rr.destroyed&&!rr.injector.get(ur,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");rr=t.get(hr);var e=t.get(Dn,null);e&&e.forEach(function(t){return t()})}(se.create({providers:a,name:r}))}return function(t){var e=pr();if(!e)throw new Error("No platform exists!");if(!e.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(o)}}function pr(){return rr&&!rr.destroyed?rr:null}var hr=function(){function t(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}return t.prototype.bootstrapModuleFactory=function(t,e){var n,r=this,o="noop"===(n=e?e.ngZone:void 0)?new or:("zone.js"===n?void 0:n)||new Yn({enableLongStackTrace:He()}),i=[{provide:Yn,useValue:o}];return o.run(function(){var e=se.create({providers:i,parent:r.injector,name:t.moduleType.name}),n=t.create(e),a=n.injector.get(Nn,null);if(!a)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return n.onDestroy(function(){return mr(r._modules,n)}),o.runOutsideAngular(function(){return o.onError.subscribe({next:function(t){a.handleError(t)}})}),function(t,e,o){try{var i=((a=n.injector.get(An)).runInitializers(),a.donePromise.then(function(){return r._moduleDoBootstrap(n),n}));return _n(i)?i.catch(function(n){throw e.runOutsideAngular(function(){return t.handleError(n)}),n}):i}catch($f){throw e.runOutsideAngular(function(){return t.handleError($f)}),$f}var a}(a,o)})},t.prototype.bootstrapModule=function(t,e){var n=this;void 0===e&&(e=[]);var r=fr({},e);return function(t,e,n){return t.get(qn).createCompiler([e]).compileModuleAsync(n)}(this.injector,r,t).then(function(t){return n.bootstrapModuleFactory(t,r)})},t.prototype._moduleDoBootstrap=function(t){var e=t.injector.get(dr);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(function(t){return e.bootstrap(t)});else{if(!t.instance.ngDoBootstrap)throw new Error("The module "+Pt(t.instance.constructor)+' was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.');t.instance.ngDoBootstrap(e)}this._modules.push(t)},t.prototype.onDestroy=function(t){this._destroyListeners.push(t)},Object.defineProperty(t.prototype,"injector",{get:function(){return this._injector},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(function(t){return t.destroy()}),this._destroyListeners.forEach(function(t){return t()}),this._destroyed=!0},Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),t}();function fr(t,e){return Array.isArray(e)?e.reduce(fr,t):i({},t,e)}var dr=function(){function t(t,e,n,r,o,i){var a=this;this._zone=t,this._console=e,this._injector=n,this._exceptionHandler=r,this._componentFactoryResolver=o,this._initStatus=i,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._enforceNoNewChanges=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._enforceNoNewChanges=He(),this._zone.onMicrotaskEmpty.subscribe({next:function(){a._zone.run(function(){a.tick()})}});var s=new P(function(t){a._stable=a._zone.isStable&&!a._zone.hasPendingMacrotasks&&!a._zone.hasPendingMicrotasks,a._zone.runOutsideAngular(function(){t.next(a._stable),t.complete()})}),u=new P(function(t){var e;a._zone.runOutsideAngular(function(){e=a._zone.onStable.subscribe(function(){Yn.assertNotInAngularZone(),Dt(function(){a._stable||a._zone.hasPendingMacrotasks||a._zone.hasPendingMicrotasks||(a._stable=!0,t.next(!0))})})});var n=a._zone.onUnstable.subscribe(function(){Yn.assertInAngularZone(),a._stable&&(a._stable=!1,a._zone.runOutsideAngular(function(){t.next(!1)}))});return function(){e.unsubscribe(),n.unsubscribe()}});this.isStable=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Number.POSITIVE_INFINITY,r=null,o=t[t.length-1];return W(o)?(r=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(n=t.pop())):"number"==typeof o&&(n=t.pop()),null===r&&1===t.length&&t[0]instanceof P?t[0]:pt(n)(it(t,r))}(s,u.pipe(function(t){return ht()((e=yt,function(t){var n;n="function"==typeof e?e:function(){return e};var r=Object.create(t,gt);return r.source=t,r.subjectFactory=n,r})(t));var e}))}var e;return e=t,t.prototype.bootstrap=function(t,e){var n,r=this;if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");n=t instanceof Ce?t:this._componentFactoryResolver.resolveComponentFactory(t),this.componentTypes.push(n.componentType);var o=n instanceof Ae?null:this._injector.get(ke),i=n.create(se.NULL,[],e||n.selector,o);i.onDestroy(function(){r._unloadComponent(i)});var a=i.injector.get(ir,null);return a&&i.injector.get(ar).registerApplication(i.location.nativeElement,a),this._loadComponent(i),He()&&this._console.log("Angular is running in the development mode. Call enableProdMode() to enable the production mode."),i},t.prototype.tick=function(){var t=this;if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");var n=e._tickScope();try{this._runningTick=!0,this._views.forEach(function(t){return t.detectChanges()}),this._enforceNoNewChanges&&this._views.forEach(function(t){return t.checkNoChanges()})}catch($f){this._zone.runOutsideAngular(function(){return t._exceptionHandler.handleError($f)})}finally{this._runningTick=!1,Zn(n)}},t.prototype.attachView=function(t){var e=t;this._views.push(e),e.attachToAppRef(this)},t.prototype.detachView=function(t){var e=t;mr(this._views,e),e.detachFromAppRef()},t.prototype._loadComponent=function(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(Pn,[]).concat(this._bootstrapListeners).forEach(function(e){return e(t)})},t.prototype._unloadComponent=function(t){this.detachView(t.hostView),mr(this.components,t)},t.prototype.ngOnDestroy=function(){this._views.slice().forEach(function(t){return t.destroy()})},Object.defineProperty(t.prototype,"viewCount",{get:function(){return this._views.length},enumerable:!0,configurable:!0}),t._tickScope=Xn("ApplicationRef#tick()"),t}();function mr(t,e){var n=t.indexOf(e);n>-1&&t.splice(n,1)}var gr=function(){function t(){this.dirty=!0,this._results=[],this.changes=new fn,this.length=0}return t.prototype.map=function(t){return this._results.map(t)},t.prototype.filter=function(t){return this._results.filter(t)},t.prototype.find=function(t){return this._results.find(t)},t.prototype.reduce=function(t,e){return this._results.reduce(t,e)},t.prototype.forEach=function(t){this._results.forEach(t)},t.prototype.some=function(t){return this._results.some(t)},t.prototype.toArray=function(){return this._results.slice()},t.prototype[Ot()]=function(){return this._results[Ot()]()},t.prototype.toString=function(){return this._results.toString()},t.prototype.reset=function(t){this._results=function t(e){return e.reduce(function(e,n){var r=Array.isArray(n)?t(n):n;return e.concat(r)},[])}(t),this.dirty=!1,this.length=this._results.length,this.last=this._results[this.length-1],this.first=this._results[0]},t.prototype.notifyOnChanges=function(){this.changes.emit(this)},t.prototype.setDirty=function(){this.dirty=!0},t.prototype.destroy=function(){this.changes.complete(),this.changes.unsubscribe()},t}(),vr=function(){return function(){}}(),yr={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"},br=function(){function t(t,e){this._compiler=t,this._config=e||yr}return t.prototype.load=function(t){return this._compiler instanceof Hn?this.loadFactory(t):this.loadAndCompile(t)},t.prototype.loadAndCompile=function(t){var e=this,r=p(t.split("#"),2),o=r[0],i=r[1];return void 0===i&&(i="default"),n("crnd")(o).then(function(t){return t[i]}).then(function(t){return wr(t,o,i)}).then(function(t){return e._compiler.compileModuleAsync(t)})},t.prototype.loadFactory=function(t){var e=p(t.split("#"),2),r=e[0],o=e[1],i="NgFactory";return void 0===o&&(o="default",i=""),n("crnd")(this._config.factoryPathPrefix+r+this._config.factoryPathSuffix).then(function(t){return t[o+i]}).then(function(t){return wr(t,r,o)})},t}();function wr(t,e,n){if(!t)throw new Error("Cannot find '"+n+"' in '"+e+"'");return t}var xr=function(){function t(){}return t.__NG_ELEMENT_ID__=function(){return Sr(t,Oe)},t}(),Sr=ne,Cr=function(){function t(){}return t.__NG_ELEMENT_ID__=function(){return Er()},t}(),Er=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Nr=function(){return function(t,e){this.name=t,this.callback=e}}(),_r=function(){function t(t,e,n){this.listeners=[],this.parent=null,this._debugContext=n,this.nativeNode=t,e&&e instanceof Ir&&e.addChild(this)}return Object.defineProperty(t.prototype,"injector",{get:function(){return this._debugContext.injector},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"componentInstance",{get:function(){return this._debugContext.component},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this._debugContext.context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"references",{get:function(){return this._debugContext.references},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"providerTokens",{get:function(){return this._debugContext.providerTokens},enumerable:!0,configurable:!0}),t}(),Ir=function(t){function e(e,n,r){var o=t.call(this,e,n,r)||this;return o.properties={},o.attributes={},o.classes={},o.styles={},o.childNodes=[],o.nativeElement=e,o}return o(e,t),e.prototype.addChild=function(t){t&&(this.childNodes.push(t),t.parent=this)},e.prototype.removeChild=function(t){var e=this.childNodes.indexOf(t);-1!==e&&(t.parent=null,this.childNodes.splice(e,1))},e.prototype.insertChildrenAfter=function(t,e){var n,r=this,o=this.childNodes.indexOf(t);-1!==o&&((n=this.childNodes).splice.apply(n,h([o+1,0],e)),e.forEach(function(e){e.parent&&e.parent.removeChild(e),t.parent=r}))},e.prototype.insertBefore=function(t,e){var n=this.childNodes.indexOf(t);-1===n?this.addChild(e):(e.parent&&e.parent.removeChild(e),e.parent=this,this.childNodes.splice(n,0,e))},e.prototype.query=function(t){return this.queryAll(t)[0]||null},e.prototype.queryAll=function(t){var e=[];return function t(e,n,r){e.childNodes.forEach(function(e){e instanceof Ir&&(n(e)&&r.push(e),t(e,n,r))})}(this,t,e),e},e.prototype.queryAllNodes=function(t){var e=[];return function t(e,n,r){e instanceof Ir&&e.childNodes.forEach(function(e){n(e)&&r.push(e),e instanceof Ir&&t(e,n,r)})}(this,t,e),e},Object.defineProperty(e.prototype,"children",{get:function(){return this.childNodes.filter(function(t){return t instanceof e})},enumerable:!0,configurable:!0}),e.prototype.triggerEventHandler=function(t,e){this.listeners.forEach(function(n){n.name==t&&n.callback(e)})},e}(_r),Tr=new Map,Ar=function(t){return Tr.get(t)||null};function kr(t){Tr.set(t.nativeNode,t)}var Rr=function(){function t(){}return t.prototype.supports=function(t){return te(t)},t.prototype.create=function(t){return new Dr(t)},t}(),Or=function(t,e){return e},Dr=function(){function t(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||Or}return t.prototype.forEachItem=function(t){var e;for(e=this._itHead;null!==e;e=e._next)t(e)},t.prototype.forEachOperation=function(t){for(var e=this._itHead,n=this._removalsHead,r=0,o=null;e||n;){var i=!n||e&&e.currentIndex<Fr(n,r,o)?e:n,a=Fr(i,r,o),s=i.currentIndex;if(i===n)r--,n=n._nextRemoved;else if(e=e._next,null==i.previousIndex)r++;else{o||(o=[]);var u=a-r,l=s-r;if(u!=l){for(var c=0;c<u;c++){var p=c<o.length?o[c]:o[c]=0,h=p+c;l<=h&&h<u&&(o[c]=p+1)}o[i.previousIndex]=l-u}}a!==s&&t(i,a,s)}},t.prototype.forEachPreviousItem=function(t){var e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)},t.prototype.forEachAddedItem=function(t){var e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)},t.prototype.forEachMovedItem=function(t){var e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)},t.prototype.forEachRemovedItem=function(t){var e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)},t.prototype.forEachIdentityChange=function(t){var e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)},t.prototype.diff=function(t){if(null==t&&(t=[]),!te(t))throw new Error("Error trying to diff '"+Pt(t)+"'. Only arrays and iterables are allowed");return this.check(t)?this:null},t.prototype.onDestroy=function(){},t.prototype.check=function(t){var e=this;this._reset();var n,r,o,i=this._itHead,a=!1;if(Array.isArray(t)){this.length=t.length;for(var s=0;s<this.length;s++)o=this._trackByFn(s,r=t[s]),null!==i&&Mt(i.trackById,o)?(a&&(i=this._verifyReinsertion(i,r,o,s)),Mt(i.item,r)||this._addIdentityChange(i,r)):(i=this._mismatch(i,r,o,s),a=!0),i=i._next}else n=0,function(t,e){if(Array.isArray(t))for(var n=0;n<t.length;n++)e(t[n]);else for(var r=t[Ot()](),o=void 0;!(o=r.next()).done;)e(o.value)}(t,function(t){o=e._trackByFn(n,t),null!==i&&Mt(i.trackById,o)?(a&&(i=e._verifyReinsertion(i,t,o,n)),Mt(i.item,t)||e._addIdentityChange(i,t)):(i=e._mismatch(i,t,o,n),a=!0),i=i._next,n++}),this.length=n;return this._truncate(i),this.collection=t,this.isDirty},Object.defineProperty(t.prototype,"isDirty",{get:function(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead},enumerable:!0,configurable:!0}),t.prototype._reset=function(){if(this.isDirty){var t=void 0,e=void 0;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=e)t.previousIndex=t.currentIndex,e=t._nextMoved;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}},t.prototype._mismatch=function(t,e,n,r){var o;return null===t?o=this._itTail:(o=t._prev,this._remove(t)),null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Mt(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,o,r)):null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Mt(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,o,r)):t=this._addAfter(new Mr(e,n),o,r),t},t.prototype._verifyReinsertion=function(t,e,n,r){var o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==o?t=this._reinsertAfter(o,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t},t.prototype._truncate=function(t){for(;null!==t;){var e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)},t.prototype._reinsertAfter=function(t,e,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);var r=t._prevRemoved,o=t._nextRemoved;return null===r?this._removalsHead=o:r._nextRemoved=o,null===o?this._removalsTail=r:o._prevRemoved=r,this._insertAfter(t,e,n),this._addToMoves(t,n),t},t.prototype._moveAfter=function(t,e,n){return this._unlink(t),this._insertAfter(t,e,n),this._addToMoves(t,n),t},t.prototype._addAfter=function(t,e,n){return this._insertAfter(t,e,n),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t},t.prototype._insertAfter=function(t,e,n){var r=null===e?this._itHead:e._next;return t._next=r,t._prev=e,null===r?this._itTail=t:r._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new Lr),this._linkedRecords.put(t),t.currentIndex=n,t},t.prototype._remove=function(t){return this._addToRemovals(this._unlink(t))},t.prototype._unlink=function(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);var e=t._prev,n=t._next;return null===e?this._itHead=n:e._next=n,null===n?this._itTail=e:n._prev=e,t},t.prototype._addToMoves=function(t,e){return t.previousIndex===e?t:(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t,t)},t.prototype._addToRemovals=function(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Lr),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t},t.prototype._addIdentityChange=function(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t},t}(),Mr=function(){return function(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}(),Pr=function(){function t(){this._head=null,this._tail=null}return t.prototype.add=function(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)},t.prototype.get=function(t,e){var n;for(n=this._head;null!==n;n=n._nextDup)if((null===e||e<=n.currentIndex)&&Mt(n.trackById,t))return n;return null},t.prototype.remove=function(t){var e=t._prevDup,n=t._nextDup;return null===e?this._head=n:e._nextDup=n,null===n?this._tail=e:n._prevDup=e,null===this._head},t}(),Lr=function(){function t(){this.map=new Map}return t.prototype.put=function(t){var e=t.trackById,n=this.map.get(e);n||(n=new Pr,this.map.set(e,n)),n.add(t)},t.prototype.get=function(t,e){var n=this.map.get(t);return n?n.get(t,e):null},t.prototype.remove=function(t){var e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return 0===this.map.size},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this.map.clear()},t}();function Fr(t,e,n){var r=t.previousIndex;if(null===r)return r;var o=0;return n&&r<n.length&&(o=n[r]),r+e+o}var zr=function(){function t(){}return t.prototype.supports=function(t){return t instanceof Map||ee(t)},t.prototype.create=function(){return new Br},t}(),Br=function(){function t(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}return Object.defineProperty(t.prototype,"isDirty",{get:function(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead},enumerable:!0,configurable:!0}),t.prototype.forEachItem=function(t){var e;for(e=this._mapHead;null!==e;e=e._next)t(e)},t.prototype.forEachPreviousItem=function(t){var e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)},t.prototype.forEachChangedItem=function(t){var e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)},t.prototype.forEachAddedItem=function(t){var e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)},t.prototype.forEachRemovedItem=function(t){var e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)},t.prototype.diff=function(t){if(t){if(!(t instanceof Map||ee(t)))throw new Error("Error trying to diff '"+Pt(t)+"'. Only maps and objects are allowed")}else t=new Map;return this.check(t)?this:null},t.prototype.onDestroy=function(){},t.prototype.check=function(t){var e=this;this._reset();var n=this._mapHead;if(this._appendAfter=null,this._forEach(t,function(t,r){if(n&&n.key===r)e._maybeAddToChanges(n,t),e._appendAfter=n,n=n._next;else{var o=e._getOrCreateRecordForKey(r,t);n=e._insertBeforeOrAppend(n,o)}}),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(var r=n;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty},t.prototype._insertBeforeOrAppend=function(t,e){if(t){var n=t._prev;return e._next=t,e._prev=n,t._prev=e,n&&(n._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null},t.prototype._getOrCreateRecordForKey=function(t,e){if(this._records.has(t)){var n=this._records.get(t);this._maybeAddToChanges(n,e);var r=n._prev,o=n._next;return r&&(r._next=o),o&&(o._prev=r),n._next=null,n._prev=null,n}var i=new Ur(t);return this._records.set(t,i),i.currentValue=e,this._addToAdditions(i),i},t.prototype._reset=function(){if(this.isDirty){var t=void 0;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}},t.prototype._maybeAddToChanges=function(t,e){Mt(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))},t.prototype._addToAdditions=function(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)},t.prototype._addToChanges=function(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)},t.prototype._forEach=function(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(function(n){return e(t[n],n)})},t}(),Ur=function(){return function(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}(),Vr=function(){function t(t){this.factories=t}return t.create=function(e,n){if(null!=n){var r=n.factories.slice();e=e.concat(r)}return new t(e)},t.extend=function(e){return{provide:t,useFactory:function(n){if(!n)throw new Error("Cannot extend IterableDiffers without a parent injector");return t.create(e,n)},deps:[[t,new Ht,new jt]]}},t.prototype.find=function(t){var e,n=this.factories.find(function(e){return e.supports(t)});if(null!=n)return n;throw new Error("Cannot find a differ supporting object '"+t+"' of type '"+((e=t).name||typeof e)+"'")},t.ngInjectableDef=xt({providedIn:"root",factory:function(){return new t([new Rr])}}),t}(),jr=function(){function t(t){this.factories=t}return t.create=function(e,n){if(n){var r=n.factories.slice();e=e.concat(r)}return new t(e)},t.extend=function(e){return{provide:t,useFactory:function(n){if(!n)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return t.create(e,n)},deps:[[t,new Ht,new jt]]}},t.prototype.find=function(t){var e=this.factories.find(function(e){return e.supports(t)});if(e)return e;throw new Error("Cannot find a differ supporting object '"+t+"'")},t.ngInjectableDef=xt({providedIn:"root",factory:function(){return new t([new zr])}}),t}(),Wr=[new zr],Hr=new Vr([new Rr]),qr=new jr(Wr),Gr=cr(null,"core",[{provide:Mn,useValue:"unknown"},{provide:hr,deps:[se]},{provide:ar,deps:[]},{provide:Ln,deps:[]}]),Kr=new Ct("LocaleId");function $r(){return Hr}function Xr(){return qr}function Zr(t){return t||"en-US"}var Yr=function(){return function(t){}}();function Qr(t,e,n){var r=t.state,o=1792&r;return o===e?(t.state=-1793&r|n,t.initIndex=-1,!0):o===n}function Jr(t,e,n){return(1792&t.state)===e&&t.initIndex<=n&&(t.initIndex=n+1,!0)}function to(t,e){return t.nodes[e]}function eo(t,e){return t.nodes[e]}function no(t,e){return t.nodes[e]}function ro(t,e){return t.nodes[e]}function oo(t,e){return t.nodes[e]}var io={setCurrentNode:void 0,createRootView:void 0,createEmbeddedView:void 0,createComponentView:void 0,createNgModuleRef:void 0,overrideProvider:void 0,overrideComponentView:void 0,clearOverrides:void 0,checkAndUpdateView:void 0,checkNoChangesView:void 0,destroyView:void 0,resolveDep:void 0,createDebugContext:void 0,handleEvent:void 0,updateDirectives:void 0,updateRenderer:void 0,dirtyParentQueries:void 0};function ao(t,e,n,r){var o="ExpressionChangedAfterItHasBeenCheckedError: Expression has changed after it was checked. Previous value: '"+e+"'. Current value: '"+n+"'.";return r&&(o+=" It seems like the view has been created after its parent and its children have been dirty checked. Has it been created in a change detection hook ?"),function(t,e){var n=new Error(t);return so(n,e),n}(o,t)}function so(t,e){t[bn]=e,t[xn]=e.logError.bind(e)}function uo(t){return new Error("ViewDestroyedError: Attempt to use a destroyed view: "+t)}var lo=function(){},co=new Map;function po(t){var e=co.get(t);return e||(e=Pt(t)+"_"+co.size,co.set(t,e)),e}var ho="$$undefined",fo="$$empty";function mo(t){return{id:ho,styles:t.styles,encapsulation:t.encapsulation,data:t.data}}var go=0;function vo(t,e,n,r){return!(!(2&t.state)&&Mt(t.oldValues[e.bindingIndex+n],r))}function yo(t,e,n,r){return!!vo(t,e,n,r)&&(t.oldValues[e.bindingIndex+n]=r,!0)}function bo(t,e,n,r){var o=t.oldValues[e.bindingIndex+n];if(1&t.state||!Yt(o,r)){var i=e.bindings[n].name;throw ao(io.createDebugContext(t,e.nodeIndex),i+": "+o,i+": "+r,0!=(1&t.state))}}function wo(t){for(var e=t;e;)2&e.def.flags&&(e.state|=8),e=e.viewContainerParent||e.parent}function xo(t,e){for(var n=t;n&&n!==e;)n.state|=64,n=n.viewContainerParent||n.parent}function So(t,e,n,r){try{return wo(33554432&t.def.nodes[e].flags?eo(t,e).componentView:t),io.handleEvent(t,e,n,r)}catch($f){t.root.errorHandler.handleError($f)}}function Co(t){return t.parent?eo(t.parent,t.parentNodeDef.nodeIndex):null}function Eo(t){return t.parent?t.parentNodeDef.parent:null}function No(t,e){switch(201347067&e.flags){case 1:return eo(t,e.nodeIndex).renderElement;case 2:return to(t,e.nodeIndex).renderText}}function _o(t){return!!t.parent&&!!(32768&t.parentNodeDef.flags)}function Io(t){return!(!t.parent||32768&t.parentNodeDef.flags)}function To(t){return 1<<t%32}function Ao(t){var e={},n=0,r={};return t&&t.forEach(function(t){var o=p(t,2),i=o[0],a=o[1];"number"==typeof i?(e[i]=a,n|=To(i)):r[i]=a}),{matchedQueries:e,references:r,matchedQueryIds:n}}function ko(t,e){return t.map(function(t){var n,r,o;return Array.isArray(t)?(o=(n=p(t,2))[0],r=n[1]):(o=0,r=t),r&&("function"==typeof r||"object"==typeof r)&&e&&Object.defineProperty(r,re,{value:e,configurable:!0}),{flags:o,token:r,tokenKey:po(r)}})}function Ro(t,e,n){var r=n.renderParent;return r?0==(1&r.flags)||0==(33554432&r.flags)||r.element.componentRendererType&&r.element.componentRendererType.encapsulation===Ut.Native?eo(t,n.renderParent.nodeIndex).renderElement:void 0:e}var Oo=new WeakMap;function Do(t){var e=Oo.get(t);return e||((e=t(function(){return lo})).factory=t,Oo.set(t,e)),e}function Mo(t,e,n,r,o){3===e&&(n=t.renderer.parentNode(No(t,t.def.lastRenderRootNode))),Po(t,e,0,t.def.nodes.length-1,n,r,o)}function Po(t,e,n,r,o,i,a){for(var s=n;s<=r;s++){var u=t.def.nodes[s];11&u.flags&&Fo(t,u,e,o,i,a),s+=u.childCount}}function Lo(t,e,n,r,o,i){for(var a=t;a&&!_o(a);)a=a.parent;for(var s=a.parent,u=Eo(a),l=u.nodeIndex+u.childCount,c=u.nodeIndex+1;c<=l;c++){var p=s.def.nodes[c];p.ngContentIndex===e&&Fo(s,p,n,r,o,i),c+=p.childCount}if(!s.parent){var h=t.root.projectableNodes[e];if(h)for(c=0;c<h.length;c++)zo(t,h[c],n,r,o,i)}}function Fo(t,e,n,r,o,i){if(8&e.flags)Lo(t,e.ngContent.index,n,r,o,i);else{var a=No(t,e);if(3===n&&33554432&e.flags&&48&e.bindingFlags?(16&e.bindingFlags&&zo(t,a,n,r,o,i),32&e.bindingFlags&&zo(eo(t,e.nodeIndex).componentView,a,n,r,o,i)):zo(t,a,n,r,o,i),16777216&e.flags)for(var s=eo(t,e.nodeIndex).viewContainer._embeddedViews,u=0;u<s.length;u++)Mo(s[u],n,r,o,i);1&e.flags&&!e.element.name&&Po(t,n,e.nodeIndex+1,e.nodeIndex+e.childCount,r,o,i)}}function zo(t,e,n,r,o,i){var a=t.renderer;switch(n){case 1:a.appendChild(r,e);break;case 2:a.insertBefore(r,e,o);break;case 3:a.removeChild(r,e);break;case 0:i.push(e)}}var Bo=/^:([^:]+):(.+)$/;function Uo(t){if(":"===t[0]){var e=t.match(Bo);return[e[1],e[2]]}return["",t]}function Vo(t){for(var e=0,n=0;n<t.length;n++)e|=t[n].flags;return e}function jo(t,e,n,r,o,i){t|=1;var a=Ao(e);return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,flags:t,checkIndex:-1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:a.matchedQueries,matchedQueryIds:a.matchedQueryIds,references:a.references,ngContentIndex:n,childCount:r,bindings:[],bindingFlags:0,outputs:[],element:{ns:null,name:null,attrs:null,template:i?Do(i):null,componentProvider:null,componentView:null,componentRendererType:null,publicProviders:null,allProviders:null,handleEvent:o||lo},provider:null,text:null,query:null,ngContent:null}}function Wo(t,e,n,r,o,i,a,s,u,l,c,h){var f;void 0===a&&(a=[]),l||(l=lo);var d=Ao(n),m=d.matchedQueries,g=d.references,v=d.matchedQueryIds,y=null,b=null;i&&(y=(f=p(Uo(i),2))[0],b=f[1]),s=s||[];for(var w=new Array(s.length),x=0;x<s.length;x++){var S=p(s[x],3),C=S[0],E=S[2],N=p(Uo(S[1]),2),_=N[0],I=N[1],T=void 0,A=void 0;switch(15&C){case 4:A=E;break;case 1:case 8:T=E}w[x]={flags:C,ns:_,name:I,nonMinifiedName:I,securityContext:T,suffix:A}}u=u||[];var k=new Array(u.length);for(x=0;x<u.length;x++){var R=p(u[x],2);k[x]={type:0,target:R[0],eventName:R[1],propName:null}}var O=(a=a||[]).map(function(t){var e=p(t,2),n=e[1],r=p(Uo(e[0]),2);return[r[0],r[1],n]});return h=function(t){if(t&&t.id===ho){var e=null!=t.encapsulation&&t.encapsulation!==Ut.None||t.styles.length||Object.keys(t.data).length;t.id=e?"c"+go++:fo}return t&&t.id===fo&&(t=null),t||null}(h),c&&(e|=33554432),{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e|=1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:m,matchedQueryIds:v,references:g,ngContentIndex:r,childCount:o,bindings:w,bindingFlags:Vo(w),outputs:k,element:{ns:y,name:b,attrs:O,template:null,componentProvider:null,componentView:c||null,componentRendererType:h,publicProviders:null,allProviders:null,handleEvent:l||lo},provider:null,text:null,query:null,ngContent:null}}function Ho(t,e,n){var r,o=n.element,i=t.root.selectorOrNode,a=t.renderer;if(t.parent||!i){r=o.name?a.createElement(o.name,o.ns):a.createComment("");var s=Ro(t,e,n);s&&a.appendChild(s,r)}else r=a.selectRootElement(i,!!o.componentRendererType&&o.componentRendererType.encapsulation===Ut.ShadowDom);if(o.attrs)for(var u=0;u<o.attrs.length;u++){var l=p(o.attrs[u],3);a.setAttribute(r,l[1],l[2],l[0])}return r}function qo(t,e,n,r){for(var o=0;o<n.outputs.length;o++){var i=n.outputs[o],a=Go(t,n.nodeIndex,(p=i.eventName,(c=i.target)?c+":"+p:p)),s=i.target,u=t;"component"===i.target&&(s=null,u=e);var l=u.renderer.listen(s||r,i.eventName,a);t.disposables[n.outputIndex+o]=l}var c,p}function Go(t,e,n){return function(r){return So(t,e,n,r)}}function Ko(t,e,n,r){if(!yo(t,e,n,r))return!1;var o=e.bindings[n],i=eo(t,e.nodeIndex),a=i.renderElement,s=o.name;switch(15&o.flags){case 1:!function(t,e,n,r,o,i){var a=e.securityContext,s=a?t.root.sanitizer.sanitize(a,i):i;s=null!=s?s.toString():null;var u=t.renderer;null!=i?u.setAttribute(n,o,s,r):u.removeAttribute(n,o,r)}(t,o,a,o.ns,s,r);break;case 2:!function(t,e,n,r){var o=t.renderer;r?o.addClass(e,n):o.removeClass(e,n)}(t,a,s,r);break;case 4:!function(t,e,n,r,o){var i=t.root.sanitizer.sanitize(Be.STYLE,o);if(null!=i){i=i.toString();var a=e.suffix;null!=a&&(i+=a)}else i=null;var s=t.renderer;null!=i?s.setStyle(n,r,i):s.removeStyle(n,r)}(t,o,a,s,r);break;case 8:!function(t,e,n,r,o){var i=e.securityContext,a=i?t.root.sanitizer.sanitize(i,o):o;t.renderer.setProperty(n,r,a)}(33554432&e.flags&&32&o.flags?i.componentView:t,o,a,s,r)}return!0}var $o=new Object,Xo=po(se),Zo=po(ie),Yo=po(ke);function Qo(t,e,n,r){return n=zt(n),{index:-1,deps:ko(r,Pt(e)),flags:t,token:e,value:n}}function Jo(t,e,n){void 0===n&&(n=se.THROW_IF_NOT_FOUND);var r,o,i=Kt(t);try{if(8&e.flags)return e.token;if(2&e.flags&&(n=null),1&e.flags)return t._parent.get(e.token,n);var a=e.tokenKey;switch(a){case Xo:case Zo:case Yo:return t}var s,u=t._def.providersByKey[a];if(u){var l=t._providers[u.index];return void 0===l&&(l=t._providers[u.index]=ti(t,u)),l===$o?void 0:l}if((s=St(e.token))&&(r=t,null!=(o=s).providedIn&&(function(t,e){return t._def.modules.indexOf(o.providedIn)>-1}(r)||"root"===o.providedIn&&r._def.isRoot))){var c=t._providers.length;return t._def.providersByKey[e.tokenKey]={flags:5120,value:s.factory,deps:[],index:c,token:e.token},t._providers[c]=$o,t._providers[c]=ti(t,t._def.providersByKey[e.tokenKey])}return 4&e.flags?n:t._parent.get(e.token,n)}finally{Kt(i)}}function ti(t,e){var n;switch(201347067&e.flags){case 512:n=function(t,e,n){var r=n.length;switch(r){case 0:return new e;case 1:return new e(Jo(t,n[0]));case 2:return new e(Jo(t,n[0]),Jo(t,n[1]));case 3:return new e(Jo(t,n[0]),Jo(t,n[1]),Jo(t,n[2]));default:for(var o=new Array(r),i=0;i<r;i++)o[i]=Jo(t,n[i]);return new(e.bind.apply(e,h([void 0],o)))}}(t,e.value,e.deps);break;case 1024:n=function(t,e,n){var r=n.length;switch(r){case 0:return e();case 1:return e(Jo(t,n[0]));case 2:return e(Jo(t,n[0]),Jo(t,n[1]));case 3:return e(Jo(t,n[0]),Jo(t,n[1]),Jo(t,n[2]));default:for(var o=Array(r),i=0;i<r;i++)o[i]=Jo(t,n[i]);return e.apply(void 0,h(o))}}(t,e.value,e.deps);break;case 2048:n=Jo(t,e.deps[0]);break;case 256:n=e.value}return n===$o||null==n||"object"!=typeof n||131072&e.flags||"function"!=typeof n.ngOnDestroy||(e.flags|=131072),void 0===n?$o:n}function ei(t,e){var n=t.viewContainer._embeddedViews;if((null==e||e>=n.length)&&(e=n.length-1),e<0)return null;var r=n[e];return r.viewContainerParent=null,ii(n,e),io.dirtyParentQueries(r),ri(r),r}function ni(t,e,n){var r=e?No(e,e.def.lastRenderRootNode):t.renderElement,o=n.renderer.parentNode(r),i=n.renderer.nextSibling(r);Mo(n,2,o,i,void 0)}function ri(t){Mo(t,3,null,null,void 0)}function oi(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function ii(t,e){e>=t.length-1?t.pop():t.splice(e,1)}var ai=new Object;function si(t,e,n,r,o,i){return new ui(t,e,n,r,o,i)}var ui=function(t){function e(e,n,r,o,i,a){var s=t.call(this)||this;return s.selector=e,s.componentType=n,s._inputs=o,s._outputs=i,s.ngContentSelectors=a,s.viewDefFactory=r,s}return o(e,t),Object.defineProperty(e.prototype,"inputs",{get:function(){var t=[],e=this._inputs;for(var n in e)t.push({propName:n,templateName:e[n]});return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){var t=[];for(var e in this._outputs)t.push({propName:e,templateName:this._outputs[e]});return t},enumerable:!0,configurable:!0}),e.prototype.create=function(t,e,n,r){if(!r)throw new Error("ngModule should be provided");var o=Do(this.viewDefFactory),i=o.nodes[0].element.componentProvider.nodeIndex,a=io.createRootView(t,e||[],n,o,r,ai),s=no(a,i).instance;return n&&a.renderer.setAttribute(eo(a,0).renderElement,"ng-version",Ve.full),new li(a,new fi(a),s)},e}(Ce),li=function(t){function e(e,n,r){var o=t.call(this)||this;return o._view=e,o._viewRef=n,o._component=r,o._elDef=o._view.def.nodes[0],o.hostView=n,o.changeDetectorRef=n,o.instance=r,o}return o(e,t),Object.defineProperty(e.prototype,"location",{get:function(){return new Oe(eo(this._view,this._elDef.nodeIndex).renderElement)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"injector",{get:function(){return new vi(this._view,this._elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentType",{get:function(){return this._component.constructor},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._viewRef.destroy()},e.prototype.onDestroy=function(t){this._viewRef.onDestroy(t)},e}(Se);function ci(t,e,n){return new pi(t,e,n)}var pi=function(){function t(t,e,n){this._view=t,this._elDef=e,this._data=n,this._embeddedViews=[]}return Object.defineProperty(t.prototype,"element",{get:function(){return new Oe(this._data.renderElement)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"injector",{get:function(){return new vi(this._view,this._elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentInjector",{get:function(){for(var t=this._view,e=this._elDef.parent;!e&&t;)e=Eo(t),t=t.parent;return t?new vi(t,e):new vi(this._view,null)},enumerable:!0,configurable:!0}),t.prototype.clear=function(){for(var t=this._embeddedViews.length-1;t>=0;t--){var e=ei(this._data,t);io.destroyView(e)}},t.prototype.get=function(t){var e=this._embeddedViews[t];if(e){var n=new fi(e);return n.attachToViewContainerRef(this),n}return null},Object.defineProperty(t.prototype,"length",{get:function(){return this._embeddedViews.length},enumerable:!0,configurable:!0}),t.prototype.createEmbeddedView=function(t,e,n){var r=t.createEmbeddedView(e||{});return this.insert(r,n),r},t.prototype.createComponent=function(t,e,n,r,o){var i=n||this.parentInjector;o||t instanceof Ae||(o=i.get(ke));var a=t.create(i,r,void 0,o);return this.insert(a.hostView,e),a},t.prototype.insert=function(t,e){if(t.destroyed)throw new Error("Cannot insert a destroyed View in a ViewContainer!");var n,r,o,i,a=t;return i=(n=this._data).viewContainer._embeddedViews,null==(r=e)&&(r=i.length),(o=a._view).viewContainerParent=this._view,oi(i,r,o),function(t,e){var n=Co(e);if(n&&n!==t&&!(16&e.state)){e.state|=16;var r=n.template._projectedViews;r||(r=n.template._projectedViews=[]),r.push(e),function(t,n){if(!(4&n.flags)){e.parent.def.nodeFlags|=4,n.flags|=4;for(var r=n.parent;r;)r.childFlags|=4,r=r.parent}}(0,e.parentNodeDef)}}(n,o),io.dirtyParentQueries(o),ni(n,r>0?i[r-1]:null,o),a.attachToViewContainerRef(this),t},t.prototype.move=function(t,e){if(t.destroyed)throw new Error("Cannot move a destroyed View in a ViewContainer!");var n,r,o,i,a,s=this._embeddedViews.indexOf(t._view);return o=e,a=(i=(n=this._data).viewContainer._embeddedViews)[r=s],ii(i,r),null==o&&(o=i.length),oi(i,o,a),io.dirtyParentQueries(a),ri(a),ni(n,o>0?i[o-1]:null,a),t},t.prototype.indexOf=function(t){return this._embeddedViews.indexOf(t._view)},t.prototype.remove=function(t){var e=ei(this._data,t);e&&io.destroyView(e)},t.prototype.detach=function(t){var e=ei(this._data,t);return e?new fi(e):null},t}();function hi(t){return new fi(t)}var fi=function(){function t(t){this._view=t,this._viewContainerRef=null,this._appRef=null}return Object.defineProperty(t.prototype,"rootNodes",{get:function(){return Mo(this._view,0,void 0,void 0,t=[]),t;var t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this._view.context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"destroyed",{get:function(){return 0!=(128&this._view.state)},enumerable:!0,configurable:!0}),t.prototype.markForCheck=function(){wo(this._view)},t.prototype.detach=function(){this._view.state&=-5},t.prototype.detectChanges=function(){var t=this._view.root.rendererFactory;t.begin&&t.begin();try{io.checkAndUpdateView(this._view)}finally{t.end&&t.end()}},t.prototype.checkNoChanges=function(){io.checkNoChangesView(this._view)},t.prototype.reattach=function(){this._view.state|=4},t.prototype.onDestroy=function(t){this._view.disposables||(this._view.disposables=[]),this._view.disposables.push(t)},t.prototype.destroy=function(){this._appRef?this._appRef.detachView(this):this._viewContainerRef&&this._viewContainerRef.detach(this._viewContainerRef.indexOf(this)),io.destroyView(this._view)},t.prototype.detachFromAppRef=function(){this._appRef=null,ri(this._view),io.dirtyParentQueries(this._view)},t.prototype.attachToAppRef=function(t){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=t},t.prototype.attachToViewContainerRef=function(t){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=t},t}();function di(t,e){return new mi(t,e)}var mi=function(t){function e(e,n){var r=t.call(this)||this;return r._parentView=e,r._def=n,r}return o(e,t),e.prototype.createEmbeddedView=function(t){return new fi(io.createEmbeddedView(this._parentView,this._def,this._def.element.template,t))},Object.defineProperty(e.prototype,"elementRef",{get:function(){return new Oe(eo(this._parentView,this._def.nodeIndex).renderElement)},enumerable:!0,configurable:!0}),e}(dn);function gi(t,e){return new vi(t,e)}var vi=function(){function t(t,e){this.view=t,this.elDef=e}return t.prototype.get=function(t,e){return void 0===e&&(e=se.THROW_IF_NOT_FOUND),io.resolveDep(this.view,this.elDef,!!this.elDef&&0!=(33554432&this.elDef.flags),{flags:0,token:t,tokenKey:po(t)},e)},t}();function yi(t){return new bi(t.renderer)}var bi=function(){function t(t){this.delegate=t}return t.prototype.selectRootElement=function(t){return this.delegate.selectRootElement(t)},t.prototype.createElement=function(t,e){var n=p(Uo(e),2),r=this.delegate.createElement(n[1],n[0]);return t&&this.delegate.appendChild(t,r),r},t.prototype.createViewRoot=function(t){return t},t.prototype.createTemplateAnchor=function(t){var e=this.delegate.createComment("");return t&&this.delegate.appendChild(t,e),e},t.prototype.createText=function(t,e){var n=this.delegate.createText(e);return t&&this.delegate.appendChild(t,n),n},t.prototype.projectNodes=function(t,e){for(var n=0;n<e.length;n++)this.delegate.appendChild(t,e[n])},t.prototype.attachViewAfter=function(t,e){for(var n=this.delegate.parentNode(t),r=this.delegate.nextSibling(t),o=0;o<e.length;o++)this.delegate.insertBefore(n,e[o],r)},t.prototype.detachView=function(t){for(var e=0;e<t.length;e++){var n=t[e],r=this.delegate.parentNode(n);this.delegate.removeChild(r,n)}},t.prototype.destroyView=function(t,e){for(var n=0;n<e.length;n++)this.delegate.destroyNode(e[n])},t.prototype.listen=function(t,e,n){return this.delegate.listen(t,e,n)},t.prototype.listenGlobal=function(t,e,n){return this.delegate.listen(t,e,n)},t.prototype.setElementProperty=function(t,e,n){this.delegate.setProperty(t,e,n)},t.prototype.setElementAttribute=function(t,e,n){var r=p(Uo(e),2),o=r[0],i=r[1];null!=n?this.delegate.setAttribute(t,i,n,o):this.delegate.removeAttribute(t,i,o)},t.prototype.setBindingDebugInfo=function(t,e,n){},t.prototype.setElementClass=function(t,e,n){n?this.delegate.addClass(t,e):this.delegate.removeClass(t,e)},t.prototype.setElementStyle=function(t,e,n){null!=n?this.delegate.setStyle(t,e,n):this.delegate.removeStyle(t,e)},t.prototype.invokeElementMethod=function(t,e,n){t[e].apply(t,n)},t.prototype.setText=function(t,e){this.delegate.setValue(t,e)},t.prototype.animate=function(){throw new Error("Renderer.animate is no longer supported!")},t}();function wi(t,e,n,r){return new xi(t,e,n,r)}var xi=function(){function t(t,e,n,r){this._moduleType=t,this._parent=e,this._bootstrapComponents=n,this._def=r,this._destroyListeners=[],this._destroyed=!1,this.injector=this,function(t){for(var e=t._def,n=t._providers=new Array(e.providers.length),r=0;r<e.providers.length;r++){var o=e.providers[r];4096&o.flags||void 0===n[r]&&(n[r]=ti(t,o))}}(this)}return t.prototype.get=function(t,e,n){void 0===e&&(e=se.THROW_IF_NOT_FOUND),void 0===n&&(n=qt.Default);var r=0;return n&qt.SkipSelf?r|=1:n&qt.Self&&(r|=4),Jo(this,{token:t,tokenKey:po(t),flags:r},e)},Object.defineProperty(t.prototype,"instance",{get:function(){return this.get(this._moduleType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"componentFactoryResolver",{get:function(){return this.get(Ie)},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){if(this._destroyed)throw new Error("The ng module "+Pt(this.instance.constructor)+" has already been destroyed.");this._destroyed=!0,function(t,e){for(var n=t._def,r=new Set,o=0;o<n.providers.length;o++)if(131072&n.providers[o].flags){var i=t._providers[o];if(i&&i!==$o){var a=i.ngOnDestroy;"function"!=typeof a||r.has(i)||(a.apply(i),r.add(i))}}}(this),this._destroyListeners.forEach(function(t){return t()})},t.prototype.onDestroy=function(t){this._destroyListeners.push(t)},t}(),Si=po(Me),Ci=po(Fe),Ei=po(Oe),Ni=po(xr),_i=po(dn),Ii=po(Cr),Ti=po(se),Ai=po(ie);function ki(t,e,n,r,o,i,a,s){var u=[];if(a)for(var l in a){var c=p(a[l],2);u[c[0]]={flags:8,name:l,nonMinifiedName:c[1],ns:null,securityContext:null,suffix:null}}var h=[];if(s)for(var f in s)h.push({type:1,propName:f,target:null,eventName:s[f]});return Ri(t,e|=16384,n,r,o,o,i,u,h)}function Ri(t,e,n,r,o,i,a,s,u){var l=Ao(n),c=l.matchedQueries,p=l.references,h=l.matchedQueryIds;u||(u=[]),s||(s=[]),i=zt(i);var f=ko(a,Pt(o));return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:c,matchedQueryIds:h,references:p,ngContentIndex:-1,childCount:r,bindings:s,bindingFlags:Vo(s),outputs:u,element:null,provider:{token:o,value:i,deps:f},text:null,query:null,ngContent:null}}function Oi(t,e){return Li(t,e)}function Di(t,e){for(var n=t;n.parent&&!_o(n);)n=n.parent;return Fi(n.parent,Eo(n),!0,e.provider.value,e.provider.deps)}function Mi(t,e){var n=Fi(t,e.parent,(32768&e.flags)>0,e.provider.value,e.provider.deps);if(e.outputs.length)for(var r=0;r<e.outputs.length;r++){var o=e.outputs[r],i=n[o.propName];if(!In(i))throw new Error("@Output "+o.propName+" not initialized in '"+n.constructor.name+"'.");var a=i.subscribe(Pi(t,e.parent.nodeIndex,o.eventName));t.disposables[e.outputIndex+r]=a.unsubscribe.bind(a)}return n}function Pi(t,e,n){return function(r){return So(t,e,n,r)}}function Li(t,e){var n=(8192&e.flags)>0,r=e.provider;switch(201347067&e.flags){case 512:return Fi(t,e.parent,n,r.value,r.deps);case 1024:return function(t,e,n,r,o){var i=o.length;switch(i){case 0:return r();case 1:return r(Bi(t,e,n,o[0]));case 2:return r(Bi(t,e,n,o[0]),Bi(t,e,n,o[1]));case 3:return r(Bi(t,e,n,o[0]),Bi(t,e,n,o[1]),Bi(t,e,n,o[2]));default:for(var a=Array(i),s=0;s<i;s++)a[s]=Bi(t,e,n,o[s]);return r.apply(void 0,h(a))}}(t,e.parent,n,r.value,r.deps);case 2048:return Bi(t,e.parent,n,r.deps[0]);case 256:return r.value}}function Fi(t,e,n,r,o){var i=o.length;switch(i){case 0:return new r;case 1:return new r(Bi(t,e,n,o[0]));case 2:return new r(Bi(t,e,n,o[0]),Bi(t,e,n,o[1]));case 3:return new r(Bi(t,e,n,o[0]),Bi(t,e,n,o[1]),Bi(t,e,n,o[2]));default:for(var a=new Array(i),s=0;s<i;s++)a[s]=Bi(t,e,n,o[s]);return new(r.bind.apply(r,h([void 0],a)))}}var zi={};function Bi(t,e,n,r,o){if(void 0===o&&(o=se.THROW_IF_NOT_FOUND),8&r.flags)return r.token;var i=t;2&r.flags&&(o=null);var a=r.tokenKey;a===Ii&&(n=!(!e||!e.element.componentView)),e&&1&r.flags&&(n=!1,e=e.parent);for(var s=t;s;){if(e)switch(a){case Si:return yi(Ui(s,e,n));case Ci:return Ui(s,e,n).renderer;case Ei:return new Oe(eo(s,e.nodeIndex).renderElement);case Ni:return eo(s,e.nodeIndex).viewContainer;case _i:if(e.element.template)return eo(s,e.nodeIndex).template;break;case Ii:return hi(Ui(s,e,n));case Ti:case Ai:return gi(s,e);default:var u=(n?e.element.allProviders:e.element.publicProviders)[a];if(u){var l=no(s,u.nodeIndex);return l||(l={instance:Li(s,u)},s.nodes[u.nodeIndex]=l),l.instance}}n=_o(s),e=Eo(s),s=s.parent,4&r.flags&&(s=null)}var c=i.root.injector.get(r.token,zi);return c!==zi||o===zi?c:i.root.ngModule.injector.get(r.token,o)}function Ui(t,e,n){var r;if(n)r=eo(t,e.nodeIndex).componentView;else for(r=t;r.parent&&!_o(r);)r=r.parent;return r}function Vi(t,e,n,r,o,i){if(32768&n.flags){var a=eo(t,n.parent.nodeIndex).componentView;2&a.def.flags&&(a.state|=8)}if(e.instance[n.bindings[r].name]=o,524288&n.flags){i=i||{};var s=Qt.unwrap(t.oldValues[n.bindingIndex+r]);i[n.bindings[r].nonMinifiedName]=new Jt(s,o,0!=(2&t.state))}return t.oldValues[n.bindingIndex+r]=o,i}function ji(t,e){if(t.def.nodeFlags&e)for(var n=t.def.nodes,r=0,o=0;o<n.length;o++){var i=n[o],a=i.parent;for(!a&&i.flags&e&&Hi(t,o,i.flags&e,r++),0==(i.childFlags&e)&&(o+=i.childCount);a&&1&a.flags&&o===a.nodeIndex+a.childCount;)a.directChildFlags&e&&(r=Wi(t,a,e,r)),a=a.parent}}function Wi(t,e,n,r){for(var o=e.nodeIndex+1;o<=e.nodeIndex+e.childCount;o++){var i=t.def.nodes[o];i.flags&n&&Hi(t,o,i.flags&n,r++),o+=i.childCount}return r}function Hi(t,e,n,r){var o=no(t,e);if(o){var i=o.instance;i&&(io.setCurrentNode(t,e),1048576&n&&Jr(t,512,r)&&i.ngAfterContentInit(),2097152&n&&i.ngAfterContentChecked(),4194304&n&&Jr(t,768,r)&&i.ngAfterViewInit(),8388608&n&&i.ngAfterViewChecked(),131072&n&&i.ngOnDestroy())}}function qi(t,e,n){var r=[];for(var o in n)r.push({propName:o,bindingType:n[o]});return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:-1,flags:t,childFlags:0,directChildFlags:0,childMatchedQueries:0,ngContentIndex:-1,matchedQueries:{},matchedQueryIds:0,references:{},childCount:0,bindings:[],bindingFlags:0,outputs:[],element:null,provider:null,text:null,query:{id:e,filterId:To(e),bindings:r},ngContent:null}}function Gi(t){for(var e=t.def.nodeMatchedQueries;t.parent&&Io(t);){var n=t.parentNodeDef;t=t.parent;for(var r=n.nodeIndex+n.childCount,o=0;o<=r;o++)67108864&(i=t.def.nodes[o]).flags&&536870912&i.flags&&(i.query.filterId&e)===i.query.filterId&&oo(t,o).setDirty(),!(1&i.flags&&o+i.childCount<n.nodeIndex)&&67108864&i.childFlags&&536870912&i.childFlags||(o+=i.childCount)}if(134217728&t.def.nodeFlags)for(o=0;o<t.def.nodes.length;o++){var i;134217728&(i=t.def.nodes[o]).flags&&536870912&i.flags&&oo(t,o).setDirty(),o+=i.childCount}}function Ki(t,e){var n=oo(t,e.nodeIndex);if(n.dirty){var r,o=void 0;if(67108864&e.flags){var i=e.parent.parent;o=$i(t,i.nodeIndex,i.nodeIndex+i.childCount,e.query,[]),r=no(t,e.parent.nodeIndex).instance}else 134217728&e.flags&&(o=$i(t,0,t.def.nodes.length-1,e.query,[]),r=t.component);n.reset(o);for(var a=e.query.bindings,s=!1,u=0;u<a.length;u++){var l=a[u],c=void 0;switch(l.bindingType){case 0:c=n.first;break;case 1:c=n,s=!0}r[l.propName]=c}s&&n.notifyOnChanges()}}function $i(t,e,n,r,o){for(var i=e;i<=n;i++){var a=t.def.nodes[i],s=a.matchedQueries[r.id];if(null!=s&&o.push(Xi(t,a,s)),1&a.flags&&a.element.template&&(a.element.template.nodeMatchedQueries&r.filterId)===r.filterId){var u=eo(t,i);if((a.childMatchedQueries&r.filterId)===r.filterId&&($i(t,i+1,i+a.childCount,r,o),i+=a.childCount),16777216&a.flags)for(var l=u.viewContainer._embeddedViews,c=0;c<l.length;c++){var p=l[c],h=Co(p);h&&h===u&&$i(p,0,p.def.nodes.length-1,r,o)}var f=u.template._projectedViews;if(f)for(c=0;c<f.length;c++){var d=f[c];$i(d,0,d.def.nodes.length-1,r,o)}}(a.childMatchedQueries&r.filterId)!==r.filterId&&(i+=a.childCount)}return o}function Xi(t,e,n){if(null!=n)switch(n){case 1:return eo(t,e.nodeIndex).renderElement;case 0:return new Oe(eo(t,e.nodeIndex).renderElement);case 2:return eo(t,e.nodeIndex).template;case 3:return eo(t,e.nodeIndex).viewContainer;case 4:return no(t,e.nodeIndex).instance}}function Zi(t,e,n){var r=Ro(t,e,n);r&&Lo(t,n.ngContent.index,1,r,null,void 0)}function Yi(t,e,n){for(var r=new Array(n.length-1),o=1;o<n.length;o++)r[o-1]={flags:8,name:null,ns:null,nonMinifiedName:null,securityContext:null,suffix:n[o]};return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:2,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:e,childCount:0,bindings:r,bindingFlags:8,outputs:[],element:null,provider:null,text:{prefix:n[0]},query:null,ngContent:null}}function Qi(t,e,n){var r,o=t.renderer;r=o.createText(n.text.prefix);var i=Ro(t,e,n);return i&&o.appendChild(i,r),{renderText:r}}function Ji(t,e){return(null!=t?t.toString():"")+e.suffix}function ta(t,e,n,r){for(var o=0,i=0,a=0,s=0,u=0,l=null,c=null,p=!1,h=!1,f=null,d=0;d<e.length;d++){var m=e[d];if(m.nodeIndex=d,m.parent=l,m.bindingIndex=o,m.outputIndex=i,m.renderParent=c,a|=m.flags,u|=m.matchedQueryIds,m.element){var g=m.element;g.publicProviders=l?l.element.publicProviders:Object.create(null),g.allProviders=g.publicProviders,p=!1,h=!1,m.element.template&&(u|=m.element.template.nodeMatchedQueries)}if(na(l,m,e.length),o+=m.bindings.length,i+=m.outputs.length,!c&&3&m.flags&&(f=m),20224&m.flags){p||(p=!0,l.element.publicProviders=Object.create(l.element.publicProviders),l.element.allProviders=l.element.publicProviders);var v=0!=(32768&m.flags);0==(8192&m.flags)||v?l.element.publicProviders[po(m.provider.token)]=m:(h||(h=!0,l.element.allProviders=Object.create(l.element.publicProviders)),l.element.allProviders[po(m.provider.token)]=m),v&&(l.element.componentProvider=m)}if(l?(l.childFlags|=m.flags,l.directChildFlags|=m.flags,l.childMatchedQueries|=m.matchedQueryIds,m.element&&m.element.template&&(l.childMatchedQueries|=m.element.template.nodeMatchedQueries)):s|=m.flags,m.childCount>0)l=m,ea(m)||(c=m);else for(;l&&d===l.nodeIndex+l.childCount;){var y=l.parent;y&&(y.childFlags|=l.childFlags,y.childMatchedQueries|=l.childMatchedQueries),c=(l=y)&&ea(l)?l.renderParent:l}}return{factory:null,nodeFlags:a,rootNodeFlags:s,nodeMatchedQueries:u,flags:t,nodes:e,updateDirectives:n||lo,updateRenderer:r||lo,handleEvent:function(t,n,r,o){return e[n].element.handleEvent(t,r,o)},bindingCount:o,outputCount:i,lastRenderRootNode:f}}function ea(t){return 0!=(1&t.flags)&&null===t.element.name}function na(t,e,n){var r=e.element&&e.element.template;if(r){if(!r.lastRenderRootNode)throw new Error("Illegal State: Embedded templates without nodes are not allowed!");if(r.lastRenderRootNode&&16777216&r.lastRenderRootNode.flags)throw new Error("Illegal State: Last root node of a template can't have embedded views, at index "+e.nodeIndex+"!")}if(20224&e.flags&&0==(1&(t?t.flags:0)))throw new Error("Illegal State: StaticProvider/Directive nodes need to be children of elements or anchors, at index "+e.nodeIndex+"!");if(e.query){if(67108864&e.flags&&(!t||0==(16384&t.flags)))throw new Error("Illegal State: Content Query nodes need to be children of directives, at index "+e.nodeIndex+"!");if(134217728&e.flags&&t)throw new Error("Illegal State: View Query nodes have to be top level nodes, at index "+e.nodeIndex+"!")}if(e.childCount){var o=t?t.nodeIndex+t.childCount:n-1;if(e.nodeIndex<=o&&e.nodeIndex+e.childCount>o)throw new Error("Illegal State: childCount of node leads outside of parent, at index "+e.nodeIndex+"!")}}function ra(t,e,n,r){var o=aa(t.root,t.renderer,t,e,n);return sa(o,t.component,r),ua(o),o}function oa(t,e,n){var r=aa(t,t.renderer,null,null,e);return sa(r,n,n),ua(r),r}function ia(t,e,n,r){var o,i=e.element.componentRendererType;return o=i?t.root.rendererFactory.createRenderer(r,i):t.root.renderer,aa(t.root,o,t,e.element.componentProvider,n)}function aa(t,e,n,r,o){var i=new Array(o.nodes.length),a=o.outputCount?new Array(o.outputCount):null;return{def:o,parent:n,viewContainerParent:null,parentNodeDef:r,context:null,component:null,nodes:i,state:13,root:t,renderer:e,oldValues:new Array(o.bindingCount),disposables:a,initIndex:-1}}function sa(t,e,n){t.component=e,t.context=n}function ua(t){var e;_o(t)&&(e=eo(t.parent,t.parentNodeDef.parent.nodeIndex).renderElement);for(var n=t.def,r=t.nodes,o=0;o<n.nodes.length;o++){var i=n.nodes[o];io.setCurrentNode(t,o);var a=void 0;switch(201347067&i.flags){case 1:var s=Ho(t,e,i),u=void 0;if(33554432&i.flags){var l=Do(i.element.componentView);u=io.createComponentView(t,i,l,s)}qo(t,u,i,s),a={renderElement:s,componentView:u,viewContainer:null,template:i.element.template?di(t,i):void 0},16777216&i.flags&&(a.viewContainer=ci(t,i,a));break;case 2:a=Qi(t,e,i);break;case 512:case 1024:case 2048:case 256:(a=r[o])||4096&i.flags||(a={instance:Oi(t,i)});break;case 16:a={instance:Di(t,i)};break;case 16384:(a=r[o])||(a={instance:Mi(t,i)}),32768&i.flags&&sa(eo(t,i.parent.nodeIndex).componentView,a.instance,a.instance);break;case 32:case 64:case 128:a={value:void 0};break;case 67108864:case 134217728:a=new gr;break;case 8:Zi(t,e,i),a=void 0}r[o]=a}va(t,ga.CreateViewNodes),xa(t,201326592,268435456,0)}function la(t){ha(t),io.updateDirectives(t,1),ya(t,ga.CheckNoChanges),io.updateRenderer(t,1),va(t,ga.CheckNoChanges),t.state&=-97}function ca(t){1&t.state?(t.state&=-2,t.state|=2):t.state&=-3,Qr(t,0,256),ha(t),io.updateDirectives(t,0),ya(t,ga.CheckAndUpdate),xa(t,67108864,536870912,0);var e=Qr(t,256,512);ji(t,2097152|(e?1048576:0)),io.updateRenderer(t,0),va(t,ga.CheckAndUpdate),xa(t,134217728,536870912,0),ji(t,8388608|((e=Qr(t,512,768))?4194304:0)),2&t.def.flags&&(t.state&=-9),t.state&=-97,Qr(t,768,1024)}function pa(t,e,n,r,o,i,a,s,u,l,c,p,f){return 0===n?function(t,e,n,r,o,i,a,s,u,l,c,p){switch(201347067&e.flags){case 1:return function(t,e,n,r,o,i,a,s,u,l,c,p){var h=e.bindings.length,f=!1;return h>0&&Ko(t,e,0,n)&&(f=!0),h>1&&Ko(t,e,1,r)&&(f=!0),h>2&&Ko(t,e,2,o)&&(f=!0),h>3&&Ko(t,e,3,i)&&(f=!0),h>4&&Ko(t,e,4,a)&&(f=!0),h>5&&Ko(t,e,5,s)&&(f=!0),h>6&&Ko(t,e,6,u)&&(f=!0),h>7&&Ko(t,e,7,l)&&(f=!0),h>8&&Ko(t,e,8,c)&&(f=!0),h>9&&Ko(t,e,9,p)&&(f=!0),f}(t,e,n,r,o,i,a,s,u,l,c,p);case 2:return function(t,e,n,r,o,i,a,s,u,l,c,p){var h=!1,f=e.bindings,d=f.length;if(d>0&&yo(t,e,0,n)&&(h=!0),d>1&&yo(t,e,1,r)&&(h=!0),d>2&&yo(t,e,2,o)&&(h=!0),d>3&&yo(t,e,3,i)&&(h=!0),d>4&&yo(t,e,4,a)&&(h=!0),d>5&&yo(t,e,5,s)&&(h=!0),d>6&&yo(t,e,6,u)&&(h=!0),d>7&&yo(t,e,7,l)&&(h=!0),d>8&&yo(t,e,8,c)&&(h=!0),d>9&&yo(t,e,9,p)&&(h=!0),h){var m=e.text.prefix;d>0&&(m+=Ji(n,f[0])),d>1&&(m+=Ji(r,f[1])),d>2&&(m+=Ji(o,f[2])),d>3&&(m+=Ji(i,f[3])),d>4&&(m+=Ji(a,f[4])),d>5&&(m+=Ji(s,f[5])),d>6&&(m+=Ji(u,f[6])),d>7&&(m+=Ji(l,f[7])),d>8&&(m+=Ji(c,f[8])),d>9&&(m+=Ji(p,f[9]));var g=to(t,e.nodeIndex).renderText;t.renderer.setValue(g,m)}return h}(t,e,n,r,o,i,a,s,u,l,c,p);case 16384:return function(t,e,n,r,o,i,a,s,u,l,c,p){var h=no(t,e.nodeIndex),f=h.instance,d=!1,m=void 0,g=e.bindings.length;return g>0&&vo(t,e,0,n)&&(d=!0,m=Vi(t,h,e,0,n,m)),g>1&&vo(t,e,1,r)&&(d=!0,m=Vi(t,h,e,1,r,m)),g>2&&vo(t,e,2,o)&&(d=!0,m=Vi(t,h,e,2,o,m)),g>3&&vo(t,e,3,i)&&(d=!0,m=Vi(t,h,e,3,i,m)),g>4&&vo(t,e,4,a)&&(d=!0,m=Vi(t,h,e,4,a,m)),g>5&&vo(t,e,5,s)&&(d=!0,m=Vi(t,h,e,5,s,m)),g>6&&vo(t,e,6,u)&&(d=!0,m=Vi(t,h,e,6,u,m)),g>7&&vo(t,e,7,l)&&(d=!0,m=Vi(t,h,e,7,l,m)),g>8&&vo(t,e,8,c)&&(d=!0,m=Vi(t,h,e,8,c,m)),g>9&&vo(t,e,9,p)&&(d=!0,m=Vi(t,h,e,9,p,m)),m&&f.ngOnChanges(m),65536&e.flags&&Jr(t,256,e.nodeIndex)&&f.ngOnInit(),262144&e.flags&&f.ngDoCheck(),d}(t,e,n,r,o,i,a,s,u,l,c,p);case 32:case 64:case 128:return function(t,e,n,r,o,i,a,s,u,l,c,p){var h=e.bindings,f=!1,d=h.length;if(d>0&&yo(t,e,0,n)&&(f=!0),d>1&&yo(t,e,1,r)&&(f=!0),d>2&&yo(t,e,2,o)&&(f=!0),d>3&&yo(t,e,3,i)&&(f=!0),d>4&&yo(t,e,4,a)&&(f=!0),d>5&&yo(t,e,5,s)&&(f=!0),d>6&&yo(t,e,6,u)&&(f=!0),d>7&&yo(t,e,7,l)&&(f=!0),d>8&&yo(t,e,8,c)&&(f=!0),d>9&&yo(t,e,9,p)&&(f=!0),f){var m=ro(t,e.nodeIndex),g=void 0;switch(201347067&e.flags){case 32:g=new Array(h.length),d>0&&(g[0]=n),d>1&&(g[1]=r),d>2&&(g[2]=o),d>3&&(g[3]=i),d>4&&(g[4]=a),d>5&&(g[5]=s),d>6&&(g[6]=u),d>7&&(g[7]=l),d>8&&(g[8]=c),d>9&&(g[9]=p);break;case 64:g={},d>0&&(g[h[0].name]=n),d>1&&(g[h[1].name]=r),d>2&&(g[h[2].name]=o),d>3&&(g[h[3].name]=i),d>4&&(g[h[4].name]=a),d>5&&(g[h[5].name]=s),d>6&&(g[h[6].name]=u),d>7&&(g[h[7].name]=l),d>8&&(g[h[8].name]=c),d>9&&(g[h[9].name]=p);break;case 128:var v=n;switch(d){case 1:g=v.transform(n);break;case 2:g=v.transform(r);break;case 3:g=v.transform(r,o);break;case 4:g=v.transform(r,o,i);break;case 5:g=v.transform(r,o,i,a);break;case 6:g=v.transform(r,o,i,a,s);break;case 7:g=v.transform(r,o,i,a,s,u);break;case 8:g=v.transform(r,o,i,a,s,u,l);break;case 9:g=v.transform(r,o,i,a,s,u,l,c);break;case 10:g=v.transform(r,o,i,a,s,u,l,c,p)}}m.value=g}return f}(t,e,n,r,o,i,a,s,u,l,c,p);default:throw"unreachable"}}(t,e,r,o,i,a,s,u,l,c,p,f):function(t,e,n){switch(201347067&e.flags){case 1:return function(t,e,n){for(var r=!1,o=0;o<n.length;o++)Ko(t,e,o,n[o])&&(r=!0);return r}(t,e,n);case 2:return function(t,e,n){for(var r=e.bindings,o=!1,i=0;i<n.length;i++)yo(t,e,i,n[i])&&(o=!0);if(o){var a="";for(i=0;i<n.length;i++)a+=Ji(n[i],r[i]);a=e.text.prefix+a;var s=to(t,e.nodeIndex).renderText;t.renderer.setValue(s,a)}return o}(t,e,n);case 16384:return function(t,e,n){for(var r=no(t,e.nodeIndex),o=r.instance,i=!1,a=void 0,s=0;s<n.length;s++)vo(t,e,s,n[s])&&(i=!0,a=Vi(t,r,e,s,n[s],a));return a&&o.ngOnChanges(a),65536&e.flags&&Jr(t,256,e.nodeIndex)&&o.ngOnInit(),262144&e.flags&&o.ngDoCheck(),i}(t,e,n);case 32:case 64:case 128:return function(t,e,n){for(var r=e.bindings,o=!1,i=0;i<n.length;i++)yo(t,e,i,n[i])&&(o=!0);if(o){var a=ro(t,e.nodeIndex),s=void 0;switch(201347067&e.flags){case 32:s=n;break;case 64:for(s={},i=0;i<n.length;i++)s[r[i].name]=n[i];break;case 128:var u=n[0],l=n.slice(1);s=u.transform.apply(u,h(l))}a.value=s}return o}(t,e,n);default:throw"unreachable"}}(t,e,r)}function ha(t){var e=t.def;if(4&e.nodeFlags)for(var n=0;n<e.nodes.length;n++){var r=e.nodes[n];if(4&r.flags){var o=eo(t,n).template._projectedViews;if(o)for(var i=0;i<o.length;i++){var a=o[i];a.state|=32,xo(a,t)}}else 0==(4&r.childFlags)&&(n+=r.childCount)}}function fa(t,e,n,r,o,i,a,s,u,l,c,p,h){return 0===n?function(t,e,n,r,o,i,a,s,u,l,c,p){var h=e.bindings.length;h>0&&bo(t,e,0,n),h>1&&bo(t,e,1,r),h>2&&bo(t,e,2,o),h>3&&bo(t,e,3,i),h>4&&bo(t,e,4,a),h>5&&bo(t,e,5,s),h>6&&bo(t,e,6,u),h>7&&bo(t,e,7,l),h>8&&bo(t,e,8,c),h>9&&bo(t,e,9,p)}(t,e,r,o,i,a,s,u,l,c,p,h):function(t,e,n){for(var r=0;r<n.length;r++)bo(t,e,r,n[r])}(t,e,r),!1}function da(t,e){if(oo(t,e.nodeIndex).dirty)throw ao(io.createDebugContext(t,e.nodeIndex),"Query "+e.query.id+" not dirty","Query "+e.query.id+" dirty",0!=(1&t.state))}function ma(t){if(!(128&t.state)){if(ya(t,ga.Destroy),va(t,ga.Destroy),ji(t,131072),t.disposables)for(var e=0;e<t.disposables.length;e++)t.disposables[e]();!function(t){if(16&t.state){var e=Co(t);if(e){var n=e.template._projectedViews;n&&(ii(n,n.indexOf(t)),io.dirtyParentQueries(t))}}}(t),t.renderer.destroyNode&&function(t){for(var e=t.def.nodes.length,n=0;n<e;n++){var r=t.def.nodes[n];1&r.flags?t.renderer.destroyNode(eo(t,n).renderElement):2&r.flags?t.renderer.destroyNode(to(t,n).renderText):(67108864&r.flags||134217728&r.flags)&&oo(t,n).destroy()}}(t),_o(t)&&t.renderer.destroy(),t.state|=128}}var ga=function(t){return t[t.CreateViewNodes=0]="CreateViewNodes",t[t.CheckNoChanges=1]="CheckNoChanges",t[t.CheckNoChangesProjectedViews=2]="CheckNoChangesProjectedViews",t[t.CheckAndUpdate=3]="CheckAndUpdate",t[t.CheckAndUpdateProjectedViews=4]="CheckAndUpdateProjectedViews",t[t.Destroy=5]="Destroy",t}({});function va(t,e){var n=t.def;if(33554432&n.nodeFlags)for(var r=0;r<n.nodes.length;r++){var o=n.nodes[r];33554432&o.flags?ba(eo(t,r).componentView,e):0==(33554432&o.childFlags)&&(r+=o.childCount)}}function ya(t,e){var n=t.def;if(16777216&n.nodeFlags)for(var r=0;r<n.nodes.length;r++){var o=n.nodes[r];if(16777216&o.flags)for(var i=eo(t,r).viewContainer._embeddedViews,a=0;a<i.length;a++)ba(i[a],e);else 0==(16777216&o.childFlags)&&(r+=o.childCount)}}function ba(t,e){var n=t.state;switch(e){case ga.CheckNoChanges:0==(128&n)&&(12==(12&n)?la(t):64&n&&wa(t,ga.CheckNoChangesProjectedViews));break;case ga.CheckNoChangesProjectedViews:0==(128&n)&&(32&n?la(t):64&n&&wa(t,e));break;case ga.CheckAndUpdate:0==(128&n)&&(12==(12&n)?ca(t):64&n&&wa(t,ga.CheckAndUpdateProjectedViews));break;case ga.CheckAndUpdateProjectedViews:0==(128&n)&&(32&n?ca(t):64&n&&wa(t,e));break;case ga.Destroy:ma(t);break;case ga.CreateViewNodes:ua(t)}}function wa(t,e){ya(t,e),va(t,e)}function xa(t,e,n,r){if(t.def.nodeFlags&e&&t.def.nodeFlags&n)for(var o=t.def.nodes.length,i=0;i<o;i++){var a=t.def.nodes[i];if(a.flags&e&&a.flags&n)switch(io.setCurrentNode(t,a.nodeIndex),r){case 0:Ki(t,a);break;case 1:da(t,a)}a.childFlags&e&&a.childFlags&n||(i+=a.childCount)}}var Sa=!1;function Ca(t,e,n,r,o,i){var a=o.injector.get(Pe);return oa(Na(t,o,a,e,n),r,i)}function Ea(t,e,n,r,o,i){var a=o.injector.get(Pe),s=Na(t,o,new rs(a),e,n),u=Pa(r);return es(Ha.create,oa,null,[s,u,i])}function Na(t,e,n,r,o){var i=e.injector.get(Ue),a=e.injector.get(Nn),s=n.createRenderer(null,null);return{ngModule:e,injector:t,projectableNodes:r,selectorOrNode:o,sanitizer:i,rendererFactory:n,renderer:s,errorHandler:a}}function _a(t,e,n,r){var o=Pa(n);return es(Ha.create,ra,null,[t,e,o,r])}function Ia(t,e,n,r){return n=Ra.get(e.element.componentProvider.provider.token)||Pa(n),es(Ha.create,ia,null,[t,e,n,r])}function Ta(t,e,n,r){return wi(t,e,n,function(t){var e=function(t){var e=!1,n=!1;return 0===Aa.size?{hasOverrides:e,hasDeprecatedOverrides:n}:(t.providers.forEach(function(t){var r=Aa.get(t.token);3840&t.flags&&r&&(e=!0,n=n||r.deprecatedBehavior)}),t.modules.forEach(function(t){ka.forEach(function(r,o){St(o).providedIn===t&&(e=!0,n=n||r.deprecatedBehavior)})}),{hasOverrides:e,hasDeprecatedOverrides:n})}(t),n=e.hasDeprecatedOverrides;return e.hasOverrides?(function(t){for(var e=0;e<t.providers.length;e++){var r=t.providers[e];n&&(r.flags|=4096);var o=Aa.get(r.token);o&&(r.flags=-3841&r.flags|o.flags,r.deps=ko(o.deps),r.value=o.value)}if(ka.size>0){var i=new Set(t.modules);ka.forEach(function(e,r){if(i.has(St(r).providedIn)){var o={token:r,flags:e.flags|(n?4096:0),deps:ko(e.deps),value:e.value,index:t.providers.length};t.providers.push(o),t.providersByKey[po(r)]=o}})}}(t=t.factory(function(){return lo})),t):t}(r))}var Aa=new Map,ka=new Map,Ra=new Map;function Oa(t){var e;Aa.set(t.token,t),"function"==typeof t.token&&(e=St(t.token))&&"function"==typeof e.providedIn&&ka.set(t.token,t)}function Da(t,e){var n=Do(e.viewDefFactory),r=Do(n.nodes[0].element.componentView);Ra.set(t,r)}function Ma(){Aa.clear(),ka.clear(),Ra.clear()}function Pa(t){if(0===Aa.size)return t;var e=function(t){for(var e=[],n=null,r=0;r<t.nodes.length;r++){var o=t.nodes[r];1&o.flags&&(n=o),n&&3840&o.flags&&Aa.has(o.provider.token)&&(e.push(n.nodeIndex),n=null)}return e}(t);if(0===e.length)return t;t=t.factory(function(){return lo});for(var n=0;n<e.length;n++)r(t,e[n]);return t;function r(t,e){for(var n=e+1;n<t.nodes.length;n++){var r=t.nodes[n];if(1&r.flags)return;if(3840&r.flags){var o=r.provider,i=Aa.get(o.token);i&&(r.flags=-3841&r.flags|i.flags,o.deps=ko(i.deps),o.value=i.value)}}}}function La(t,e,n,r,o,i,a,s,u,l,c,p,h){var f=t.def.nodes[e];return pa(t,f,n,r,o,i,a,s,u,l,c,p,h),224&f.flags?ro(t,e).value:void 0}function Fa(t,e,n,r,o,i,a,s,u,l,c,p,h){var f=t.def.nodes[e];return fa(t,f,n,r,o,i,a,s,u,l,c,p,h),224&f.flags?ro(t,e).value:void 0}function za(t){return es(Ha.detectChanges,ca,null,[t])}function Ba(t){return es(Ha.checkNoChanges,la,null,[t])}function Ua(t){return es(Ha.destroy,ma,null,[t])}var Va,ja,Wa,Ha=function(t){return t[t.create=0]="create",t[t.detectChanges=1]="detectChanges",t[t.checkNoChanges=2]="checkNoChanges",t[t.destroy=3]="destroy",t[t.handleEvent=4]="handleEvent",t}({});function qa(t,e){ja=t,Wa=e}function Ga(t,e,n,r){return qa(t,e),es(Ha.handleEvent,t.def.handleEvent,null,[t,e,n,r])}function Ka(t,e){if(128&t.state)throw uo(Ha[Va]);return qa(t,Ya(t,0)),t.def.updateDirectives(function(t,n,r){for(var o=[],i=3;i<arguments.length;i++)o[i-3]=arguments[i];var a=t.def.nodes[n];return 0===e?Xa(t,a,r,o):Za(t,a,r,o),16384&a.flags&&qa(t,Ya(t,n)),224&a.flags?ro(t,a.nodeIndex).value:void 0},t)}function $a(t,e){if(128&t.state)throw uo(Ha[Va]);return qa(t,Qa(t,0)),t.def.updateRenderer(function(t,n,r){for(var o=[],i=3;i<arguments.length;i++)o[i-3]=arguments[i];var a=t.def.nodes[n];return 0===e?Xa(t,a,r,o):Za(t,a,r,o),3&a.flags&&qa(t,Qa(t,n)),224&a.flags?ro(t,a.nodeIndex).value:void 0},t)}function Xa(t,e,n,r){if(pa.apply(void 0,h([t,e,n],r))){var o=1===n?r[0]:r;if(16384&e.flags){for(var i={},a=0;a<e.bindings.length;a++){var s=e.bindings[a],u=o[a];8&s.flags&&(i[(f=s.nonMinifiedName,"ng-reflect-"+f.replace(/[$@]/g,"_").replace(Xt,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"-"+t[1].toLowerCase()}))]=Zt(u))}var l=e.parent,c=eo(t,l.nodeIndex).renderElement;if(l.element.name)for(var p in i)null!=(u=i[p])?t.renderer.setAttribute(c,p,u):t.renderer.removeAttribute(c,p);else t.renderer.setValue(c,"bindings="+JSON.stringify(i,null,2))}}var f}function Za(t,e,n,r){fa.apply(void 0,h([t,e,n],r))}function Ya(t,e){for(var n=e;n<t.def.nodes.length;n++){var r=t.def.nodes[n];if(16384&r.flags&&r.bindings&&r.bindings.length)return n}return null}function Qa(t,e){for(var n=e;n<t.def.nodes.length;n++){var r=t.def.nodes[n];if(3&r.flags&&r.bindings&&r.bindings.length)return n}return null}var Ja=function(){function t(t,e){this.view=t,this.nodeIndex=e,null==e&&(this.nodeIndex=e=0),this.nodeDef=t.def.nodes[e];for(var n=this.nodeDef,r=t;n&&0==(1&n.flags);)n=n.parent;if(!n)for(;!n&&r;)n=Eo(r),r=r.parent;this.elDef=n,this.elView=r}return Object.defineProperty(t.prototype,"elOrCompView",{get:function(){return eo(this.elView,this.elDef.nodeIndex).componentView||this.view},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"injector",{get:function(){return gi(this.elView,this.elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"component",{get:function(){return this.elOrCompView.component},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this.elOrCompView.context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"providerTokens",{get:function(){var t=[];if(this.elDef)for(var e=this.elDef.nodeIndex+1;e<=this.elDef.nodeIndex+this.elDef.childCount;e++){var n=this.elView.def.nodes[e];20224&n.flags&&t.push(n.provider.token),e+=n.childCount}return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"references",{get:function(){var t={};if(this.elDef){ts(this.elView,this.elDef,t);for(var e=this.elDef.nodeIndex+1;e<=this.elDef.nodeIndex+this.elDef.childCount;e++){var n=this.elView.def.nodes[e];20224&n.flags&&ts(this.elView,n,t),e+=n.childCount}}return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"componentRenderElement",{get:function(){var t=function(t){for(;t&&!_o(t);)t=t.parent;return t.parent?eo(t.parent,Eo(t).nodeIndex):null}(this.elOrCompView);return t?t.renderElement:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderNode",{get:function(){return 2&this.nodeDef.flags?No(this.view,this.nodeDef):No(this.elView,this.elDef)},enumerable:!0,configurable:!0}),t.prototype.logError=function(t){for(var e,n,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];2&this.nodeDef.flags?(e=this.view.def,n=this.nodeDef.nodeIndex):(e=this.elView.def,n=this.elDef.nodeIndex);var i=function(t,e){for(var n=-1,r=0;r<=e;r++)3&t.nodes[r].flags&&n++;return n}(e,n),a=-1;e.factory(function(){var e;return++a===i?(e=t.error).bind.apply(e,h([t],r)):lo}),a<i&&(t.error("Illegal state: the ViewDefinitionFactory did not call the logger!"),t.error.apply(t,h(r)))},t}();function ts(t,e,n){for(var r in e.references)n[r]=Xi(t,e,e.references[r])}function es(t,e,n,r){var o=Va,i=ja,a=Wa;try{Va=t;var s=e.apply(n,r);return ja=i,Wa=a,Va=o,s}catch($f){if(Sn($f)||!ja)throw $f;throw function(t,e){return t instanceof Error||(t=new Error(t.toString())),so(t,e),t}($f,ns())}}function ns(){return ja?new Ja(ja,Wa):null}var rs=function(){function t(t){this.delegate=t}return t.prototype.createRenderer=function(t,e){return new os(this.delegate.createRenderer(t,e))},t.prototype.begin=function(){this.delegate.begin&&this.delegate.begin()},t.prototype.end=function(){this.delegate.end&&this.delegate.end()},t.prototype.whenRenderingDone=function(){return this.delegate.whenRenderingDone?this.delegate.whenRenderingDone():Promise.resolve(null)},t}(),os=function(){function t(t){this.delegate=t,this.debugContextFactory=ns,this.data=this.delegate.data}return t.prototype.createDebugContext=function(t){return this.debugContextFactory(t)},t.prototype.destroyNode=function(t){!function(t){Tr.delete(t.nativeNode)}(Ar(t)),this.delegate.destroyNode&&this.delegate.destroyNode(t)},t.prototype.destroy=function(){this.delegate.destroy()},t.prototype.createElement=function(t,e){var n=this.delegate.createElement(t,e),r=this.createDebugContext(n);if(r){var o=new Ir(n,null,r);o.name=t,kr(o)}return n},t.prototype.createComment=function(t){var e=this.delegate.createComment(t),n=this.createDebugContext(e);return n&&kr(new _r(e,null,n)),e},t.prototype.createText=function(t){var e=this.delegate.createText(t),n=this.createDebugContext(e);return n&&kr(new _r(e,null,n)),e},t.prototype.appendChild=function(t,e){var n=Ar(t),r=Ar(e);n&&r&&n instanceof Ir&&n.addChild(r),this.delegate.appendChild(t,e)},t.prototype.insertBefore=function(t,e,n){var r=Ar(t),o=Ar(e),i=Ar(n);r&&o&&r instanceof Ir&&r.insertBefore(i,o),this.delegate.insertBefore(t,e,n)},t.prototype.removeChild=function(t,e){var n=Ar(t),r=Ar(e);n&&r&&n instanceof Ir&&n.removeChild(r),this.delegate.removeChild(t,e)},t.prototype.selectRootElement=function(t,e){var n=this.delegate.selectRootElement(t,e),r=ns();return r&&kr(new Ir(n,null,r)),n},t.prototype.setAttribute=function(t,e,n,r){var o=Ar(t);o&&o instanceof Ir&&(o.attributes[r?r+":"+e:e]=n),this.delegate.setAttribute(t,e,n,r)},t.prototype.removeAttribute=function(t,e,n){var r=Ar(t);r&&r instanceof Ir&&(r.attributes[n?n+":"+e:e]=null),this.delegate.removeAttribute(t,e,n)},t.prototype.addClass=function(t,e){var n=Ar(t);n&&n instanceof Ir&&(n.classes[e]=!0),this.delegate.addClass(t,e)},t.prototype.removeClass=function(t,e){var n=Ar(t);n&&n instanceof Ir&&(n.classes[e]=!1),this.delegate.removeClass(t,e)},t.prototype.setStyle=function(t,e,n,r){var o=Ar(t);o&&o instanceof Ir&&(o.styles[e]=n),this.delegate.setStyle(t,e,n,r)},t.prototype.removeStyle=function(t,e,n){var r=Ar(t);r&&r instanceof Ir&&(r.styles[e]=null),this.delegate.removeStyle(t,e,n)},t.prototype.setProperty=function(t,e,n){var r=Ar(t);r&&r instanceof Ir&&(r.properties[e]=n),this.delegate.setProperty(t,e,n)},t.prototype.listen=function(t,e,n){if("string"!=typeof t){var r=Ar(t);r&&r.listeners.push(new Nr(e,n))}return this.delegate.listen(t,e,n)},t.prototype.parentNode=function(t){return this.delegate.parentNode(t)},t.prototype.nextSibling=function(t){return this.delegate.nextSibling(t)},t.prototype.setValue=function(t,e){return this.delegate.setValue(t,e)},t}();function is(t,e,n){return new as(t,e,n)}var as=function(t){function e(e,n,r){var o=t.call(this)||this;return o.moduleType=e,o._bootstrapComponents=n,o._ngModuleDefFactory=r,o}return o(e,t),e.prototype.create=function(t){!function(){if(!Sa){Sa=!0;var t=He()?{setCurrentNode:qa,createRootView:Ea,createEmbeddedView:_a,createComponentView:Ia,createNgModuleRef:Ta,overrideProvider:Oa,overrideComponentView:Da,clearOverrides:Ma,checkAndUpdateView:za,checkNoChangesView:Ba,destroyView:Ua,createDebugContext:function(t,e){return new Ja(t,e)},handleEvent:Ga,updateDirectives:Ka,updateRenderer:$a}:{setCurrentNode:function(){},createRootView:Ca,createEmbeddedView:ra,createComponentView:ia,createNgModuleRef:wi,overrideProvider:lo,overrideComponentView:lo,clearOverrides:lo,checkAndUpdateView:ca,checkNoChangesView:la,destroyView:ma,createDebugContext:function(t,e){return new Ja(t,e)},handleEvent:function(t,e,n,r){return t.def.handleEvent(t,e,n,r)},updateDirectives:function(t,e){return t.def.updateDirectives(0===e?La:Fa,t)},updateRenderer:function(t,e){return t.def.updateRenderer(0===e?La:Fa,t)}};io.setCurrentNode=t.setCurrentNode,io.createRootView=t.createRootView,io.createEmbeddedView=t.createEmbeddedView,io.createComponentView=t.createComponentView,io.createNgModuleRef=t.createNgModuleRef,io.overrideProvider=t.overrideProvider,io.overrideComponentView=t.overrideComponentView,io.clearOverrides=t.clearOverrides,io.checkAndUpdateView=t.checkAndUpdateView,io.checkNoChangesView=t.checkNoChangesView,io.destroyView=t.destroyView,io.resolveDep=Bi,io.createDebugContext=t.createDebugContext,io.handleEvent=t.handleEvent,io.updateDirectives=t.updateDirectives,io.updateRenderer=t.updateRenderer,io.dirtyParentQueries=Gi}}();var e=function(t){var e=Array.from(t.providers),n=Array.from(t.modules),r={};for(var o in t.providersByKey)r[o]=t.providersByKey[o];return{factory:t.factory,isRoot:t.isRoot,providers:e,modules:n,providersByKey:r}}(Do(this._ngModuleDefFactory));return io.createNgModuleRef(this.moduleType,t||se.NULL,this._bootstrapComponents,e)},e}(Re),ss=function(){return function(){}}(),us=function(){function t(){}return t.getAvailableVideoInputs=function(){return navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?new Promise(function(t,e){navigator.mediaDevices.enumerateDevices().then(function(e){t(e.filter(function(t){return"videoinput"===t.kind}))}).catch(function(t){e(t.message||t)})}):Promise.reject("enumerateDevices() not supported.")},t}(),ls=function(){function t(){this.showWebcam=!0,this.allowCameraSwitch=!0,this.multipleWebcamsAvailable=!1,this.videoOptions={},this.errors=[],this.webcamImage=null,this.trigger=new V,this.nextWebcam=new V}return t.prototype.ngOnInit=function(){var t=this;us.getAvailableVideoInputs().then(function(e){t.multipleWebcamsAvailable=e&&e.length>1})},t.prototype.triggerSnapshot=function(){this.trigger.next()},t.prototype.toggleWebcam=function(){this.showWebcam=!this.showWebcam},t.prototype.handleInitError=function(t){this.errors.push(t)},t.prototype.showNextWebcam=function(t){this.nextWebcam.next(t)},t.prototype.handleImage=function(t){console.log("received webcam image",t),this.webcamImage=t},t.prototype.cameraWasSwitched=function(t){console.log("active device: "+t),this.deviceId=t},Object.defineProperty(t.prototype,"triggerObservable",{get:function(){return this.trigger.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextWebcamObservable",{get:function(){return this.nextWebcam.asObservable()},enumerable:!0,configurable:!0}),t}(),cs=function(){return function(){}}(),ps=new Ct("Location Initialized"),hs=function(){return function(){}}(),fs=new Ct("appBaseHref"),ds=function(){function t(t){var n=this;this._subject=new fn,this._platformStrategy=t;var r=this._platformStrategy.getBaseHref();this._baseHref=e.stripTrailingSlash(ms(r)),this._platformStrategy.onPopState(function(t){n._subject.emit({url:n.path(!0),pop:!0,state:t.state,type:t.type})})}var e;return e=t,t.prototype.path=function(t){return void 0===t&&(t=!1),this.normalize(this._platformStrategy.path(t))},t.prototype.isCurrentPathEqualTo=function(t,n){return void 0===n&&(n=""),this.path()==this.normalize(t+e.normalizeQueryParams(n))},t.prototype.normalize=function(t){return e.stripTrailingSlash(function(t,e){return t&&e.startsWith(t)?e.substring(t.length):e}(this._baseHref,ms(t)))},t.prototype.prepareExternalUrl=function(t){return t&&"/"!==t[0]&&(t="/"+t),this._platformStrategy.prepareExternalUrl(t)},t.prototype.go=function(t,e,n){void 0===e&&(e=""),void 0===n&&(n=null),this._platformStrategy.pushState(n,"",t,e)},t.prototype.replaceState=function(t,e,n){void 0===e&&(e=""),void 0===n&&(n=null),this._platformStrategy.replaceState(n,"",t,e)},t.prototype.forward=function(){this._platformStrategy.forward()},t.prototype.back=function(){this._platformStrategy.back()},t.prototype.subscribe=function(t,e,n){return this._subject.subscribe({next:t,error:e,complete:n})},t.normalizeQueryParams=function(t){return t&&"?"!==t[0]?"?"+t:t},t.joinWithSlash=function(t,e){if(0==t.length)return e;if(0==e.length)return t;var n=0;return t.endsWith("/")&&n++,e.startsWith("/")&&n++,2==n?t+e.substring(1):1==n?t+e:t+"/"+e},t.stripTrailingSlash=function(t){var e=t.match(/#|\?|$/),n=e&&e.index||t.length;return t.slice(0,n-("/"===t[n-1]?1:0))+t.slice(n)},t}();function ms(t){return t.replace(/\/index.html$/,"")}var gs=function(t){function e(e,n){var r=t.call(this)||this;return r._platformLocation=e,r._baseHref="",null!=n&&(r._baseHref=n),r}return o(e,t),e.prototype.onPopState=function(t){this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t)},e.prototype.getBaseHref=function(){return this._baseHref},e.prototype.path=function(t){void 0===t&&(t=!1);var e=this._platformLocation.hash;return null==e&&(e="#"),e.length>0?e.substring(1):e},e.prototype.prepareExternalUrl=function(t){var e=ds.joinWithSlash(this._baseHref,t);return e.length>0?"#"+e:e},e.prototype.pushState=function(t,e,n,r){var o=this.prepareExternalUrl(n+ds.normalizeQueryParams(r));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.pushState(t,e,o)},e.prototype.replaceState=function(t,e,n,r){var o=this.prepareExternalUrl(n+ds.normalizeQueryParams(r));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.replaceState(t,e,o)},e.prototype.forward=function(){this._platformLocation.forward()},e.prototype.back=function(){this._platformLocation.back()},e}(hs),vs=function(t){function e(e,n){var r=t.call(this)||this;if(r._platformLocation=e,null==n&&(n=r._platformLocation.getBaseHrefFromDOM()),null==n)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");return r._baseHref=n,r}return o(e,t),e.prototype.onPopState=function(t){this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t)},e.prototype.getBaseHref=function(){return this._baseHref},e.prototype.prepareExternalUrl=function(t){return ds.joinWithSlash(this._baseHref,t)},e.prototype.path=function(t){void 0===t&&(t=!1);var e=this._platformLocation.pathname+ds.normalizeQueryParams(this._platformLocation.search),n=this._platformLocation.hash;return n&&t?""+e+n:e},e.prototype.pushState=function(t,e,n,r){var o=this.prepareExternalUrl(n+ds.normalizeQueryParams(r));this._platformLocation.pushState(t,e,o)},e.prototype.replaceState=function(t,e,n,r){var o=this.prepareExternalUrl(n+ds.normalizeQueryParams(r));this._platformLocation.replaceState(t,e,o)},e.prototype.forward=function(){this._platformLocation.forward()},e.prototype.back=function(){this._platformLocation.back()},e}(hs),ys=["en",[["a","p"],["AM","PM"],void 0],[["AM","PM"],void 0,void 0],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],void 0,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],void 0,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",void 0,"{1} 'at' {0}",void 0],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"$","US Dollar",{},function(t){var e=Math.floor(Math.abs(t)),n=t.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===n?1:5}],bs={},ws=function(t){return t[t.Zero=0]="Zero",t[t.One=1]="One",t[t.Two=2]="Two",t[t.Few=3]="Few",t[t.Many=4]="Many",t[t.Other=5]="Other",t}({}),xs=new Ct("UseV4Plurals"),Ss=function(){return function(){}}(),Cs=function(t){function e(e,n){var r=t.call(this)||this;return r.locale=e,r.deprecatedPluralFn=n,r}return o(e,t),e.prototype.getPluralCategory=function(t,e){switch(this.deprecatedPluralFn?this.deprecatedPluralFn(e||this.locale,t):function(t){return function(t){var e=t.toLowerCase().replace(/_/g,"-"),n=bs[e];if(n)return n;var r=e.split("-")[0];if(n=bs[r])return n;if("en"===r)return ys;throw new Error('Missing locale data for the locale "'+t+'".')}(t)[18]}(e||this.locale)(t)){case ws.Zero:return"zero";case ws.One:return"one";case ws.Two:return"two";case ws.Few:return"few";case ws.Many:return"many";default:return"other"}},e}(Ss),Es=function(){function t(t,e,n,r){this.$implicit=t,this.ngForOf=e,this.index=n,this.count=r}return Object.defineProperty(t.prototype,"first",{get:function(){return 0===this.index},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"last",{get:function(){return this.index===this.count-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"even",{get:function(){return this.index%2==0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"odd",{get:function(){return!this.even},enumerable:!0,configurable:!0}),t}(),Ns=function(){function t(t,e,n){this._viewContainer=t,this._template=e,this._differs=n,this._ngForOfDirty=!0,this._differ=null}return Object.defineProperty(t.prototype,"ngForOf",{set:function(t){this._ngForOf=t,this._ngForOfDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ngForTrackBy",{get:function(){return this._trackByFn},set:function(t){He()&&null!=t&&"function"!=typeof t&&console&&console.warn&&console.warn("trackBy must be a function, but received "+JSON.stringify(t)+". See https://angular.io/docs/ts/latest/api/common/index/NgFor-directive.html#!#change-propagation for more information."),this._trackByFn=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ngForTemplate",{set:function(t){t&&(this._template=t)},enumerable:!0,configurable:!0}),t.prototype.ngDoCheck=function(){if(this._ngForOfDirty){this._ngForOfDirty=!1;var t=this._ngForOf;if(!this._differ&&t)try{this._differ=this._differs.find(t).create(this.ngForTrackBy)}catch(r){throw new Error("Cannot find a differ supporting object '"+t+"' of type '"+((e=t).name||typeof e)+"'. NgFor only supports binding to Iterables such as Arrays.")}}var e;if(this._differ){var n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}},t.prototype._applyChanges=function(t){var e=this,n=[];t.forEachOperation(function(t,r,o){if(null==t.previousIndex){var i=e._viewContainer.createEmbeddedView(e._template,new Es(null,e._ngForOf,-1,-1),o),a=new _s(t,i);n.push(a)}else null==o?e._viewContainer.remove(r):(i=e._viewContainer.get(r),e._viewContainer.move(i,o),a=new _s(t,i),n.push(a))});for(var r=0;r<n.length;r++)this._perViewChange(n[r].view,n[r].record);r=0;for(var o=this._viewContainer.length;r<o;r++){var i=this._viewContainer.get(r);i.context.index=r,i.context.count=o,i.context.ngForOf=this._ngForOf}t.forEachIdentityChange(function(t){e._viewContainer.get(t.currentIndex).context.$implicit=t.item})},t.prototype._perViewChange=function(t,e){t.context.$implicit=e.item},t.ngTemplateContextGuard=function(t,e){return!0},t}(),_s=function(){return function(t,e){this.record=t,this.view=e}}(),Is=function(){function t(t,e){this._viewContainer=t,this._context=new Ts,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=e}return Object.defineProperty(t.prototype,"ngIf",{set:function(t){this._context.$implicit=this._context.ngIf=t,this._updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ngIfThen",{set:function(t){As("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ngIfElse",{set:function(t){As("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()},enumerable:!0,configurable:!0}),t.prototype._updateView=function(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))},t.ngTemplateGuard_ngIf=function(t,e){return!0},t}(),Ts=function(){return function(){this.$implicit=null,this.ngIf=null}}();function As(t,e){if(e&&!e.createEmbeddedView)throw new Error(t+" must be a TemplateRef, but received '"+Pt(e)+"'.")}var ks=function(){function t(){}return t.prototype.transform=function(t){return JSON.stringify(t,null,2)},t}(),Rs=function(){return function(){}}(),Os=new Ct("DocumentToken"),Ds="server",Ms=function(){function t(){}return t.ngInjectableDef=xt({providedIn:"root",factory:function(){return new Ps($t(Os),window)}}),t}(),Ps=function(){function t(t,e){this.document=t,this.window=e,this.offset=function(){return[0,0]}}return t.prototype.setOffset=function(t){this.offset=Array.isArray(t)?function(){return t}:t},t.prototype.getScrollPosition=function(){return this.supportScrollRestoration()?[this.window.scrollX,this.window.scrollY]:[0,0]},t.prototype.scrollToPosition=function(t){this.supportScrollRestoration()&&this.window.scrollTo(t[0],t[1])},t.prototype.scrollToAnchor=function(t){if(this.supportScrollRestoration()){var e=this.document.querySelector("#"+t);if(e)return void this.scrollToElement(e);var n=this.document.querySelector("[name='"+t+"']");if(n)return void this.scrollToElement(n)}},t.prototype.setHistoryScrollRestoration=function(t){if(this.supportScrollRestoration()){var e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}},t.prototype.scrollToElement=function(t){var e=t.getBoundingClientRect(),n=e.left+this.window.pageXOffset,r=e.top+this.window.pageYOffset,o=this.offset();this.window.scrollTo(n-o[0],r-o[1])},t.prototype.supportScrollRestoration=function(){try{return!!this.window&&!!this.window.scrollTo}catch(t){return!1}},t}(),Ls=new P(function(t){return t.complete()});function Fs(t){return t?function(t){return new P(function(e){return t.schedule(function(){return e.complete()})})}(t):Ls}function zs(t){var e=new P(function(e){e.next(t),e.complete()});return e._isScalar=!0,e.value=t,e}function Bs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];switch(W(n)?t.pop():n=void 0,t.length){case 0:return Fs(n);case 1:return n?it(t,n):zs(t[0]);default:return it(t,n)}}var Us=function(t){function e(e){var n=t.call(this)||this;return n._value=e,n}return o(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return n&&!n.closed&&e.next(this._value),n},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new z;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(V);function Vs(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}Vs.prototype=Object.create(Error.prototype);var js=Vs,Ws={},Hs=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new qs(t,this.resultSelector))},t}(),qs=function(t){function e(e,n){var r=t.call(this,e)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return o(e,t),e.prototype._next=function(t){this.values.push(Ws),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var n=0;n<e;n++){var r=t[n];this.add(tt(this,r,r,n))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,n,r,o){var i=this.values,a=this.toRespond?i[n]===Ws?--this.toRespond:this.toRespond:0;i[n]=e,0===a&&(this.resultSelector?this._tryResultSelector(i):this.destination.next(i.slice()))},e.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(n){return void this.destination.error(n)}this.destination.next(e)},e}(et);function Gs(t){return new P(function(e){var n;try{n=t()}catch(r){return void e.error(r)}return(n?at(n):Fs()).subscribe(e)})}function Ks(){return pt(1)}function $s(t,e){return function(n){return n.lift(new Xs(t,e))}}var Xs=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new Zs(t,this.predicate,this.thisArg))},t}(),Zs=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.predicate=n,o.thisArg=r,o.count=0,o}return o(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}e&&this.destination.next(t)},e}(A);function Ys(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}Ys.prototype=Object.create(Error.prototype);var Qs=Ys;function Js(t){return function(e){return 0===t?Fs():e.lift(new tu(t))}}var tu=function(){function t(t){if(this.total=t,this.total<0)throw new Qs}return t.prototype.call=function(t,e){return e.subscribe(new eu(t,this.total))},t}(),eu=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.ring=new Array,r.count=0,r}return o(e,t),e.prototype._next=function(t){var e=this.ring,n=this.total,r=this.count++;e.length<n?e.push(t):e[r%n]=t},e.prototype._complete=function(){var t=this.destination,e=this.count;if(e>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,o=0;o<n;o++){var i=e++%n;t.next(r[i])}t.complete()},e}(A);function nu(t,e,n){return function(r){return r.lift(new ru(t,e,n))}}var ru=function(){function t(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}return t.prototype.call=function(t,e){return e.subscribe(new ou(t,this.nextOrObserver,this.error,this.complete))},t}(),ou=function(t){function e(e,n,r,o){var i=t.call(this,e)||this;return i._tapNext=O,i._tapError=O,i._tapComplete=O,i._tapError=r||O,i._tapComplete=o||O,m(n)?(i._context=i,i._tapNext=n):n&&(i._context=n,i._tapNext=n.next||O,i._tapError=n.error||O,i._tapComplete=n.complete||O),i}return o(e,t),e.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.next(t)},e.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},e}(A),iu=function(t){return void 0===t&&(t=au),nu({hasValue:!1,next:function(){this.hasValue=!0},complete:function(){if(!this.hasValue)throw t()}})};function au(){return new js}function su(t){return void 0===t&&(t=null),function(e){return e.lift(new uu(t))}}var uu=function(){function t(t){this.defaultValue=t}return t.prototype.call=function(t,e){return e.subscribe(new lu(t,this.defaultValue))},t}(),lu=function(t){function e(e,n){var r=t.call(this,e)||this;return r.defaultValue=n,r.isEmpty=!0,r}return o(e,t),e.prototype._next=function(t){this.isEmpty=!1,this.destination.next(t)},e.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},e}(A);function cu(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?$s(function(e,n){return t(e,n,r)}):ct,Js(1),n?su(e):iu(function(){return new js}))}}function pu(t){return function(e){var n=new hu(t),r=e.lift(n);return n.caught=r}}var hu=function(){function t(t){this.selector=t}return t.prototype.call=function(t,e){return e.subscribe(new fu(t,this.selector,this.caught))},t}(),fu=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.selector=n,o.caught=r,o}return o(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=void 0;try{n=this.selector(e,this.caught)}catch(o){return void t.prototype.error.call(this,o)}this._unsubscribeAndRecycle();var r=new H(this,void 0,void 0);this.add(r),tt(this,n,void 0,void 0,r)}},e}(et);function du(t){return function(e){return 0===t?Fs():e.lift(new mu(t))}}var mu=function(){function t(t){if(this.total=t,this.total<0)throw new Qs}return t.prototype.call=function(t,e){return e.subscribe(new gu(t,this.total))},t}(),gu=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.count=0,r}return o(e,t),e.prototype._next=function(t){var e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))},e}(A);function vu(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?$s(function(e,n){return t(e,n,r)}):ct,du(1),n?su(e):iu(function(){return new js}))}}var yu=function(){function t(t,e,n){this.predicate=t,this.thisArg=e,this.source=n}return t.prototype.call=function(t,e){return e.subscribe(new bu(t,this.predicate,this.thisArg,this.source))},t}(),bu=function(t){function e(e,n,r,o){var i=t.call(this,e)||this;return i.predicate=n,i.thisArg=r,i.source=o,i.index=0,i.thisArg=r||i,i}return o(e,t),e.prototype.notifyComplete=function(t){this.destination.next(t),this.destination.complete()},e.prototype._next=function(t){var e=!1;try{e=this.predicate.call(this.thisArg,t,this.index++,this.source)}catch(n){return void this.destination.error(n)}e||this.notifyComplete(!1)},e.prototype._complete=function(){this.notifyComplete(!0)},e}(A);function wu(t,e){return"function"==typeof e?function(n){return n.pipe(wu(function(n,r){return at(t(n,r)).pipe(nt(function(t,o){return e(n,t,r,o)}))}))}:function(e){return e.lift(new xu(t))}}var xu=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new Su(t,this.project))},t}(),Su=function(t){function e(e,n){var r=t.call(this,e)||this;return r.project=n,r.index=0,r}return o(e,t),e.prototype._next=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(r){return void this.destination.error(r)}this._innerSub(e,t,n)},e.prototype._innerSub=function(t,e,n){var r=this.innerSubscription;r&&r.unsubscribe();var o=new H(this,void 0,void 0);this.destination.add(o),this.innerSubscription=tt(this,t,e,n,o)},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=null},e.prototype.notifyComplete=function(e){this.destination.remove(e),this.innerSubscription=null,this.isStopped&&t.prototype._complete.call(this)},e.prototype.notifyNext=function(t,e,n,r,o){this.destination.next(e)},e}(et);function Cu(t,e){var n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new Eu(t,e,n))}}var Eu=function(){function t(t,e,n){void 0===n&&(n=!1),this.accumulator=t,this.seed=e,this.hasSeed=n}return t.prototype.call=function(t,e){return e.subscribe(new Nu(t,this.accumulator,this.seed,this.hasSeed))},t}(),Nu=function(t){function e(e,n,r,o){var i=t.call(this,e)||this;return i.accumulator=n,i._seed=r,i.hasSeed=o,i.index=0,i}return o(e,t),Object.defineProperty(e.prototype,"seed",{get:function(){return this._seed},set:function(t){this.hasSeed=!0,this._seed=t},enumerable:!0,configurable:!0}),e.prototype._next=function(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.accumulator(this.seed,t,n)}catch(r){this.destination.error(r)}this.seed=e,this.destination.next(e)},e}(A);function _u(t,e){return st(t,e,1)}var Iu=function(){function t(t){this.callback=t}return t.prototype.call=function(t,e){return e.subscribe(new Tu(t,this.callback))},t}(),Tu=function(t){function e(e,n){var r=t.call(this,e)||this;return r.add(new S(n)),r}return o(e,t),e}(A),Au=null;function ku(){return Au}var Ru,Ou={class:"className",innerHtml:"innerHTML",readonly:"readOnly",tabindex:"tabIndex"},Du={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Mu={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"};At.Node&&(Ru=At.Node.prototype.contains||function(t){return!!(16&this.compareDocumentPosition(t))});var Pu,Lu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.parse=function(t){throw new Error("parse not implemented")},e.makeCurrent=function(){var t;t=new e,Au||(Au=t)},e.prototype.hasProperty=function(t,e){return e in t},e.prototype.setProperty=function(t,e,n){t[e]=n},e.prototype.getProperty=function(t,e){return t[e]},e.prototype.invoke=function(t,e,n){var r;(r=t)[e].apply(r,h(n))},e.prototype.logError=function(t){window.console&&(console.error?console.error(t):console.log(t))},e.prototype.log=function(t){window.console&&window.console.log&&window.console.log(t)},e.prototype.logGroup=function(t){window.console&&window.console.group&&window.console.group(t)},e.prototype.logGroupEnd=function(){window.console&&window.console.groupEnd&&window.console.groupEnd()},Object.defineProperty(e.prototype,"attrToPropMap",{get:function(){return Ou},enumerable:!0,configurable:!0}),e.prototype.contains=function(t,e){return Ru.call(t,e)},e.prototype.querySelector=function(t,e){return t.querySelector(e)},e.prototype.querySelectorAll=function(t,e){return t.querySelectorAll(e)},e.prototype.on=function(t,e,n){t.addEventListener(e,n,!1)},e.prototype.onAndCancel=function(t,e,n){return t.addEventListener(e,n,!1),function(){t.removeEventListener(e,n,!1)}},e.prototype.dispatchEvent=function(t,e){t.dispatchEvent(e)},e.prototype.createMouseEvent=function(t){var e=this.getDefaultDocument().createEvent("MouseEvent");return e.initEvent(t,!0,!0),e},e.prototype.createEvent=function(t){var e=this.getDefaultDocument().createEvent("Event");return e.initEvent(t,!0,!0),e},e.prototype.preventDefault=function(t){t.preventDefault(),t.returnValue=!1},e.prototype.isPrevented=function(t){return t.defaultPrevented||null!=t.returnValue&&!t.returnValue},e.prototype.getInnerHTML=function(t){return t.innerHTML},e.prototype.getTemplateContent=function(t){return"content"in t&&this.isTemplateElement(t)?t.content:null},e.prototype.getOuterHTML=function(t){return t.outerHTML},e.prototype.nodeName=function(t){return t.nodeName},e.prototype.nodeValue=function(t){return t.nodeValue},e.prototype.type=function(t){return t.type},e.prototype.content=function(t){return this.hasProperty(t,"content")?t.content:t},e.prototype.firstChild=function(t){return t.firstChild},e.prototype.nextSibling=function(t){return t.nextSibling},e.prototype.parentElement=function(t){return t.parentNode},e.prototype.childNodes=function(t){return t.childNodes},e.prototype.childNodesAsList=function(t){for(var e=t.childNodes,n=new Array(e.length),r=0;r<e.length;r++)n[r]=e[r];return n},e.prototype.clearNodes=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},e.prototype.appendChild=function(t,e){t.appendChild(e)},e.prototype.removeChild=function(t,e){t.removeChild(e)},e.prototype.replaceChild=function(t,e,n){t.replaceChild(e,n)},e.prototype.remove=function(t){return t.parentNode&&t.parentNode.removeChild(t),t},e.prototype.insertBefore=function(t,e,n){t.insertBefore(n,e)},e.prototype.insertAllBefore=function(t,e,n){n.forEach(function(n){return t.insertBefore(n,e)})},e.prototype.insertAfter=function(t,e,n){t.insertBefore(n,e.nextSibling)},e.prototype.setInnerHTML=function(t,e){t.innerHTML=e},e.prototype.getText=function(t){return t.textContent},e.prototype.setText=function(t,e){t.textContent=e},e.prototype.getValue=function(t){return t.value},e.prototype.setValue=function(t,e){t.value=e},e.prototype.getChecked=function(t){return t.checked},e.prototype.setChecked=function(t,e){t.checked=e},e.prototype.createComment=function(t){return this.getDefaultDocument().createComment(t)},e.prototype.createTemplate=function(t){var e=this.getDefaultDocument().createElement("template");return e.innerHTML=t,e},e.prototype.createElement=function(t,e){return(e=e||this.getDefaultDocument()).createElement(t)},e.prototype.createElementNS=function(t,e,n){return(n=n||this.getDefaultDocument()).createElementNS(t,e)},e.prototype.createTextNode=function(t,e){return(e=e||this.getDefaultDocument()).createTextNode(t)},e.prototype.createScriptTag=function(t,e,n){var r=(n=n||this.getDefaultDocument()).createElement("SCRIPT");return r.setAttribute(t,e),r},e.prototype.createStyleElement=function(t,e){var n=(e=e||this.getDefaultDocument()).createElement("style");return this.appendChild(n,this.createTextNode(t,e)),n},e.prototype.createShadowRoot=function(t){return t.createShadowRoot()},e.prototype.getShadowRoot=function(t){return t.shadowRoot},e.prototype.getHost=function(t){return t.host},e.prototype.clone=function(t){return t.cloneNode(!0)},e.prototype.getElementsByClassName=function(t,e){return t.getElementsByClassName(e)},e.prototype.getElementsByTagName=function(t,e){return t.getElementsByTagName(e)},e.prototype.classList=function(t){return Array.prototype.slice.call(t.classList,0)},e.prototype.addClass=function(t,e){t.classList.add(e)},e.prototype.removeClass=function(t,e){t.classList.remove(e)},e.prototype.hasClass=function(t,e){return t.classList.contains(e)},e.prototype.setStyle=function(t,e,n){t.style[e]=n},e.prototype.removeStyle=function(t,e){t.style[e]=""},e.prototype.getStyle=function(t,e){return t.style[e]},e.prototype.hasStyle=function(t,e,n){var r=this.getStyle(t,e)||"";return n?r==n:r.length>0},e.prototype.tagName=function(t){return t.tagName},e.prototype.attributeMap=function(t){for(var e=new Map,n=t.attributes,r=0;r<n.length;r++){var o=n.item(r);e.set(o.name,o.value)}return e},e.prototype.hasAttribute=function(t,e){return t.hasAttribute(e)},e.prototype.hasAttributeNS=function(t,e,n){return t.hasAttributeNS(e,n)},e.prototype.getAttribute=function(t,e){return t.getAttribute(e)},e.prototype.getAttributeNS=function(t,e,n){return t.getAttributeNS(e,n)},e.prototype.setAttribute=function(t,e,n){t.setAttribute(e,n)},e.prototype.setAttributeNS=function(t,e,n,r){t.setAttributeNS(e,n,r)},e.prototype.removeAttribute=function(t,e){t.removeAttribute(e)},e.prototype.removeAttributeNS=function(t,e,n){t.removeAttributeNS(e,n)},e.prototype.templateAwareRoot=function(t){return this.isTemplateElement(t)?this.content(t):t},e.prototype.createHtmlDocument=function(){return document.implementation.createHTMLDocument("fakeTitle")},e.prototype.getDefaultDocument=function(){return document},e.prototype.getBoundingClientRect=function(t){try{return t.getBoundingClientRect()}catch(e){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}},e.prototype.getTitle=function(t){return t.title},e.prototype.setTitle=function(t,e){t.title=e||""},e.prototype.elementMatches=function(t,e){return!!this.isElementNode(t)&&(t.matches&&t.matches(e)||t.msMatchesSelector&&t.msMatchesSelector(e)||t.webkitMatchesSelector&&t.webkitMatchesSelector(e))},e.prototype.isTemplateElement=function(t){return this.isElementNode(t)&&"TEMPLATE"===t.nodeName},e.prototype.isTextNode=function(t){return t.nodeType===Node.TEXT_NODE},e.prototype.isCommentNode=function(t){return t.nodeType===Node.COMMENT_NODE},e.prototype.isElementNode=function(t){return t.nodeType===Node.ELEMENT_NODE},e.prototype.hasShadowRoot=function(t){return null!=t.shadowRoot&&t instanceof HTMLElement},e.prototype.isShadowRoot=function(t){return t instanceof DocumentFragment},e.prototype.importIntoDoc=function(t){return document.importNode(this.templateAwareRoot(t),!0)},e.prototype.adoptNode=function(t){return document.adoptNode(t)},e.prototype.getHref=function(t){return t.getAttribute("href")},e.prototype.getEventKey=function(t){var e=t.key;if(null==e){if(null==(e=t.keyIdentifier))return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===t.location&&Mu.hasOwnProperty(e)&&(e=Mu[e]))}return Du[e]||e},e.prototype.getGlobalEventTarget=function(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null},e.prototype.getHistory=function(){return window.history},e.prototype.getLocation=function(){return window.location},e.prototype.getBaseHref=function(t){var e,n=Fu||(Fu=document.querySelector("base"))?Fu.getAttribute("href"):null;return null==n?null:(e=n,Pu||(Pu=document.createElement("a")),Pu.setAttribute("href",e),"/"===Pu.pathname.charAt(0)?Pu.pathname:"/"+Pu.pathname)},e.prototype.resetBaseElement=function(){Fu=null},e.prototype.getUserAgent=function(){return window.navigator.userAgent},e.prototype.setData=function(t,e,n){this.setAttribute(t,"data-"+e,n)},e.prototype.getData=function(t,e){return this.getAttribute(t,"data-"+e)},e.prototype.getComputedStyle=function(t){return getComputedStyle(t)},e.prototype.supportsWebAnimation=function(){return"function"==typeof Element.prototype.animate},e.prototype.performanceNow=function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},e.prototype.supportsCookies=function(){return!0},e.prototype.getCookie=function(t){return function(t,e){var n,r;e=encodeURIComponent(e);try{for(var o=c(t.split(";")),i=o.next();!i.done;i=o.next()){var a=i.value,s=a.indexOf("="),u=p(-1==s?[a,""]:[a.slice(0,s),a.slice(s+1)],2),l=u[1];if(u[0].trim()===e)return decodeURIComponent(l)}}catch(h){n={error:h}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return null}(document.cookie,t)},e.prototype.setCookie=function(t,e){document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)},e}(function(t){function e(){var e=t.call(this)||this;e._animationPrefix=null,e._transitionEnd=null;try{var n=e.createElement("div",document);if(null!=e.getStyle(n,"animationName"))e._animationPrefix="";else for(var r=["Webkit","Moz","O","ms"],o=0;o<r.length;o++)if(null!=e.getStyle(n,r[o]+"AnimationName")){e._animationPrefix="-"+r[o].toLowerCase()+"-";break}var i={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};Object.keys(i).forEach(function(t){null!=e.getStyle(n,t)&&(e._transitionEnd=i[t])})}catch(a){e._animationPrefix=null,e._transitionEnd=null}return e}return o(e,t),e.prototype.getDistributedNodes=function(t){return t.getDistributedNodes()},e.prototype.resolveAndSetHref=function(t,e,n){t.href=null==n?e:e+"/../"+n},e.prototype.supportsDOMEvents=function(){return!0},e.prototype.supportsNativeShadowDOM=function(){return"function"==typeof document.body.createShadowRoot},e.prototype.getAnimationPrefix=function(){return this._animationPrefix?this._animationPrefix:""},e.prototype.getTransitionEnd=function(){return this._transitionEnd?this._transitionEnd:""},e.prototype.supportsAnimation=function(){return null!=this._animationPrefix&&null!=this._transitionEnd},e}(function(){function t(){this.resourceLoaderType=null}return Object.defineProperty(t.prototype,"attrToPropMap",{get:function(){return this._attrToPropMap},set:function(t){this._attrToPropMap=t},enumerable:!0,configurable:!0}),t}())),Fu=null,zu=Os;function Bu(){return!!window.history.pushState}var Uu=function(t){function e(e){var n=t.call(this)||this;return n._doc=e,n._init(),n}var n;return o(e,t),e.prototype._init=function(){this.location=ku().getLocation(),this._history=ku().getHistory()},e.prototype.getBaseHrefFromDOM=function(){return ku().getBaseHref(this._doc)},e.prototype.onPopState=function(t){ku().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",t,!1)},e.prototype.onHashChange=function(t){ku().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",t,!1)},Object.defineProperty(e.prototype,"pathname",{get:function(){return this.location.pathname},set:function(t){this.location.pathname=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"search",{get:function(){return this.location.search},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hash",{get:function(){return this.location.hash},enumerable:!0,configurable:!0}),e.prototype.pushState=function(t,e,n){Bu()?this._history.pushState(t,e,n):this.location.hash=n},e.prototype.replaceState=function(t,e,n){Bu()?this._history.replaceState(t,e,n):this.location.hash=n},e.prototype.forward=function(){this._history.forward()},e.prototype.back=function(){this._history.back()},a([(n=Vt(zu),function(t,e){n(t,e,0)}),s("design:paramtypes",[Object])],e)}(cs),Vu=new Ct("TRANSITION_ID"),ju=[{provide:Tn,useFactory:function(t,e,n){return function(){n.get(An).donePromise.then(function(){var n=ku();Array.prototype.slice.apply(n.querySelectorAll(e,"style[ng-transition]")).filter(function(e){return n.getAttribute(e,"ng-transition")===t}).forEach(function(t){return n.remove(t)})})}},deps:[Vu,zu,se],multi:!0}],Wu=function(){function t(){}return t.init=function(){var e;e=new t,sr=e},t.prototype.addToWindow=function(t){At.getAngularTestability=function(e,n){void 0===n&&(n=!0);var r=t.findTestabilityInTree(e,n);if(null==r)throw new Error("Could not find testability for element.");return r},At.getAllAngularTestabilities=function(){return t.getAllTestabilities()},At.getAllAngularRootElements=function(){return t.getAllRootElements()},At.frameworkStabilizers||(At.frameworkStabilizers=[]),At.frameworkStabilizers.push(function(t){var e=At.getAllAngularTestabilities(),n=e.length,r=!1,o=function(e){r=r||e,0==--n&&t(r)};e.forEach(function(t){t.whenStable(o)})})},t.prototype.findTestabilityInTree=function(t,e,n){if(null==e)return null;var r=t.getTestability(e);return null!=r?r:n?ku().isShadowRoot(e)?this.findTestabilityInTree(t,ku().getHost(e),!0):this.findTestabilityInTree(t,ku().parentElement(e),!0):null},t}();function Hu(t,e){"undefined"!=typeof COMPILED&&COMPILED||((At.ng=At.ng||{})[t]=e)}var qu={ApplicationRef:dr,NgZone:Yn};function Gu(t){return Ar(t)}var Ku=new Ct("EventManagerPlugins"),$u=function(){function t(t,e){var n=this;this._zone=e,this._eventNameToPlugin=new Map,t.forEach(function(t){return t.manager=n}),this._plugins=t.slice().reverse()}return t.prototype.addEventListener=function(t,e,n){return this._findPluginFor(e).addEventListener(t,e,n)},t.prototype.addGlobalEventListener=function(t,e,n){return this._findPluginFor(e).addGlobalEventListener(t,e,n)},t.prototype.getZone=function(){return this._zone},t.prototype._findPluginFor=function(t){var e=this._eventNameToPlugin.get(t);if(e)return e;for(var n=this._plugins,r=0;r<n.length;r++){var o=n[r];if(o.supports(t))return this._eventNameToPlugin.set(t,o),o}throw new Error("No event manager plugin found for event "+t)},t}(),Xu=function(){function t(t){this._doc=t}return t.prototype.addGlobalEventListener=function(t,e,n){var r=ku().getGlobalEventTarget(this._doc,t);if(!r)throw new Error("Unsupported event target "+r+" for event "+e);return this.addEventListener(r,e,n)},t}(),Zu=function(){function t(){this._stylesSet=new Set}return t.prototype.addStyles=function(t){var e=this,n=new Set;t.forEach(function(t){e._stylesSet.has(t)||(e._stylesSet.add(t),n.add(t))}),this.onStylesAdded(n)},t.prototype.onStylesAdded=function(t){},t.prototype.getAllStyles=function(){return Array.from(this._stylesSet)},t}(),Yu=function(t){function e(e){var n=t.call(this)||this;return n._doc=e,n._hostNodes=new Set,n._styleNodes=new Set,n._hostNodes.add(e.head),n}return o(e,t),e.prototype._addStylesToHost=function(t,e){var n=this;t.forEach(function(t){var r=n._doc.createElement("style");r.textContent=t,n._styleNodes.add(e.appendChild(r))})},e.prototype.addHost=function(t){this._addStylesToHost(this._stylesSet,t),this._hostNodes.add(t)},e.prototype.removeHost=function(t){this._hostNodes.delete(t)},e.prototype.onStylesAdded=function(t){var e=this;this._hostNodes.forEach(function(n){return e._addStylesToHost(t,n)})},e.prototype.ngOnDestroy=function(){this._styleNodes.forEach(function(t){return ku().remove(t)})},e}(Zu),Qu={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Ju=/%COMP%/g,tl="_nghost-%COMP%",el="_ngcontent-%COMP%";function nl(t,e,n){for(var r=0;r<e.length;r++){var o=e[r];Array.isArray(o)?nl(t,o,n):(o=o.replace(Ju,t),n.push(o))}return n}function rl(t){return function(e){!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}var ol=function(){function t(t,e){this.eventManager=t,this.sharedStylesHost=e,this.rendererByCompId=new Map,this.defaultRenderer=new il(t)}return t.prototype.createRenderer=function(t,e){if(!t||!e)return this.defaultRenderer;switch(e.encapsulation){case Ut.Emulated:var n=this.rendererByCompId.get(e.id);return n||(n=new ll(this.eventManager,this.sharedStylesHost,e),this.rendererByCompId.set(e.id,n)),n.applyToHost(t),n;case Ut.Native:case Ut.ShadowDom:return new cl(this.eventManager,this.sharedStylesHost,t,e);default:if(!this.rendererByCompId.has(e.id)){var r=nl(e.id,e.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(e.id,this.defaultRenderer)}return this.defaultRenderer}},t.prototype.begin=function(){},t.prototype.end=function(){},t}(),il=function(){function t(t){this.eventManager=t,this.data=Object.create(null)}return t.prototype.destroy=function(){},t.prototype.createElement=function(t,e){return e?document.createElementNS(Qu[e],t):document.createElement(t)},t.prototype.createComment=function(t){return document.createComment(t)},t.prototype.createText=function(t){return document.createTextNode(t)},t.prototype.appendChild=function(t,e){t.appendChild(e)},t.prototype.insertBefore=function(t,e,n){t&&t.insertBefore(e,n)},t.prototype.removeChild=function(t,e){t&&t.removeChild(e)},t.prototype.selectRootElement=function(t,e){var n="string"==typeof t?document.querySelector(t):t;if(!n)throw new Error('The selector "'+t+'" did not match any elements');return e||(n.textContent=""),n},t.prototype.parentNode=function(t){return t.parentNode},t.prototype.nextSibling=function(t){return t.nextSibling},t.prototype.setAttribute=function(t,e,n,r){if(r){e=r+":"+e;var o=Qu[r];o?t.setAttributeNS(o,e,n):t.setAttribute(e,n)}else t.setAttribute(e,n)},t.prototype.removeAttribute=function(t,e,n){if(n){var r=Qu[n];r?t.removeAttributeNS(r,e):t.removeAttribute(n+":"+e)}else t.removeAttribute(e)},t.prototype.addClass=function(t,e){t.classList.add(e)},t.prototype.removeClass=function(t,e){t.classList.remove(e)},t.prototype.setStyle=function(t,e,n,r){r&Le.DashCase?t.style.setProperty(e,n,r&Le.Important?"important":""):t.style[e]=n},t.prototype.removeStyle=function(t,e,n){n&Le.DashCase?t.style.removeProperty(e):t.style[e]=""},t.prototype.setProperty=function(t,e,n){sl(e,"property"),t[e]=n},t.prototype.setValue=function(t,e){t.nodeValue=e},t.prototype.listen=function(t,e,n){return sl(e,"listener"),"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,rl(n)):this.eventManager.addEventListener(t,e,rl(n))},t}(),al="@".charCodeAt(0);function sl(t,e){if(t.charCodeAt(0)===al)throw new Error("Found the synthetic "+e+" "+t+'. Please include either "BrowserAnimationsModule" or "NoopAnimationsModule" in your application.')}var ul,ll=function(t){function e(e,n,r){var o=t.call(this,e)||this;o.component=r;var i=nl(r.id,r.styles,[]);return n.addStyles(i),o.contentAttr=el.replace(Ju,r.id),o.hostAttr=tl.replace(Ju,r.id),o}return o(e,t),e.prototype.applyToHost=function(e){t.prototype.setAttribute.call(this,e,this.hostAttr,"")},e.prototype.createElement=function(e,n){var r=t.prototype.createElement.call(this,e,n);return t.prototype.setAttribute.call(this,r,this.contentAttr,""),r},e}(il),cl=function(t){function e(e,n,r,o){var i=t.call(this,e)||this;i.sharedStylesHost=n,i.hostEl=r,i.component=o,i.shadowRoot=o.encapsulation===Ut.ShadowDom?r.attachShadow({mode:"open"}):r.createShadowRoot(),i.sharedStylesHost.addHost(i.shadowRoot);for(var a=nl(o.id,o.styles,[]),s=0;s<a.length;s++){var u=document.createElement("style");u.textContent=a[s],i.shadowRoot.appendChild(u)}return i}return o(e,t),e.prototype.nodeOrShadowRoot=function(t){return t===this.hostEl?this.shadowRoot:t},e.prototype.destroy=function(){this.sharedStylesHost.removeHost(this.shadowRoot)},e.prototype.appendChild=function(e,n){return t.prototype.appendChild.call(this,this.nodeOrShadowRoot(e),n)},e.prototype.insertBefore=function(e,n,r){return t.prototype.insertBefore.call(this,this.nodeOrShadowRoot(e),n,r)},e.prototype.removeChild=function(e,n){return t.prototype.removeChild.call(this,this.nodeOrShadowRoot(e),n)},e.prototype.parentNode=function(e){return this.nodeOrShadowRoot(t.prototype.parentNode.call(this,this.nodeOrShadowRoot(e)))},e}(il),pl="undefined"!=typeof Zone&&Zone.__symbol__||function(t){return"__zone_symbol__"+t},hl=pl("addEventListener"),fl=pl("removeEventListener"),dl={},ml="__zone_symbol__propagationStopped";"undefined"!=typeof Zone&&Zone[pl("BLACK_LISTED_EVENTS")]&&(ul={});var gl=function(t){return!!ul&&ul.hasOwnProperty(t)},vl=function(t){var e=dl[t.type];if(e){var n=this[e];if(n){var r=[t];if(1===n.length)return(a=n[0]).zone!==Zone.current?a.zone.run(a.handler,this,r):a.handler.apply(this,r);for(var o=n.slice(),i=0;i<o.length&&!0!==t[ml];i++){var a;(a=o[i]).zone!==Zone.current?a.zone.run(a.handler,this,r):a.handler.apply(this,r)}}}},yl=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.ngZone=n,r&&function(t){return t===Ds}(r)||o.patchEvent(),o}return o(e,t),e.prototype.patchEvent=function(){if("undefined"!=typeof Event&&Event&&Event.prototype&&!Event.prototype.__zone_symbol__stopImmediatePropagation){var t=Event.prototype.__zone_symbol__stopImmediatePropagation=Event.prototype.stopImmediatePropagation;Event.prototype.stopImmediatePropagation=function(){this&&(this[ml]=!0),t&&t.apply(this,arguments)}}},e.prototype.supports=function(t){return!0},e.prototype.addEventListener=function(t,e,n){var r=this,o=n;if(!t[hl]||Yn.isInAngularZone()&&!gl(e))t.addEventListener(e,o,!1);else{var i=dl[e];i||(i=dl[e]=pl("ANGULAR"+e+"FALSE"));var a=t[i],s=a&&a.length>0;a||(a=t[i]=[]);var u=gl(e)?Zone.root:Zone.current;if(0===a.length)a.push({zone:u,handler:o});else{for(var l=!1,c=0;c<a.length;c++)if(a[c].handler===o){l=!0;break}l||a.push({zone:u,handler:o})}s||t[hl](e,vl,!1)}return function(){return r.removeEventListener(t,e,o)}},e.prototype.removeEventListener=function(t,e,n){var r=t[fl];if(!r)return t.removeEventListener.apply(t,[e,n,!1]);var o=dl[e],i=o&&t[o];if(!i)return t.removeEventListener.apply(t,[e,n,!1]);for(var a=!1,s=0;s<i.length;s++)if(i[s].handler===n){a=!0,i.splice(s,1);break}a?0===i.length&&r.apply(t,[e,vl,!1]):t.removeEventListener.apply(t,[e,n,!1])},e}(Xu),bl={pan:!0,panstart:!0,panmove:!0,panend:!0,pancancel:!0,panleft:!0,panright:!0,panup:!0,pandown:!0,pinch:!0,pinchstart:!0,pinchmove:!0,pinchend:!0,pinchcancel:!0,pinchin:!0,pinchout:!0,press:!0,pressup:!0,rotate:!0,rotatestart:!0,rotatemove:!0,rotateend:!0,rotatecancel:!0,swipe:!0,swipeleft:!0,swiperight:!0,swipeup:!0,swipedown:!0,tap:!0},wl=new Ct("HammerGestureConfig"),xl=new Ct("HammerLoader"),Sl=function(){function t(){this.events=[],this.overrides={}}return t.prototype.buildHammer=function(t){var e=new Hammer(t,this.options);for(var n in e.get("pinch").set({enable:!0}),e.get("rotate").set({enable:!0}),this.overrides)e.get(n).set(this.overrides[n]);return e},t}(),Cl=function(t){function e(e,n,r,o){var i=t.call(this,e)||this;return i._config=n,i.console=r,i.loader=o,i}return o(e,t),e.prototype.supports=function(t){return!(!bl.hasOwnProperty(t.toLowerCase())&&!this.isCustomEvent(t)||!window.Hammer&&!this.loader&&(this.console.warn('The "'+t+'" event cannot be bound because Hammer.JS is not loaded and no custom loader has been specified.'),1))},e.prototype.addEventListener=function(t,e,n){var r=this,o=this.manager.getZone();if(e=e.toLowerCase(),!window.Hammer&&this.loader){var i=!1,a=function(){i=!0};return this.loader().then(function(){if(!window.Hammer)return r.console.warn("The custom HAMMER_LOADER completed, but Hammer.JS is not present."),void(a=function(){});i||(a=r.addEventListener(t,e,n))}).catch(function(){r.console.warn('The "'+e+'" event cannot be bound because the custom Hammer.JS loader failed.'),a=function(){}}),function(){a()}}return o.runOutsideAngular(function(){var i=r._config.buildHammer(t),a=function(t){o.runGuarded(function(){n(t)})};return i.on(e,a),function(){i.off(e,a),"function"==typeof i.destroy&&i.destroy()}})},e.prototype.isCustomEvent=function(t){return this._config.events.indexOf(t)>-1},e}(Xu),El=["alt","control","meta","shift"],Nl={alt:function(t){return t.altKey},control:function(t){return t.ctrlKey},meta:function(t){return t.metaKey},shift:function(t){return t.shiftKey}},_l=function(t){function e(e){return t.call(this,e)||this}var n;return o(e,t),n=e,e.prototype.supports=function(t){return null!=n.parseEventName(t)},e.prototype.addEventListener=function(t,e,r){var o=n.parseEventName(e),i=n.eventCallback(o.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(function(){return ku().onAndCancel(t,o.domEventName,i)})},e.parseEventName=function(t){var e=t.toLowerCase().split("."),r=e.shift();if(0===e.length||"keydown"!==r&&"keyup"!==r)return null;var o=n._normalizeKey(e.pop()),i="";if(El.forEach(function(t){var n=e.indexOf(t);n>-1&&(e.splice(n,1),i+=t+".")}),i+=o,0!=e.length||0===o.length)return null;var a={};return a.domEventName=r,a.fullKey=i,a},e.getEventFullKey=function(t){var e="",n=ku().getEventKey(t);return" "===(n=n.toLowerCase())?n="space":"."===n&&(n="dot"),El.forEach(function(r){r!=n&&(0,Nl[r])(t)&&(e+=r+".")}),e+=n},e.eventCallback=function(t,e,r){return function(o){n.getEventFullKey(o)===t&&r.runGuarded(function(){return e(o)})}},e._normalizeKey=function(t){switch(t){case"esc":return"escape";default:return t}},e}(Xu),Il=function(){return function(){}}(),Tl=function(t){function e(e){var n=t.call(this)||this;return n._doc=e,n}return o(e,t),e.prototype.sanitize=function(t,e){if(null==e)return null;switch(t){case Be.NONE:return e;case Be.HTML:return e instanceof kl?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"HTML"),function(t,e){var n=null;try{Ye=Ye||new qe(t);var r=e?String(e):"";n=Ye.getInertBodyElement(r);var o=5,i=r;do{if(0===o)throw new Error("Failed to sanitize html because the input is unstable");o--,r=i,i=n.innerHTML,n=Ye.getInertBodyElement(r)}while(r!==i);var a=new un,s=a.sanitizeChildren(hn(n)||n);return He()&&a.sanitizedSomething&&console.warn("WARNING: sanitizing HTML stripped some content, see http://g.co/ng/security#xss"),s}finally{if(n)for(var u=hn(n)||n;u.firstChild;)u.removeChild(u.firstChild)}}(this._doc,String(e)));case Be.STYLE:return e instanceof Rl?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"Style"),function(t){if(!(t=String(t).trim()))return"";var e=t.match(vn);return e&&$e(e[1])===e[1]||t.match(gn)&&function(t){for(var e=!0,n=!0,r=0;r<t.length;r++){var o=t.charAt(r);"'"===o&&n?e=!e:'"'===o&&e&&(n=!n)}return e&&n}(t)?t:(He()&&console.warn("WARNING: sanitizing unsafe style value "+t+" (see http://g.co/ng/security#xss)."),"unsafe")}(e));case Be.SCRIPT:if(e instanceof Ol)return e.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(e,"Script"),new Error("unsafe value used in a script context");case Be.URL:return e instanceof Ml||e instanceof Dl?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"URL"),$e(String(e)));case Be.RESOURCE_URL:if(e instanceof Ml)return e.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(e,"ResourceURL"),new Error("unsafe value used in a resource URL context (see http://g.co/ng/security#xss)");default:throw new Error("Unexpected SecurityContext "+t+" (see http://g.co/ng/security#xss)")}},e.prototype.checkNotSafeValue=function(t,e){if(t instanceof Al)throw new Error("Required a safe "+e+", got a "+t.getTypeName()+" (see http://g.co/ng/security#xss)")},e.prototype.bypassSecurityTrustHtml=function(t){return new kl(t)},e.prototype.bypassSecurityTrustStyle=function(t){return new Rl(t)},e.prototype.bypassSecurityTrustScript=function(t){return new Ol(t)},e.prototype.bypassSecurityTrustUrl=function(t){return new Dl(t)},e.prototype.bypassSecurityTrustResourceUrl=function(t){return new Ml(t)},e}(Il),Al=function(){function t(t){this.changingThisBreaksApplicationSecurity=t}return t.prototype.toString=function(){return"SafeValue must use [property]=binding: "+this.changingThisBreaksApplicationSecurity+" (see http://g.co/ng/security#xss)"},t}(),kl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.getTypeName=function(){return"HTML"},e}(Al),Rl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.getTypeName=function(){return"Style"},e}(Al),Ol=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.getTypeName=function(){return"Script"},e}(Al),Dl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.getTypeName=function(){return"URL"},e}(Al),Ml=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.getTypeName=function(){return"ResourceURL"},e}(Al),Pl=cr(Gr,"browser",[{provide:Mn,useValue:"browser"},{provide:Dn,useValue:function(){Lu.makeCurrent(),Wu.init()},multi:!0},{provide:cs,useClass:Uu,deps:[zu]},{provide:zu,useFactory:function(){return document},deps:[]}]);function Ll(){return new Nn}var Fl=function(){function t(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}var e;return e=t,t.withServerTransition=function(t){return{ngModule:e,providers:[{provide:kn,useValue:t.appId},{provide:Vu,useExisting:kn},ju]}},t}();"undefined"!=typeof window&&window;var zl=function(){return function(t,e){this.id=t,this.url=e}}(),Bl=function(t){function e(e,n,r,o){void 0===r&&(r="imperative"),void 0===o&&(o=null);var i=t.call(this,e,n)||this;return i.navigationTrigger=r,i.restoredState=o,i}return o(e,t),e.prototype.toString=function(){return"NavigationStart(id: "+this.id+", url: '"+this.url+"')"},e}(zl),Ul=function(t){function e(e,n,r){var o=t.call(this,e,n)||this;return o.urlAfterRedirects=r,o}return o(e,t),e.prototype.toString=function(){return"NavigationEnd(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"')"},e}(zl),Vl=function(t){function e(e,n,r){var o=t.call(this,e,n)||this;return o.reason=r,o}return o(e,t),e.prototype.toString=function(){return"NavigationCancel(id: "+this.id+", url: '"+this.url+"')"},e}(zl),jl=function(t){function e(e,n,r){var o=t.call(this,e,n)||this;return o.error=r,o}return o(e,t),e.prototype.toString=function(){return"NavigationError(id: "+this.id+", url: '"+this.url+"', error: "+this.error+")"},e}(zl),Wl=function(t){function e(e,n,r,o){var i=t.call(this,e,n)||this;return i.urlAfterRedirects=r,i.state=o,i}return o(e,t),e.prototype.toString=function(){return"RoutesRecognized(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},e}(zl),Hl=function(t){function e(e,n,r,o){var i=t.call(this,e,n)||this;return i.urlAfterRedirects=r,i.state=o,i}return o(e,t),e.prototype.toString=function(){return"GuardsCheckStart(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},e}(zl),ql=function(t){function e(e,n,r,o,i){var a=t.call(this,e,n)||this;return a.urlAfterRedirects=r,a.state=o,a.shouldActivate=i,a}return o(e,t),e.prototype.toString=function(){return"GuardsCheckEnd(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+", shouldActivate: "+this.shouldActivate+")"},e}(zl),Gl=function(t){function e(e,n,r,o){var i=t.call(this,e,n)||this;return i.urlAfterRedirects=r,i.state=o,i}return o(e,t),e.prototype.toString=function(){return"ResolveStart(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},e}(zl),Kl=function(t){function e(e,n,r,o){var i=t.call(this,e,n)||this;return i.urlAfterRedirects=r,i.state=o,i}return o(e,t),e.prototype.toString=function(){return"ResolveEnd(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},e}(zl),$l=function(){function t(t){this.route=t}return t.prototype.toString=function(){return"RouteConfigLoadStart(path: "+this.route.path+")"},t}(),Xl=function(){function t(t){this.route=t}return t.prototype.toString=function(){return"RouteConfigLoadEnd(path: "+this.route.path+")"},t}(),Zl=function(){function t(t){this.snapshot=t}return t.prototype.toString=function(){return"ChildActivationStart(path: '"+(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"")+"')"},t}(),Yl=function(){function t(t){this.snapshot=t}return t.prototype.toString=function(){return"ChildActivationEnd(path: '"+(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"")+"')"},t}(),Ql=function(){function t(t){this.snapshot=t}return t.prototype.toString=function(){return"ActivationStart(path: '"+(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"")+"')"},t}(),Jl=function(){function t(t){this.snapshot=t}return t.prototype.toString=function(){return"ActivationEnd(path: '"+(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"")+"')"},t}(),tc=function(){function t(t,e,n){this.routerEvent=t,this.position=e,this.anchor=n}return t.prototype.toString=function(){return"Scroll(anchor: '"+this.anchor+"', position: '"+(this.position?this.position[0]+", "+this.position[1]:null)+"')"},t}(),ec=function(){return function(){}}(),nc="primary",rc=function(){function t(t){this.params=t||{}}return t.prototype.has=function(t){return this.params.hasOwnProperty(t)},t.prototype.get=function(t){if(this.has(t)){var e=this.params[t];return Array.isArray(e)?e[0]:e}return null},t.prototype.getAll=function(t){if(this.has(t)){var e=this.params[t];return Array.isArray(e)?e:[e]}return[]},Object.defineProperty(t.prototype,"keys",{get:function(){return Object.keys(this.params)},enumerable:!0,configurable:!0}),t}();function oc(t){return new rc(t)}var ic="ngNavigationCancelingError";function ac(t){var e=Error("NavigationCancelingError: "+t);return e[ic]=!0,e}function sc(t,e,n){var r=n.path.split("/");if(r.length>t.length)return null;if("full"===n.pathMatch&&(e.hasChildren()||r.length<t.length))return null;for(var o={},i=0;i<r.length;i++){var a=r[i],s=t[i];if(a.startsWith(":"))o[a.substring(1)]=s;else if(a!==s.path)return null}return{consumed:t.slice(0,r.length),posParams:o}}var uc=function(){return function(t,e){this.routes=t,this.module=e}}();function lc(t,e){void 0===e&&(e="");for(var n=0;n<t.length;n++){var r=t[n];cc(r,pc(e,r))}}function cc(t,e){if(!t)throw new Error("\n      Invalid configuration of route '"+e+"': Encountered undefined route.\n      The reason might be an extra comma.\n\n      Example:\n      const routes: Routes = [\n        { path: '', redirectTo: '/dashboard', pathMatch: 'full' },\n        { path: 'dashboard',  component: DashboardComponent },, << two commas\n        { path: 'detail/:id', component: HeroDetailComponent }\n      ];\n    ");if(Array.isArray(t))throw new Error("Invalid configuration of route '"+e+"': Array cannot be specified");if(!t.component&&!t.children&&!t.loadChildren&&t.outlet&&t.outlet!==nc)throw new Error("Invalid configuration of route '"+e+"': a componentless route without children or loadChildren cannot have a named outlet set");if(t.redirectTo&&t.children)throw new Error("Invalid configuration of route '"+e+"': redirectTo and children cannot be used together");if(t.redirectTo&&t.loadChildren)throw new Error("Invalid configuration of route '"+e+"': redirectTo and loadChildren cannot be used together");if(t.children&&t.loadChildren)throw new Error("Invalid configuration of route '"+e+"': children and loadChildren cannot be used together");if(t.redirectTo&&t.component)throw new Error("Invalid configuration of route '"+e+"': redirectTo and component cannot be used together");if(t.path&&t.matcher)throw new Error("Invalid configuration of route '"+e+"': path and matcher cannot be used together");if(void 0===t.redirectTo&&!t.component&&!t.children&&!t.loadChildren)throw new Error("Invalid configuration of route '"+e+"'. One of the following must be provided: component, redirectTo, children or loadChildren");if(void 0===t.path&&void 0===t.matcher)throw new Error("Invalid configuration of route '"+e+"': routes must have either a path or a matcher specified");if("string"==typeof t.path&&"/"===t.path.charAt(0))throw new Error("Invalid configuration of route '"+e+"': path cannot start with a slash");if(""===t.path&&void 0!==t.redirectTo&&void 0===t.pathMatch)throw new Error("Invalid configuration of route '{path: \""+e+'", redirectTo: "'+t.redirectTo+"\"}': please provide 'pathMatch'. The default value of 'pathMatch' is 'prefix', but often the intent is to use 'full'.");if(void 0!==t.pathMatch&&"full"!==t.pathMatch&&"prefix"!==t.pathMatch)throw new Error("Invalid configuration of route '"+e+"': pathMatch can only be set to 'prefix' or 'full'");t.children&&lc(t.children,e)}function pc(t,e){return e?t||e.path?t&&!e.path?t+"/":!t&&e.path?e.path:t+"/"+e.path:"":t}function hc(t){var e=t.children&&t.children.map(hc),n=e?i({},t,{children:e}):i({},t);return!n.component&&(e||n.loadChildren)&&n.outlet&&n.outlet!==nc&&(n.component=ec),n}function fc(t,e){var n,r=Object.keys(t),o=Object.keys(e);if(r.length!=o.length)return!1;for(var i=0;i<r.length;i++)if(t[n=r[i]]!==e[n])return!1;return!0}function dc(t){return Array.prototype.concat.apply([],t)}function mc(t){return t.length>0?t[t.length-1]:null}function gc(t,e){for(var n in t)t.hasOwnProperty(n)&&e(t[n],n)}function vc(t){return In(t)?t:_n(t)?at(Promise.resolve(t)):Bs(t)}function yc(t,e,n){return n?function(t,e){return fc(t,e)}(t.queryParams,e.queryParams)&&function t(e,n){if(!Sc(e.segments,n.segments))return!1;if(e.numberOfChildren!==n.numberOfChildren)return!1;for(var r in n.children){if(!e.children[r])return!1;if(!t(e.children[r],n.children[r]))return!1}return!0}(t.root,e.root):function(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(function(n){return e[n]===t[n]})}(t.queryParams,e.queryParams)&&function t(e,n){return function e(n,r,o){if(n.segments.length>o.length)return!!Sc(a=n.segments.slice(0,o.length),o)&&!r.hasChildren();if(n.segments.length===o.length){if(!Sc(n.segments,o))return!1;for(var i in r.children){if(!n.children[i])return!1;if(!t(n.children[i],r.children[i]))return!1}return!0}var a=o.slice(0,n.segments.length),s=o.slice(n.segments.length);return!!Sc(n.segments,a)&&!!n.children[nc]&&e(n.children[nc],r,s)}(e,n,n.segments)}(t.root,e.root)}var bc=function(){function t(t,e,n){this.root=t,this.queryParams=e,this.fragment=n}return Object.defineProperty(t.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=oc(this.queryParams)),this._queryParamMap},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return _c.serialize(this)},t}(),wc=function(){function t(t,e){var n=this;this.segments=t,this.children=e,this.parent=null,gc(e,function(t,e){return t.parent=n})}return t.prototype.hasChildren=function(){return this.numberOfChildren>0},Object.defineProperty(t.prototype,"numberOfChildren",{get:function(){return Object.keys(this.children).length},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return Ic(this)},t}(),xc=function(){function t(t,e){this.path=t,this.parameters=e}return Object.defineProperty(t.prototype,"parameterMap",{get:function(){return this._parameterMap||(this._parameterMap=oc(this.parameters)),this._parameterMap},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return Dc(this)},t}();function Sc(t,e){return t.length===e.length&&t.every(function(t,n){return t.path===e[n].path})}function Cc(t,e){var n=[];return gc(t.children,function(t,r){r===nc&&(n=n.concat(e(t,r)))}),gc(t.children,function(t,r){r!==nc&&(n=n.concat(e(t,r)))}),n}var Ec=function(){return function(){}}(),Nc=function(){function t(){}return t.prototype.parse=function(t){var e=new zc(t);return new bc(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())},t.prototype.serialize=function(t){var e,n;return"/"+function t(e,n){if(!e.hasChildren())return Ic(e);if(n){var r=e.children[nc]?t(e.children[nc],!1):"",o=[];return gc(e.children,function(e,n){n!==nc&&o.push(n+":"+t(e,!1))}),o.length>0?r+"("+o.join("//")+")":r}var i=Cc(e,function(n,r){return r===nc?[t(e.children[nc],!1)]:[r+":"+t(n,!1)]});return Ic(e)+"/("+i.join("//")+")"}(t.root,!0)+(e=t.queryParams,(n=Object.keys(e).map(function(t){var n=e[t];return Array.isArray(n)?n.map(function(e){return Ac(t)+"="+Ac(e)}).join("&"):Ac(t)+"="+Ac(n)})).length?"?"+n.join("&"):"")+("string"==typeof t.fragment?"#"+encodeURI(t.fragment):"")},t}(),_c=new Nc;function Ic(t){return t.segments.map(function(t){return Dc(t)}).join("/")}function Tc(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ac(t){return Tc(t).replace(/%3B/gi,";")}function kc(t){return Tc(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Rc(t){return decodeURIComponent(t)}function Oc(t){return Rc(t.replace(/\+/g,"%20"))}function Dc(t){return""+kc(t.path)+(e=t.parameters,Object.keys(e).map(function(t){return";"+kc(t)+"="+kc(e[t])}).join(""));var e}var Mc=/^[^\/()?;=#]+/;function Pc(t){var e=t.match(Mc);return e?e[0]:""}var Lc=/^[^=?&#]+/,Fc=/^[^?&#]+/,zc=function(){function t(t){this.url=t,this.remaining=t}return t.prototype.parseRootSegment=function(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new wc([],{}):new wc([],this.parseChildren())},t.prototype.parseQueryParams=function(){var t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t},t.prototype.parseFragment=function(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null},t.prototype.parseChildren=function(){if(""===this.remaining)return{};this.consumeOptional("/");var t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());var e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));var n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(n[nc]=new wc(t,e)),n},t.prototype.parseSegment=function(){var t=Pc(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error("Empty path url segment cannot have parameters: '"+this.remaining+"'.");return this.capture(t),new xc(Rc(t),this.parseMatrixParams())},t.prototype.parseMatrixParams=function(){for(var t={};this.consumeOptional(";");)this.parseParam(t);return t},t.prototype.parseParam=function(t){var e=Pc(this.remaining);if(e){this.capture(e);var n="";if(this.consumeOptional("=")){var r=Pc(this.remaining);r&&this.capture(n=r)}t[Rc(e)]=Rc(n)}},t.prototype.parseQueryParam=function(t){var e,n=(e=this.remaining.match(Lc))?e[0]:"";if(n){this.capture(n);var r="";if(this.consumeOptional("=")){var o=function(t){var e=t.match(Fc);return e?e[0]:""}(this.remaining);o&&this.capture(r=o)}var i=Oc(n),a=Oc(r);if(t.hasOwnProperty(i)){var s=t[i];Array.isArray(s)||(t[i]=s=[s]),s.push(a)}else t[i]=a}},t.prototype.parseParens=function(t){var e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){var n=Pc(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error("Cannot parse url '"+this.url+"'");var o=void 0;n.indexOf(":")>-1?(o=n.substr(0,n.indexOf(":")),this.capture(o),this.capture(":")):t&&(o=nc);var i=this.parseChildren();e[o]=1===Object.keys(i).length?i[nc]:new wc([],i),this.consumeOptional("//")}return e},t.prototype.peekStartsWith=function(t){return this.remaining.startsWith(t)},t.prototype.consumeOptional=function(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)},t.prototype.capture=function(t){if(!this.consumeOptional(t))throw new Error('Expected "'+t+'".')},t}(),Bc=function(){function t(t){this._root=t}return Object.defineProperty(t.prototype,"root",{get:function(){return this._root.value},enumerable:!0,configurable:!0}),t.prototype.parent=function(t){var e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null},t.prototype.children=function(t){var e=Uc(t,this._root);return e?e.children.map(function(t){return t.value}):[]},t.prototype.firstChild=function(t){var e=Uc(t,this._root);return e&&e.children.length>0?e.children[0].value:null},t.prototype.siblings=function(t){var e=Vc(t,this._root);return e.length<2?[]:e[e.length-2].children.map(function(t){return t.value}).filter(function(e){return e!==t})},t.prototype.pathFromRoot=function(t){return Vc(t,this._root).map(function(t){return t.value})},t}();function Uc(t,e){var n,r;if(t===e.value)return e;try{for(var o=c(e.children),i=o.next();!i.done;i=o.next()){var a=Uc(t,i.value);if(a)return a}}catch(s){n={error:s}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return null}function Vc(t,e){var n,r;if(t===e.value)return[e];try{for(var o=c(e.children),i=o.next();!i.done;i=o.next()){var a=Vc(t,i.value);if(a.length)return a.unshift(e),a}}catch(s){n={error:s}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return[]}var jc=function(){function t(t,e){this.value=t,this.children=e}return t.prototype.toString=function(){return"TreeNode("+this.value+")"},t}();function Wc(t){var e={};return t&&t.children.forEach(function(t){return e[t.value.outlet]=t}),e}var Hc=function(t){function e(e,n){var r=t.call(this,e)||this;return r.snapshot=n,Zc(r,e),r}return o(e,t),e.prototype.toString=function(){return this.snapshot.toString()},e}(Bc);function qc(t,e){var n=function(t,e){var n=new $c([],{},{},"",{},nc,e,null,t.root,-1,{});return new Xc("",new jc(n,[]))}(t,e),r=new Us([new xc("",{})]),o=new Us({}),i=new Us({}),a=new Us({}),s=new Us(""),u=new Gc(r,o,a,s,i,nc,e,n.root);return u.snapshot=n.root,new Hc(new jc(u,[]),n)}var Gc=function(){function t(t,e,n,r,o,i,a,s){this.url=t,this.params=e,this.queryParams=n,this.fragment=r,this.data=o,this.outlet=i,this.component=a,this._futureSnapshot=s}return Object.defineProperty(t.prototype,"routeConfig",{get:function(){return this._futureSnapshot.routeConfig},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._routerState.root},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._routerState.parent(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstChild",{get:function(){return this._routerState.firstChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this._routerState.children(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pathFromRoot",{get:function(){return this._routerState.pathFromRoot(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMap",{get:function(){return this._paramMap||(this._paramMap=this.params.pipe(nt(function(t){return oc(t)}))),this._paramMap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(nt(function(t){return oc(t)}))),this._queryParamMap},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return this.snapshot?this.snapshot.toString():"Future("+this._futureSnapshot+")"},t}();function Kc(t,e){void 0===e&&(e="emptyOnly");var n=t.pathFromRoot,r=0;if("always"!==e)for(r=n.length-1;r>=1;){var o=n[r],a=n[r-1];if(o.routeConfig&&""===o.routeConfig.path)r--;else{if(a.component)break;r--}}return function(t){return t.reduce(function(t,e){return{params:i({},t.params,e.params),data:i({},t.data,e.data),resolve:i({},t.resolve,e._resolvedData)}},{params:{},data:{},resolve:{}})}(n.slice(r))}var $c=function(){function t(t,e,n,r,o,i,a,s,u,l,c){this.url=t,this.params=e,this.queryParams=n,this.fragment=r,this.data=o,this.outlet=i,this.component=a,this.routeConfig=s,this._urlSegment=u,this._lastPathIndex=l,this._resolve=c}return Object.defineProperty(t.prototype,"root",{get:function(){return this._routerState.root},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._routerState.parent(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstChild",{get:function(){return this._routerState.firstChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this._routerState.children(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pathFromRoot",{get:function(){return this._routerState.pathFromRoot(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMap",{get:function(){return this._paramMap||(this._paramMap=oc(this.params)),this._paramMap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=oc(this.queryParams)),this._queryParamMap},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return"Route(url:'"+this.url.map(function(t){return t.toString()}).join("/")+"', path:'"+(this.routeConfig?this.routeConfig.path:"")+"')"},t}(),Xc=function(t){function e(e,n){var r=t.call(this,n)||this;return r.url=e,Zc(r,n),r}return o(e,t),e.prototype.toString=function(){return Yc(this._root)},e}(Bc);function Zc(t,e){e.value._routerState=t,e.children.forEach(function(e){return Zc(t,e)})}function Yc(t){var e=t.children.length>0?" { "+t.children.map(Yc).join(", ")+" } ":"";return""+t.value+e}function Qc(t){if(t.snapshot){var e=t.snapshot,n=t._futureSnapshot;t.snapshot=n,fc(e.queryParams,n.queryParams)||t.queryParams.next(n.queryParams),e.fragment!==n.fragment&&t.fragment.next(n.fragment),fc(e.params,n.params)||t.params.next(n.params),function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(!fc(t[n],e[n]))return!1;return!0}(e.url,n.url)||t.url.next(n.url),fc(e.data,n.data)||t.data.next(n.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function Jc(t,e){var n,r;return fc(t.params,e.params)&&Sc(n=t.url,r=e.url)&&n.every(function(t,e){return fc(t.parameters,r[e].parameters)})&&!(!t.parent!=!e.parent)&&(!t.parent||Jc(t.parent,e.parent))}function tp(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function ep(t,e,n,r,o){var i={};return r&&gc(r,function(t,e){i[e]=Array.isArray(t)?t.map(function(t){return""+t}):""+t}),new bc(n.root===t?e:function t(e,n,r){var o={};return gc(e.children,function(e,i){o[i]=e===n?r:t(e,n,r)}),new wc(e.segments,o)}(n.root,t,e),i,o)}var np=function(){function t(t,e,n){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=n,t&&n.length>0&&tp(n[0]))throw new Error("Root segment cannot have matrix parameters");var r=n.find(function(t){return"object"==typeof t&&null!=t&&t.outlets});if(r&&r!==mc(n))throw new Error("{outlets:{}} has to be the last command")}return t.prototype.toRoot=function(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]},t}(),rp=function(){return function(t,e,n){this.segmentGroup=t,this.processChildren=e,this.index=n}}();function op(t){return"object"==typeof t&&null!=t&&t.outlets?t.outlets[nc]:""+t}function ip(t,e,n){if(t||(t=new wc([],{})),0===t.segments.length&&t.hasChildren())return ap(t,e,n);var r=function(t,e,n){for(var r=0,o=e,i={match:!1,pathIndex:0,commandIndex:0};o<t.segments.length;){if(r>=n.length)return i;var a=t.segments[o],s=op(n[r]),u=r<n.length-1?n[r+1]:null;if(o>0&&void 0===s)break;if(s&&u&&"object"==typeof u&&void 0===u.outlets){if(!cp(s,u,a))return i;r+=2}else{if(!cp(s,{},a))return i;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}(t,e,n),o=n.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){var i=new wc(t.segments.slice(0,r.pathIndex),{});return i.children[nc]=new wc(t.segments.slice(r.pathIndex),t.children),ap(i,0,o)}return r.match&&0===o.length?new wc(t.segments,{}):r.match&&!t.hasChildren()?sp(t,e,n):r.match?ap(t,0,o):sp(t,e,n)}function ap(t,e,n){if(0===n.length)return new wc(t.segments,{});var r=function(t){var e,n;return"object"!=typeof t[0]?((e={})[nc]=t,e):void 0===t[0].outlets?((n={})[nc]=t,n):t[0].outlets}(n),o={};return gc(r,function(n,r){null!==n&&(o[r]=ip(t.children[r],e,n))}),gc(t.children,function(t,e){void 0===r[e]&&(o[e]=t)}),new wc(t.segments,o)}function sp(t,e,n){for(var r=t.segments.slice(0,e),o=0;o<n.length;){if("object"==typeof n[o]&&void 0!==n[o].outlets){var i=up(n[o].outlets);return new wc(r,i)}if(0===o&&tp(n[0]))r.push(new xc(t.segments[e].path,n[0])),o++;else{var a=op(n[o]),s=o<n.length-1?n[o+1]:null;a&&s&&tp(s)?(r.push(new xc(a,lp(s))),o+=2):(r.push(new xc(a,{})),o++)}}return new wc(r,{})}function up(t){var e={};return gc(t,function(t,n){null!==t&&(e[n]=sp(new wc([],{}),0,t))}),e}function lp(t){var e={};return gc(t,function(t,n){return e[n]=""+t}),e}function cp(t,e,n){return t==n.path&&fc(e,n.parameters)}var pp=function(){function t(t,e,n,r){this.routeReuseStrategy=t,this.futureState=e,this.currState=n,this.forwardEvent=r}return t.prototype.activate=function(t){var e=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,n,t),Qc(this.futureState.root),this.activateChildRoutes(e,n,t)},t.prototype.deactivateChildRoutes=function(t,e,n){var r=this,o=Wc(e);t.children.forEach(function(t){var e=t.value.outlet;r.deactivateRoutes(t,o[e],n),delete o[e]}),gc(o,function(t,e){r.deactivateRouteAndItsChildren(t,n)})},t.prototype.deactivateRoutes=function(t,e,n){var r=t.value,o=e?e.value:null;if(r===o)if(r.component){var i=n.getContext(r.outlet);i&&this.deactivateChildRoutes(t,e,i.children)}else this.deactivateChildRoutes(t,e,n);else o&&this.deactivateRouteAndItsChildren(e,n)},t.prototype.deactivateRouteAndItsChildren=function(t,e){this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)},t.prototype.detachAndStoreRouteSubtree=function(t,e){var n=e.getContext(t.value.outlet);if(n&&n.outlet){var r=n.outlet.detach(),o=n.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:r,route:t,contexts:o})}},t.prototype.deactivateRouteAndOutlet=function(t,e){var n=this,r=e.getContext(t.value.outlet);if(r){var o=Wc(t),i=t.value.component?r.children:e;gc(o,function(t,e){return n.deactivateRouteAndItsChildren(t,i)}),r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated())}},t.prototype.activateChildRoutes=function(t,e,n){var r=this,o=Wc(e);t.children.forEach(function(t){r.activateRoutes(t,o[t.value.outlet],n),r.forwardEvent(new Jl(t.value.snapshot))}),t.children.length&&this.forwardEvent(new Yl(t.value.snapshot))},t.prototype.activateRoutes=function(t,e,n){var r=t.value,o=e?e.value:null;if(Qc(r),r===o)if(r.component){var i=n.getOrCreateContext(r.outlet);this.activateChildRoutes(t,e,i.children)}else this.activateChildRoutes(t,e,n);else if(r.component)if(i=n.getOrCreateContext(r.outlet),this.routeReuseStrategy.shouldAttach(r.snapshot)){var a=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),i.children.onOutletReAttached(a.contexts),i.attachRef=a.componentRef,i.route=a.route.value,i.outlet&&i.outlet.attach(a.componentRef,a.route.value),hp(a.route)}else{var s=function(t){for(var e=r.snapshot.parent;e;e=e.parent){var n=e.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(),u=s?s.module.componentFactoryResolver:null;i.attachRef=null,i.route=r,i.resolver=u,i.outlet&&i.outlet.activateWith(r,u),this.activateChildRoutes(t,null,i.children)}else this.activateChildRoutes(t,null,n)},t}();function hp(t){Qc(t.value),t.children.forEach(hp)}function fp(t){return"function"==typeof t}function dp(t){return t instanceof bc}var mp=function(){return function(t){this.segmentGroup=t||null}}(),gp=function(){return function(t){this.urlTree=t}}();function vp(t){return new P(function(e){return e.error(new mp(t))})}function yp(t){return new P(function(e){return e.error(new gp(t))})}function bp(t){return new P(function(e){return e.error(new Error("Only absolute redirects can have named outlets. redirectTo: '"+t+"'"))})}var wp=function(){function t(t,e,n,r,o){this.configLoader=e,this.urlSerializer=n,this.urlTree=r,this.config=o,this.allowRedirects=!0,this.ngModule=t.get(ke)}return t.prototype.apply=function(){var t=this;return this.expandSegmentGroup(this.ngModule,this.config,this.urlTree.root,nc).pipe(nt(function(e){return t.createUrlTree(e,t.urlTree.queryParams,t.urlTree.fragment)})).pipe(pu(function(e){if(e instanceof gp)return t.allowRedirects=!1,t.match(e.urlTree);if(e instanceof mp)throw t.noMatchError(e);throw e}))},t.prototype.match=function(t){var e=this;return this.expandSegmentGroup(this.ngModule,this.config,t.root,nc).pipe(nt(function(n){return e.createUrlTree(n,t.queryParams,t.fragment)})).pipe(pu(function(t){if(t instanceof mp)throw e.noMatchError(t);throw t}))},t.prototype.noMatchError=function(t){return new Error("Cannot match any routes. URL Segment: '"+t.segmentGroup+"'")},t.prototype.createUrlTree=function(t,e,n){var r,o=t.segments.length>0?new wc([],((r={})[nc]=t,r)):t;return new bc(o,e,n)},t.prototype.expandSegmentGroup=function(t,e,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(t,e,n).pipe(nt(function(t){return new wc([],t)})):this.expandSegment(t,n,e,n.segments,r,!0)},t.prototype.expandChildren=function(t,e,n){var r=this;return function(n,o){if(0===Object.keys(n).length)return Bs({});var i=[],a=[],s={};return gc(n,function(n,o){var u,l,c=(u=o,l=n,r.expandSegmentGroup(t,e,l,u)).pipe(nt(function(t){return s[o]=t}));o===nc?i.push(c):a.push(c)}),Bs.apply(null,i.concat(a)).pipe(Ks(),cu(),nt(function(){return s}))}(n.children)},t.prototype.expandSegment=function(t,e,n,r,o,i){var a=this;return Bs.apply(void 0,h(n)).pipe(nt(function(s){return a.expandSegmentAgainstRoute(t,e,n,s,r,o,i).pipe(pu(function(t){if(t instanceof mp)return Bs(null);throw t}))}),Ks(),vu(function(t){return!!t}),pu(function(t,n){if(t instanceof js||"EmptyError"===t.name){if(a.noLeftoversInUrl(e,r,o))return Bs(new wc([],{}));throw new mp(e)}throw t}))},t.prototype.noLeftoversInUrl=function(t,e,n){return 0===e.length&&!t.children[n]},t.prototype.expandSegmentAgainstRoute=function(t,e,n,r,o,i,a){return Ep(r)!==i?vp(e):void 0===r.redirectTo?this.matchSegmentAgainstRoute(t,e,r,o):a&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,n,r,o,i):vp(e)},t.prototype.expandSegmentAgainstRouteUsingRedirect=function(t,e,n,r,o,i){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,r,i):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,n,r,o,i)},t.prototype.expandWildCardWithParamsAgainstRouteUsingRedirect=function(t,e,n,r){var o=this,i=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?yp(i):this.lineralizeSegments(n,i).pipe(st(function(n){var i=new wc(n,{});return o.expandSegment(t,i,e,n,r,!1)}))},t.prototype.expandRegularSegmentAgainstRouteUsingRedirect=function(t,e,n,r,o,i){var a=this,s=xp(e,r,o),u=s.consumedSegments,l=s.lastChild,c=s.positionalParamSegments;if(!s.matched)return vp(e);var p=this.applyRedirectCommands(u,r.redirectTo,c);return r.redirectTo.startsWith("/")?yp(p):this.lineralizeSegments(r,p).pipe(st(function(r){return a.expandSegment(t,e,n,r.concat(o.slice(l)),i,!1)}))},t.prototype.matchSegmentAgainstRoute=function(t,e,n,r){var o=this;if("**"===n.path)return n.loadChildren?this.configLoader.load(t.injector,n).pipe(nt(function(t){return n._loadedConfig=t,new wc(r,{})})):Bs(new wc(r,{}));var a=xp(e,n,r),s=a.consumedSegments,u=a.lastChild;if(!a.matched)return vp(e);var l=r.slice(u);return this.getChildConfig(t,n,r).pipe(st(function(t){var n=t.module,r=t.routes,a=function(t,e,n,r){return n.length>0&&function(t,e,n){return r.some(function(n){return Cp(t,e,n)&&Ep(n)!==nc})}(t,n)?{segmentGroup:Sp(new wc(e,function(t,e){var n,r,o={};o[nc]=e;try{for(var i=c(t),a=i.next();!a.done;a=i.next()){var s=a.value;""===s.path&&Ep(s)!==nc&&(o[Ep(s)]=new wc([],{}))}}catch(u){n={error:u}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return o}(r,new wc(n,t.children)))),slicedSegments:[]}:0===n.length&&function(t,e,n){return r.some(function(n){return Cp(t,e,n)})}(t,n)?{segmentGroup:Sp(new wc(t.segments,function(t,e,n,r){var o,a,s={};try{for(var u=c(n),l=u.next();!l.done;l=u.next()){var p=l.value;Cp(t,e,p)&&!r[Ep(p)]&&(s[Ep(p)]=new wc([],{}))}}catch(h){o={error:h}}finally{try{l&&!l.done&&(a=u.return)&&a.call(u)}finally{if(o)throw o.error}}return i({},r,s)}(t,n,r,t.children))),slicedSegments:n}:{segmentGroup:t,slicedSegments:n}}(e,s,l,r),u=a.segmentGroup,p=a.slicedSegments;return 0===p.length&&u.hasChildren()?o.expandChildren(n,r,u).pipe(nt(function(t){return new wc(s,t)})):0===r.length&&0===p.length?Bs(new wc(s,{})):o.expandSegment(n,u,r,p,nc,!0).pipe(nt(function(t){return new wc(s.concat(t.segments),t.children)}))}))},t.prototype.getChildConfig=function(t,e,n){var r=this;return e.children?Bs(new uc(e.children,t)):e.loadChildren?void 0!==e._loadedConfig?Bs(e._loadedConfig):function(t,e,n){var r,o=e.canLoad;return o&&0!==o.length?at(o).pipe(nt(function(r){var o,i=t.get(r);if(function(t){return t&&fp(t.canLoad)}(i))o=i.canLoad(e,n);else{if(!fp(i))throw new Error("Invalid CanLoad guard");o=i(e,n)}return vc(o)})).pipe(Ks(),(r=function(t){return!0===t},function(t){return t.lift(new yu(r,void 0,t))})):Bs(!0)}(t.injector,e,n).pipe(st(function(n){return n?r.configLoader.load(t.injector,e).pipe(nt(function(t){return e._loadedConfig=t,t})):function(t){return new P(function(e){return e.error(ac("Cannot load children because the guard of the route \"path: '"+t.path+"'\" returned false"))})}(e)})):Bs(new uc([],t))},t.prototype.lineralizeSegments=function(t,e){for(var n=[],r=e.root;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return Bs(n);if(r.numberOfChildren>1||!r.children[nc])return bp(t.redirectTo);r=r.children[nc]}},t.prototype.applyRedirectCommands=function(t,e,n){return this.applyRedirectCreatreUrlTree(e,this.urlSerializer.parse(e),t,n)},t.prototype.applyRedirectCreatreUrlTree=function(t,e,n,r){var o=this.createSegmentGroup(t,e.root,n,r);return new bc(o,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)},t.prototype.createQueryParams=function(t,e){var n={};return gc(t,function(t,r){if("string"==typeof t&&t.startsWith(":")){var o=t.substring(1);n[r]=e[o]}else n[r]=t}),n},t.prototype.createSegmentGroup=function(t,e,n,r){var o=this,i=this.createSegments(t,e.segments,n,r),a={};return gc(e.children,function(e,i){a[i]=o.createSegmentGroup(t,e,n,r)}),new wc(i,a)},t.prototype.createSegments=function(t,e,n,r){var o=this;return e.map(function(e){return e.path.startsWith(":")?o.findPosParam(t,e,r):o.findOrReturn(e,n)})},t.prototype.findPosParam=function(t,e,n){var r=n[e.path.substring(1)];if(!r)throw new Error("Cannot redirect to '"+t+"'. Cannot find '"+e.path+"'.");return r},t.prototype.findOrReturn=function(t,e){var n,r,o=0;try{for(var i=c(e),a=i.next();!a.done;a=i.next()){var s=a.value;if(s.path===t.path)return e.splice(o),s;o++}}catch(u){n={error:u}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return t},t}();function xp(t,e,n){if(""===e.path)return"full"===e.pathMatch&&(t.hasChildren()||n.length>0)?{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}:{matched:!0,consumedSegments:[],lastChild:0,positionalParamSegments:{}};var r=(e.matcher||sc)(n,t,e);return r?{matched:!0,consumedSegments:r.consumed,lastChild:r.consumed.length,positionalParamSegments:r.posParams}:{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}}function Sp(t){if(1===t.numberOfChildren&&t.children[nc]){var e=t.children[nc];return new wc(t.segments.concat(e.segments),e.children)}return t}function Cp(t,e,n){return(!(t.hasChildren()||e.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0!==n.redirectTo}function Ep(t){return t.outlet||nc}var Np=function(){return function(t){this.path=t,this.route=this.path[this.path.length-1]}}(),_p=function(){return function(t,e){this.component=t,this.route=e}}();function Ip(t,e,n){var r=function(t){if(!t)return null;for(var e=t.parent;e;e=e.parent){var n=e.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(e);return(r?r.module.injector:n).get(t)}function Tp(t,e,n,r,o){void 0===o&&(o={canDeactivateChecks:[],canActivateChecks:[]});var i=Wc(e);return t.children.forEach(function(t){!function(t,e,n,r,o){void 0===o&&(o={canDeactivateChecks:[],canActivateChecks:[]});var i=t.value,a=e?e.value:null,s=n?n.getContext(t.value.outlet):null;if(a&&i.routeConfig===a.routeConfig){var u=function(t,e,n){if("function"==typeof n)return n(t,e);switch(n){case"pathParamsChange":return!Sc(t.url,e.url);case"pathParamsOrQueryParamsChange":return!Sc(t.url,e.url)||!fc(t.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Jc(t,e)||!fc(t.queryParams,e.queryParams);case"paramsChange":default:return!Jc(t,e)}}(a,i,i.routeConfig.runGuardsAndResolvers);u?o.canActivateChecks.push(new Np(r)):(i.data=a.data,i._resolvedData=a._resolvedData),Tp(t,e,i.component?s?s.children:null:n,r,o),u&&o.canDeactivateChecks.push(new _p(s&&s.outlet&&s.outlet.component||null,a))}else a&&Ap(e,s,o),o.canActivateChecks.push(new Np(r)),Tp(t,null,i.component?s?s.children:null:n,r,o)}(t,i[t.value.outlet],n,r.concat([t.value]),o),delete i[t.value.outlet]}),gc(i,function(t,e){return Ap(t,n.getContext(e),o)}),o}function Ap(t,e,n){var r=Wc(t),o=t.value;gc(r,function(t,r){Ap(t,o.component?e?e.children.getContext(r):null:e,n)}),n.canDeactivateChecks.push(new _p(o.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,o))}var kp=Symbol("INITIAL_VALUE");function Rp(){return wu(function(t){return(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=null,r=null;return W(t[t.length-1])&&(r=t.pop()),"function"==typeof t[t.length-1]&&(n=t.pop()),1===t.length&&f(t[0])&&(t=t[0]),it(t,r).lift(new Hs(n))}).apply(void 0,h(t.map(function(t){return t.pipe(du(1),function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){var n=t[t.length-1];W(n)?t.pop():n=null;var r=t.length;return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 1===t.length||2===t.length&&W(t[1])?at(t[0]):Ks()(Bs.apply(void 0,t))}(1!==r||n?r>0?it(t,n):Fs(n):zs(t[0]),e)}}(kp))}))).pipe(Cu(function(t,e){var n=!1;return e.reduce(function(t,r,o){if(t!==kp)return t;if(r===kp&&(n=!0),!n){if(!1===r)return r;if(o===e.length-1||dp(r))return r}return t},t)},kp),$s(function(t){return t!==kp}),nt(function(t){return dp(t)?t:!0===t}),du(1))})}function Op(t,e){return null!==t&&e&&e(new Ql(t)),Bs(!0)}function Dp(t,e){return null!==t&&e&&e(new Zl(t)),Bs(!0)}function Mp(t,e,n){var r=e.routeConfig?e.routeConfig.canActivate:null;return r&&0!==r.length?Bs(r.map(function(r){return Gs(function(){var o,i=Ip(r,e,n);if(function(t){return t&&fp(t.canActivate)}(i))o=vc(i.canActivate(e,t));else{if(!fp(i))throw new Error("Invalid CanActivate guard");o=vc(i(e,t))}return o.pipe(vu())})})).pipe(Rp()):Bs(!0)}function Pp(t,e,n){var r=e[e.length-1],o=e.slice(0,e.length-1).reverse().map(function(t){return function(t){var e=t.routeConfig?t.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:t,guards:e}:null}(t)}).filter(function(t){return null!==t}).map(function(e){return Gs(function(){return Bs(e.guards.map(function(o){var i,a=Ip(o,e.node,n);if(function(t){return t&&fp(t.canActivateChild)}(a))i=vc(a.canActivateChild(r,t));else{if(!fp(a))throw new Error("Invalid CanActivateChild guard");i=vc(a(r,t))}return i.pipe(vu())})).pipe(Rp())})});return Bs(o).pipe(Rp())}var Lp=function(){return function(){}}(),Fp=function(){function t(t,e,n,r,o,i){this.rootComponentType=t,this.config=e,this.urlTree=n,this.url=r,this.paramsInheritanceStrategy=o,this.relativeLinkResolution=i}return t.prototype.recognize=function(){try{var t=Up(this.urlTree.root,[],[],this.config,this.relativeLinkResolution).segmentGroup,e=this.processSegmentGroup(this.config,t,nc),n=new $c([],Object.freeze({}),Object.freeze(i({},this.urlTree.queryParams)),this.urlTree.fragment,{},nc,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new jc(n,e),o=new Xc(this.url,r);return this.inheritParamsAndData(o._root),Bs(o)}catch($f){return new P(function(e){return e.error($f)})}},t.prototype.inheritParamsAndData=function(t){var e=this,n=t.value,r=Kc(n,this.paramsInheritanceStrategy);n.params=Object.freeze(r.params),n.data=Object.freeze(r.data),t.children.forEach(function(t){return e.inheritParamsAndData(t)})},t.prototype.processSegmentGroup=function(t,e,n){return 0===e.segments.length&&e.hasChildren()?this.processChildren(t,e):this.processSegment(t,e,e.segments,n)},t.prototype.processChildren=function(t,e){var n,r=this,o=Cc(e,function(e,n){return r.processSegmentGroup(t,e,n)});return n={},o.forEach(function(t){var e=n[t.value.outlet];if(e){var r=e.url.map(function(t){return t.toString()}).join("/"),o=t.value.url.map(function(t){return t.toString()}).join("/");throw new Error("Two segments cannot have the same outlet name: '"+r+"' and '"+o+"'.")}n[t.value.outlet]=t.value}),o.sort(function(t,e){return t.value.outlet===nc?-1:e.value.outlet===nc?1:t.value.outlet.localeCompare(e.value.outlet)}),o},t.prototype.processSegment=function(t,e,n,r){var o,i;try{for(var a=c(t),s=a.next();!s.done;s=a.next()){var u=s.value;try{return this.processSegmentAgainstRoute(u,e,n,r)}catch($f){if(!($f instanceof Lp))throw $f}}}catch(l){o={error:l}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}if(this.noLeftoversInUrl(e,n,r))return[];throw new Lp},t.prototype.noLeftoversInUrl=function(t,e,n){return 0===e.length&&!t.children[n]},t.prototype.processSegmentAgainstRoute=function(t,e,n,r){if(t.redirectTo)throw new Lp;if((t.outlet||nc)!==r)throw new Lp;var o,a=[],s=[];if("**"===t.path){var u=n.length>0?mc(n).parameters:{};o=new $c(n,u,Object.freeze(i({},this.urlTree.queryParams)),this.urlTree.fragment,Wp(t),r,t.component,t,zp(e),Bp(e)+n.length,Hp(t))}else{var l=function(t,e,n){if(""===e.path){if("full"===e.pathMatch&&(t.hasChildren()||n.length>0))throw new Lp;return{consumedSegments:[],lastChild:0,parameters:{}}}var r=(e.matcher||sc)(n,t,e);if(!r)throw new Lp;var o={};gc(r.posParams,function(t,e){o[e]=t.path});var a=r.consumed.length>0?i({},o,r.consumed[r.consumed.length-1].parameters):o;return{consumedSegments:r.consumed,lastChild:r.consumed.length,parameters:a}}(e,t,n);a=l.consumedSegments,s=n.slice(l.lastChild),o=new $c(a,l.parameters,Object.freeze(i({},this.urlTree.queryParams)),this.urlTree.fragment,Wp(t),r,t.component,t,zp(e),Bp(e)+a.length,Hp(t))}var c=function(t){return t.children?t.children:t.loadChildren?t._loadedConfig.routes:[]}(t),p=Up(e,a,s,c,this.relativeLinkResolution),h=p.segmentGroup,f=p.slicedSegments;if(0===f.length&&h.hasChildren()){var d=this.processChildren(c,h);return[new jc(o,d)]}if(0===c.length&&0===f.length)return[new jc(o,[])];var m=this.processSegment(c,h,f,nc);return[new jc(o,m)]},t}();function zp(t){for(var e=t;e._sourceSegment;)e=e._sourceSegment;return e}function Bp(t){for(var e=t,n=e._segmentIndexShift?e._segmentIndexShift:0;e._sourceSegment;)n+=(e=e._sourceSegment)._segmentIndexShift?e._segmentIndexShift:0;return n-1}function Up(t,e,n,r,o){if(n.length>0&&function(t,e,n){return r.some(function(n){return Vp(t,e,n)&&jp(n)!==nc})}(t,n)){var a=new wc(e,function(t,e,n,r){var o,i,a={};a[nc]=r,r._sourceSegment=t,r._segmentIndexShift=e.length;try{for(var s=c(n),u=s.next();!u.done;u=s.next()){var l=u.value;if(""===l.path&&jp(l)!==nc){var p=new wc([],{});p._sourceSegment=t,p._segmentIndexShift=e.length,a[jp(l)]=p}}}catch(h){o={error:h}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return a}(t,e,r,new wc(n,t.children)));return a._sourceSegment=t,a._segmentIndexShift=e.length,{segmentGroup:a,slicedSegments:[]}}if(0===n.length&&function(t,e,n){return r.some(function(n){return Vp(t,e,n)})}(t,n)){var s=new wc(t.segments,function(t,e,n,r,o,a){var s,u,l={};try{for(var p=c(r),h=p.next();!h.done;h=p.next()){var f=h.value;if(Vp(t,n,f)&&!o[jp(f)]){var d=new wc([],{});d._sourceSegment=t,d._segmentIndexShift="legacy"===a?t.segments.length:e.length,l[jp(f)]=d}}}catch(m){s={error:m}}finally{try{h&&!h.done&&(u=p.return)&&u.call(p)}finally{if(s)throw s.error}}return i({},o,l)}(t,e,n,r,t.children,o));return s._sourceSegment=t,s._segmentIndexShift=e.length,{segmentGroup:s,slicedSegments:n}}var u=new wc(t.segments,t.children);return u._sourceSegment=t,u._segmentIndexShift=e.length,{segmentGroup:u,slicedSegments:n}}function Vp(t,e,n){return(!(t.hasChildren()||e.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0===n.redirectTo}function jp(t){return t.outlet||nc}function Wp(t){return t.data||{}}function Hp(t){return t.resolve||{}}function qp(t,e,n,r){var o=Ip(t,e,r);return vc(o.resolve?o.resolve(e,n):o(e,n))}function Gp(t){return function(e){return e.pipe(wu(function(e){var n=t(e);return n?at(n).pipe(nt(function(){return e})):at([e])}))}}var Kp=function(){return function(){}}(),$p=function(){function t(){}return t.prototype.shouldDetach=function(t){return!1},t.prototype.store=function(t,e){},t.prototype.shouldAttach=function(t){return!1},t.prototype.retrieve=function(t){return null},t.prototype.shouldReuseRoute=function(t,e){return t.routeConfig===e.routeConfig},t}(),Xp=new Ct("ROUTES"),Zp=function(){function t(t,e,n,r){this.loader=t,this.compiler=e,this.onLoadStartListener=n,this.onLoadEndListener=r}return t.prototype.load=function(t,e){var n=this;return this.onLoadStartListener&&this.onLoadStartListener(e),this.loadModuleFactory(e.loadChildren).pipe(nt(function(r){n.onLoadEndListener&&n.onLoadEndListener(e);var o=r.create(t);return new uc(dc(o.injector.get(Xp)).map(hc),o)}))},t.prototype.loadModuleFactory=function(t){var e=this;return"string"==typeof t?at(this.loader.load(t)):vc(t()).pipe(st(function(t){return t instanceof Re?Bs(t):at(e.compiler.compileModuleAsync(t))}))},t}(),Yp=function(){return function(){}}(),Qp=function(){function t(){}return t.prototype.shouldProcessUrl=function(t){return!0},t.prototype.extract=function(t){return t},t.prototype.merge=function(t,e){return t},t}();function Jp(t){throw t}function th(t,e,n){return e.parse("/")}function eh(t,e){return Bs(null)}var nh=function(){function t(t,e,n,r,o,i,a,s){var u=this;this.rootComponentType=t,this.urlSerializer=e,this.rootContexts=n,this.location=r,this.config=s,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.navigationId=0,this.isNgZoneEnabled=!1,this.events=new V,this.errorHandler=Jp,this.malformedUriErrorHandler=th,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:eh,afterPreactivation:eh},this.urlHandlingStrategy=new Qp,this.routeReuseStrategy=new $p,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="legacy",this.ngModule=o.get(ke),this.console=o.get(Ln);var l=o.get(Yn);this.isNgZoneEnabled=l instanceof Yn,this.resetConfig(s),this.currentUrlTree=new bc(new wc([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new Zp(i,a,function(t){return u.triggerEvent(new $l(t))},function(t){return u.triggerEvent(new Xl(t))}),this.routerState=qc(this.currentUrlTree,this.rootComponentType),this.transitions=new Us({id:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}return t.prototype.setupNavigations=function(t){var e=this,n=this.events;return t.pipe($s(function(t){return 0!==t.id}),nt(function(t){return i({},t,{extractedUrl:e.urlHandlingStrategy.extract(t.rawUrl)})}),nu(function(t){e.currentNavigation={id:t.id,initialUrl:t.currentRawUrl,extractedUrl:t.extractedUrl,trigger:t.source,extras:t.extras,previousNavigation:e.lastSuccessfulNavigation?i({},e.lastSuccessfulNavigation,{previousNavigation:null}):null}}),wu(function(t){var r,o,a,s,u=!1,l=!1;return Bs(t).pipe(wu(function(t){var r,o,a,s,u=!e.navigated||t.extractedUrl.toString()!==e.browserUrlTree.toString();if(("reload"===e.onSameUrlNavigation||u)&&e.urlHandlingStrategy.shouldProcessUrl(t.rawUrl))return Bs(t).pipe(wu(function(t){var r=e.transitions.getValue();return n.next(new Bl(t.id,e.serializeUrl(t.extractedUrl),t.source,t.restoredState)),r!==e.transitions.getValue()?Ls:[t]}),wu(function(t){return Promise.resolve(t)}),(r=e.ngModule.injector,o=e.configLoader,a=e.urlSerializer,s=e.config,function(t){return t.pipe(wu(function(t){return function(e,n,r,o,i){return new wp(e,n,r,t.extractedUrl,i).apply()}(r,o,a,0,s).pipe(nt(function(e){return i({},t,{urlAfterRedirects:e})}))}))}),nu(function(t){e.currentNavigation=i({},e.currentNavigation,{finalUrl:t.urlAfterRedirects})}),function(t,n,r,o,a){return function(r){return r.pipe(st(function(r){return function(t,e,n,r,o,i){return void 0===o&&(o="emptyOnly"),void 0===i&&(i="legacy"),new Fp(t,e,n,r,o,i).recognize()}(t,n,r.urlAfterRedirects,(s=r.urlAfterRedirects,e.serializeUrl(s)),o,a).pipe(nt(function(t){return i({},r,{targetSnapshot:t})}));var s}))}}(e.rootComponentType,e.config,0,e.paramsInheritanceStrategy,e.relativeLinkResolution),nu(function(t){"eager"===e.urlUpdateStrategy&&(t.extras.skipLocationChange||e.setBrowserUrl(t.urlAfterRedirects,!!t.extras.replaceUrl,t.id),e.browserUrlTree=t.urlAfterRedirects)}),nu(function(t){var r=new Wl(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);n.next(r)}));if(u&&e.rawUrlTree&&e.urlHandlingStrategy.shouldProcessUrl(e.rawUrlTree)){var l=t.extractedUrl,c=t.source,p=t.restoredState,h=t.extras,f=new Bl(t.id,e.serializeUrl(l),c,p);n.next(f);var d=qc(l,e.rootComponentType).snapshot;return Bs(i({},t,{targetSnapshot:d,urlAfterRedirects:l,extras:i({},h,{skipLocationChange:!1,replaceUrl:!1})}))}return e.rawUrlTree=t.rawUrl,t.resolve(null),Ls}),Gp(function(t){var n=t.extras;return e.hooks.beforePreactivation(t.targetSnapshot,{navigationId:t.id,appliedUrlTree:t.extractedUrl,rawUrlTree:t.rawUrl,skipLocationChange:!!n.skipLocationChange,replaceUrl:!!n.replaceUrl})}),nu(function(t){var n=new Hl(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);e.triggerEvent(n)}),nt(function(t){return i({},t,{guards:(n=t.targetSnapshot,r=t.currentSnapshot,o=e.rootContexts,a=n._root,Tp(a,r?r._root:null,o,[a.value]))});var n,r,o,a}),function(t,e){return function(n){return n.pipe(st(function(n){var r=n.targetSnapshot,o=n.currentSnapshot,a=n.guards,s=a.canActivateChecks,u=a.canDeactivateChecks;return 0===u.length&&0===s.length?Bs(i({},n,{guardsResult:!0})):function(t,e,n,r){return at(u).pipe(st(function(t){return function(t,e,n,r,o){var i=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return i&&0!==i.length?Bs(i.map(function(i){var a,s=Ip(i,e,o);if(function(t){return t&&fp(t.canDeactivate)}(s))a=vc(s.canDeactivate(t,e,n,r));else{if(!fp(s))throw new Error("Invalid CanDeactivate guard");a=vc(s(t,e,n,r))}return a.pipe(vu())})).pipe(Rp()):Bs(!0)}(t.component,t.route,n,e,r)}),vu(function(t){return!0!==t},!0))}(0,r,o,t).pipe(st(function(n){return n&&"boolean"==typeof n?function(t,e,n,r){return at(s).pipe(_u(function(e){return at([Dp(e.route.parent,r),Op(e.route,r),Pp(t,e.path,n),Mp(t,e.route,n)]).pipe(Ks(),vu(function(t){return!0!==t},!0))}),vu(function(t){return!0!==t},!0))}(r,0,t,e):Bs(n)}),nt(function(t){return i({},n,{guardsResult:t})}))}))}}(e.ngModule.injector,function(t){return e.triggerEvent(t)}),nu(function(t){if(dp(t.guardsResult)){var n=ac('Redirecting to "'+e.serializeUrl(t.guardsResult)+'"');throw n.url=t.guardsResult,n}}),nu(function(t){var n=new ql(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(t.urlAfterRedirects),t.targetSnapshot,!!t.guardsResult);e.triggerEvent(n)}),$s(function(t){if(!t.guardsResult){e.resetUrlToCurrentUrlTree();var r=new Vl(t.id,e.serializeUrl(t.extractedUrl),"");return n.next(r),t.resolve(!1),!1}return!0}),Gp(function(t){if(t.guards.canActivateChecks.length)return Bs(t).pipe(nu(function(t){var n=new Gl(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);e.triggerEvent(n)}),(n=e.paramsInheritanceStrategy,r=e.ngModule.injector,function(t){return t.pipe(st(function(t){var e=t.targetSnapshot,o=t.guards.canActivateChecks;return o.length?at(o).pipe(_u(function(t){return function(t,n,r,o){return function(t,e,n,r){var o=Object.keys(t);if(0===o.length)return Bs({});if(1===o.length){var i=o[0];return qp(t[i],e,n,r).pipe(nt(function(t){var e;return(e={})[i]=t,e}))}var a={};return at(o).pipe(st(function(o){return qp(t[o],e,n,r).pipe(nt(function(t){return a[o]=t,t}))})).pipe(cu(),nt(function(){return a}))}(t._resolve,t,e,o).pipe(nt(function(e){return t._resolvedData=e,t.data=i({},t.data,Kc(t,r).resolve),null}))}(t.route,0,n,r)}),function(t,e){return arguments.length>=2?function(e){return D(Cu(t,void 0),Js(1),su(void 0))(e)}:function(e){return D(Cu(function(e,n,r){return t(e)}),Js(1))(e)}}(function(t,e){return t}),nt(function(e){return t})):Bs(t)}))}),nu(function(t){var n=new Kl(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);e.triggerEvent(n)}));var n,r}),Gp(function(t){var n=t.extras;return e.hooks.afterPreactivation(t.targetSnapshot,{navigationId:t.id,appliedUrlTree:t.extractedUrl,rawUrlTree:t.rawUrl,skipLocationChange:!!n.skipLocationChange,replaceUrl:!!n.replaceUrl})}),nt(function(t){var n,r,o,a=(o=function t(e,n,r){if(r&&e.shouldReuseRoute(n.value,r.value.snapshot)){(u=r.value)._futureSnapshot=n.value;var o=function(e,n,r){return n.children.map(function(n){var o,i;try{for(var a=c(r.children),s=a.next();!s.done;s=a.next()){var u=s.value;if(e.shouldReuseRoute(u.value.snapshot,n.value))return t(e,n,u)}}catch(l){o={error:l}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}return t(e,n)})}(e,n,r);return new jc(u,o)}var i=e.retrieve(n.value);if(i){var a=i.route;return function t(e,n){if(e.value.routeConfig!==n.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(e.children.length!==n.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");n.value._futureSnapshot=e.value;for(var r=0;r<e.children.length;++r)t(e.children[r],n.children[r])}(n,a),a}var s,u=new Gc(new Us((s=n.value).url),new Us(s.params),new Us(s.queryParams),new Us(s.fragment),new Us(s.data),s.outlet,s.component,s);return o=n.children.map(function(n){return t(e,n)}),new jc(u,o)}(e.routeReuseStrategy,(n=t.targetSnapshot)._root,(r=t.currentRouterState)?r._root:void 0),new Hc(o,n));return i({},t,{targetRouterState:a})}),nu(function(t){e.currentUrlTree=t.urlAfterRedirects,e.rawUrlTree=e.urlHandlingStrategy.merge(e.currentUrlTree,t.rawUrl),e.routerState=t.targetRouterState,"deferred"===e.urlUpdateStrategy&&(t.extras.skipLocationChange||e.setBrowserUrl(e.rawUrlTree,!!t.extras.replaceUrl,t.id,t.extras.state),e.browserUrlTree=t.urlAfterRedirects)}),(o=e.rootContexts,a=e.routeReuseStrategy,s=function(t){return e.triggerEvent(t)},nt(function(t){return new pp(a,t.targetRouterState,t.currentRouterState,s).activate(o),t})),nu({next:function(){u=!0},complete:function(){u=!0}}),(r=function(){if(!u&&!l){e.resetUrlToCurrentUrlTree();var r=new Vl(t.id,e.serializeUrl(t.extractedUrl),"Navigation ID "+t.id+" is not equal to the current navigation id "+e.navigationId);n.next(r),t.resolve(!1)}e.currentNavigation=null},function(t){return t.lift(new Iu(r))}),pu(function(r){if(l=!0,(s=r)&&s[ic]){var o=dp(r.url);o||(e.navigated=!0,e.resetStateAndUrl(t.currentRouterState,t.currentUrlTree,t.rawUrl));var i=new Vl(t.id,e.serializeUrl(t.extractedUrl),r.message);n.next(i),t.resolve(!1),o&&e.navigateByUrl(r.url)}else{e.resetStateAndUrl(t.currentRouterState,t.currentUrlTree,t.rawUrl);var a=new jl(t.id,e.serializeUrl(t.extractedUrl),r);n.next(a);try{t.resolve(e.errorHandler(r))}catch(u){t.reject(u)}}var s;return Ls}))}))},t.prototype.resetRootComponentType=function(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType},t.prototype.getTransition=function(){return this.transitions.value},t.prototype.setTransition=function(t){this.transitions.next(i({},this.getTransition(),t))},t.prototype.initialNavigation=function(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})},t.prototype.setUpLocationChangeListener=function(){var t=this;this.locationSubscription||(this.locationSubscription=this.location.subscribe(function(e){var n=t.parseUrl(e.url),r="popstate"===e.type?"popstate":"hashchange",o=e.state&&e.state.navigationId?e.state:null;setTimeout(function(){t.scheduleNavigation(n,r,o,{replaceUrl:!0})},0)}))},Object.defineProperty(t.prototype,"url",{get:function(){return this.serializeUrl(this.currentUrlTree)},enumerable:!0,configurable:!0}),t.prototype.getCurrentNavigation=function(){return this.currentNavigation},t.prototype.triggerEvent=function(t){this.events.next(t)},t.prototype.resetConfig=function(t){lc(t),this.config=t.map(hc),this.navigated=!1,this.lastSuccessfulId=-1},t.prototype.ngOnDestroy=function(){this.dispose()},t.prototype.dispose=function(){this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=null)},t.prototype.createUrlTree=function(t,e){void 0===e&&(e={});var n=e.relativeTo,r=e.queryParams,o=e.fragment,a=e.preserveQueryParams,s=e.queryParamsHandling,u=e.preserveFragment;He()&&a&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead.");var l=n||this.routerState.root,c=u?this.currentUrlTree.fragment:o,p=null;if(s)switch(s){case"merge":p=i({},this.currentUrlTree.queryParams,r);break;case"preserve":p=this.currentUrlTree.queryParams;break;default:p=r||null}else p=a?this.currentUrlTree.queryParams:r||null;return null!==p&&(p=this.removeEmptyProps(p)),function(t,e,n,r,o){if(0===n.length)return ep(e.root,e.root,e,r,o);var i=function(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new np(!0,0,t);var e=0,n=!1,r=t.reduce(function(t,r,o){if("object"==typeof r&&null!=r){if(r.outlets){var i={};return gc(r.outlets,function(t,e){i[e]="string"==typeof t?t.split("/"):t}),h(t,[{outlets:i}])}if(r.segmentPath)return h(t,[r.segmentPath])}return"string"!=typeof r?h(t,[r]):0===o?(r.split("/").forEach(function(r,o){0==o&&"."===r||(0==o&&""===r?n=!0:".."===r?e++:""!=r&&t.push(r))}),t):h(t,[r])},[]);return new np(n,e,r)}(n);if(i.toRoot())return ep(e.root,new wc([],{}),e,r,o);var a=function(t,n,r){if(t.isAbsolute)return new rp(e.root,!0,0);if(-1===r.snapshot._lastPathIndex)return new rp(r.snapshot._urlSegment,!0,0);var o=tp(t.commands[0])?0:1;return function(e,n,i){for(var a=r.snapshot._urlSegment,s=r.snapshot._lastPathIndex+o,u=t.numberOfDoubleDots;u>s;){if(u-=s,!(a=a.parent))throw new Error("Invalid number of '../'");s=a.segments.length}return new rp(a,!1,s-u)}()}(i,0,t),s=a.processChildren?ap(a.segmentGroup,a.index,i.commands):ip(a.segmentGroup,a.index,i.commands);return ep(a.segmentGroup,s,e,r,o)}(l,this.currentUrlTree,t,p,c)},t.prototype.navigateByUrl=function(t,e){void 0===e&&(e={skipLocationChange:!1}),He()&&this.isNgZoneEnabled&&!Yn.isInAngularZone()&&this.console.warn("Navigation triggered outside Angular zone, did you forget to call 'ngZone.run()'?");var n=dp(t)?t:this.parseUrl(t),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(r,"imperative",null,e)},t.prototype.navigate=function(t,e){return void 0===e&&(e={skipLocationChange:!1}),function(t){for(var e=0;e<t.length;e++){var n=t[e];if(null==n)throw new Error("The requested path contains "+n+" segment at index "+e)}}(t),this.navigateByUrl(this.createUrlTree(t,e),e)},t.prototype.serializeUrl=function(t){return this.urlSerializer.serialize(t)},t.prototype.parseUrl=function(t){var e;try{e=this.urlSerializer.parse(t)}catch($f){e=this.malformedUriErrorHandler($f,this.urlSerializer,t)}return e},t.prototype.isActive=function(t,e){if(dp(t))return yc(this.currentUrlTree,t,e);var n=this.parseUrl(t);return yc(this.currentUrlTree,n,e)},t.prototype.removeEmptyProps=function(t){return Object.keys(t).reduce(function(e,n){var r=t[n];return null!=r&&(e[n]=r),e},{})},t.prototype.processNavigations=function(){var t=this;this.navigations.subscribe(function(e){t.navigated=!0,t.lastSuccessfulId=e.id,t.events.next(new Ul(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(t.currentUrlTree))),t.lastSuccessfulNavigation=t.currentNavigation,t.currentNavigation=null,e.resolve(!0)},function(e){t.console.warn("Unhandled Navigation Error: ")})},t.prototype.scheduleNavigation=function(t,e,n,r){var o=this.getTransition();if(o&&"imperative"!==e&&"imperative"===o.source&&o.rawUrl.toString()===t.toString())return Promise.resolve(!0);if(o&&"hashchange"==e&&"popstate"===o.source&&o.rawUrl.toString()===t.toString())return Promise.resolve(!0);if(o&&"popstate"==e&&"hashchange"===o.source&&o.rawUrl.toString()===t.toString())return Promise.resolve(!0);var i=null,a=null,s=new Promise(function(t,e){i=t,a=e}),u=++this.navigationId;return this.setTransition({id:u,source:e,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:t,extras:r,resolve:i,reject:a,promise:s,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),s.catch(function(t){return Promise.reject(t)})},t.prototype.setBrowserUrl=function(t,e,n,r){var o=this.urlSerializer.serialize(t);r=r||{},this.location.isCurrentPathEqualTo(o)||e?this.location.replaceState(o,"",i({},r,{navigationId:n})):this.location.go(o,"",i({},r,{navigationId:n}))},t.prototype.resetStateAndUrl=function(t,e,n){this.routerState=t,this.currentUrlTree=e,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n),this.resetUrlToCurrentUrlTree()},t.prototype.resetUrlToCurrentUrlTree=function(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",{navigationId:this.lastSuccessfulId})},t}(),rh=function(){return function(){this.outlet=null,this.route=null,this.resolver=null,this.children=new oh,this.attachRef=null}}(),oh=function(){function t(){this.contexts=new Map}return t.prototype.onChildOutletCreated=function(t,e){var n=this.getOrCreateContext(t);n.outlet=e,this.contexts.set(t,n)},t.prototype.onChildOutletDestroyed=function(t){var e=this.getContext(t);e&&(e.outlet=null)},t.prototype.onOutletDeactivated=function(){var t=this.contexts;return this.contexts=new Map,t},t.prototype.onOutletReAttached=function(t){this.contexts=t},t.prototype.getOrCreateContext=function(t){var e=this.getContext(t);return e||(e=new rh,this.contexts.set(t,e)),e},t.prototype.getContext=function(t){return this.contexts.get(t)||null},t}(),ih=function(){function t(t,e,n,r,o){this.parentContexts=t,this.location=e,this.resolver=n,this.changeDetector=o,this.activated=null,this._activatedRoute=null,this.activateEvents=new fn,this.deactivateEvents=new fn,this.name=r||nc,t.onChildOutletCreated(this.name,this)}return t.prototype.ngOnDestroy=function(){this.parentContexts.onChildOutletDestroyed(this.name)},t.prototype.ngOnInit=function(){if(!this.activated){var t=this.parentContexts.getContext(this.name);t&&t.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.resolver||null))}},Object.defineProperty(t.prototype,"isActivated",{get:function(){return!!this.activated},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"component",{get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activatedRoute",{get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activatedRouteData",{get:function(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}},enumerable:!0,configurable:!0}),t.prototype.detach=function(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();var t=this.activated;return this.activated=null,this._activatedRoute=null,t},t.prototype.attach=function(t,e){this.activated=t,this._activatedRoute=e,this.location.insert(t.hostView)},t.prototype.deactivate=function(){if(this.activated){var t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}},t.prototype.activateWith=function(t,e){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=t;var n=(e=e||this.resolver).resolveComponentFactory(t._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,o=new ah(t,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,o),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)},t}(),ah=function(){function t(t,e,n){this.route=t,this.childContexts=e,this.parent=n}return t.prototype.get=function(t,e){return t===Gc?this.route:t===oh?this.childContexts:this.parent.get(t,e)},t}(),sh=function(){return function(){}}(),uh=function(){function t(){}return t.prototype.preload=function(t,e){return e().pipe(pu(function(){return Bs(null)}))},t}(),lh=function(){function t(){}return t.prototype.preload=function(t,e){return Bs(null)},t}(),ch=function(){function t(t,e,n,r,o){this.router=t,this.injector=r,this.preloadingStrategy=o,this.loader=new Zp(e,n,function(e){return t.triggerEvent(new $l(e))},function(e){return t.triggerEvent(new Xl(e))})}return t.prototype.setUpPreloading=function(){var t=this;this.subscription=this.router.events.pipe($s(function(t){return t instanceof Ul}),_u(function(){return t.preload()})).subscribe(function(){})},t.prototype.preload=function(){var t=this.injector.get(ke);return this.processRoutes(t,this.router.config)},t.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},t.prototype.processRoutes=function(t,e){var n,r,o=[];try{for(var i=c(e),a=i.next();!a.done;a=i.next()){var s=a.value;if(s.loadChildren&&!s.canLoad&&s._loadedConfig){var u=s._loadedConfig;o.push(this.processRoutes(u.module,u.routes))}else s.loadChildren&&!s.canLoad?o.push(this.preloadConfig(t,s)):s.children&&o.push(this.processRoutes(t,s.children))}}catch(l){n={error:l}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return at(o).pipe(pt(),nt(function(t){}))},t.prototype.preloadConfig=function(t,e){var n=this;return this.preloadingStrategy.preload(e,function(){return n.loader.load(t.injector,e).pipe(st(function(t){return e._loadedConfig=t,n.processRoutes(t.module,t.routes)}))})},t}(),ph=function(){function t(t,e,n){void 0===n&&(n={}),this.router=t,this.viewportScroller=e,this.options=n,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},n.scrollPositionRestoration=n.scrollPositionRestoration||"disabled",n.anchorScrolling=n.anchorScrolling||"disabled"}return t.prototype.init=function(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()},t.prototype.createScrollEvents=function(){var t=this;return this.router.events.subscribe(function(e){e instanceof Bl?(t.store[t.lastId]=t.viewportScroller.getScrollPosition(),t.lastSource=e.navigationTrigger,t.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof Ul&&(t.lastId=e.id,t.scheduleScrollEvent(e,t.router.parseUrl(e.urlAfterRedirects).fragment))})},t.prototype.consumeScrollEvents=function(){var t=this;return this.router.events.subscribe(function(e){e instanceof tc&&(e.position?"top"===t.options.scrollPositionRestoration?t.viewportScroller.scrollToPosition([0,0]):"enabled"===t.options.scrollPositionRestoration&&t.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===t.options.anchorScrolling?t.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==t.options.scrollPositionRestoration&&t.viewportScroller.scrollToPosition([0,0]))})},t.prototype.scheduleScrollEvent=function(t,e){this.router.triggerEvent(new tc(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,e))},t.prototype.ngOnDestroy=function(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()},t}(),hh=new Ct("ROUTER_CONFIGURATION"),fh=new Ct("ROUTER_FORROOT_GUARD"),dh=[ds,{provide:Ec,useClass:Nc},{provide:nh,useFactory:xh,deps:[dr,Ec,oh,ds,se,yn,Hn,Xp,hh,[Yp,new jt],[Kp,new jt]]},oh,{provide:Gc,useFactory:Sh,deps:[nh]},{provide:yn,useClass:br},ch,lh,uh,{provide:hh,useValue:{enableTracing:!1}}];function mh(){return new lr("Router",nh)}var gh=function(){function t(t,e){}var e;return e=t,t.forRoot=function(t,n){return{ngModule:e,providers:[dh,wh(t),{provide:fh,useFactory:bh,deps:[[nh,new jt,new Ht]]},{provide:hh,useValue:n||{}},{provide:hs,useFactory:yh,deps:[cs,[new Vt(fs),new jt],hh]},{provide:ph,useFactory:vh,deps:[nh,Ms,hh]},{provide:sh,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:lh},{provide:lr,multi:!0,useFactory:mh},[Ch,{provide:Tn,multi:!0,useFactory:Eh,deps:[Ch]},{provide:_h,useFactory:Nh,deps:[Ch]},{provide:Pn,multi:!0,useExisting:_h}]]}},t.forChild=function(t){return{ngModule:e,providers:[wh(t)]}},t}();function vh(t,e,n){return n.scrollOffset&&e.setOffset(n.scrollOffset),new ph(t,e,n)}function yh(t,e,n){return void 0===n&&(n={}),n.useHash?new gs(t,e):new vs(t,e)}function bh(t){if(t)throw new Error("RouterModule.forRoot() called twice. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function wh(t){return[{provide:_t,multi:!0,useValue:t},{provide:Xp,multi:!0,useValue:t}]}function xh(t,e,n,r,o,i,a,s,u,l,c){void 0===u&&(u={});var p=new nh(null,e,n,r,o,i,a,dc(s));if(l&&(p.urlHandlingStrategy=l),c&&(p.routeReuseStrategy=c),u.errorHandler&&(p.errorHandler=u.errorHandler),u.malformedUriErrorHandler&&(p.malformedUriErrorHandler=u.malformedUriErrorHandler),u.enableTracing){var h=ku();p.events.subscribe(function(t){h.logGroup("Router Event: "+t.constructor.name),h.log(t.toString()),h.log(t),h.logGroupEnd()})}return u.onSameUrlNavigation&&(p.onSameUrlNavigation=u.onSameUrlNavigation),u.paramsInheritanceStrategy&&(p.paramsInheritanceStrategy=u.paramsInheritanceStrategy),u.urlUpdateStrategy&&(p.urlUpdateStrategy=u.urlUpdateStrategy),u.relativeLinkResolution&&(p.relativeLinkResolution=u.relativeLinkResolution),p}function Sh(t){return t.routerState.root}var Ch=function(){function t(t){this.injector=t,this.initNavigation=!1,this.resultOfPreactivationDone=new V}return t.prototype.appInitializer=function(){var t=this;return this.injector.get(ps,Promise.resolve(null)).then(function(){var e=null,n=new Promise(function(t){return e=t}),r=t.injector.get(nh),o=t.injector.get(hh);if(t.isLegacyDisabled(o)||t.isLegacyEnabled(o))e(!0);else if("disabled"===o.initialNavigation)r.setUpLocationChangeListener(),e(!0);else{if("enabled"!==o.initialNavigation)throw new Error("Invalid initialNavigation options: '"+o.initialNavigation+"'");r.hooks.afterPreactivation=function(){return t.initNavigation?Bs(null):(t.initNavigation=!0,e(!0),t.resultOfPreactivationDone)},r.initialNavigation()}return n})},t.prototype.bootstrapListener=function(t){var e=this.injector.get(hh),n=this.injector.get(ch),r=this.injector.get(ph),o=this.injector.get(nh),i=this.injector.get(dr);t===i.components[0]&&(this.isLegacyEnabled(e)?o.initialNavigation():this.isLegacyDisabled(e)&&o.setUpLocationChangeListener(),n.setUpPreloading(),r.init(),o.resetRootComponentType(i.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())},t.prototype.isLegacyEnabled=function(t){return"legacy_enabled"===t.initialNavigation||!0===t.initialNavigation||void 0===t.initialNavigation},t.prototype.isLegacyDisabled=function(t){return"legacy_disabled"===t.initialNavigation||!1===t.initialNavigation},t}();function Eh(t){return t.appInitializer.bind(t)}function Nh(t){return t.bootstrapListener.bind(t)}var _h=new Ct("Router Initializer"),Ih=mo({encapsulation:2,styles:[],data:{}});function Th(t){return ta(0,[(t()(),Wo(0,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),ki(1,212992,null,0,ih,[oh,xr,Ie,[8,null],Cr],null,null)],function(t,e){t(e,1,0)},null)}function Ah(t){return ta(0,[(t()(),Wo(0,0,null,null,1,"ng-component",[],null,null,null,Th,Ih)),ki(1,49152,null,0,ec,[],null,null)],null,null)}var kh=si("ng-component",ec,Ah,{},{},[]),Rh=function(){function t(t,e,n){this._mimeType=null,this._imageAsBase64=null,this._imageAsDataUrl=null,this._imageData=null,this._mimeType=e,this._imageAsDataUrl=t,this._imageData=n}return t.getDataFromDataUrl=function(t,e){return t.replace("data:"+e+";base64,","")},Object.defineProperty(t.prototype,"imageAsBase64",{get:function(){return this._imageAsBase64?this._imageAsBase64:this._imageAsBase64=t.getDataFromDataUrl(this._imageAsDataUrl,this._mimeType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageAsDataUrl",{get:function(){return this._imageAsDataUrl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageData",{get:function(){return this._imageData},enumerable:!0,configurable:!0}),t}(),Oh=function(){function t(){this.width=224,this.height=224,this.videoOptions=t.DEFAULT_VIDEO_OPTIONS,this.allowCameraSwitch=!0,this.captureImageData=!1,this.imageType=t.DEFAULT_IMAGE_TYPE,this.imageQuality=t.DEFAULT_IMAGE_QUALITY,this.imageCapture=new fn,this.initError=new fn,this.imageClick=new fn,this.cameraSwitched=new fn,this.availableVideoInputs=[],this.videoInitialized=!1,this.activeVideoInputIndex=-1,this.mediaStream=null,this.activeVideoSettings=null}return Object.defineProperty(t.prototype,"trigger",{set:function(t){var e=this;this.triggerSubscription&&this.triggerSubscription.unsubscribe(),this.triggerSubscription=t.subscribe(function(){e.takeSnapshot()})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"switchCamera",{set:function(t){var e=this;this.switchCameraSubscription&&this.switchCameraSubscription.unsubscribe(),this.switchCameraSubscription=t.subscribe(function(t){"string"==typeof t?e.switchToVideoInput(t):e.rotateVideoInput(!1!==t)})},enumerable:!0,configurable:!0}),t.getMediaConstraintsForDevice=function(t,e){var n=e||this.DEFAULT_VIDEO_OPTIONS;return t&&(n.deviceId={exact:t}),n},t.getDeviceIdFromMediaStreamTrack=function(e){if(e.getSettings&&e.getSettings()&&e.getSettings().deviceId)return e.getSettings().deviceId;if(e.getConstraints&&e.getConstraints()&&e.getConstraints().deviceId){var n=e.getConstraints().deviceId;return t.getValueFromConstrainDOMString(n)}},t.getFacingModeFromMediaStreamTrack=function(e){if(e){if(e.getSettings&&e.getSettings()&&e.getSettings().facingMode)return e.getSettings().facingMode;if(e.getConstraints&&e.getConstraints()&&e.getConstraints().facingMode){var n=e.getConstraints().facingMode;return t.getValueFromConstrainDOMString(n)}}},t.isUserFacing=function(e){var n=t.getFacingModeFromMediaStreamTrack(e);return!!n&&"user"===n.toLowerCase()},t.getValueFromConstrainDOMString=function(t){if(t){if(t instanceof String)return String(t);if(Array.isArray(t)&&Array(t).length>0)return String(t[0]);if("object"==typeof t){if(t.exact)return String(t.exact);if(t.ideal)return String(t.ideal)}}return null},t.prototype.ngAfterViewInit=function(){var t=this;this.detectAvailableDevices().then(function(e){t.switchToVideoInput(e.length>0?e[0].deviceId:null)}).catch(function(e){t.initError.next({message:e}),t.switchToVideoInput(null)})},t.prototype.ngOnDestroy=function(){this.stopMediaTracks(),this.unsubscribeFromSubscriptions()},t.prototype.takeSnapshot=function(){var e=this.video.nativeElement,n={width:this.width,height:this.height};e.videoWidth&&(n.width=e.videoWidth,n.height=e.videoHeight);var r=this.canvas.nativeElement;r.width=n.width,r.height=n.height;var o=r.getContext("2d");o.drawImage(this.video.nativeElement,0,0);var i=this.imageType?this.imageType:t.DEFAULT_IMAGE_TYPE,a=r.toDataURL(i,this.imageQuality?this.imageQuality:t.DEFAULT_IMAGE_QUALITY),s=null;this.captureImageData&&(s=o.getImageData(0,0,r.width,r.height)),this.imageCapture.next(new Rh(a,i,s))},t.prototype.rotateVideoInput=function(t){this.availableVideoInputs&&this.availableVideoInputs.length>1&&this.switchToVideoInput(this.availableVideoInputs[(this.activeVideoInputIndex+(t?1:this.availableVideoInputs.length-1))%this.availableVideoInputs.length].deviceId)},t.prototype.switchToVideoInput=function(t){this.videoInitialized=!1,this.stopMediaTracks(),this.initWebcam(t,this.videoOptions)},t.prototype.videoResize=function(){},Object.defineProperty(t.prototype,"videoWidth",{get:function(){var t=this.getVideoAspectRatio();return Math.min(this.width,this.height*t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"videoHeight",{get:function(){var t=this.getVideoAspectRatio();return Math.min(this.height,this.width/t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"videoStyleClasses",{get:function(){var t="";return this.isMirrorImage()&&(t+="mirrored "),t.trim()},enumerable:!0,configurable:!0}),t.prototype.getVideoAspectRatio=function(){var t=this.video.nativeElement;return t.videoWidth&&t.videoWidth>0&&t.videoHeight&&t.videoHeight>0?t.videoWidth/t.videoHeight:this.width/this.height},t.prototype.initWebcam=function(e,n){var r=this,o=this.video.nativeElement;if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var i=t.getMediaConstraintsForDevice(e,n);navigator.mediaDevices.getUserMedia({video:i}).then(function(e){r.mediaStream=e,o.srcObject=e,o.play(),r.activeVideoSettings=e.getVideoTracks()[0].getSettings();var n=t.getDeviceIdFromMediaStreamTrack(e.getVideoTracks()[0]);r.activeVideoInputIndex=n?r.availableVideoInputs.findIndex(function(t){return t.deviceId===n}):-1,r.videoInitialized=!0,r.cameraSwitched.next(n)}).catch(function(t){r.initError.next({message:t.message,mediaStreamError:t})})}else this.initError.next({message:"Cannot read UserMedia from MediaDevices."})},t.prototype.getActiveVideoTrack=function(){return this.mediaStream?this.mediaStream.getVideoTracks()[0]:null},t.prototype.isMirrorImage=function(){if(!this.getActiveVideoTrack())return!1;var e="auto";switch(this.mirrorImage&&("string"==typeof this.mirrorImage?e=String(this.mirrorImage).toLowerCase():this.mirrorImage.x&&(e=this.mirrorImage.x.toLowerCase())),e){case"always":return!0;case"never":return!1}return t.isUserFacing(this.getActiveVideoTrack())},t.prototype.stopMediaTracks=function(){this.mediaStream&&this.mediaStream.getTracks&&this.mediaStream.getTracks().forEach(function(t){return t.stop()})},t.prototype.unsubscribeFromSubscriptions=function(){this.triggerSubscription&&this.triggerSubscription.unsubscribe(),this.switchCameraSubscription&&this.switchCameraSubscription.unsubscribe()},t.prototype.detectAvailableDevices=function(){var t=this;return new Promise(function(e,n){us.getAvailableVideoInputs().then(function(n){t.availableVideoInputs=n,e(n)}).catch(function(e){t.availableVideoInputs=[],n(e)})})},t.DEFAULT_VIDEO_OPTIONS={facingMode:"environment"},t.DEFAULT_IMAGE_TYPE="image/jpeg",t.DEFAULT_IMAGE_QUALITY=.92,t}(),Dh=mo({encapsulation:0,styles:[[".webcam-wrapper[_ngcontent-%COMP%]{display:inline-block;position:relative;line-height:0}.webcam-wrapper[_ngcontent-%COMP%]   video.mirrored[_ngcontent-%COMP%]{-webkit-transform:scale(-1,1);transform:scale(-1,1)}.webcam-wrapper[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{display:none}.webcam-wrapper[_ngcontent-%COMP%]   .camera-switch[_ngcontent-%COMP%]{background-color:rgba(0,0,0,.1);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAE9UlEQVR42u2aT2hdRRTGf+cRQqghSqihdBFDkRISK2KDfzDWxHaRQHEhaINKqa1gKQhd6EZLN+IidCH+Q0oWIkVRC21BQxXRitVaSbKoJSGtYGoK2tQ/tU1jY5v0c5F54Xl7b/KSO/PyEt+3e5f75p7zzZwzZ74zUEIJJfyfYaEGllQGVAGZlENdBy6Z2cSiYFTSKkkfS/pH/nBF0kFJdUW9AiRVASeAukD8DgNrzOySrwEzng18KaDzALXuG8W3AiStAvqBisBRNg40mtlPxbYCOgvgPO4bncWW+JpVeDQXRQhIygDfA00F5r0XuNfMrgclQFI98DDQCNQA5ZFXqoCWBVp8XwHRHeEqcN7loy/NbHBesyqpQ1KfFj/6nC+ZvFaApFrgPaCZpYVvgCfNbDiRAElNwGFg+RIt/X8H2s2s9wYCJDUAR4HqJX7++RN40MwGpgmQVAH0AQ2BPz4AHHPl8nBOAqtyFWQjsA6oL4Ada81sPDv7uwImod8kvSJp9RyS8O2SXnb/DYVd2Y9VSroQ4ANXJO2WVJmixqh0kzMWwL4LkiqRtDnA4D1zmfE8j9g9AezcnAHaPcfXdbfdnPZ2Yps6+DwAvO/Z1naTdApY7Xng48BDZnY1MpMVQBuw3iXc5Tnb0wBwBPjUzP6eoezuArZ6svM0geJLkvZEYnl3nkntoqROSbckSW2Suj3ZOIangc7GPJuUtNGdFIfmMeavktoSSKiW9LMPw30Q8JqkekmjCbOZRhuclLQjgYSNxUBAj6RyZ9ATgUJpUtJTCSR8vpAEXHAyWK5BXYFIGHOlepSAloUk4NEYgyoknQhEwhFJ0e8h6VSaQeerCb5uZgdi9utxYBNwOUD93hIVXswM4INCi6K9wAszFC2DwLOBDjHbYp59karIUnRdzYy/3ClqVklaUhfwTICj7K25OqA7a4wWagVsm4Me/xzwg2cCqqONFzO7DPxSCAJi436GUBgHHguQD2oTlJ55oSzP9ybccsttSJw1szdjFOSnI/8dTCGZHwcORp4Nx7y3B1iZ8/sm4MW8/Euxg5wIsS/HaAp3zeP4/G7obRDXI4jiTIA22H7Xdc7X+S3A5lC7QBQ357aq3VAjCeSkwUfAJrfvz+R8A9ADLAtZB+TinpjC5JMA+//jwPZZnF8G7J+L8z4IWB/zbG+gIujVWfLBW/NStVMmqaG4POJRsIjix7h8IGnLQuoBbQki5sVAJHyYm7YkNaRRtXwQ8G1cHpX0iKRrgUjYno17Sf0LrQhJUkdCeHWkVITGJI0k1QeS3ikGSUzOyJUJJNznYneuOCnpTldcxa2kP3xJYqOeSDjqZG8ShJLnE8TTuMS6Iyu1BW7djZqkfo9N0QOuYJmYQddfB7RG+gLTNzqAY9FrL+5/nwEbvDdJJe3zzOrhNP3AWRqmk55t3ZcBuj3b2gb0Sbrbo/NNzk7fFzu7s/E5EiC+rrmeQU0Kx2skvRFoOx2ZzlmSdgbsw49JetvtBpk8nM64d/cGbNtJ0s7cGyJlwHeEv+t3nqnLSgPAUOSGyG3AHUxdzqoJbEcvcL+ZTeTeEapzJKxgaeOcc/7Mf06D7kFrguS0VDAMtGadv+E47DT9tcChJej8ISfpD+abgTe45uOkFi8mnQ+JBVQ+d4VXuOptjavcyot8pq86mfwk8LWZnaOEEkoooYQSSojDv8AhQNeGfe0jAAAAAElFTkSuQmCC);background-repeat:no-repeat;border-radius:5px;position:absolute;right:13px;top:10px;height:48px;width:48px;background-size:80%;cursor:pointer;background-position:center;transition:background-color .2s ease}.webcam-wrapper[_ngcontent-%COMP%]   .camera-switch[_ngcontent-%COMP%]:hover{background-color:rgba(0,0,0,.18)}"]],data:{}});function Mh(t){return ta(0,[(t()(),Wo(0,0,null,null,0,"div",[["class","camera-switch"]],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.rotateVideoInput(!0)&&r),r},null,null))],null,null)}function Ph(t){return ta(0,[qi(402653184,1,{video:0}),qi(402653184,2,{canvas:0}),(t()(),Wo(2,0,null,null,4,"div",[["class","webcam-wrapper"]],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.imageClick.next()&&r),r},null,null)),(t()(),Wo(3,0,[[1,0],["video",1]],null,0,"video",[["autoplay",""],["muted",""],["playsinline",""]],[[8,"width",0],[8,"height",0],[8,"className",0]],[[null,"resize"]],function(t,e,n){var r=!0;return"resize"===e&&(r=!1!==t.component.videoResize()&&r),r},null,null)),(t()(),jo(16777216,null,null,1,null,Mh)),ki(5,16384,null,0,Is,[xr,dn],{ngIf:[0,"ngIf"]},null),(t()(),Wo(6,0,[[2,0],["canvas",1]],null,0,"canvas",[],[[8,"width",0],[8,"height",0]],null,null,null,null))],function(t,e){var n=e.component;t(e,5,0,n.allowCameraSwitch&&n.availableVideoInputs.length>1&&n.videoInitialized)},function(t,e){var n=e.component;t(e,3,0,n.videoWidth,n.videoHeight,n.videoStyleClasses),t(e,6,0,n.width,n.height)})}var Lh=function(t,e){return(Lh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function Fh(t,e){function n(){this.constructor=t}Lh(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var zh=function(){return(zh=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function Bh(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function Uh(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var Vh={},jh={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Wh(t){t in Vh||(Vh[t]=function(t){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var e=document.createElement("canvas");return e.addEventListener("webglcontextlost",function(e){e.preventDefault(),delete Vh[t]},!1),1===t?e.getContext("webgl",jh)||e.getContext("experimental-webgl",jh):e.getContext("webgl2",jh)}(t));var e=Vh[t];return e.isContextLost()?(delete Vh[t],Wh(t)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Vh[t])}function Hh(t){for(var e=t.length,n=0,r=0;e>0;)r=Math.random()*e|0,n=t[--e],t[e]=t[r],t[r]=n}function qh(t,e,n){return Math.max(t,Math.min(e,n))}function Gh(t){return t%2==0?t:t+1}function Kh(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return e}function $h(t,e){var n=Math.random();return e*n+(1-n)*t}function Xh(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function Zh(t,e,n){void 0===n&&(n=""),Xh(tf(t,e),function(){return n+" Shapes "+t+" and "+e+" must match"})}function Yh(t){Xh(null!=t,function(){return"The input to the tensor constructor must be a non-null value."})}function Qh(t,e){if(void 0===e&&(e=[]),null==e&&(e=[]),Array.isArray(t)||mf(t))for(var n=0;n<t.length;++n)Qh(t[n],e);else e.push(t);return e}function Jh(t){if(0===t.length)return 1;for(var e=t[0],n=1;n<t.length;n++)e*=t[n];return e}function tf(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function ef(t){return t%1==0}function nf(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var e=Math.exp(2*t);return(e-1)/(e+1)}function rf(t){var e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function of(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function af(t,e,n){return void 0===e&&(e=function(t){return 0}),new Promise(function(r,o){var i=0,a=function(){if(t())r();else{var s=e(++i);null!=n&&i>=n?o():setTimeout(a,s)}};a()})}function sf(t,e){for(var n=1,r=-1,o=0;o<t.length;++o)if(t[o]>=0)n*=t[o];else if(-1===t[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(t[o]<0)throw Error("Shapes can not be < 0. Found "+t[o]+" at dim "+o);if(-1===r){if(e>0&&e!==n)throw Error("Size("+e+") must match the product of shape "+t);return t}if(0===n)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(e%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+n);var i=t.slice();return i[r]=e/n,i}function uf(t,e){var n=e.length;return Xh((t=null==t?e.map(function(t,e){return e}):[].concat(t)).every(function(t){return t>=-n&&t<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+t}),Xh(t.every(function(t){return ef(t)}),function(){return"All values in axis param must be integers but got axis "+t}),t.map(function(t){return t<0?n+t:t})}function lf(t,e){for(var n=[],r=[],o=null==e?null:uf(e,t).sort(),i=0,a=0;a<t.length;++a){if(null!=o){if(o[i]===a&&1!==t[a])throw new Error("Can't squeeze axis "+a+" since its dim '"+t[a]+"' is not 1");(null==o[i]||o[i]>a)&&1===t[a]&&(n.push(t[a]),r.push(a)),o[i]<=a&&i++}1!==t[a]&&(n.push(t[a]),r.push(a))}return{newShape:n,keptDims:r}}function cf(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error("Unknown data type "+t);n=new Uint8Array(e)}return n}function pf(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error("Unknown data type "+t);n=new Array(e)}return n}function hf(t,e,n){if("float32"===e)for(var r=0;r<t.length;r++){var o=t[r];if(isNaN(o)||!isFinite(o))throw Error("The result of the '"+n+"' is "+o+".")}}function ff(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function df(t,e){return!("complex64"===e||"float32"===e&&"complex64"!==t||"int32"===e&&"float32"!==t&&"complex64"!==t||"bool"===e&&"bool"===t)}function mf(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function gf(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function vf(t){if(null==t)return 0;var e=0;return t.forEach(function(t){return e+=2*t.length}),e}function yf(t){return"string"==typeof t||t instanceof String}function bf(t){return"boolean"==typeof t}function wf(t){return"number"==typeof t}function xf(t){return Array.isArray(t)?xf(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":wf(t)?"float32":yf(t)?"string":bf(t)?"bool":"float32"}function Sf(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Cf(t,e){for(var n=e;n<t;++n)if(t%n==0)return n;return t}function Ef(t){var e=t.length;if(e<2)return[];var n=new Array(e-1);n[e-2]=t[e-1];for(var r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function Nf(t,e,n){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Qh(t)),n&&ff(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){for(var r=new Uint8Array(t.length),o=0;o<r.length;++o)0!==Math.round(t[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+e)}function _f(t,e){if(0===t.length)return e[0];var n=t.reduce(function(t,e){return t*e});if(0===n)return[];if(n!==e.length)throw new Error("["+t+"] does not match the input size.");return function t(e,n,r){var o=new Array;if(1===n.length)for(var i=n[0],a=0;a<i;a++)o[a]=r[e+a];else{i=n[0];var s=n.slice(1),u=s.reduce(function(t,e){return t*e});for(a=0;a<i;a++)o[a]=t(e+a*u,s,r)}return o}(0,t,e)}function If(t,e){for(var n=Tf(t,e),r=0;r<n.length;r++)n[r]=1;return n}function Tf(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error("Unknown data type "+e)}function Af(){if("undefined"!=typeof performance)return performance.now();if("undefined"!=typeof process){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}function kf(t){t.forEach(function(e){Xh(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."})})}var Rf=Object.freeze({shuffle:Hh,clamp:qh,nearestLargerEven:Gh,sum:Kh,randUniform:$h,distSquared:function(t,e){for(var n=0,r=0;r<t.length;r++){var o=Number(t[r])-Number(e[r]);n+=o*o}return n},assert:Xh,assertShapesMatch:Zh,assertNonNull:Yh,flatten:Qh,sizeFromShape:Jh,isScalarShape:function(t){return 0===t.length},arraysEqual:tf,isInt:ef,tanh:nf,sizeToSquarishShape:rf,createShuffledIndices:function(t){for(var e=new Uint32Array(t),n=0;n<t;++n)e[n]=n;return Hh(e),e},rightPad:of,repeatedTry:af,inferFromImplicitShape:sf,parseAxisParam:uf,squeezeShape:lf,getTypedArrayFromDType:cf,getArrayFromDType:pf,checkComputationForErrors:hf,checkConversionForErrors:ff,hasEncodingLoss:df,isTypedArray:mf,bytesPerElement:gf,bytesFromStringArray:vf,isString:yf,isBoolean:bf,isNumber:wf,inferDtype:xf,isFunction:Sf,nearestDivisor:Cf,computeStrides:Ef,toTypedArray:Nf,toNestedArray:_f,makeOnesTypedArray:If,makeZerosTypedArray:Tf,now:Af,assertNonNegativeIntegerDimensions:kf}),Of=function(){function t(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new Df)}return t.prototype.profileKernel=function(t,e){var n,r=this,o=this.backendTimer.time(function(){n=e()});return(Array.isArray(n)?n:[n]).forEach(function(e){var n=e.dataSync();hf(n,e.dtype,t),o.then(function(o){var i="";null!=o.getExtraProfileInfo&&(i=o.getExtraProfileInfo()),r.logger.logKernelProfile(t,e,n,o.kernelMs,i)})}),n},t}(),Df=function(){function t(){}return t.prototype.logKernelProfile=function(t,e,n,r,o){var i=of(r+"ms",9),a=of(t,25),s=e.rank,u=e.size,l=of(e.shape.toString(),14);console.log("%c"+a+"\t%c"+i+"\t%c"+s+"D "+l+"\t%c"+u+"\t%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green")},t}(),Mf=7;function Pf(t,e){return of(Array.isArray(t)?parseFloat(t[0].toFixed(Mf))+" + "+parseFloat(t[1].toFixed(Mf))+"j":yf(t)?"'"+t+"'":parseFloat(t.toFixed(Mf)).toString(),e)}function Lf(t){for(var e=[],n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}var Ff=function(){function t(t,e,n){var r=this;if(this.dtype=e,this.shape=t.slice(),this.size=Jh(t),null!=n){var o=n.length;Xh(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+r.size+"'."})}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||pf(e,Jh(this.shape)),this.strides=Ef(t)}return t.prototype.set=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),Xh(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+e.rank+")"});var o=this.locToIndex(n);this.values[o]=t},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];0===t.length&&(t=[0]);for(var n=t[t.length-1],r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return this.values[n]},t.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},t.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return Vf.make(this.shape,{values:this.values},this.dtype)},t}(),zf=null,Bf=null,Uf=null,Vf=function(){function t(t,e,n,r,o){this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=Jh(t),this.strides=Ef(t),this.dataId=null!=r?r:{},this.id=zf().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",zf().registerTensor(this,o),null!=n&&zf().write(this.dataId,n)}return t.make=function(e,n,r,o){return new t(e,r,n.values,n.dataId,o)},t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),Xh(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},t.prototype.as3D=function(t,e,n){return this.throwIfDisposed(),this.reshape([t,e,n])},t.prototype.as4D=function(t,e,n,r){return this.throwIfDisposed(),this.reshape([t,e,n,r])},t.prototype.as5D=function(t,e,n,r,o){return this.throwIfDisposed(),this.reshape([t,e,n,r,o])},t.prototype.asType=function(t){return this.throwIfDisposed(),Bf.cast(this,t)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return Bh(this,void 0,void 0,function(){var t;return Uh(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,Bf.buffer(this.shape,this.dtype,t)]}})})},t.prototype.bufferSync=function(){return Bf.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return Bh(this,void 0,void 0,function(){var t;return Uh(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,_f(this.shape,t)]}})})},t.prototype.arraySync=function(){return _f(this.shape,this.dataSync())},t.prototype.data=function(){return Bh(this,void 0,void 0,function(){return Uh(this,function(t){return this.throwIfDisposed(),[2,zf().read(this.dataId)]})})},t.prototype.dataSync=function(){return this.throwIfDisposed(),zf().readSync(this.dataId)},t.prototype.dispose=function(){this.isDisposed||(zf().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(t){return void 0===t&&(t=!1),Bf.print(this,t)},t.prototype.reshape=function(t){return this.throwIfDisposed(),Bf.reshape(this,t)},t.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},t.prototype.expandDims=function(t){return void 0===t&&(t=0),Bf.expandDims(this,t)},t.prototype.cumsum=function(t,e,n){return void 0===t&&(t=0),void 0===e&&(e=!1),void 0===n&&(n=!1),Bf.cumsum(this,t,e,n)},t.prototype.squeeze=function(t){return this.throwIfDisposed(),Bf.squeeze(this,t)},t.prototype.clone=function(){return this.throwIfDisposed(),Bf.clone(this)},t.prototype.oneHot=function(t,e,n){return this.throwIfDisposed(),Bf.oneHot(this,t,e,n)},t.prototype.toString=function(t){return void 0===t&&(t=!1),function(t,e,n,r){var o=Ef(e),i=function(t,e,n,r){var o=Jh(e),i=r[r.length-1],a=new Array(i).fill(0),s=e.length,u="complex64"===n?Lf(t):t;if(s>1)for(var l=0;l<o/i;l++)for(var c=l*i,p=0;p<i;p++)a[p]=Math.max(a[p],Pf(u[c+p],0).length);return a}(t,e,n,o),a=e.length,s=function t(e,n,r,o,i,a){void 0===a&&(a=!0);var s="complex64"===r?2:1,u=n[0],l=n.length;if(0===l)return"complex64"===r?[Pf(Lf(e)[0],0)]:[e[0].toString()];if(1===l){if(u>20){var c=Array.from(e.slice(0,3*s)),p=Array.from(e.slice(u-3*s,u));return"complex64"===r&&(c=Lf(c),p=Lf(p)),["["+c.map(function(t,e){return Pf(t,i[e])}).join(", ")+", ..., "+p.map(function(t,e){return Pf(t,i[u-3+e])}).join(", ")+"]"]}return["["+("complex64"===r?Lf(e):Array.from(e)).map(function(t,e){return Pf(t,i[e])}).join(", ")+"]"]}var h=n.slice(1),f=o.slice(1),d=o[0]*s,m=[];if(u>20){for(var g=0;g<3;g++){var v=(y=g*d)+d;m.push.apply(m,t(e.slice(y,v),h,r,f,i,!1))}for(m.push("..."),g=u-3;g<u;g++)v=(y=g*d)+d,m.push.apply(m,t(e.slice(y,v),h,r,f,i,g===u-1))}else for(g=0;g<u;g++){var y;v=(y=g*d)+d,m.push.apply(m,t(e.slice(y,v),h,r,f,i,g===u-1))}var b=2===l?",":"";for(m[0]="["+m[0]+b,g=1;g<m.length-1;g++)m[g]=" "+m[g]+b;var w=",\n";for(g=2;g<l;g++)w+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(a?"":w),m}(t,e,n,o,i),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+a),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(t){return"    "+t}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,t)},t.prototype.tile=function(t){return this.throwIfDisposed(),Bf.tile(this,t)},t.prototype.gather=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),Bf.gather(this,t,e)},t.prototype.matMul=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=!1),this.throwIfDisposed(),Bf.matMul(this,t,e,n)},t.prototype.dot=function(t){return this.throwIfDisposed(),Bf.dot(this,t)},t.prototype.norm=function(t,e,n){return void 0===t&&(t="euclidean"),void 0===e&&(e=null),void 0===n&&(n=!1),this.throwIfDisposed(),Bf.norm(this,t,e,n)},t.prototype.slice=function(t,e){return this.throwIfDisposed(),Bf.slice(this,t,e)},t.prototype.reverse=function(t){return this.throwIfDisposed(),Bf.reverse(this,t)},t.prototype.concat=function(e,n){return void 0===n&&(n=0),this.throwIfDisposed(),e instanceof t&&(e=[e]),Bf.concat([this].concat(e),n)},t.prototype.split=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),Bf.split(this,t,e)},t.prototype.stack=function(t,e){return void 0===e&&(e=0),Bf.stack([this,t],e)},t.prototype.unstack=function(t){return void 0===t&&(t=0),Bf.unstack(this,t)},t.prototype.pad=function(t,e){return void 0===e&&(e=0),Bf.pad(this,t,e)},t.prototype.batchNormalization=function(t,e,n,r,o){return void 0===n&&(n=.001),Uf("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,o,r,n)},t.prototype.batchNorm=function(t,e,n,r,o){return void 0===o&&(o=.001),this.throwIfDisposed(),Bf.batchNorm(this,t,e,n,r,o)},t.prototype.all=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Bf.all(this,t,e)},t.prototype.any=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Bf.any(this,t,e)},t.prototype.logSumExp=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Bf.logSumExp(this,t,e)},t.prototype.sum=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Bf.sum(this,t,e)},t.prototype.prod=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Bf.prod(this,t,e)},t.prototype.mean=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Bf.mean(this,t,e)},t.prototype.min=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Bf.min(this,t,e)},t.prototype.max=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Bf.max(this,t,e)},t.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),Bf.argMin(this,t)},t.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),Bf.argMax(this,t)},t.prototype.cast=function(t){return this.throwIfDisposed(),Bf.cast(this,t)},t.prototype.add=function(t){return this.throwIfDisposed(),Bf.add(this,t)},t.prototype.addStrict=function(t){return this.throwIfDisposed(),Bf.addStrict(this,t)},t.prototype.atan2=function(t){return this.throwIfDisposed(),Bf.atan2(this,t)},t.prototype.sub=function(t){return this.throwIfDisposed(),Bf.sub(this,t)},t.prototype.subStrict=function(t){return this.throwIfDisposed(),Bf.subStrict(this,t)},t.prototype.pow=function(t){return this.throwIfDisposed(),Bf.pow(this,t)},t.prototype.powStrict=function(t){return this.throwIfDisposed(),Bf.powStrict(this,t)},t.prototype.mul=function(t){return this.throwIfDisposed(),Bf.mul(this,t)},t.prototype.mulStrict=function(t){return this.throwIfDisposed(),Bf.mulStrict(this,t)},t.prototype.div=function(t){return this.throwIfDisposed(),Bf.div(this,t)},t.prototype.floorDiv=function(t){return this.throwIfDisposed(),Bf.floorDiv(this,t)},t.prototype.divStrict=function(t){return this.throwIfDisposed(),Bf.divStrict(this,t)},t.prototype.minimum=function(t){return this.throwIfDisposed(),Bf.minimum(this,t)},t.prototype.minimumStrict=function(t){return this.throwIfDisposed(),Bf.minimumStrict(this,t)},t.prototype.maximum=function(t){return this.throwIfDisposed(),Bf.maximum(this,t)},t.prototype.maximumStrict=function(t){return this.throwIfDisposed(),Bf.maximumStrict(this,t)},t.prototype.mod=function(t){return this.throwIfDisposed(),Bf.mod(this,t)},t.prototype.modStrict=function(t){return this.throwIfDisposed(),Bf.modStrict(this,t)},t.prototype.squaredDifference=function(t){return this.throwIfDisposed(),Bf.squaredDifference(this,t)},t.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),Bf.squaredDifferenceStrict(this,t)},t.prototype.transpose=function(t){return this.throwIfDisposed(),Bf.transpose(this,t)},t.prototype.notEqual=function(t){return this.throwIfDisposed(),Bf.notEqual(this,t)},t.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),Bf.notEqualStrict(this,t)},t.prototype.less=function(t){return this.throwIfDisposed(),Bf.less(this,t)},t.prototype.lessStrict=function(t){return this.throwIfDisposed(),Bf.lessStrict(this,t)},t.prototype.equal=function(t){return this.throwIfDisposed(),Bf.equal(this,t)},t.prototype.equalStrict=function(t){return this.throwIfDisposed(),Bf.equalStrict(this,t)},t.prototype.lessEqual=function(t){return this.throwIfDisposed(),Bf.lessEqual(this,t)},t.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),Bf.lessEqualStrict(this,t)},t.prototype.greater=function(t){return this.throwIfDisposed(),Bf.greater(this,t)},t.prototype.greaterStrict=function(t){return this.throwIfDisposed(),Bf.greaterStrict(this,t)},t.prototype.greaterEqual=function(t){return this.throwIfDisposed(),Bf.greaterEqual(this,t)},t.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),Bf.greaterEqualStrict(this,t)},t.prototype.logicalAnd=function(t){return this.throwIfDisposed(),Bf.logicalAnd(this,t)},t.prototype.logicalOr=function(t){return this.throwIfDisposed(),Bf.logicalOr(this,t)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),Bf.logicalNot(this)},t.prototype.logicalXor=function(t){return this.throwIfDisposed(),Bf.logicalXor(this,t)},t.prototype.where=function(t,e){return this.throwIfDisposed(),Bf.where(t,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),Bf.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),Bf.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),Bf.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),Bf.sign(this)},t.prototype.exp=function(){return this.throwIfDisposed(),Bf.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),Bf.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),Bf.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),Bf.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),Bf.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),Bf.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),Bf.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),Bf.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),Bf.abs(this)},t.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),Bf.clipByValue(this,t,e)},t.prototype.relu=function(){return this.throwIfDisposed(),Bf.relu(this)},t.prototype.elu=function(){return this.throwIfDisposed(),Bf.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),Bf.selu(this)},t.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),Bf.leakyRelu(this,t)},t.prototype.prelu=function(t){return this.throwIfDisposed(),Bf.prelu(this,t)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),Bf.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),Bf.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),Bf.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),Bf.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),Bf.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),Bf.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),Bf.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),Bf.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),Bf.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),Bf.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),Bf.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),Bf.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),Bf.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),Bf.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),Bf.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),Bf.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),Bf.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),Bf.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),Bf.round(this)},t.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),Bf.step(this,t)},t.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),Bf.softmax(this,t)},t.prototype.logSoftmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),Bf.logSoftmax(this,t)},t.prototype.resizeBilinear=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),Bf.image.resizeBilinear(this,t,e)},t.prototype.resizeNearestNeighbor=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),Bf.image.resizeNearestNeighbor(this,t,e)},t.prototype.conv1d=function(t,e,n,r,o,i){return void 0===r&&(r="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),Bf.conv1d(this,t,e,n,r,o,i)},t.prototype.conv2d=function(t,e,n,r,o,i){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),Bf.conv2d(this,t,e,n,r,o,i)},t.prototype.conv2dTranspose=function(t,e,n,r,o){return this.throwIfDisposed(),Bf.conv2dTranspose(this,t,e,n,r,o)},t.prototype.depthwiseConv2D=function(t,e,n,r,o,i){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),Bf.depthwiseConv2d(this,t,e,n,r,o,i)},t.prototype.separableConv2d=function(t,e,n,r,o,i){return void 0===o&&(o=[1,1]),void 0===i&&(i="NHWC"),this.throwIfDisposed(),Bf.separableConv2d(this,t,e,n,r,o,i)},t.prototype.avgPool=function(t,e,n,r){return this.throwIfDisposed(),Bf.avgPool(this,t,e,n,r)},t.prototype.maxPool=function(t,e,n,r){return this.throwIfDisposed(),Bf.maxPool(this,t,e,n,r)},t.prototype.localResponseNormalization=function(t,e,n,r){return void 0===t&&(t=5),void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=.5),Bf.localResponseNormalization(this,t,e,n,r)},t.prototype.pool=function(t,e,n,r,o){return this.throwIfDisposed(),Bf.pool(this,t,e,n,r,o)},t.prototype.variable=function(t,e,n){return void 0===t&&(t=!0),this.throwIfDisposed(),jf.variable(this,t,e,n)},t.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),Bf.unsortedSegmentSum(this,t,e)},t.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),Bf.batchToSpaceND(this,t,e)},t.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),Bf.spaceToBatchND(this,t,e)},t.prototype.topk=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=!0),this.throwIfDisposed(),Bf.topk(this,t,e)},t.prototype.stridedSlice=function(t,e,n,r,o,i,a,s){return void 0===r&&(r=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),this.throwIfDisposed(),Bf.stridedSlice(this,t,e,n,r,o,i,a,s)},t.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),Bf.depthToSpace(this,t,e)},t.prototype.fft=function(){return this.throwIfDisposed(),Bf.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),Bf.spectral.ifft(this)},t.prototype.rfft=function(){return this.throwIfDisposed(),Bf.spectral.rfft(this)},t.prototype.irfft=function(){return this.throwIfDisposed(),Bf.spectral.irfft(this)},t}();Object.defineProperty(Vf,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.dataId&&null!=t.shape&&null!=t.dtype}});var jf=function(t){function e(e,n,r){void 0===n&&(n=!0);var o=t.call(this,e.shape,e.dtype,null,e.dataId)||this;o.trainable=n,o.name=r,null==o.name&&(o.name=zf().nextVariableId().toString());try{zf().registerVariable(o)}catch(t){throw zf().disposeTensor(o),t}return o}return Fh(e,t),e.variable=function(t,n,r,o){return void 0===n&&(n=!0),null!=o&&o!==t.dtype&&(t=t.asType(o)),new e(t,n,r)},e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!tf(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");zf().disposeTensor(this),this.dataId=t.dataId,zf().registerTensor(this)},e}(Vf);Object.defineProperty(jf,Symbol.hasInstance,{value:function(t){return t instanceof Vf&&null!=t.assign&&t.assign instanceof Function}});var Wf,Hf,qf,Gf,Kf,$f,Xf=jf.variable;($f=Wf||(Wf={})).R0="R0",$f.R1="R1",$f.R2="R2",$f.R3="R3",$f.R4="R4",$f.R5="R5",$f.R6="R6",function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(Hf||(Hf={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(qf||(qf={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(Gf||(Gf={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(Kf||(Kf={}));var Zf={float32:Gf,int32:Hf,bool:qf,complex64:Kf};function Yf(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error("Can not upcast "+t+" with "+e)}return Zf[t][e]}function Qf(t){return Yf(t,"int32")}function Jf(t,e){if(t.dtype===e.dtype)return[t,e];var n=Yf(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function td(t){var e=[];return function t(e,n,r){if(null!=e)if(e instanceof Vf)n.push(e);else if(function(t){return Array.isArray(t)||"object"==typeof t}(e)){var o=e;for(var i in o){var a=o[i];r.has(a)||(r.add(a),t(a,n,r))}}}(t,e,new Set),e}var ed,nd=function(){function t(t,e,n){this.backend=t,this.safeMode=e,this.debugMode=n,this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.profiling=!1,this.gradientScopeCount=0,this.customGradientDepth=0,this.scopeStack=[],this.keepTensors=new Set,this.tensorInfo=new WeakMap,this.profiler=new Of(t),this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.moveData=function(t){this.write(t,this.readSync(t))},t.prototype.tidy=function(t,e,n){var r=this;void 0===n&&(n=!1);var o,i=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=t}return this.scopedRun(function(){return r.startScope(i,n)},function(){return r.endScope(o,n)},function(){return(o=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),o})},t.prototype.scopedRun=function(t,e,n){t();try{var r=n();return e(),r}catch(t){throw e(),t}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.runKernel=function(t,e,n){var r,o=this,i=[],a=function(t){return i.push(t),t},s=null!=this.activeScope?this.activeScope.name:"",u=this.numBytes,l=this.numTensors;if(this.scopedRun(function(){return o.customGradientDepth++},function(){return o.customGradientDepth--},function(){r=o.debugMode()?o.profiler.profileKernel(s,function(){return t(o.backend,a)}):t(o.backend,a)}),this.shouldRecord()){var c={id:this.nextTapeNodeId++,name:s,inputs:e,outputs:Array.isArray(r)?r:[r]};null!=n&&(c.gradient=function(t){return n(t,i)}),this.activeTape.push(c)}return this.profiling&&this.activeProfile.kernels.push({name:s,bytesAdded:this.numBytes-u,totalBytesSnapshot:this.numBytes,tensorsAdded:this.numTensors-l,totalTensorsSnapshot:this.numTensors,inputShapes:Object.keys(e).map(function(t){return e[t].shape}),outputShape:Array.isArray(r)?r.map(function(t){return t.shape}):r.shape}),r},t.prototype.registerTensor=function(t,e){var n=this.tensorInfo.has(t.dataId)?this.tensorInfo.get(t.dataId).refCount:0;if(this.numTensors++,"string"===t.dtype&&this.numStringTensors++,0===n){this.numDataBuffers++;var r=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(r=Jh(t.shape)*gf(t.dtype)),this.tensorInfo.set(t.dataId,{backend:null!=e?e:this.backend,dtype:t.dtype,shape:t.shape,bytes:r,refCount:0}),this.numBytes+=r,null!=e?e.register(t.dataId,t.shape,t.dtype):this.backend.register(t.dataId,t.shape,t.dtype)}this.tensorInfo.get(t.dataId).refCount++,t instanceof jf||this.track(t)},t.prototype.registerVariable=function(t){if(null!=this.registeredVariables[t.name])throw new Error("Variable with name "+t.name+" was already registered");this.registeredVariables[t.name]=t},t.prototype.disposeTensor=function(t){if(this.tensorInfo.has(t.dataId)){this.keepTensors.has(t.id)&&this.keepTensors.delete(t.id),this.numTensors--,"string"===t.dtype&&this.numStringTensors--;var e=this.tensorInfo.get(t.dataId);e.refCount<=1?("complex64"!==t.dtype&&(this.numBytes-=e.bytes),this.numDataBuffers--,e.backend.disposeData(t.dataId),this.tensorInfo.delete(t.dataId)):this.tensorInfo.get(t.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var t in this.registeredVariables)this.disposeTensor(this.registeredVariables[t]),delete this.registeredVariables[t]},t.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.numTensors,t.numDataBuffers=this.numDataBuffers,t.numBytes=this.numBytes,this.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},t.prototype.profile=function(t){return Bh(this,void 0,void 0,function(){var e,n;return Uh(this,function(r){return this.profiling=!0,e=this.numBytes,n=this.numTensors,this.activeProfile.kernels=[],this.activeProfile.result=t(),this.profiling=!1,this.activeProfile.peakBytes=Math.max.apply(Math,this.activeProfile.kernels.map(function(t){return t.totalBytesSnapshot})),this.activeProfile.newBytes=this.numBytes-e,this.activeProfile.newTensors=this.numTensors-n,[2,this.activeProfile]})})},t.prototype.shouldRecord=function(){return null!=this.activeTape&&0===this.customGradientDepth},t.prototype.addTapeNode=function(t,e,n){var r={};t.forEach(function(t,e){r[e]=t});var o={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:r,outputs:[e],gradient:function(t){var e={};return n(t).forEach(function(t,n){e[n]=function(){return t}}),e}};this.activeTape.push(o)},t.prototype.keep=function(t){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {...}) to avoid memory leaks.");return this.keepTensors.add(t.id),t},t.prototype.startScope=function(t,e){void 0===e&&(e=!1),e&&0===this.gradientScopeCount&&(this.activeTape=[]),e&&this.gradientScopeCount++;var n={track:[],name:"unnamed scope"};t&&(n.name=t),this.scopeStack.push(n),this.activeScope=n},t.prototype.endScope=function(t,e){var n=this;void 0===e&&(e=!1),e&&(this.gradientScopeCount--,0===this.gradientScopeCount&&(this.activeTape=null));var r=new Set(this.keepTensors),o=td(t);o.forEach(function(t){return r.add(t.id)});for(var i=0;i<this.activeScope.track.length;i++){var a=this.activeScope.track[i];r.has(a.id)||(null!=this.activeTape?o.push(a):a.dispose())}var s=this.scopeStack.pop();this.activeScope=0===this.scopeStack.length?null:this.scopeStack[this.scopeStack.length-1],o.forEach(function(t){!n.keepTensors.has(t.id)&&function(t,e){for(var n=0;n<e.length;n++)if(e[n].id===t.id)return!0;return!1}(t,s.track)&&n.track(t)})},t.prototype.gradients=function(t,e,n,r){var o=this;if(void 0===r&&(r=!1),Xh(e.length>0,function(){return"gradients() received an empty list of xs."}),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");return this.tidy("gradients",function(){var i=t();Xh(i instanceof Vf,function(){return"The result y returned by f() must be a tensor."});var a=function(t,e,n){for(var r={},o={},i=0;i<e.length;i++)r[e[i].id]=!0;for(i=0;i<t.length;i++){var a=(d=t[i]).inputs;for(var s in a){for(var u=a[s],l=!1,c=0;c<e.length;c++)if(r[u.id]){d.outputs.forEach(function(t){return r[t.id]=!0}),l=!0,o[d.id]=!0;break}if(l)break}}var p={};p[n.id]=!0;var h={};for(i=t.length-1;i>=0;i--)for(a=(d=t[i]).inputs,c=0;c<d.outputs.length;c++)if(p[d.outputs[c].id]){for(var s in a)p[a[s].id]=!0,h[d.id]=!0;break}var f=[];for(i=0;i<t.length;i++){var d;if(o[(d=t[i]).id]&&h[d.id]){var m={};for(var s in d.inputs){var g=d.inputs[s];r[g.id]&&(m[s]=g)}var v=Object.assign({},d);v.inputs=m,v.outputs=d.outputs,f.push(v)}}return f}(o.activeTape,e,i);if(!r&&0===a.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");var s={};return s[i.id]=null==n?function(t){var e=If(Jh(t),"float32");return Vf.make(t,{values:e})}(i.shape):n,function(t,e){for(var n=function(n){var r=e[n],o=[];if(r.outputs.forEach(function(e){var n=t[e.id];if(null!=n)o.push(n);else{var r=Vf.make(e.shape,{values:Tf(e.size,e.dtype)},e.dtype);o.push(r)}}),null==r.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+r.name+".");var i=r.gradient(1===r.outputs.length?o[0]:o);for(var a in r.inputs){if(!(a in i))throw new Error("Cannot backprop through input "+a+". Available gradients found: "+Object.keys(i)+".");var s=i[a]();if("float32"!==s.dtype)throw new Error("Error in gradient for op "+r.name+". The gradient of input "+a+" must have 'float32' dtype, but has '"+s.dtype+"'");var u=r.inputs[a];if(!tf(s.shape,u.shape))throw new Error("Error in gradient for op "+r.name+". The gradient of input '"+a+"' has shape '"+s.shape+"', which does not match the shape of the input '"+u.shape+"'");if(null==t[u.id])t[u.id]=s;else{var l=t[u.id];t[u.id]=l.add(s),l.dispose()}}},r=e.length-1;r>=0;r--)n(r)}(s,a),{value:i,grads:e.map(function(t){return s[t.id]})}},!0)},t.prototype.customGrad=function(t){var e=this;return Xh(Sf(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,r,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];return Xh(o.every(function(t){return t instanceof Vf}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}),e.scopedRun(function(){return e.customGradientDepth++},function(){return e.customGradientDepth--},function(){r=e.tidy(t.name,function(){var e=t.apply(void 0,o),r=e.value,i=e.gradFunc;return Xh(r instanceof Vf,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),Xh(Sf(i),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n=i,r},!0)}),e.shouldRecord()&&e.addTapeNode(o,r,function(t){var e=n(t),r=Array.isArray(e)?e:[e];return Xh(r.length===o.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),Xh(r.every(function(t){return t instanceof Vf}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}),r}),r}},t.prototype.write=function(t,e){var n=this.tensorInfo.get(t);if("string"===n.dtype){var r=vf(e);this.numBytes+=r-n.bytes,n.bytes=r}this.backend!==n.backend&&(n.backend.disposeData(t),n.backend=this.backend,this.backend.register(t,n.shape,n.dtype)),this.backend.write(t,e)},t.prototype.readSync=function(t){return this.tensorInfo.get(t).backend.readSync(t)},t.prototype.read=function(t){return this.tensorInfo.get(t).backend.read(t)},t.prototype.fromPixels=function(t,e){return this.backend.fromPixels(t,e)},t.prototype.time=function(t){return Bh(this,void 0,void 0,function(){var e,n;return Uh(this,function(r){switch(r.label){case 0:return e=Af(),[4,this.backend.time(t)];case 1:return(n=r.sent()).wallMs=Af()-e,[2,n]}})})},t.prototype.track=function(t){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {op();...}); to avoid memory leaks.");return null!=this.activeScope&&this.activeScope.track.push(t),t},t.nextTensorId=0,t.nextVariableId=0,t}();!function(t){t[t.NUMBER=0]="NUMBER",t[t.BOOLEAN=1]="BOOLEAN",t[t.STRING=2]="STRING"}(ed||(ed={}));var rd,od,id=[{name:"DEBUG",type:ed.BOOLEAN},{name:"IS_BROWSER",type:ed.BOOLEAN},{name:"WEBGL_LAZILY_UNPACK",type:ed.BOOLEAN},{name:"WEBGL_CPU_FORWARD",type:ed.BOOLEAN},{name:"WEBGL_PACK",type:ed.BOOLEAN},{name:"WEBGL_PACK_BATCHNORMALIZATION",type:ed.BOOLEAN},{name:"WEBGL_PACK_CLIP",type:ed.BOOLEAN},{name:"WEBGL_PACK_DEPTHWISECONV",type:ed.BOOLEAN},{name:"WEBGL_PACK_BINARY_OPERATIONS",type:ed.BOOLEAN},{name:"WEBGL_PACK_ARRAY_OPERATIONS",type:ed.BOOLEAN},{name:"WEBGL_PACK_IMAGE_OPERATIONS",type:ed.BOOLEAN},{name:"WEBGL_PACK_REDUCE",type:ed.BOOLEAN},{name:"WEBGL_CONV_IM2COL",type:ed.BOOLEAN},{name:"WEBGL_MAX_TEXTURE_SIZE",type:ed.NUMBER},{name:"WEBGL_NUM_MB_BEFORE_PAGING",type:ed.NUMBER},{name:"WEBGL_MAX_TEXTURES_IN_SHADER",type:ed.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:ed.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:ed.BOOLEAN},{name:"WEBGL_VERSION",type:ed.NUMBER},{name:"WEBGL_RENDER_FLOAT32_ENABLED",type:ed.BOOLEAN},{name:"WEBGL_DOWNLOAD_FLOAT_ENABLED",type:ed.BOOLEAN},{name:"WEBGL_FENCE_API_ENABLED",type:ed.BOOLEAN},{name:"WEBGL_SIZE_UPLOAD_UNIFORM",type:ed.NUMBER},{name:"BACKEND",type:ed.STRING},{name:"EPSILON",type:ed.NUMBER},{name:"PROD",type:ed.BOOLEAN},{name:"TENSORLIKE_CHECK_SHAPE_CONSISTENCY",type:ed.BOOLEAN},{name:"DEPRECATION_WARNINGS_ENABLED",type:ed.BOOLEAN}];function ad(t){try{if(null!=Wh(t))return!0}catch(t){return!1}return!1}var sd="tfjsflags";function ud(){var t={};if("undefined"==typeof window||void 0===window.location||void 0===window.location.search)return t;var e=function(t){var e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")}),e}(window.location.search);if(sd in e){var n={};e[sd].split(",").forEach(function(t){var e=t.split(":");n[e[0]]=e[1]}),id.forEach(function(e){e.name in n&&(console.log("Setting feature override from URL "+e.name+": "+n[e.name]),e.type===ed.NUMBER?t[e.name]=+n[e.name]:e.type===ed.BOOLEAN?t[e.name]="true"===n[e.name]:e.type===ed.STRING?t[e.name]=n[e.name]:console.warn("Unknown URL param: "+e.name+"."))})}return t}function ld(t,e){return null!=t.getExtension(e)}function cd(t,e){var n=t.createFramebuffer(),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,2===e?t.RGBA32F:t.RGBA,1,1,0,t.RGBA,t.FLOAT,null),t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(n),o}var pd,hd=function(){function t(t){this.features={},this.registry={},null!=t&&(this.features=t),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return t.setBackend=function(t,e){if(void 0===e&&(e=!1),!(t in md.registry))throw new Error("Backend name '"+t+"' not found in registry");md.engine.backend=md.findBackend(t),md.backendName=t},t.getBackend=function(){return md.initEngine(),md.backendName},t.disposeVariables=function(){md.engine.disposeVariables()},t.memory=function(){return md.engine.memory()},t.profile=function(t){return md.engine.profile(t)},t.tidy=function(t,e){return md.engine.tidy(t,e)},t.dispose=function(t){td(t).forEach(function(t){return t.dispose()})},t.keep=function(t){return md.engine.keep(t)},t.time=function(t){return md.engine.time(t)},t.prototype.get=function(t){return t in this.features?this.features[t]:(this.features[t]=this.evaluateFeature(t),this.features[t])},t.prototype.getFeatures=function(){return this.features},t.prototype.set=function(t,e){this.features[t]=e},t.prototype.getBestBackendName=function(){var t=this;if(0===Object.keys(this.registry).length)throw new Error("No backend found in registry.");return Object.keys(this.registry).map(function(e){return{name:e,entry:t.registry[e]}}).sort(function(t,e){return e.entry.priority-t.entry.priority})[0].name},t.prototype.evaluateFeature=function(t){if("DEBUG"===t)return!1;if("IS_BROWSER"===t)return"undefined"!=typeof window;if("IS_NODE"===t)return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node;if("IS_CHROME"===t)return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);if("WEBGL_CPU_FORWARD"===t)return!0;if("WEBGL_PACK"===t)return 0!==this.get("WEBGL_VERSION");if("WEBGL_PACK_BATCHNORMALIZATION"===t)return this.get("WEBGL_PACK");if("WEBGL_PACK_CLIP"===t)return this.get("WEBGL_PACK");if("WEBGL_PACK_DEPTHWISECONV"===t)return this.get("WEBGL_PACK");if("WEBGL_PACK_BINARY_OPERATIONS"===t)return this.get("WEBGL_PACK");if("WEBGL_PACK_ARRAY_OPERATIONS"===t)return this.get("WEBGL_PACK");if("WEBGL_PACK_IMAGE_OPERATIONS"===t)return this.get("WEBGL_PACK");if("WEBGL_PACK_REDUCE"===t)return this.get("WEBGL_PACK");if("WEBGL_LAZILY_UNPACK"===t)return this.get("WEBGL_PACK");if("WEBGL_CONV_IM2COL"===t)return this.get("WEBGL_PACK");if("WEBGL_NUM_MB_BEFORE_PAGING"===t)return this.get("PROD")||!this.get("IS_BROWSER")?Number.POSITIVE_INFINITY:window.screen.height*window.screen.width*window.devicePixelRatio*600/1024;if("WEBGL_MAX_TEXTURE_SIZE"===t)return function(t){if(null==rd){var e=Wh(t);rd=e.getParameter(e.MAX_TEXTURE_SIZE)}return rd}(this.get("WEBGL_VERSION"));if("WEBGL_MAX_TEXTURES_IN_SHADER"===t)return function(t){if(null==od){var e=Wh(t);od=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,od)}(this.get("WEBGL_VERSION"));if("IS_TEST"===t)return!1;if("BACKEND"===t)return this.getBestBackendName();if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"===t){var e=this.get("WEBGL_VERSION");return 0===e?0:function(t){if(0===t)return 0;var e=Wh(t);return ld(e,"EXT_disjoint_timer_query_webgl2")&&2===t?2:ld(e,"EXT_disjoint_timer_query")?1:0}(e)}if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE"===t)return this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!function(){var t=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}();if("HAS_WEBGL"===t)return this.get("WEBGL_VERSION")>0;if("WEBGL_VERSION"===t)return ad(2)?2:ad(1)?1:0;if("WEBGL_RENDER_FLOAT32_ENABLED"===t)return function(t){if(0===t)return!1;var e=Wh(t);if(1===t){if(!ld(e,"OES_texture_float"))return!1}else if(!ld(e,"EXT_color_buffer_float"))return!1;return cd(e,t)}(this.get("WEBGL_VERSION"));if("WEBGL_DOWNLOAD_FLOAT_ENABLED"===t)return function(t){if(0===t)return!1;var e=Wh(t);if(1===t){if(!ld(e,"OES_texture_float"))return!1;if(!ld(e,"WEBGL_color_buffer_float"))return!1}else if(!ld(e,"EXT_color_buffer_float"))return!1;return cd(e,t)}(this.get("WEBGL_VERSION"));if("WEBGL_FENCE_API_ENABLED"===t)return function(t){return 2===t&&null!=Wh(t).fenceSync}(this.get("WEBGL_VERSION"));if("WEBGL_SIZE_UPLOAD_UNIFORM"===t)return this.get("WEBGL_RENDER_FLOAT32_ENABLED")?4:0;if("TEST_EPSILON"===t)return 32===this.backend.floatPrecision()?.001:.1;if("EPSILON"===t)return 32===this.backend.floatPrecision()?1e-7:1e-4;if("PROD"===t)return!1;if("TENSORLIKE_CHECK_SHAPE_CONSISTENCY"===t)return!this.get("PROD");if("DEPRECATION_WARNINGS_ENABLED"===t)return!0;throw new Error("Unknown feature "+t+".")},t.prototype.setFeatures=function(t){this.features=Object.assign({},t)},t.prototype.reset=function(){this.features=ud(),null!=this.globalEngine&&(this.globalEngine=null)},Object.defineProperty(t.prototype,"backend",{get:function(){return this.engine.backend},enumerable:!0,configurable:!0}),t.prototype.findBackend=function(t){return t in this.registry?this.registry[t].backend:null},t.prototype.registerBackend=function(t,e,n){var r=this;if(void 0===n&&(n=1),t in this.registry)return console.warn(t+" backend was already registered. Reusing existing backend"),!1;try{var o=e();return o.setDataMover({moveData:function(t){return r.engine.moveData(t)}}),this.registry[t]={backend:o,priority:n},!0}catch(e){return console.warn("Registration of backend "+t+" failed"),console.warn(e.stack||e.message),!1}},t.prototype.removeBackend=function(t){if(!(t in this.registry))throw new Error(t+" backend not found in registry");this.registry[t].backend.dispose(),delete this.registry[t]},Object.defineProperty(t.prototype,"engine",{get:function(){return this.initEngine(),this.globalEngine},enumerable:!0,configurable:!0}),t.prototype.initEngine=function(){var t=this;if(null==this.globalEngine){this.backendName=this.get("BACKEND");var e=this.findBackend(this.backendName);this.globalEngine=new nd(e,!1,function(){return t.get("DEBUG")})}},Object.defineProperty(t.prototype,"global",{get:function(){return fd()},enumerable:!0,configurable:!0}),t}();function fd(){if(null==pd){var t=void 0;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof global)t=global;else{if("undefined"==typeof process)throw new Error("Could not find a global object");t=process}pd=t}return pd}function dd(t){md.get("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}Uf=dd;var md=function(){var t=fd();return null==t.ENV&&(t.ENV=new hd(ud())),function(t){zf=t}(function(){return t.ENV.engine}),t.ENV}();function gd(t){return md.engine.customGrad(t)}Object.freeze({EPSILON_FLOAT16:1e-4,EPSILON_FLOAT32:1e-7,Environment:hd,enableProdMode:function(){md.set("PROD",!0)},enableDebugMode:function(){md.set("DEBUG",!0)},disableDeprecationWarnings:function(){md.set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},deprecationWarn:dd,ENV:md});var vd=hd.tidy,yd=hd.keep,bd=hd.dispose;function wd(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];md.get("IS_TEST")||console.warn.apply(console,t)}function xd(t,e,n,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(e.slice(0))).push(t[0]/n),o=o.concat(t.slice(1));else{o=o.concat(t[0]);for(var i=e.length,a=0;a<i;++a)o=o.concat([t[a+1]/e[a],e[a]]);o=o.concat(t.slice(i+1))}return o}function Sd(t,e,n){void 0===n&&(n=!0);var r=[];if(n){r.push(e);for(var o=e+1;o<t;++o)o<=2*e?(r.push(o),r.push(o-(e+1))):r.push(o)}else{var i=[],a=[];for(o=1;o<t;++o)o>=2*e+1||o%2==1?a.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,a)}return r}function Cd(t,e,n,r){void 0===r&&(r=!0);var o=[];o.push(r?t[0]/n:t[0]*n);for(var i=1;i<t.length;++i)o.push(i<=e.length?r?e[i-1]*t[i]:t[i]/e[i-1]:t[i]);return o}function Ed(t,e){for(var n=[0],r=0;r<e;++r)n.push(t[r][0]);return n}function Nd(t,e,n){for(var r=t.slice(0,1),o=0;o<n;++o)r.push(t[o+1]-e[o][0]-e[o][1]);return r}function _d(t,e){for(var n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function Id(t,e){for(var n=[],r=t.length,o=0;o<r;o++)-1===e.indexOf(o)&&n.push(t[o]);return[n,e.map(function(e){return t[e]})]}function Td(t,e){return function(t,e,n){for(var r=t.length+e.length,o=[],i=0,a=0,s=0;s<r;s++)-1===n.indexOf(s)?o.push(t[i++]):o.push(e[a++]);return o}(t,e.map(function(t){return 1}),e)}function Ad(t,e,n){Xh(_d(e,n),function(){return t+" supports only inner-most axes for now. Got axes "+e+" and rank-"+n+" input."})}function kd(t,e){if(_d(t,e))return null;for(var n=[],r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach(function(t){return n.push(t)}),n}function Rd(t){return t.map(function(t,e){return[e,t]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}function Od(t,e){for(var n=[],r=e-t;r<e;++r)n.push(r);return n}function Dd(t,e){for(var n=t[0].slice(),r=1;r<t.length;r++)n[e]+=t[r][e];return n}function Md(t,e){if(t.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==e.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>t.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+t.rank);if(0===t.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+t.shape+".");for(var n=e.shape,r=n[n.length-1],o=1,i=0;i<n.length-1;++i)o*=n[i];var a=t.shape,s=n.slice();s.pop();var u=1;for(i=r;i<t.rank;++i)u*=a[i],s.push(a[i]);var l=Ef(t.shape).map(function(t){return t/u}).concat([1]).slice(0,r);return[s,o,u,l]}var Pd=30;function Ld(t){return t<=Pd?t:Cf(t,Math.floor(Math.sqrt(t)))}function Fd(t,e,n){for(var r=e.rank>1?e.shape[e.rank-1]:1,o=n.length,i=1,a=r;a<o;++a)i*=n[a];return{sliceRank:r,numUpdates:e.size/(r<1?1:r),sliceSize:i,strides:Ef(n.slice(0,r)).concat([1]),outputSize:Jh(n)}}function zd(t,e,n,r,o,i,a,s,u){if(void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),0!==a)throw new Error("ellipsis mask is not yet supported");if(0!==s)throw new Error("new axis mask is not yet supported");for(var l=[],c=[],p=[],h=0;h<t.length;h++)l[h]=Bd(o,e,r,t,h),c[h]=Ud(i,n,r,t,h),u&1<<h&&(c[h]=l[h]+1,p.push(h));var f=new Array(t.length).fill(0);return f=f.map(function(t,e){for(var n=0,o=l[e];!(r[e]>0?o>=c[e]:o<=c[e]);o+=r[e])n+=1;return n}),[l,f,p]}function Bd(t,e,n,r,o){var i=e[o];t&1<<o&&(i=n[o]>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[o];return i<0&&(i+=a),qh(0,i,a-1)}function Ud(t,e,n,r,o){var i=e[o];t&1<<o&&(i=n[o]>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var a=r[o];return i<0&&(i+=a),n[o]>0?qh(0,i,a):qh(-1,i,a-1)}function Vd(t,e,n){for(var r=n.length,o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(o=r+1;o<n.length;o++)if(e[o]>0||n[o]!==t[o])return!1;return!0}function jd(t,e){for(var n=t.length>0?t[t.length-1]:1,r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}function Wd(t){var e=t;if(mf(t))return[t.length];if(!Array.isArray(t))return[];for(var n=[];Array.isArray(e)||mf(e);)n.push(e.length),e=e[0];return Array.isArray(t)&&md.get("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function t(e,n,r){if(r=r||[],Array.isArray(e)||mf(e)){Xh(n.length>0,function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+e.length+" elements"}),Xh(e.length===n[0],function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+e.length+" elements"});for(var o=n.slice(1),i=0;i<e.length;++i)t(e[i],o,r.concat(i))}else Xh(0===n.length,function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"})}(t,n,[]),n}function Hd(t,e,n,r){if(null!=t&&("numeric"!==t&&t!==e||"numeric"===t&&"string"===e))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+t+" tensor, but got "+e+" tensor")}function qd(t,e,n,r){if(void 0===r&&(r="numeric"),t instanceof Vf)return Hd(r,t.dtype,e,n),t;var o=xf(t);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),Hd(r,o,e,n),!mf(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("Argument '"+e+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+t.constructor.name+"'");var i=Wd(t);mf(t)||Array.isArray(t)||(t=[t]);var a="string"!==o?Nf(t,o,md.get("DEBUG")):Qh(t);return Vf.make(i,{values:a},o)}function Gd(t,e,n){if(!Array.isArray(t))throw new Error("Argument "+e+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return t.map(function(t,r){return qd(t,e+"["+r+"]",n)})}function Kd(t){var e=Object.keys(t);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var n=e[0],r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];md.engine.startScope(n);try{var o=r.apply(void 0,t);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),md.engine.endScope(o),o}catch(t){throw md.engine.endScope(null),t}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}var $d=Kd({softmax_:function(t,e){void 0===e&&(e=-1);var n=qd(t,"logits","softmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+e);return gd(function(t){var n=t.logSumExp([e],!0),r=t.toFloat().sub(n).exp();return{value:r,gradFunc:function(t){var n=t.mul(r);return n.sub(n.sum([e],!0).mul(r))}}})(n)}}),Xd=Kd({logSoftmax_:function(t,e){void 0===e&&(e=-1);var n=qd(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+e);return gd(function(t){var n=t.max(e,!0),r=t.sub(n),o=r.toFloat().sub(r.exp().sum(e,!0).log());return{value:o,gradFunc:function(t){var n=o.exp();return t.sub(t.sum(e,!0).mul(n))}}})(n)}}),Zd=Kd({complex_:function(t,e){var n=qd(t,"real","complex"),r=qd(e,"imag","complex");return Zh(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),md.engine.runKernel(function(t){return t.complex(n,r)},{$real:n,$imag:r})}}),Yd=Kd({real_:function(t){var e=qd(t,"input","real");return md.engine.runKernel(function(t){return t.real(e)},{$input:e})}}),Qd=Kd({imag_:function(t){var e=qd(t,"input","imag");return md.engine.runKernel(function(t){return t.imag(e)},{$input:e})}});function Jd(t,e,n){if(null==n&&(n=xf(t)),"complex64"===n)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!mf(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");var r=Wd(t);if(null!=e){kf(e);var o=Jh(e),i=Jh(r);Xh(o===i,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+o+" values but has "+i});for(var a=0;a<r.length;++a){var s=a!==r.length-1||r[a]!==Jh(e.slice(a));Xh(r[a]===e[a]||!s,function(){return"Error creating a new Tensor. Inferred shape ("+r+") does not match the provided shape ("+e+"). "})}}return mf(t)||Array.isArray(t)||(t=[t]),e=e||r,t="string"!==n?Nf(t,n,md.get("DEBUG")):Qh(t),Vf.make(e,{values:t},n)}function tm(t,e){if((mf(t)||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");return Jd(t,[],e)}function em(t,e){Yh(t);var n=Wd(t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Jd(t,n,e)}function nm(t,e,n){if(Yh(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Wd(t);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Jd(t,e=e||r,n)}function rm(t,e,n){if(Yh(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Wd(t);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Jd(t,e=e||r,n)}function om(t,e,n){if(Yh(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Wd(t);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Jd(t,e=e||r,n)}function im(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=im(t,"float32"),r=im(t,"float32");return Zd(n,r)}var o=If(Jh(t),e);return Vf.make(t,{values:o},e)}function am(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=am(t,"float32"),r=am(t,"float32");return Zd(n,r)}var o=Tf(Jh(t),e);return Vf.make(t,{values:o},e)}function sm(t,e,n){return md.engine.runKernel(function(r){return r.fill(t,e,n)},{})}function um(t,e,n){if(0===n)throw new Error("Cannot request zero samples");var r=(e-t)/(n-1),o=Tf(n,"float32");o[0]=t;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return em(o,"float32")}function lm(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(t===e||t<e&&n<0||e<t&&n>1)return am([0],r);var o=Tf(Math.abs(Math.ceil((e-t)/n)),r);e<t&&1===n&&(n=-1),o[0]=t;for(var i=1;i<o.length;i++)o[i]=o[i-1]+n;return em(o,r)}var cm=Kd({onesLike_:function(t){var e=qd(t,"x","onesLike");return md.engine.runKernel(function(t){return t.onesLike(e)},{$x:e},null)}}),pm=Kd({zerosLike_:function(t){var e=qd(t,"x","zerosLike");return md.engine.runKernel(function(t){return t.zerosLike(e)},{$x:e},null)}}),hm=function(){function t(t){this.dataMover=t,this.data=new WeakMap}return t.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(t),this.data.get(t)},t.prototype.set=function(t,e){this.data.set(t,e)},t.prototype.has=function(t){return this.data.has(t)},t.prototype.delete=function(t){return this.data.delete(t)},t}();function fm(t,e,n){if("complex64"===e){if("complex64"===t.dtype)return t.clone();var r=am(t.shape),o=t.toFloat(),i=n.complex(o,r);return r.dispose(),o.dispose(),i}if(!df(t.dtype,e))return Vf.make(t.shape,{dataId:t.dataId},e);if("complex64"===t.dtype){var a=n.real(t);return i=a.cast(e),a.dispose(),i}if("int32"===e)return n.int(t);if("bool"===e){var s=tm(0,t.dtype);return i=n.notEqual(t,s),s.dispose(),i}throw new Error("Error in Cast: unknown dtype argument ("+e+")")}function dm(t,e){return Vf.make(e,{dataId:t.dataId},t.dtype)}function mm(t,e){if(t.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+t.length+", imag: "+e.length+".");for(var n=new Float32Array(2*t.length),r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function gm(t,e){return{real:t[2*e],imag:t[2*e+1]}}function vm(t,e,n,r){t[2*r]=e,t[2*r+1]=n}function ym(t,e,n){var r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}}function bm(t,e,n,r,o){for(var i=Array.from(e).map(function(t,e){return{score:t,boxIndex:e}}).filter(function(t){return t.score>o}).sort(function(t,e){return e.score-t.score}),a=[],s=0;s<i.length;s++){var u=i[s],l=u.boxIndex;if(u.score<o)break;for(var c=!1,p=a.length-1;p>=0;--p)if(wm(t,l,a[p])>=r){c=!0;break}if(!c&&(a.push(l),a.length>=n))break}return em(a,"int32")}function wm(t,e,n){var r=t.subarray(4*e,4*e+4),o=t.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),p=Math.max(o[0],o[2]),h=Math.max(o[1],o[3]),f=(s-i)*(u-a),d=(p-l)*(h-c);if(f<=0||d<=0)return 0;var m=Math.max(i,l),g=Math.max(a,c),v=Math.min(s,p),y=Math.min(u,h),b=Math.max(v-m,0)*Math.max(y-g,0);return b/(f+d-b)}function xm(t,e,n){var r=new Array(t.rank).fill(0),o=t.shape.slice();return e.map(function(e){o[n]=e;var i=t.slice(r,o);return r[n]+=e,i})}function Sm(t,e,n,r,o){for(var i=e[e.length-1],a=[t.length/i,i],s=a[0],u=a[1],l=cf(n,s*r),c=cf("int32",s*r),p=0;p<s;p++){for(var h=p*u,f=t.subarray(h,h+u),d=[],m=0;m<f.length;m++)d.push({value:f[m],index:m});d.sort(function(t,e){return e.value-t.value});var g=p*r,v=l.subarray(g,g+r),y=c.subarray(g,g+r);for(m=0;m<r;m++)v[m]=d[m].value,y[m]=d[m].index}var b=e.slice();return b[b.length-1]=r,[Jd(l,b,n),Jd(c,b,"int32")]}!function(){function t(){}t.prototype.time=function(t){throw new Error("Not yet implemented.")},t.prototype.read=function(t){throw new Error("Not yet implemented.")},t.prototype.readSync=function(t){throw new Error("Not yet implemented.")},t.prototype.disposeData=function(t){throw new Error("Not yet implemented.")},t.prototype.write=function(t,e){throw new Error("Not yet implemented.")},t.prototype.fromPixels=function(t,e){throw new Error("Not yet implemented.")},t.prototype.register=function(t,e,n){throw new Error("Not yet implemented.")},t.prototype.memory=function(){throw new Error("Not yet implemented.")},t.prototype.floatPrecision=function(){throw new Error("Not yet implemented")},t.prototype.batchMatMul=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.fusedBatchMatMul=function(t,e,n,r,o,i){throw new Error("Not yet implemented")},t.prototype.slice=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.stridedSlice=function(t,e,n,r,o,i,a,s,u){throw new Error("Not yet implemented")},t.prototype.unstack=function(t,e){throw new Error("Not yet implemented")},t.prototype.reverse=function(t,e){throw new Error("Not yet implemented")},t.prototype.concat=function(t,e){throw new Error("Not yet implemented")},t.prototype.neg=function(t){throw new Error("Not yet implemented")},t.prototype.add=function(t,e){throw new Error("Not yet implemented")},t.prototype.addN=function(t){throw new Error("Not yet implemented")},t.prototype.subtract=function(t,e){throw new Error("Not yet implemented")},t.prototype.multiply=function(t,e){throw new Error("Not yet implemented")},t.prototype.realDivide=function(t,e){throw new Error("Not yet implemented")},t.prototype.floorDiv=function(t,e){throw new Error("Not yet implemented")},t.prototype.sum=function(t,e){throw new Error("Not yet implemented")},t.prototype.prod=function(t,e){throw new Error("Not yet implemented")},t.prototype.unsortedSegmentSum=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.argMin=function(t,e){throw new Error("Not yet implemented")},t.prototype.argMax=function(t,e){throw new Error("Not yet implemented")},t.prototype.equal=function(t,e){throw new Error("Not yet implemented")},t.prototype.notEqual=function(t,e){throw new Error("Not yet implemented")},t.prototype.less=function(t,e){throw new Error("Not yet implemented")},t.prototype.lessEqual=function(t,e){throw new Error("Not yet implemented")},t.prototype.greater=function(t,e){throw new Error("Not yet implemented")},t.prototype.greaterEqual=function(t,e){throw new Error("Not yet implemented")},t.prototype.logicalNot=function(t){throw new Error("Not yet implemented")},t.prototype.logicalAnd=function(t,e){throw new Error("Not yet implemented")},t.prototype.logicalOr=function(t,e){throw new Error("Not yet implemented")},t.prototype.where=function(t){throw new Error("Not yet implemented")},t.prototype.select=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.topk=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.min=function(t,e){throw new Error("Not yet implemented")},t.prototype.minimum=function(t,e){throw new Error("Not yet implemented")},t.prototype.mod=function(t,e){throw new Error("Not yet implemented")},t.prototype.max=function(t,e){throw new Error("Not yet implemented")},t.prototype.maximum=function(t,e){throw new Error("Not yet implemented")},t.prototype.all=function(t,e){throw new Error("Not yet implemented")},t.prototype.any=function(t,e){throw new Error("Not yet implemented")},t.prototype.squaredDifference=function(t,e){throw new Error("Not yet implemented")},t.prototype.ceil=function(t){throw new Error("Not yet implemented")},t.prototype.floor=function(t){throw new Error("Not yet implemented")},t.prototype.round=function(t){throw new Error("Not yet implemented")},t.prototype.sign=function(t){throw new Error("Not yet implemented")},t.prototype.pow=function(t,e){throw new Error("Not yet implemented")},t.prototype.exp=function(t){throw new Error("Not yet implemented")},t.prototype.expm1=function(t){throw new Error("Not yet implemented")},t.prototype.log=function(t){throw new Error("Not yet implemented")},t.prototype.log1p=function(t){throw new Error("Not yet implemented")},t.prototype.sqrt=function(t){throw new Error("Not yet implemented")},t.prototype.rsqrt=function(t){throw new Error("Not yet implemented")},t.prototype.square=function(t){throw new Error("Not yet implemented")},t.prototype.reciprocal=function(t){throw new Error("Not yet implemented")},t.prototype.relu=function(t){throw new Error("Not yet implemented")},t.prototype.prelu=function(t,e){throw new Error("Not yet implemented")},t.prototype.elu=function(t){throw new Error("Not yet implemented")},t.prototype.eluDer=function(t,e){throw new Error("Not yet implemented")},t.prototype.selu=function(t){throw new Error("Not yet implemented")},t.prototype.int=function(t){throw new Error("Not yet implemented")},t.prototype.clip=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.abs=function(t){throw new Error("Not yet implemented")},t.prototype.complexAbs=function(t){throw new Error("Not yet implemented")},t.prototype.sigmoid=function(t){throw new Error("Not yet implemented")},t.prototype.softplus=function(t){throw new Error("Not yet implemented")},t.prototype.sin=function(t){throw new Error("Not yet implemented")},t.prototype.cos=function(t){throw new Error("Not yet implemented")},t.prototype.tan=function(t){throw new Error("Not yet implemented")},t.prototype.asin=function(t){throw new Error("Not yet implemented")},t.prototype.acos=function(t){throw new Error("Not yet implemented")},t.prototype.atan=function(t){throw new Error("Not yet implemented")},t.prototype.atan2=function(t,e){throw new Error("Not yet implemented")},t.prototype.sinh=function(t){throw new Error("Not yet implemented")},t.prototype.cosh=function(t){throw new Error("Not yet implemented")},t.prototype.tanh=function(t){throw new Error("Not yet implemented")},t.prototype.asinh=function(t){throw new Error("Not yet implemented")},t.prototype.acosh=function(t){throw new Error("Not yet implemented")},t.prototype.atanh=function(t){throw new Error("Not yet implemented")},t.prototype.erf=function(t){throw new Error("Not yet implemented")},t.prototype.step=function(t,e){throw new Error("Not yet implemented")},t.prototype.conv2d=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv2dDerInput=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv2dDerFilter=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2D=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2DDerInput=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv3d=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv3dDerInput=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv3dDerFilter=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.maxPool=function(t,e){throw new Error("Not yet implemented")},t.prototype.maxPoolBackprop=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.avgPool=function(t,e){throw new Error("Not yet implemented")},t.prototype.avgPoolBackprop=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.reshape=function(t,e){throw new Error("Not yet implemented")},t.prototype.cast=function(t,e){throw new Error("Not yet implemented")},t.prototype.tile=function(t,e){throw new Error("Not yet implemented")},t.prototype.pad=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.transpose=function(t,e){throw new Error("Not yet implemented")},t.prototype.gather=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.gatherND=function(t,e){throw new Error("Not yet implemented")},t.prototype.scatterND=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.batchToSpaceND=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.spaceToBatchND=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.resizeBilinear=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.resizeBilinearBackprop=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.resizeNearestNeighbor=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.batchNormalization=function(t,e,n,r,o,i){throw new Error("Not yet implemented")},t.prototype.localResponseNormalization4D=function(t,e,n,r,o){throw new Error("Not yet implemented")},t.prototype.LRNGrad=function(t,e,n,r,o,i,a){throw new Error("Not yet implemented")},t.prototype.multinomial=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.oneHot=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.cumsum=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.nonMaxSuppression=function(t,e,n,r,o){throw new Error("Not yet implemented")},t.prototype.fft=function(t){throw new Error("Not yet implemented")},t.prototype.ifft=function(t){throw new Error("Not yet implemented")},t.prototype.complex=function(t,e){throw new Error("Not yet implemented")},t.prototype.real=function(t){throw new Error("Not yet implemented")},t.prototype.imag=function(t){throw new Error("Not yet implemented")},t.prototype.cropAndResize=function(t,e,n,r,o,i){throw new Error("Not yet implemented")},t.prototype.depthToSpace=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.split=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.sparseToDense=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.fill=function(t,e,n){throw new Error("Not yet implemented.")},t.prototype.onesLike=function(t){throw new Error("Not yet implemented")},t.prototype.zerosLike=function(t){throw new Error("Not yet implemented")},t.prototype.setDataMover=function(t){throw new Error("Not yet implemented")},t.prototype.dispose=function(){throw new Error("Not yet implemented")}}();var Cm=function(t,e,n){this.variableNames=["A"];var r=t.windowSize,o=t.batchSize,i=Math.ceil(t.inSize/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+(n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));")+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+("max"===e?">":"<")+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function Em(t,e){return["x","y","z","w","u","v"].slice(0,e).map(function(e){return t+"."+e})}function Nm(t,e){return 1===e?[t]:Em(t,e)}function _m(t,e){for(var n=t.length,r=[],o=0;o<n;o++){var i=n-1-o;(e[e.length-1-o]||1)>1&&1===(t[i]||1)&&r.unshift(i)}return r}function Im(t,e){for(var n=[],r=0;r<e.length;r++){var o=t[t.length-r-1],i=e.length-r-1;(null==o||1===o&&e[i]>1)&&n.unshift(i)}return n}function Tm(t,e){for(var n=[],r=Math.max(t.length,e.length),o=0;o<r;o++){var i=t[t.length-o-1];null==i&&(i=1);var a=e[e.length-o-1];if(null==a&&(a=1),1===i)n.unshift(a);else if(1===a)n.unshift(i);else{if(i!==a)throw Error("Operands could not be broadcast together with shapes "+t+" and "+e+".");n.unshift(i)}}return n}function Am(){var t,e,n,r,o,i,a,s;return 2===md.get("WEBGL_VERSION")?(t="#version 300 es",e="in",n="out",r="in",o="texture",i="outputColor",a="out vec4 outputColor;",s="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",e="attribute",n="varying",r="varying",o="texture2D",i="gl_FragColor",a="",s="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:o,output:i,defineOutput:a,defineRound:s}}function km(t,e,n){void 0===n&&(n="index");var r=Ef(e);return r.map(function(e,o){return"int "+t[o]+" = "+n+" / "+e+"; "+(o===r.length-1?"int "+t[o+1]+" = "+n+" - "+t[o]+" * "+e:"index -= "+t[o]+" * "+e)+";"}).join("")}function Rm(t){return 1===t.length?""+t[0]:"vec"+t.length+"("+t.join(",")+")"}var Om="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Dm="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Mm="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Pm="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Lm(t){return"offset"+t}function Fm(t){var e=t.name,n=Jh(t.shapeInfo.logicalShape);return 1===n?"return "+e+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+e+"[i];\n      }\n    }\n  "}function zm(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function Bm(t,e){var n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function Um(t,e){return e.map(function(e){return t[e]}).join(", ")}var Vm=function(t,e,n,r){this.variableNames=["A"],this.usesPackedTextures=!0,Xh(t.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var o=Math.ceil(t[t.length-1]/e);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var i,a,s=this.outputShape,u=s.length,l=zm(u),c=Nm("coords",u);if(1===o){var p=zm(a=u+1);i="\n        "+p+" sourceLocR = "+p+"("+c.join()+", 0);\n        ++"+c[u-1]+";\n        "+p+" sourceLocG = "+p+"("+c.join()+", 0);\n        ++"+c[u-2]+";\n        "+p+" sourceLocA = "+p+"("+c.join()+", 0);\n        --"+c[u-1]+";\n        "+p+" sourceLocB = "+p+"("+c.join()+", 0);\n        --"+c[u-2]+";"}else a=u,i="\n        "+l+" sourceLocR = coords;\n        ++"+c[u-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+c[u-2]+";\n        "+l+" sourceLocA = coords;\n        --"+c[u-1]+";\n        "+l+" sourceLocB = coords;\n        --"+c[u-2]+";";var h=["x","y","z","w","u","v"].slice(0,a),f="."+h[a-1],d=h.map(function(t){return"int "+t}),m=Nm("sourceLocR",a-1).concat("inIdx.r"),g=Nm("sourceLocG",a-1).concat("inIdx.g"),v=Nm("sourceLocB",a-1).concat("inIdx.b"),y=Nm("sourceLocA",a-1).concat("inIdx.a"),b="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+y.join()+")));",x="vec4(\n            getAChannel("+m.join()+"),\n            hasNextCol ? getAChannel("+g.join()+") : 0.,\n            hasNextRow ? getAChannel("+v.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+y.join()+") : 0.)",S=r?"":"\n      float getBestIndicesAChannel("+d.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+d.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+S+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+c[u-1]+" < "+(s[u-1]-1)+";\n        bool hasNextRow = "+c[u-2]+" < "+(s[u-2]-1)+";\n        "+i+"\n        ivec4 srcIdx = ivec4(sourceLocR"+f+", sourceLocG"+f+",\n          sourceLocB"+f+", sourceLocA"+f+") * "+e+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+x+";\n\n        for (int i = 0; i < "+e+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+x+";\n          bvec4 nan = isNaN(candidate);\n          bvec4 replace = bvec4(\n            vec4("+b+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},jm=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.effectiveFilterHeight,n=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-t.padInfo.top)+", "+(n-1-t.padInfo.left)+");\n      const float avgMultiplier = float("+1/(t.filterHeight*t.filterWidth)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+";\n            wR += "+t.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+";\n            wC+= "+t.dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Wm=function(t,e,n,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Tm(t,e),Tm(t,n);var a="0.0";null!=r&&(Tm(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";null!=o&&(Tm(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+i+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},Hm=function(t,e,n,r,o,i){this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],Tm(t,e),Tm(t,n);var a="vec4(0.0)";null!=r&&(Tm(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(Tm(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = "+a+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+i+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},qm=function(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Tm(e,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+t+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Gm="return a + b;",Km="return a - b;",$m="return a * b;",Xm=function(){function t(t,e,n){this.variableNames=["A","B"],this.outputShape=Tm(e,n),this.userCode="\n      uniform float NAN;\n      float binaryOperation(float a, float b) {\n        "+t+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(){var t=this;return function(e,n){null==t.startLoc&&(t.startLoc=e.getUniformLocationNoThrow(n,"NAN"),null==t.startLoc)||e.gl.uniform1f(t.startLoc,NaN)}},t}(),Zm=function(){function t(t,e,n){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.outputShape=Tm(e,n),this.userCode="\n      uniform float NAN;\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(){var t=this;return function(e,n){null==t.startLoc&&(t.startLoc=e.getUniformLocationNoThrow(n,"NAN"),null==t.startLoc)||e.gl.uniform1f(t.startLoc,NaN)}},t}(),Ym=function(){function t(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float min;\n      uniform float max;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isNaN(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, min, max));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"min"),n.maxLoc=r.getUniformLocationNoThrow(o,"max")),r.gl.uniform1f(n.minLoc,t),r.gl.uniform1f(n.maxLoc,e)}},t}(),Qm=function(){function t(t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t,this.userCode="\n      uniform float min;\n      uniform float max;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (hasNaN(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(min), vec4(max)));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"min"),n.maxLoc=r.getUniformLocationNoThrow(o,"max")),r.gl.uniform1f(n.minLoc,t),r.gl.uniform1f(n.maxLoc,e)}},t}(),Jm=function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},tg=function(t){this.outputShape=[],this.outputShape=Dd(t,1),this.variableNames=t.map(function(t,e){return"T"+e});var e=new Array(t.length-1);e[0]=t[0][1];for(var n=1;n<e.length;n++)e[n]=e[n-1]+t[n][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<e.length;n++)r.push("else if (yC < "+e[n]+") setOutput(getT"+n+"(yR, yC-"+e[n-1]+"));");r.push("else setOutput(getT"+e.length+"(yR, yC-"+e[e.length-1]+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},eg=function(t,e){this.usesPackedTextures=!0,this.outputShape=[],this.outputShape=Dd(t,e);var n=this.outputShape,r=n.length,o=zm(r),i=Nm("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map(function(t,e){return"T"+e});var s=new Array(t.length-1);s[0]=t[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+t[u][e];var l=a[e],c="vec2("+a.slice(-2).join()+")",p=a.join(),h="if ("+l+" < "+s[0]+")\n          return getChannel(getT0("+p+"), "+c+");";for(u=1;u<s.length;u++)h+="\n        else if ("+l+" < "+s[u]+") {\n          "+l+" -= "+s[u-1]+";\n          return getChannel(getT"+u+"("+p+"), "+c+");\n        }";h+="\n        else {\n          "+l+" -= "+s[s.length-1]+";\n          return getChannel(getT"+s.length+"("+p+"), "+c+");\n        }",this.userCode="\n      float getValue("+a.map(function(t){return"int "+t})+") {\n        "+h+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+i+"), 0., 0., 0.);\n        if (++"+i[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+i+");\n        }\n        if (++"+i[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+i+");\n        }\n        if ("+i[r-2]+" < "+n[r-2]+" &&\n            --"+i[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+i+");\n        }\n        setOutput(result);\n      }\n    "},ng=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},rg=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-t.padInfo.top)+", "+(n-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},og=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yF = 0; yF < "+t.outDepth+"; yF++) {\n            int xF = wF + yF * "+t.strideDepth+" - "+t.padInfo.front+";\n\n            if (xF < 0 || xF >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n              int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n                int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ig=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(e-1-t.padInfo.front)+", "+(n-1-t.padInfo.top)+", "+(r-1-t.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+e+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+t.strideDepth+".0;\n\n          if (dyF < 0.0 || dyF >= "+t.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+e+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ag=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+t.outChannels/t.inChannels+" + dm;\n\n        float dotProd = 0.0;\n\n        // TODO: Vec4 over the batch size\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},sg=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-t.padInfo.top)+", "+(n-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TODO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+r+"; dm++) {\n              int d2 = d1 * "+r+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ug=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.padInfo.top,n=t.padInfo.left,r=t.strideHeight,o=t.strideWidth,i=t.dilationHeight,a=t.dilationWidth,s=t.filterHeight,u=t.filterWidth,l=4*Math.floor(t.inChannels/4),c=t.inChannels%4;this.userCode="\n      const ivec2 strides = ivec2("+r+", "+o+");\n      const ivec2 pads = ivec2("+e+", "+n+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+"; wR++) {\n          int xR = xRCorner + wR * "+i+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+u+"; wC++) {\n            int xC = xCCorner + wC * "+a+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+l+"; d1 += 4) {\n              vec4 xValues = vec4(\n                getX(batch, xR, xC, d1),\n                getX(batch, xR, xC, d1 + 1),\n                getX(batch, xR, xC, d1 + 2),\n                getX(batch, xR, xC, d1 + 3)\n              );\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              dotProd += dot(xValues, wValues);\n            }\n\n            if ("+(1===c)+") {\n              dotProd +=\n                getX(batch, xR, xC, "+l+") *\n                getW(wR, wC, "+l+", d2);\n            } else if ("+(2===c)+") {\n              vec2 xValues = vec2(\n                getX(batch, xR, xC, "+l+"),\n                getX(batch, xR, xC, "+l+" + 1)\n              );\n              vec2 wValues = vec2(\n                getW(wR, wC, "+l+", d2),\n                getW(wR, wC, "+l+" + 1, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            } else if ("+(3===c)+") {\n              vec3 xValues = vec3(\n                getX(batch, xR, xC, "+l+"),\n                getX(batch, xR, xC, "+l+" + 1),\n                getX(batch, xR, xC, "+l+" + 2)\n              );\n              vec3 wValues = vec3(\n                getW(wR, wC, "+l+", d2),\n                getW(wR, wC, "+l+" + 1, d2),\n                getW(wR, wC, "+l+" + 2, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},lg=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,l=t.dilationWidth,c=t.filterDepth,p=t.filterHeight,h=t.filterWidth,f=4*Math.floor(t.inChannels/4),d=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+e+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+c+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+p+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+h+"; wC++) {\n              int xC = xCCorner + wC * "+l+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===d)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+f+") *\n                  getW(wF, wR, wC, "+f+", d2);\n              } else if ("+(2===d)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===d)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1),\n                  getX(batch, xF, xR, xC, "+f+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2),\n                  getW(wF, wR, wC, "+f+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},cg=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+t.strideHeight+", "+t.strideWidth+");\n      const ivec2 pads = ivec2("+t.padInfo.top+", "+t.padInfo.left+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+e+";\n        int q = d2 - d1 * "+e+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+t.filterHeight+"; wR++) {\n          int xR = xRCorner + wR * "+t.dilationHeight+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+t.filterWidth+"; wC++) {\n            int xC = xCCorner + wC * "+t.dilationWidth+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},pg=function(t){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=t.outShape;for(var e=t.inHeight,n=t.inWidth,r=t.padInfo.top,o=t.padInfo.left,i=t.strideHeight,a=t.strideWidth,s=t.dilationHeight,u=t.dilationWidth,l=t.filterHeight,c=t.filterWidth,p=c,h="int xR; int xC; int xCOffset;",f=0;f<l;f++)for(var d=0;d<c;d++)h+="\n          vec4 xTexelR"+f+"C"+2*d+" = vec4(0.);\n          vec4 wR"+f+"C"+d+" = vec4(0.);\n          vec4 xR"+f+"C"+d+" = vec4(0.);";for(f=0;f<l;f++)for(var m=0;m<p;m++){if(h+="\n          xR = xRCorner + "+f*s+";\n          xC = xCCorner + "+(d=2*m)*u+";\n        ",1===a){if(d<c&&(h+=o%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+e+" && xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+f+"C"+d+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+f+"C"+d+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+e+" && xCOffset >= 0 && xCOffset < "+n+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n                  xR"+f+"C"+d+" = vec4(previous.zw, xTexelR"+f+"C"+d+".xy);\n                } else {\n                  xR"+f+"C"+d+" = vec4(0, 0, xTexelR"+f+"C"+d+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+e+" && xC >= 0 && xC < "+n+") {\n                  xTexelR"+f+"C"+d+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+f+"C"+d+" = vec4(0.);\n                }\n\n                xR"+f+"C"+d+" = xTexelR"+f+"C"+d+";\n              ",d+1<c)){var g=o%2==0?Gh(u):u;u%2==0&&o%2==1||u%2!=0&&o%2!=1?(h+="\n                  xCOffset = xC + "+o%2+" + "+g+";\n\n                  if(xR >= 0 && xR < "+e+" &&\n                    xCOffset >= 0 && xCOffset < "+n+") {\n                    xTexelR"+f+"C"+(d+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",u>1&&(h+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+e+" &&\n                      xCOffset >= 0 && xCOffset < "+n+") {\n                      xTexelR"+f+"C"+d+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+f+"C"+d+" = vec4(0.);\n                    }\n                  "),h+="\n                  xR"+f+"C"+(d+1)+" = vec4(\n                    xTexelR"+f+"C"+d+".zw, xTexelR"+f+"C"+(d+2)+".xy);\n                "):h+="\n                  xCOffset = xC + "+g+";\n\n                  if(xR >= 0 && xR < "+e+" &&\n                    xCOffset >= 0 && xCOffset < "+n+") {\n                    xTexelR"+f+"C"+(d+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+f+"C"+(d+1)+" = xTexelR"+f+"C"+(d+2)+";\n                "}}else d<c&&(h+="\n              if(xR >= 0 && xR < "+e+") {\n            ",o%2==1?(h+="\n                xCOffset = xC + 1 - "+a+";\n                if(xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+f+"C"+d+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+f+"C"+d+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+n+") {\n                  xTexelR"+f+"C"+(d+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+f+"C"+(d+2)+" = vec4(0.);\n                }\n\n                xR"+f+"C"+d+" = vec4(\n                  xTexelR"+f+"C"+d+".zw, xTexelR"+f+"C"+(d+2)+".zw);\n              ",d+1<c&&(h+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+a+";\n                  if(xCOffset >= 0 && xCOffset < "+n+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+f+"C"+(d+1)+" = vec4(xTexelR"+f+"C"+(d+2)+".xy, final.xy);\n                ")):(h+="\n                if(xC >= 0 && xC < "+n+") {\n                  xTexelR"+f+"C"+d+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+f+"C"+d+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+a+";\n                if(xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+f+"C"+(d+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+f+"C"+(d+2)+" = vec4(0.);\n                }\n\n                xR"+f+"C"+d+" = vec4(\n                  xTexelR"+f+"C"+d+".xy, xTexelR"+f+"C"+(d+2)+".xy);\n              ",d+1<c&&(h+="\n                  xR"+f+"C"+(d+1)+" = vec4(\n                    xTexelR"+f+"C"+d+".zw, xTexelR"+f+"C"+(d+2)+".zw);\n                ")),h+="}");d<c&&(h+="\n            vec4 wTexelR"+f+"C"+d+" = getW("+f+", "+d+", d1, q);\n            wR"+f+"C"+d+" = vec4(wTexelR"+f+"C"+d+".xz, wTexelR"+f+"C"+d+".xz);\n          ",d+1<c&&(h+="\n              vec4 wTexelR"+f+"C"+(d+1)+" = getW("+f+", "+(d+1)+", d1, q);\n              wR"+f+"C"+(d+1)+" =\n                vec4(wTexelR"+f+"C"+(d+1)+".xz, wTexelR"+f+"C"+(d+1)+".xz);"))}for(f=0;f<l;f++)for(d=0;d<c;d++)h+="result += xR"+f+"C"+d+" * wR"+f+"C"+d+";";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+a+");\n      const ivec2 pads = ivec2("+r+", "+o+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 result = vec4(0.);\n\n        "+h+"\n\n        setOutput(result);\n      }\n    "},hg=function(t,e,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=t[0],a=t[1],s=t[2],u=n[0],l=n[1];this.outputShape=[e[0],u,l,t[3]];var c=[a-1+".0",s-1+".0"],p=c[0],h=c[1],f=u>1?[""+(a-1)/(u-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],d=l>1?[""+(s-1)/(l-1),"(x2-x1) * width_ratio","x1*"+h+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+h];this.userCode="\n      const float height_ratio = float("+f[0]+");\n      const float width_ratio = float("+d[0]+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+i+") {\n          return;\n        }\n\n        float height_scale = "+f[1]+";\n        float width_scale = "+d[1]+";\n\n        float in_y = "+f[2]+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+d[2]+";\n        if( in_x < 0.0 || in_x > "+h+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexRC = vec2(in_y,in_x);\n        if("+("bilinear"===r?1:0)+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n          ivec2 sourceCeilRC = ivec2(ceil(sourceFracIndexRC));\n\n          float topLeft = getImage(b, sourceFloorRC.x, sourceFloorRC.y, d);\n          float bottomLeft = getImage(b, sourceCeilRC.x, sourceFloorRC.y, d);\n          float topRight = getImage(b, sourceFloorRC.x, sourceCeilRC.y, d);\n          float bottomRight = getImage(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n          vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n          float top = topLeft + (topRight - topLeft) * fracRC.y;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n          float newValue = top + (bottom - top) * fracRC.x;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestRC = ivec2(floor(\n            sourceFracIndexRC + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestRC.x, sourceNearestRC.y, d);\n          setOutput(newValue);\n        }\n      }\n    "},fg=function(t,e,n){this.variableNames=["x"],this.outputShape=t;var r=t.length,o=t[t.length-1],i=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+zm(r)+" coords = getOutputCoords();\n        int end = "+dg(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+i+" end) {\n            continue;\n          }\n          if (idx == end && "+e+") {\n            continue;\n          }\n          "+dg(r,"coords")+" = idx;\n          val += getX("+function(t,e){if(1===r)return""+e;if(2===r)return e+".x, "+e+".y";if(3===r)return e+".x, "+e+".y, "+e+".z";if(4===r)return e+".x, "+e+".y, "+e+".z, "+e+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}(0,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function dg(t,e){if(1===t)return""+e;if(2===t)return e+".y";if(3===t)return e+".z";if(4===t)return e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}var mg,gg,vg=function(){function t(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+e+";\n      int offset_h = imod(h, "+e+");\n      int in_w = w / "+e+";\n      int offset_w = imod(w, "+e+");\n      int offset_d = (offset_h * "+e+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return t.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),yg=function(t){this.variableNames=["A"];var e=Am();this.outputShape=t,this.userCode="\n      const float FLOAT_MAX = 1.70141184e38;\n      const float FLOAT_MIN = 1.17549435e-38;\n\n      lowp vec4 encode_float(highp float v) {\n        if (isNaN(v)) {\n          return vec4(255, 255, 255, 255);\n        }\n\n        highp float av = abs(v);\n\n        if(av < FLOAT_MIN) {\n          return vec4(0.0, 0.0, 0.0, 0.0);\n        } else if(v > FLOAT_MAX) {\n          return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n        } else if(v < -FLOAT_MAX) {\n          return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n        }\n\n        highp vec4 c = vec4(0,0,0,0);\n\n        highp float e = floor(log2(av));\n        highp float m = exp2(fract(log2(av))) - 1.0;\n\n        c[2] = floor(128.0 * m);\n        m -= c[2] / 128.0;\n        c[1] = floor(32768.0 * m);\n        m -= c[1] / 32768.0;\n        c[0] = floor(8388608.0 * m);\n\n        highp float ebias = e + 127.0;\n        c[3] = floor(ebias / 2.0);\n        ebias -= c[3] * 2.0;\n        c[2] += floor(ebias) * 128.0;\n\n        c[3] += 128.0 * step(0.0, -v);\n\n        return c / 255.0;\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+e.output+" = encode_float(x);\n      }\n    "},bg=function(t,e,n){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+t+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+(n?r+".0":"1.0")+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},wg=function(){function t(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.valueLoc&&(e.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(e.valueLoc,t)}},t}(),xg=function(t){this.variableNames=["A"];var e=Am(),n=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+e.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},Sg=function(t,e,n){this.variableNames=["A","indices"];var r=t.slice();r[n]=e,this.outputShape=r,this.rank=r.length;var o=zm(this.rank),i=function(t,e){var n=t.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],i=0;i<t.length;i++)o.push(i===e?"int(getIndices("+r[i]+"))":""+r[i]);return o.join()}(t,n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},Cg=function(t,e,n){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=n;var r=zm(e.length),o=zm(n.length);this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+(this.sliceDim>1?"strides[j]":"strides")+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function Eg(t,e){return[e,t]}function Ng(t,e){return t*e}function _g(t,e,n){var r=function(t,e){if(t%e!=0)throw new Error("unpackedSize ("+t+") must be a multiple of "+e);return t/e}(t.length,n);if(e.length<r)throw new Error("matrix length ("+e.length+") must be >= "+r);for(var o=0,i=0;i<t.length;i+=n)e[o++]=t[i]}function Ig(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function Tg(t,e){var n=Ig(t,e);return n[0]*n[1]*4}function Ag(t,e,n,r,o){var i=n*r;if(o.length<i)throw new Error("matrix length ("+o.length+") must be >= "+i);for(var a=r%2==1,s=n%2==1,u=Math.floor(r/2),l=Math.floor(n/2),c=Math.ceil(r/2),p=c*Math.ceil(n/2),h=Gh(n)*Gh(r),f=0;f<e;f++){for(var d=f*n*r,m=f*h,g=a?4:0,v=r+(a?1:0),y=m,b=d,w=d+r,x=0;x<l;++x){for(var S=0;S<u;++S)o[b++]=t[y++],o[b++]=t[y++],o[w++]=t[y++],o[w++]=t[y++];y+=g,b+=v,w+=v}if(a){y=m+4*(c-1);var C=d+r-1;for(g=4*c,v=2*r,x=0;x<l;++x)o[C]=t[y],o[C+r]=t[y+2],y+=g,C+=v}if(s){for(y=m+4*(p-c),C=d+(n-1)*r,S=0;S<u;++S)o[C++]=t[y++],o[C++]=t[y++],y+=2;a&&(o[d+n*r-1]=t[y])}}return o}function kg(t,e){var n=e();return Dg(t),n}!function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(mg||(mg={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(gg||(gg={}));var Rg=!1;function Og(t){Rg=t}function Dg(t){if(Rg){var e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+Fg(t,e))}}var Mg=5.96e-8,Pg=65504;function Lg(t){return!!(md.get("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||Mg<Math.abs(t)&&Math.abs(t)<Pg)}function Fg(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function zg(t,e){return av(t,function(){return t.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function Bg(t,e){var n=av(t,function(){return t.createShader(t.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(kg(t,function(){return t.shaderSource(n,e)}),kg(t,function(){return t.compileShader(n)}),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function Ug(t,e){var n=av(t,function(){return t.createShader(t.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(kg(t,function(){return t.shaderSource(n,e)}),kg(t,function(){return t.compileShader(n)}),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw function(t,e){var n=Vg.exec(e);if(null==n)return console.log("Couldn't parse line number in error: "+e),void console.log(t);for(var r=+n[1],o=t.split("\n"),i=o.length.toString().length+2,a=o.map(function(t,e){return of((e+1).toString(),i)+t}),s=0,u=0;u<a.length;u++)s=Math.max(a[u].length,s);var l=a.slice(0,r-1),c=a.slice(r-1,r),p=a.slice(r);console.log(l.join("\n")),console.log(e.split("\n")[0]),console.log("%c "+of(c[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(p.join("\n"))}(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var Vg=/ERROR: [0-9]+:([0-9]+):/g;function jg(t){return av(t,function(){return t.createProgram()},"Unable to create WebGLProgram.")}function Wg(t,e){if(kg(t,function(){return t.linkProgram(e)}),!1===t.getProgramParameter(e,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Hg(t,e){if(kg(t,function(){return t.validateProgram(e)}),!1===t.getProgramParameter(e,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function qg(t,e){var n=av(t,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return kg(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,n)}),kg(t,function(){return t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)}),n}function Gg(t,e){var n=av(t,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return kg(t,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)}),kg(t,function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)}),n}function Kg(){return 2===md.get("WEBGL_VERSION")?1:4}function $g(t){return av(t,function(){return t.createTexture()},"Unable to create WebGLTexture.")}function Xg(t,e){var n=md.get("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){var r="["+t+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(t>n||e>n)throw r="["+t+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function Zg(t){return av(t,function(){return t.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Yg(t,e,n,r,o,i,a){var s=t.getAttribLocation(e,n);return-1!==s&&(kg(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),kg(t,function(){return t.vertexAttribPointer(s,o,t.FLOAT,!1,i,a)}),kg(t,function(){return t.enableVertexAttribArray(s)}),!0)}function Qg(t,e,n){sv(t,n),kg(t,function(){return t.activeTexture(t.TEXTURE0+n)}),kg(t,function(){return t.bindTexture(t.TEXTURE_2D,e)})}function Jg(t,e,n){return av(t,function(){return t.getUniformLocation(e,n)},'uniform "'+n+'" not present in program.')}function tv(t,e,n){return t.getUniformLocation(e,n)}function ev(t,e,n,r,o){kg(t,function(){return Qg(t,n,o)}),kg(t,function(){return t.uniform1i(r,o)})}function nv(t,e,n){kg(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,n)}),kg(t,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)})}function rv(t,e){kg(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,e)}),kg(t,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)})}function ov(t){var e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+iv(t,e))}function iv(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function av(t,e,n){var r=kg(t,function(){return e()});if(null==r)throw new Error(n);return r}function sv(t,e){var n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function uv(t,e){return void 0===e&&(e=2),Jh(t.slice(0,t.length-e))}function lv(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function cv(t,e){var n;void 0===e&&(e=!1);var r=md.get("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,1===(t=t.map(function(e,n){return n>=t.length-2?Gh(t[n]):t[n]})).length&&(t=[2,t[0]])),2!==t.length){var o=lf(t);t=o.newShape}var i=Jh(t);if(t.length<=1&&i<=r)return[1,i];if(2===t.length&&t[0]<=r&&t[1]<=r)return t;if(3===t.length&&t[0]*t[1]<=r&&t[2]<=r)return[t[0]*t[1],t[2]];if(3===t.length&&t[0]<=r&&t[1]*t[2]<=r)return[t[0],t[1]*t[2]];if(4===t.length&&t[0]*t[1]*t[2]<=r&&t[3]<=r)return[t[0]*t[1]*t[2],t[3]];if(4===t.length&&t[0]<=r&&t[1]*t[2]*t[3]<=r)return[t[0],t[1]*t[2]*t[3]];if(e){var a=uv(t),s=2,u=2;return t.length&&(s=(n=lv(t))[0],u=n[1]),rf(i=a*(s/2)*(u/2)).map(function(t){return 2*t})}return rf(i)}function pv(t){return t%2==0}function hv(t,e){if(tf(t=t.slice(-2),e=e.slice(-2)))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){var n=t.slice(-1)[0],r=e.slice(-1)[0];if(n===r)return!0;if(pv(n)&&pv(r)&&(1===t[0]||1===e[0]))return!0}return t[1]===e[1]&&pv(t[0])&&pv(e[0])}var fv=Object.freeze({callAndCheck:kg,enableDebugWebGLErrorChecking:Og,checkWebGLError:Dg,canBeRepresented:Lg,getWebGLErrorMessage:Fg,getExtensionOrThrow:zg,createVertexShader:Bg,createFragmentShader:Ug,createProgram:jg,linkProgram:Wg,validateProgram:Hg,createStaticVertexBuffer:qg,createStaticIndexBuffer:Gg,getNumChannels:Kg,createTexture:$g,validateTextureSize:Xg,createFramebuffer:Zg,bindVertexBufferToProgramAttribute:Yg,bindTextureUnit:Qg,unbindTextureUnit:function(t,e){sv(t,e),kg(t,function(){return t.activeTexture(t.TEXTURE0+e)}),kg(t,function(){return t.bindTexture(t.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:Jg,getProgramUniformLocation:tv,bindTextureToProgramUniformSampler:ev,bindCanvasToFramebuffer:function(t){kg(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),kg(t,function(){return t.viewport(0,0,t.canvas.width,t.canvas.height)}),kg(t,function(){return t.scissor(0,0,t.canvas.width,t.canvas.height)})},bindColorTextureToFramebuffer:nv,unbindColorTextureFromFramebuffer:rv,validateFramebuffer:ov,getFramebufferErrorMessage:iv,getBatchDim:uv,getRowsCols:lv,getTextureShapeFromLogicalShape:cv,isReshapeFree:hv});function dv(t){var e=Am();return Bg(t,e.version+"\n    precision highp float;\n    "+e.attribute+" vec3 clipSpacePos;\n    "+e.attribute+" vec2 uv;\n    "+e.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function mv(t){return qg(t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function gv(t){return Gg(t,new Uint16Array([0,1,2,2,1,3]))}function vv(t,e){var n,r,o,i,a,s,u,l,c=t;return 2===md.get("WEBGL_VERSION")?(n=c.R32F,r=c.R16F,o=c.RGBA16F,i=c.RGBA32F,a=c.RED,s=4,u=1,l=c.HALF_FLOAT):(n=t.RGBA,r=t.RGBA,o=t.RGBA,i=c.RGBA,a=t.RGBA,s=4,u=4,l=null!=e?e.HALF_FLOAT_OES:null),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:t.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l}}function yv(t,e,n,r,o,i){Xg(e,n);var a=$g(t),s=t.TEXTURE_2D;return kg(t,function(){return t.bindTexture(s,a)}),kg(t,function(){return t.texParameteri(s,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)}),kg(t,function(){return t.texParameteri(s,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}),kg(t,function(){return t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST)}),kg(t,function(){return t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST)}),kg(t,function(){return t.texImage2D(s,0,r,e,n,0,o,i,null)}),kg(t,function(){return t.bindTexture(t.TEXTURE_2D,null)}),a}function bv(t,e,n,r){var o=Eg(e,n);return yv(t,o[0],o[1],r.internalFormatFloat,r.textureFormatFloat,t.FLOAT)}function wv(t,e,n,r){var o=Eg(e,n);return yv(t,o[0],o[1],r.internalFormatHalfFloat,r.textureFormatFloat,r.textureTypeHalfFloat)}function xv(t,e,n,r){var o=Eg(e,n);return yv(t,o[0],o[1],t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}function Sv(t,e,n,r){var o=Ig(e,n);return yv(t,o[0],o[1],r.internalFormatPackedFloat,t.RGBA,t.FLOAT)}function Cv(t,e,n,r){var o=Ig(e,n);return yv(t,o[0],o[1],r.internalFormatPackedHalfFloat,t.RGBA,r.textureTypeHalfFloat)}function Ev(t,e,n){return kg(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,n)}),Yg(t,e,"clipSpacePos",n,3,20,0)&&Yg(t,e,"uv",n,2,20,12)}function Nv(t,e,n){kg(t,function(){return t.bindTexture(t.TEXTURE_2D,e)}),kg(t,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)}),kg(t,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function _v(t,e,n,r,o,i){Xg(n,r),kg(t,function(){return t.bindTexture(t.TEXTURE_2D,e)}),kg(t,function(){return t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,r,i,t.FLOAT,o)}),kg(t,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function Iv(t,e,n,r,o,i,a){var s,u=Eg(n,r),l=u[0],c=u[1],p=n*r;1===a.defaultNumChannels&&p===o.length?s=o:function(t,e,n){var r=Ng(t.length,n);if(e.length<r)throw new Error("unpackedArray length ("+e.length+") must be >= "+r);for(var o=0,i=0;i<t.length;++i)e[o]=t[i],o+=n}(o,s=new Float32Array(p*i),i),_v(t,e,l,c,s,a.textureFormatFloat)}function Tv(t,e,n,r,o,i,a,s,u){var l=Ig(i,a),c=l[0],p=l[1],h=new Float32Array(Tg(i,a));(function(t,e,n,r,o){for(var i=r%2==1,a=n%2==1,s=Math.floor(r/2),u=Math.floor(n/2),l=Math.ceil(r/2),c=l*Math.ceil(n/2),p=Gh(n)*Gh(r),h=0;h<e;h++){for(var f=h*n*r,d=h*p,m=i?4:0,g=r,v=d,y=0;y<u;++y){for(var b=2*y*r,w=0;w<s;++w){var x=f+b+2*w;o[v]=t[x],o[v+1]=t[x+1],o[v+2]=t[x+g],o[v+3]=t[x+g+1],v+=4}v+=m}if(i){x=f+r-1,v=d+4*(l-1);var S=2*r;for(m=4*l,y=0;y<u;++y)o[v]=t[x],o[v+2]=t[x+r],x+=S,v+=m}if(a){for(x=f+(n-1)*r,v=d+4*(c-l),w=0;w<s;++w)o[v++]=t[x++],o[v++]=t[x++],v+=2;i&&a&&(o[d+p-4]=t[x])}}})(s,n,r,o,h),_v(t,e,c,p,h,t.RGBA)}function Av(t,e,n,r,o){var i=e;if(2===md.get("WEBGL_VERSION")){var a=t,s=a.createBuffer();kg(t,function(){return t.bindBuffer(a.PIXEL_PACK_BUFFER,s)});var u=4*Ng(n*r,o.downloadUnpackNumChannels);kg(t,function(){return t.bufferData(a.PIXEL_PACK_BUFFER,u,a.STREAM_READ)}),kg(t,function(){return a.readPixels(0,0,r,n,t.RGBA,t.FLOAT,0)}),kg(t,function(){return t.bindBuffer(a.PIXEL_PACK_BUFFER,null)}),i=s}return i}function kv(t,e,n,r,o){var i=t,a=new Float32Array(Ng(n*r,o.downloadUnpackNumChannels));i.bindBuffer(i.PIXEL_PACK_BUFFER,e),i.getBufferSubData(i.PIXEL_PACK_BUFFER,0,a),i.bindBuffer(i.PIXEL_PACK_BUFFER,null);var s=new Float32Array(n*r);return _g(a,s,o.downloadUnpackNumChannels),s}function Rv(t,e,n,r){var o=Eg(e,n),i=o[0],a=o[1],s=new Float32Array(Ng(e*n,r.downloadUnpackNumChannels));kg(t,function(){return t.readPixels(0,0,i,a,r.downloadTextureFormat,t.FLOAT,s)});var u=new Float32Array(e*n);return _g(s,u,r.downloadUnpackNumChannels),u}function Ov(t,e,n,r){var o=Eg(e,n),i=o[0],a=o[1],s=new Uint8Array(Ng(e*n,4));return kg(t,function(){return t.readPixels(0,0,i,a,r.downloadTextureFormat,t.UNSIGNED_BYTE,s)}),new Float32Array(s.buffer)}function Dv(t,e,n,r,o,i,a,s){var u=t,l=new Float32Array(Tg(i,a));u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null);var c=new Float32Array(Jh([n,r,o]));return Ag(l,n,r,o,c),c}function Mv(t,e,n,r,o,i,a){var s=Ig(o,i),u=s[0],l=s[1],c=new Float32Array(Tg(o,i));kg(t,function(){return t.readPixels(0,0,u,l,t.RGBA,t.FLOAT,c)});var p=new Float32Array(Jh([e,n,r]));return Ag(c,e,n,r,p)}var Pv=Object.freeze({createVertexShader:dv,createVertexBuffer:mv,createIndexBuffer:gv,getTextureConfig:vv,createFloat32MatrixTexture:bv,createFloat16MatrixTexture:wv,createUnsignedBytesMatrixTexture:xv,createPackedMatrixTexture:Sv,createFloat16PackedMatrixTexture:Cv,bindVertexProgramAttributeStreams:Ev,uploadPixelDataToTexture:Nv,uploadMatrixToTexture:Iv,uploadMatrixToPackedTexture:Tv,maybeCreateBufferFromOutputTexture:Av,downloadFloat32MatrixFromBuffer:kv,downloadFloat32MatrixFromOutputTexture:Rv,downloadByteEncodedFloatMatrixFromOutputTexture:Ov,downloadPackedMatrixFromBuffer:Dv,downloadMatrixFromPackedOutputTexture:Mv}),Lv=function(){function t(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.autoDebugValidate=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=md.get("WEBGL_VERSION");null!=t?(this.gl=t,function(t,e){Vh[t]=e}(e,t)):this.gl=Wh(e),1===md.get("WEBGL_VERSION")?(this.textureFloatExtension=zg(this.gl,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),md.get("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=zg(this.gl,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=zg(this.gl,"EXT_color_buffer_float"),this.vertexBuffer=mv(this.gl),this.indexBuffer=gv(this.gl),this.framebuffer=Zg(this.gl),this.textureConfig=vv(this.gl,this.textureHalfFloatExtension)}return t.prototype.dispose=function(){var t=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;kg(e,function(){return e.finish()}),kg(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),kg(e,function(){return e.deleteFramebuffer(t.framebuffer)}),kg(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),kg(e,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),kg(e,function(){return e.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},t.prototype.enableAutomaticDebugValidation=function(t){this.autoDebugValidate=t,Og(t)},t.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),bv(this.gl,t,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),wv(this.gl,t,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),xv(this.gl,t,e)},t.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),Nv(this.gl,t,e)},t.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),Cv(this.gl,t,e,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),Sv(this.gl,t,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(rv(this.gl,this.framebuffer),this.outputTexture=null),kg(this.gl,function(){return e.gl.deleteTexture(t)})},t.prototype.uploadMatrixToTexture=function(t,e,n,r){this.throwIfDisposed();var o=Kg();return Iv(this.gl,t,e,n,r,o,this.textureConfig)},t.prototype.uploadMatrixToPackedTexture=function(t,e,n,r,o,i,a){return this.throwIfDisposed(),Tv(this.gl,t,e,n,r,o,i,a)},t.prototype.downloadFloat32MatrixFromOutputTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,function(){return Rv(r.gl,e,n,r.textureConfig)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,function(){return Ov(r.gl,e,n,r.textureConfig)})},t.prototype.downloadPackedMatrixFromBuffer=function(t,e,n,r,o,i){return Dv(this.gl,t,e,n,r,o,i)},t.prototype.downloadFloat32MatrixFromBuffer=function(t,e,n){return kv(this.gl,t,e,n,this.textureConfig)},t.prototype.maybeCreateBufferFromTexture=function(t,e,n){this.bindTextureToFrameBuffer(t);var r=Av(this.gl,t,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},t.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},t.prototype.createFence=function(t){var e,n,r=this;if(md.get("WEBGL_FENCE_API_ENABLED")){var o=t,i=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=function(){var t=o.clientWaitSync(i,0,0);return t===o.ALREADY_SIGNALED||t===o.CONDITION_SATISFIED},e=i}else md.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(e,md.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:e,isFencePassed:n}},t.prototype.downloadMatrixFromPackedTexture=function(t,e,n,r,o,i){var a=this;return this.downloadMatrixDriver(t,function(){return Mv(a.gl,e,n,r,o,i)})},t.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,n=Ug(e,t),r=dv(e),o=jg(e);return kg(e,function(){return e.attachShader(o,r)}),kg(e,function(){return e.attachShader(o,n)}),Wg(e,o),this.autoDebugValidate&&Hg(e,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=Ev(e,this.program,this.vertexBuffer)),o},t.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&kg(this.gl,function(){return e.gl.deleteProgram(t)})},t.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,null!=this.program&&this.autoDebugValidate&&Hg(this.gl,this.program),kg(this.gl,function(){return e.gl.useProgram(t)})},t.prototype.getUniformLocation=function(t,e,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?Jg(this.gl,t,e):tv(this.gl,t,e)},t.prototype.getAttributeLocation=function(t,e){var n=this;return this.throwIfDisposed(),kg(this.gl,function(){return n.gl.getAttribLocation(t,e)})},t.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},t.prototype.setInputMatrixTexture=function(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),ev(this.gl,0,t,e,n)},t.prototype.setOutputMatrixTexture=function(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)},t.prototype.setOutputPackedMatrixTexture=function(t,e,n){this.throwIfDisposed();var r=Ig(e,n);this.setOutputMatrixTextureDriver(t,r[0],r[1])},t.prototype.setOutputMatrixWriteRegion=function(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&Hg(this.gl,this.program),ov(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.autoDebugValidate&&this.debugValidate(),kg(t,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),kg(this.gl,function(){return t.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=zg(this.gl,2===md.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(2===md.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),o=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,o),o},t.prototype.endQuery=function(){if(2!==md.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,n=this.getQueryTimerExtensionWebGL2();e.endQuery(n.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(t){return Bh(this,void 0,void 0,function(){var e=this;return Uh(this,function(n){switch(n.label){case 0:return[4,af(function(){return e.disposed||e.isQueryAvailable(t,md.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(t,md.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},t.prototype.getQueryTime=function(t,e){if(0===e)return null;if(2===e){var n=this.gl;return n.getQueryParameter(t,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(t,r.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(t,e){if(0===e)return!0;if(2===e){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(t,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint},t.prototype.pollFence=function(t){var e=this;return new Promise(function(n){e.addItemToPoll(function(){return t.isFencePassed()},function(){return n()})})},t.prototype.pollItems=function(){for(var t=function(t){for(var e=0;e<t.length&&t[e]();++e);return e-1}(this.itemsToPoll.map(function(t){return t.isDoneFn})),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},t.prototype.addItemToPoll=function(t,e){var n=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||af(function(){return n.pollItems(),0===n.itemsToPoll.length})},t.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),nv(this.gl,t,this.framebuffer),this.autoDebugValidate&&ov(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(nv(this.gl,this.outputTexture,this.framebuffer),this.autoDebugValidate&&ov(this.gl)):rv(this.gl,this.framebuffer)},t.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var n=e();return this.unbindTextureToFrameBuffer(),n},t.prototype.setOutputMatrixTextureDriver=function(t,e,n){this.throwIfDisposed();var r=this.gl;nv(r,t,this.framebuffer),this.autoDebugValidate&&ov(r),this.outputTexture=t,kg(r,function(){return r.viewport(0,0,e,n)}),kg(r,function(){return r.scissor(0,0,e,n)})},t.prototype.setOutputMatrixWriteRegionDriver=function(t,e,n,r){var o=this;this.throwIfDisposed(),kg(this.gl,function(){return o.gl.scissor(t,e,n,r)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();function Fv(t,e){if(t.length!==e.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+e.length+" inputs");t.forEach(function(t,n){var r=t.logicalShape,o=e[n],i=o.shape;if(!tf(r,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+i+" must match");if(!t.isUniform||!o.isUniform){var a=t.texShape,s=o.isUniform?null:o.texData.texShape;if(!tf(a,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+s+" must match")}})}var zv=function(t,e,n){this.variableNames=["A"],this.outputShape=t;var r=n.inChannels,o=n.strideWidth,i=n.strideHeight,a=n.padInfo,s=n.outWidth,u=n.dilationWidth,l=n.dilationHeight,c=a.left,p=a.top,h=r*n.filterWidth,f=Am();this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            int blockIndex = rc.y + col;\n            int pos = rc.x + row;\n\n            if(blockIndex >= "+t[1]+" || pos >= "+t[0]+") continue;\n\n            int offsetY = int(blockIndex / ("+s+")) * "+i+" - "+p+";\n            int d0 = offsetY + "+l+" * (pos / "+h+");\n\n            if(d0 >= "+e[0]+" || d0 < 0) continue;\n\n            int offsetX = int(mod(float(blockIndex), "+s+".) * "+o+". - "+c+".);\n            int d1 = offsetX + "+u+" * (int(mod(float(pos), "+h+".) / "+r+".));\n\n            if(d1 >= "+e[1]+" || d1 < 0) continue;\n\n            result[row * 2 + col] = getA(d0, d1, int(mod(float(pos), "+r+".)));\n          }\n        }\n\n        "+f.output+" = result;\n      }\n    "},Bv=function(t,e,n,r,o){this.variableNames=["x"],this.outputShape=[];var i=e,a=t[3]-1;this.outputShape=t;var s="float("+n+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+i+"; j <= "+i+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+a+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+(.5===o?"inversesqrt("+s+")":1===o?"1.0/("+s+")":"exp(log("+s+") * float(-"+o+"));")+";\n        setOutput(val);\n      }\n    "},Uv=function(t,e,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+e+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+e+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},Vv=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.effectiveFilterHeight,n=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-t.padInfo.top)+", "+(n-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+";\n          wR += "+t.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(e*n-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+n+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},jv=function(t,e,n,r,o,i){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===i&&(i=null),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=e;var a=Math.ceil((n?t[1]:t[2])/2),s=n?"i * 2, rc.y":"rc.y, i * 2",u=r?"rc.z, i * 2":"i * 2, rc.z",l=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],c=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],p="",h="";i&&(p="vec4 activation(vec4 x) {\n        "+i+"\n      }",h="result = activation(result);");var f=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),this.userCode="\n      "+p+"\n\n      const float sharedDimension = "+a+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+a+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+s+");\n          vec4 b = getMatrixB(rc.x, "+u+");\n\n          result += ("+l[0]+" * "+c[0]+") + ("+l[1]+" * "+c[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+f+"\n\n        "+h+"\n\n        setOutput(result);\n      }\n    "},Wv=function(){function t(t,e,n){this.variableNames=["probs"],this.outputShape=[t,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.seedLoc&&(e.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(e.seedLoc,t)}},t}(),Hv=function(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},qv=function(t){this.variableNames=["A"],this.isPackShader=!0,this.outputShape=t;var e=t.length;if(0===e)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=Nm("rc",e),r=zm(e),o=function(t,e,n){if(1===t)return"rc > "+e[0];for(var r="",o=t-2;o<t;o++)r+=n[o]+" >= "+e[o],o<t-1&&(r+="||");return r}(e,t,n),i=function(t,e,n,r){if(1===t)return"";var o=r.slice(-2);return"\n    int r = "+o[0]+";\n    int c = "+o[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+e+";\n    bool rEdge = rp1 >= "+n+";\n  "}(e,t[t.length-1],t[t.length-2],n),a=function(t,e){var n=t.length,r=function(t,e){for(var n=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var i=(0===r?"r":"rp1")+", "+(0===o?"c":"cp1"),a=2;a<t;a++)i=e[e.length-1-a]+","+i;n.push(i)}return n}(n,e);return 1===n?"getA(rc),\n            rc + 1 >= "+t[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(t,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+i+"\n\n            setOutput(vec4("+a+"));\n          }\n        }\n      "}},Gv=function(t,e,n){this.variableNames=["x"],this.outputShape=e.map(function(e,n){return e[0]+t[n]+e[1]});var r=t.length,o=zm(r),i=e.map(function(t){return t[0]}).join(","),a=e.map(function(e,n){return e[0]+t[n]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+i+");\n      "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+i+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},Kv=function(t,e,n){this.variableNames=["x"],this.usesPackedTextures=!0,this.outputShape=e.map(function(e,n){return e[0]+t[n]+e[1]});for(var r=t.length,o=zm(r),i=e.map(function(t){return t[0]}).join(","),a=e.map(function(e,n){return e[0]+t[n]}).join(","),s=Nm("rc",r),u=Nm("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=1===r?"source":"vec2("+u.slice(-2).join()+")",p=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+l+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+l+") {"],h=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",d=0,m=1===r?2:4;d<m;d++)f+="\n        "+p[d]+"\n        if ("+h+") {\n          result["+d+"] = float("+n+");\n        } else {\n          "+o+" source = rc - start;\n          result["+d+"] = getChannel(getX("+u.join()+"), "+c+");\n        }\n      ";this.userCode="\n      const "+o+" start = "+o+"("+i+");\n      const "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+(f+=1===r?"} ":"}}")+"\n        setOutput(result);\n      }\n    "},$v=function(t,e,n){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,o=t.strideHeight,i=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;var h="avg"===e,f="0.0";if(h||(f="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+i+");\n        const ivec2 pads = ivec2("+c+", "+p+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+l+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var d=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(d="avgValue / count");var m=4*Math.floor(r/4),g=r%4,v="\n      if ("+h+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+i+");\n      const ivec2 pads = ivec2("+c+", "+p+");\n      const float initializationValue = "+f+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+f+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+a+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+m+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+v+"\n          }\n\n          int xC = xCCorner + "+m+";\n          if ("+(1===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(2===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(3===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+v+"\n          }\n        }\n        setOutput("+d+");\n      }\n    "}},Xv=function(t,e){this.variableNames=["x"];var n=t.windowSize,r=t.batchSize,o=t.inSize,i=Math.ceil(o/n);this.outputShape=[r,i];var a="0.0",s="";"prod"===e?a="1.0":"min"===e?(a="1.0 / 1e-20",s="min"):"max"===e&&(a="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e?u="sumValue":"prod"===e?u="prodValue":"all"===e?u="allValue":"any"===e&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,p="\n      if ("+("sum"===e)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===e)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",h="vec4";"all"===e?(a="1.0",p="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===e&&(a="0.0",p="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");var f="";o%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+f+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+p+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(1===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+p+"\n        } else if ("+(2===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+p+"\n        } else if ("+(3===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+p+"\n        }\n        setOutput("+u+");\n      }\n    "},Zv=function(t,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+km(["r","c","d"],e)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+function(t){return"\n    int getFlatIndex(ivec3 coords) {\n      return round("+function(t,e){if(t.length!==e.length)throw new Error("Vectors to be dotted must be of the same length -got "+t.length+" and "+e.length);for(var n=[],r=Math.floor(t.length/4),o=t.length%4,i=0;i<r;i++){var a=t.slice(4*i,4*i+4),s=e.slice(4*i,4*i+4);n.push(Rm(a)+", "+Rm(s))}return 0!==o&&(a=t.slice(4*r),s=e.slice(4*r),1===a.length&&(a=a.map(function(t){return"float("+t+")"}),s=s.map(function(t){return"float("+t+")"})),n.push(Rm(a)+", "+Rm(s))),n.map(function(t,e){return"dot("+t+")"}).join("+")}(["coords.x","coords.y","coords.z"],Ef(t).map(function(t){return t.toString()}).concat(["1."]))+");\n    }\n  "}(t)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+t[1]+";\n        int cols = "+t[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},Yv=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],i=r[2],a=t.shape,s=a[1],u=a[2],l=[n&&s>1?o-1:o,n&&u>1?i-1:i],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],p=l[0]/c[0],h=l[1]/c[1],f=1/p,d=1/h,m=2*Math.ceil(f)+2,g=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+p+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(i-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Qv=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var o=t[1],i=t[2];this.outputShape=[t[0],e,n,t[3]];var a=[r&&e>1?o-1:o,r&&n>1?i-1:i],s=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+a[0]/s[0]+",\n          "+a[1]/s[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},Jv=function(t,e,n,r){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=[];var o=t[1],i=t[2],a=t[3];this.outputShape=[t[0],e,n,a];var s=[r&&e>1?o-1:o,r&&n>1?i-1:i],u=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+s[0]/u[0]+",\n          "+s[1]/u[1]+",\n          "+s[1]/u[1]+");\n      const vec3 inputShapeRC = vec3("+o+".0, "+i+".0,\n                                     "+i+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n        \n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(a-1)+"; \n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},ty=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],i=r[2],a=t.shape,s=a[1],u=a[2],l=[n&&s>1?o-1:o,n&&u>1?i-1:i],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],p=l[0]/c[0],h=l[1]/c[1],f=1/p,d=1/h,m=2*Math.ceil(f)+2,g=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+p+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+l[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+l[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},ey=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var o=t[1],i=t[2];this.outputShape=[t[0],e,n,t[3]];var a=[r&&e>1?o-1:o,r&&n>1?i-1:i],s=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+a[0]/s[0]+",\n          "+a[1]/s[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+(r?"0.5":"0.0")+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},ny=function(t,e){this.variableNames=["x"];var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=t,1!==n){var r=t.map(function(n,r){return function(n){return-1!==e.indexOf(n)&&1!==t[n]?t[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)}).join(","),o=zm(n);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+t[0]+" - coord - 1));\n        }\n      "},ry=function(t,e,n,r,o,i,a){void 0===a&&(a=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=zm(o.length),u=zm(i.length),l="";1===n?l="i":2===n&&(l="i, j");var c="";1===r?c="i":2===r&&(c="i, coords[1]"),this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+t+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+e+"; j++) {\n              int index = round(getIndices("+l+"));\n              flattenedIndex += index * "+(e>1?"strides[j]":"strides")+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates("+c+");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},oy=function(t,e){this.variableNames=["x","segmentIds"];var n=t.windowSize,r=t.batchSize,o=t.inSize,i=t.numSegments,a=i*Math.ceil(o/n);this.outputShape=[r,a];var s=4*Math.floor(n/4),u=n%4,l="\n        sumValue += dot(values, segFilter);\n    ",c="";o%n>0&&(c="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var p="";o%n>0&&(p="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+c+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+p+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+i+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+i+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+l+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+l+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+l+"\n        }\n        setOutput(sumValue);\n      }\n    "},iy=function(t,e,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<e.length;u++)s.push(""+i[u]),u<t&&a.push(""+i[u]);r=a.join(),o=s.join()}var l=zm(n);this.userCode="\n      void main() {\n        "+l+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},ay=function(){function t(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e,n=zm(this.rank),r="uniform int start["+this.rank+"];",o=function(t){if(1===t)return"sourceLoc";if(t<=6)return sy.slice(0,t).map(function(t){return"sourceLoc."+t}).join(",");throw Error("Slicing for rank "+t+" is not yet supported")}(this.rank);e="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+t.map(function(t,e){return"sourceLoc."+sy[e]+" = start["+e+"] + coords."+sy[e]+";"}).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+e+"\n        setOutput(getSource("+o+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){null==e.startLoc&&(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null==e.startLoc)||n.gl.uniform1iv(e.startLoc,t)}},t}(),sy=["x","y","z","w","u","v"],uy=function(){function t(t){this.variableNames=["source"],this.usesPackedTextures=!0,this.outputShape=t,this.rank=t.length;var e=zm(this.rank),n=Nm("coords",this.rank),r=Nm("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",i="getChannel(getSource("+r.join()+"), "+o+")",a="\n      result.x = "+i+";\n      if (++"+n[this.rank-1]+" < "+t[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+i+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+t[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+i+";\n        if (++"+n[this.rank-1]+" < "+t[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+i+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+e+"("+t.map(function(t,e){return"start["+e+"]"}).join()+");":t.map(function(t,e){return r[e]+" = "+n[e]+" + start["+e+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+e+" coords = getOutputCoords();\n        "+e+" sourceLoc;\n        "+u+" \n        vec4 result = vec4(0.);\n        "+a+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){null==e.startLoc&&(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null==e.startLoc)||n.gl.uniform1iv(e.startLoc,t)}},t}(),ly=function(t,e,n,r){this.variableNames=["x"];var o=n.filter(function(t,e){return-1===r.indexOf(e)});this.outputShape=o;var i=n.length,a=zm(n.length),s=zm(o.length),u="";if(1===i)u="coords * strides + begin";else{var l=0;u=n.map(function(t,e){return-1===r.indexOf(e)?(l++,1===o.length?"coords * strides["+e+"] + begin["+e+"]":"coords["+(l-1)+"] * strides["+e+"] + begin["+e+"]"):"begin["+e+"]"}).join(",")}this.userCode="\n      "+a+" begin = "+a+"("+t+");\n      "+a+" strides = "+a+"("+e+");\n\n      void main() {\n        "+s+" coords = getOutputCoords();\n        setOutput(getX("+u+"));\n      }\n    "},cy=function(){function t(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(t,e,n){var r,o=py(e,n),i=hy(t,o,n);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[i].shift();return this.usedTextures[i].push(a),a}return this.numUsedTextures++,this.log(),o===gg.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):o===gg.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):o===gg.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):o===gg.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):o===gg.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(r),r},t.prototype.releaseTexture=function(t,e,n,r){if(null!=this.freeTextures){var o=hy(e,py(n,r),r);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(t),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[o],a=i.indexOf(t);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(a,1),this.log()}},t.prototype.log=function(){this.logEnabled&&console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+(this.numFreeTextures+this.numUsedTextures)+")")},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var t=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();function py(t,e){if(t===mg.UPLOAD)return e?gg.PACKED_2X2_FLOAT32:gg.UNPACKED_FLOAT32;if(t===mg.RENDER||null==t)return e?md.get("WEBGL_RENDER_FLOAT32_ENABLED")?gg.PACKED_2X2_FLOAT32:gg.PACKED_2X2_FLOAT16:md.get("WEBGL_RENDER_FLOAT32_ENABLED")?gg.UNPACKED_FLOAT32:gg.UNPACKED_FLOAT16;if(t===mg.DOWNLOAD||t===mg.PIXELS)return gg.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+t)}function hy(t,e,n){return t[0]+"_"+t[1]+"_"+e+"_"+n}var fy=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[r]*e[r];this.outputShape=n,this.rank=n.length;var o=zm(this.rank),i=function(t){var e=t.length;if(e>5)throw Error("Tile for rank "+e+" is not yet supported");if(1===e)return"imod(resRC, "+t[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<t.length;o++)r.push("imod("+n[o]+", "+t[o]+")");return r.join()}(t);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},dy=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];this.outputShape=n,this.rank=n.length;var o=zm(this.rank),i=function(t){var e=t.length;if(e>6)throw Error("Transpose for rank "+e+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e),o=0;o<t.length;o++)r[t[o]]=n[o];return r.join()}(e);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+i+"));\n    }\n    "},my=function(t,e){this.variableNames=["A"],this.usesPackedTextures=!0;for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=zm(this.rank),i=Em("rc",this.rank),a=new Array(this.rank);for(r=0;r<e.length;r++)a[e[r]]=i[r];var s="vec2("+a.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+n[this.rank-1],l="getChannel(getA("+a.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+l+";\n      if("+u+") {\n        result[1] = "+l+";\n      }\n      --"+i[this.rank-1]+";\n      if(++"+i[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+l+";\n        if("+u+") {\n          result[3] = "+l+";\n        }\n      }  \n      setOutput(result);\n    }\n    "},gy=function(){function t(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float NAN;\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(){var t=this;return function(e,n){null==t.startLoc&&(t.startLoc=e.getUniformLocationNoThrow(n,"NAN"),null==t.startLoc)||e.gl.uniform1f(t.startLoc,NaN)}},t}(),vy="if (isNaN(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",yy="return exp(x);",by="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n\n  result.r = isNaN(x.r) ? x.r : result.r;\n  result.g = isNaN(x.g) ? x.g : result.g;\n  result.b = isNaN(x.b) ? x.b : result.b;\n  result.a = isNaN(x.a) ? x.a : result.a;\n\n  return result;\n",wy=function(){function t(t,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t,this.userCode="\n      uniform float NAN;\n      vec4 unaryOperation(vec4 x) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(){var t=this;return function(e,n){null==t.startLoc&&(t.startLoc=e.getUniformLocationNoThrow(n,"NAN"),null==t.startLoc)||e.gl.uniform1f(t.startLoc,NaN)}},t}(),xy=function(t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t;var e=t.length,n=Nm("rc",e),r=zm(e),o=function(t,e){if(1===t)return"rc";for(var n="",r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}(e,n),i=n.slice(-2),a=e<=1?"rc":"vec2("+i.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+a+"));\n      }\n    "},Sy=Kd({concat_:function(t,e){void 0===e&&(e=0),Xh(t.length>=1,function(){return"Pass at least one tensor to concat"});var n=Gd(t,"tensors","concat");e=uf(e,n[0].shape)[0];var r=Dd(n.map(function(t){return t.shape}),e);if(0===Jh(r))return Jd([],r);if(1===(n=n.filter(function(t){return t.size>0})).length)return n[0];var o=n.map(function(t){return t.shape});return function(t,e){var n=t[0].length;t.forEach(function(t,e){Xh(t.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+e+"] must be the same as the rank of the rest ("+n+")"})}),Xh(e>=0&&e<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=t[0];t.forEach(function(t,o){for(var i=0;i<n;i++)Xh(i===e||t[i]===r[i],function(){return"Error in concat"+n+"D: Shape of tensors["+o+"] ("+t+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}(o,e),md.engine.runKernel(function(t){return t.concat(n,e)},n,function(t){var n=o.map(function(t){return t[e]});return Iy(t,n,e).map(function(t){return function(){return t}})})}}),Cy=Kd({concat1d_:function(t){return Sy(t,0)}}),Ey=Kd({concat2d_:function(t,e){return Sy(t,e)}}),Ny=Kd({concat3d_:function(t,e){return Sy(t,e)}}),_y=Kd({concat4d_:function(t,e){return Sy(t,e)}}),Iy=Kd({split_:function(t,e,n){void 0===n&&(n=0);var r,o=qd(t,"x","split");return n=uf(n,o.shape)[0],"number"==typeof e?(Xh(o.shape[n]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(o.shape[n]/e)):(Xh(o.shape[n]===e.reduce(function(t,e){return t+e}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),md.engine.runKernel(function(t){return t.split(o,r,n)},{$x:o},function(t){return{$x:function(){return Sy(t,n)}}})}});function Ty(t,e){return t(e={exports:{}},e.exports),e.exports}"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var Ay=Ty(function(t){!function(t,e,n){function r(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var n=new function(t){var e,n=this,r=(e=4022871197,function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1),r=null}(t),o=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+1.1102230246251565e-16*(2097152*i()|0)},i.quick=i,o&&("object"==typeof o&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.alea=o}(0,t)}),ky=Ty(function(t){!function(t,e,n){function r(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var n=new function(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.xor128=o}(0,t)}),Ry=Ty(function(t){!function(t,e,n){function r(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var n=new function(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.xorwow=o}(0,t)}),Oy=Ty(function(t){!function(t,e,n){function r(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var n=new function(t){var e=this;e.next=function(){var t,n,r=e.x,o=e.i;return t=r[o],n=(t^=t>>>7)^t<<24,n^=(t=r[o+1&7])^t>>>10,n^=(t=r[o+3&7])^t>>>3,n^=(t=r[o+4&7])^t<<7,t=r[o+7&7],n^=(t^=t<<13)^t<<9,r[o]=n,e.i=o+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.x&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.xorshift7=o}(0,t)}),Dy=Ty(function(t){!function(t,e,n){function r(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var n=new function(t){var e=this;e.next=function(){var t,n,r=e.w,o=e.X,i=e.i;return e.w=r=r+1640531527|0,n=o[i+34&127],t=o[i=i+1&127],n^=n<<13,t^=t<<17,n=o[i]=(n^=n>>>15)^(t^=t>>>12),e.i=i,n+(r^r>>>16)|0},function(t,e){var n,r,o,i,a,s=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),o=0,i=-32;i<u;++i)e&&(r^=e.charCodeAt((i+32)%e.length)),0===i&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=0==(n=s[127&i]^=r+(a=a+1640531527|0))?o+1:0);for(o>=128&&(s[127&(e&&e.length||0)]=-1),o=127,i=512;i>0;--i)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,s[o]=(r^=r>>>15)^(n^=n>>>12);t.w=a,t.X=s,t.i=o}(e,t)}(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.X&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.xor4096=o}(0,t)}),My=Ty(function(t){!function(t,e,n){function r(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var n=new function(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,o=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^o,e.a=o-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.tychei=o}(0,t)}),Py=Ty(function(t){!function(e,r){var o,i=this,a=256,s=6,u="random",l=r.pow(a,s),c=r.pow(2,52),p=2*c,h=a-1;function f(t,n,f){var v=[],y=m(function t(e,n){var r,o=[],i=typeof e;if(n&&"object"==i)for(r in e)try{o.push(t(e[r],n-1))}catch(t){}return o.length?o:"string"==i?e:e+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[t,g(e)]:null==t?function(){try{var t;return o&&(t=o.randomBytes)?t=t(a):(t=new Uint8Array(a),(i.crypto||i.msCrypto).getRandomValues(t)),g(t)}catch(t){var n=i.navigator,r=n&&n.plugins;return[+new Date,i,r,i.screen,g(e)]}}():t,3),v),b=new function(t){var e,n=t.length,r=this,o=0,i=r.i=r.j=0,s=r.S=[];for(n||(t=[n++]);o<a;)s[o]=o++;for(o=0;o<a;o++)s[o]=s[i=h&i+t[o%n]+(e=s[o])],s[i]=e;(r.g=function(t){for(var e,n=0,o=r.i,i=r.j,s=r.S;t--;)e=s[o=h&o+1],n=n*a+s[h&(s[o]=s[i=h&i+e])+(s[i]=e)];return r.i=o,r.j=i,n})(a)}(v),w=function(){for(var t=b.g(s),e=l,n=0;t<c;)t=(t+n)*a,e*=a,n=b.g(1);for(;t>=p;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|b.g(4)},w.quick=function(){return b.g(4)/4294967296},w.double=w,m(g(b.S),e),(n.pass||f||function(t,e,n,o){return o&&(o.S&&d(o,b),t.state=function(){return d(b,{})}),n?(r[u]=t,e):t})(w,y,"global"in n?n.global:this==r,n.state)}function d(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function m(t,e){for(var n,r=t+"",o=0;o<r.length;)e[h&o]=h&(n^=19*e[h&o])+r.charCodeAt(o++);return g(e)}function g(t){return String.fromCharCode.apply(0,t)}if(r["seed"+u]=f,m(r.random(),e),t.exports){t.exports=f;try{o=n(!function(){var t=new Error("Cannot find module 'crypto'");throw t.code="MODULE_NOT_FOUND",t}())}catch(t){}}}([],Math)});Py.alea=Ay,Py.xor128=ky,Py.xorwow=Ry,Py.xorshift7=Oy,Py.xor4096=Dy,Py.tychei=My;var Ly=Py.alea,Fy=function(){function t(t,e,n,r,o){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var i=o||Math.random();this.random=Ly(i.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,n,r=!1;!r;){var o=void 0,i=void 0,a=void 0;do{a=(o=2*this.random()-1)*o+(i=2*this.random()-1)*i}while(a>=1||0===a);var s=Math.sqrt(-2*Math.log(a)/a);e=this.mean+this.stdDev*o*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(e)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(e)},t.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)},t.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},t}();function zy(t,e,n){return void 0===e&&(e="float32"),e=e||"float32",kf(t),new Ff(t,e,n)}var By=Kd({batchToSpaceND_:function(t,e,n){var r=qd(t,"x","batchToSpaceND"),o=e.reduce(function(t,e){return t*e});return Xh(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),Xh(n.length===e.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+e.length}),Xh(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+o}),md.engine.runKernel(function(t){return t.batchToSpaceND(r,e,n)},{$x:r},function(t){return{$x:function(){return t.spaceToBatchND(e,n)}}})}}),Uy=Kd({cast_:function(t,e){var n=qd(t,"x","cast");return md.engine.runKernel(function(t){return t.cast(n,e)},{$x:n},function(t){return{$x:function(){return t.clone()}}})}}),Vy=Kd({clone_:function(t){var e=qd(t,"x","clone",null);return md.engine.runKernel(function(t){return Vf.make(e.shape,{dataId:e.dataId},e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),jy=Kd({cumsum_:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var o=qd(t,"x","cumsum"),i=kd([e|=0],o.rank),a=o;null!=i&&(a=o.transpose(i));var s=Od(1,o.rank)[0],u=md.engine.runKernel(function(t){return t.cumsum(a,s,n,r)},{permutedX:a},function(t){return{permutedX:function(){return t.cumsum(e,n,!r)}}});return null!=i&&(u=u.transpose(i)),u}}),Wy=Kd({depthToSpace_:function(t,e,n){void 0===n&&(n="NHWC");var r=qd(t,"x","depthToSpace"),o="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],a="NHWC"===n?r.shape[3]:r.shape[1];return Xh(o*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+e+"  for depthToSpace with input shape\n      "+r.shape}),Xh(i*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+e+" for depthToSpace with input shape\n          "+r.shape}),Xh(a%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+r.shape}),md.engine.runKernel(function(t){return t.depthToSpace(r,e,n)},{$x:r})}}),Hy=Kd({expandDims_:function(t,e){void 0===e&&(e=0);var n=qd(t,"x","expandDims");Xh(e<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return e<0&&(Xh(-(n.rank+1)<=e,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),e=n.rank+e+1),r.splice(e,0,1),nb(n,r)}}),qy=Kd({eye_:function(t,e,n,r){void 0===r&&(r="float32"),null==e&&(e=t);for(var o=zy([t,e],r),i=t<=e?t:e,a=0;a<i;++a)o.set(1,a,a);var s=o.toTensor().as2D(t,e);if(null==n)return s;if(1===n.length)return ab(Hy(s,0),[n[0],1,1]);if(2===n.length)return ab(Hy(Hy(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return ab(Hy(Hy(Hy(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),Gy=Kd({multinomial_:function(t,e,n,r){void 0===r&&(r=!1);var o=qd(t,"logits","multinomial"),i=o.size,a=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);n=n||Math.random();var s=1===a?o.as2D(1,-1):o,u=md.engine.runKernel(function(t){return t.multinomial(s,r,e,n)},{logits2D:s});return 1===a?u.as1D():u}}),Ky=Kd({oneHot_:function(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var o=qd(t,"indices","oneHot","int32"),i=o.shape.concat([e]);return o=o.flatten(),md.engine.runKernel(function(t){return t.oneHot(o,e,n,r)},{$indices:o},function(t){return{$indices:function(){return am(o.shape,"float32")}}}).reshape(i)}}),$y=Kd({pad_:function(t,e,n){void 0===n&&(n=0);var r=qd(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o=e.map(function(t){return t[0]});return md.engine.runKernel(function(t){return t.pad(r,e,n)},{$x:r},function(t){return{$x:function(){return t.slice(o,r.shape)}}})}}),Xy=Kd({pad1d_:function(t,e,n){return void 0===n&&(n=0),Xh(2===e.length,function(){return"Invalid number of paddings. Must be length of 2."}),$y(t,[e],n)}}),Zy=Kd({pad2d_:function(t,e,n){return void 0===n&&(n=0),Xh(2===e.length&&2===e[0].length&&2===e[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),$y(t,e,n)}}),Yy=Kd({pad3d_:function(t,e,n){return void 0===n&&(n=0),Xh(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),$y(t,e,n)}}),Qy=Kd({pad4d_:function(t,e,n){return void 0===n&&(n=0),Xh(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),$y(t,e,n)}}),Jy=Kd({rand_:function(t,e,n){var r=Jh(t),o=null;if(null==n||"float32"===n)o=new Float32Array(r);else if("int32"===n)o=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=e();return Vf.make(t,{values:o},n)}}),tb=Kd({randomNormal_:function(t,e,n,r,o){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new Fy(e,n,r,!1,o),a=zy(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),eb=Kd({randomUniform_:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var o=zy(t,r),i=0;i<o.values.length;i++)o.values[i]=$h(e,n);return o.toTensor()}}),nb=Kd({reshape_:function(t,e){var n=qd(t,"x","reshape",null);return e=sf(e,n.size),Xh(n.size===Jh(e),function(){return"new shape and old shape must have the same number of elements."}),md.engine.runKernel(function(t){return t.reshape(n,e)},{$x:n},function(t){return{$x:function(){return t.reshape(n.shape)}}})}}),rb=Kd({spaceToBatchND_:function(t,e,n){var r=qd(t,"x","spaceToBatchND");return Xh(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),Xh(n.length===e.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+e.length}),Xh(r.shape.reduce(function(t,r,o){return o>0&&o<=e.length?t&&(r+n[o-1][0]+n[o-1][1])%e[o-1]==0:t},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+e.toString()}),md.engine.runKernel(function(t){return t.spaceToBatchND(r,e,n)},{$x:r},function(t){return{$x:function(){return t.batchToSpaceND(e,n)}}})}}),ob=Kd({squeeze_:function(t,e){var n=qd(t,"x","squeeze");return nb(n,lf(n.shape,e).newShape)}}),ib=Kd({stack_:function(t,e){void 0===e&&(e=0);var n=Gd(t,"tensors","stack");if(Xh(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===n.length)return n[0].expandDims(e);var r=n[0].shape,o=n[0].dtype;Xh(e<=n[0].rank,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(t){Zh(r,t.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(t){Xh(o===t.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var i=n.map(function(t){return t.expandDims(e)});return Sy(i,e)}}),ab=Kd({tile_:function(t,e){var n=qd(t,"x","tile");return Xh(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+e+"."}),md.engine.runKernel(function(t){return t.tile(n,e)},{$x:n},function(t){return{$x:function(){var r=pm(n);if(1===n.rank)for(var o=0;o<e[0];++o)r=r.add(t.slice([o*n.shape[0]],[n.shape[0]]));else if(2===n.rank)for(o=0;o<e[0];++o)for(var i=0;i<e[1];++i)r=r.add(t.slice([o*n.shape[0],i*n.shape[1]],[n.shape[0],n.shape[1]]));else if(3===n.rank)for(o=0;o<e[0];++o)for(i=0;i<e[1];++i)for(var a=0;a<e[2];++a)r=r.add(t.slice([o*n.shape[0],i*n.shape[1],a*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else{if(4!==n.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+n.rank+" tensors yet.");for(o=0;o<e[0];++o)for(i=0;i<e[1];++i)for(a=0;a<e[2];++a)for(var s=0;s<e[3];++s)r=r.add(t.slice([o*n.shape[0],i*n.shape[1],a*n.shape[2],s*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]))}return r}}})}}),sb=Kd({truncatedNormal_:function(t,e,n,r,o){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new Fy(e,n,r,!0,o),a=zy(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),ub=Kd({unstack_:function(t,e){void 0===e&&(e=0),e=e||0;var n=qd(t,"x","unstack");return Xh(e>=-n.shape.length&&e<n.shape.length,function(){return"Axis = "+e+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),e<0&&(e+=n.shape.length),md.engine.runKernel(function(t){return t.unstack(n,e)},{$x:n},function(t){return{$x:function(){return ib(t,e)}}})}}),lb=function(t,e){return Bh(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c,p;return Uh(this,function(h){switch(h.label){case 0:return n=qd(t,"x","setdiff1d"),r=qd(e,"y","setdiff1d"),Xh(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),Xh(1===n.rank,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),Xh(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return o=h.sent(),[4,r.data()];case 2:for(i=h.sent(),a=new Set(i),s=0,c=0;c<o.length;c++)a.has(o[c])||s++;for(u=new Ff([s],n.dtype),l=new Ff([s],"int32"),c=0,p=0;c<o.length;c++)a.has(o[c])||(u.values[p]=o[c],l.values[p]=c,p++);return[2,[u.toTensor(),l.toTensor()]]}})})};function cb(t,e){for(var n=[],r=0;r<e.length;r++)e[r]&&n.push(r);var o=zy(t,"int32"),i=zy([n.length,t.length],"int32");for(r=0;r<n.length;r++){var a=o.indexToLoc(n[r]);i.values.set(a,r*t.length)}return i.toTensor()}var pb=function(){function t(t){if(this.gpgpu=t,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.lruDataGPU=[],this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.binaryCache={},this.disposed=!1,md.get("WEBGL_VERSION")<1)throw new Error("WebGL is not supported on this device");if(null==t){var e=Wh(md.get("WEBGL_VERSION"));this.gpgpu=new Lv(e),this.canvas=e.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpuCreatedLocally=!1,this.canvas=t.gl.canvas;this.textureManager=new cy(this.gpgpu)}return t.prototype.register=function(t,e,n){if(this.texData.has(t))throw new Error("Data buffer is already registered");this.texData.set(t,{shape:e,dtype:n})},t.prototype.setDataMover=function(t){this.texData=new hm(t)},t.prototype.fromPixels=function(t,e){if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=[t.height,t.width],r=[t.height,t.width,e];if(md.get("IS_BROWSER")){if(!(t instanceof HTMLVideoElement||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+t.constructor.name);if(t instanceof HTMLVideoElement){if(null==this.fromPixels2DContext){if("complete"!==document.readyState)throw new Error("The DOM is not ready yet. Please call tf.browser.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=document.createElement("canvas").getContext("2d")}this.fromPixels2DContext.canvas.width=t.width,this.fromPixels2DContext.canvas.height=t.height,this.fromPixels2DContext.drawImage(t,0,0,t.width,t.height),t=this.fromPixels2DContext.canvas}}var o=this.makeTensorHandle(n,"int32");this.texData.get(o.dataId).usage=mg.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(o.dataId),t);var i=new xg(r),a=this.compileAndRun(i,[o]);return this.disposeData(o.dataId),a},t.prototype.makeTensorHandle=function(t,e){var n={};return this.register(n,t,e),{dataId:n,shape:t,dtype:e}},t.prototype.write=function(t,e){if(null==e)throw new Error("MathBackendWebGL.write(): values can not be null");if(md.get("DEBUG"))for(var n=0;n<e.length;n++){var r=e[n];if(!Lg(r))throw Error("The value "+r+" cannot be represented on this device.")}var o=this.texData.get(t),i=o.texture,a=o.texShape,s=o.usage,u=o.dtype,l=o.isPacked;if("complex64"===u)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");null!=i&&(this.releaseTexture(t,i,a,s,u,l),o.texture=null,o.texShape=null),o.usage=mg.UPLOAD,o.values=e},t.prototype.readSync=function(t){var e=this.texData.get(t),n=e.values,r=e.dtype,o=e.complexTensors,i=e.shape;if(null!=e.slice){var a=new gy(i,"return x;"),s=this.compileAndRun(a,[{dataId:t,shape:i,dtype:r}]),u=this.readSync(s.dataId);return s.dispose(),u}if(null!=n)return this.convertAndCacheOnCPU(t);if("string"===r)return n;var l,c,p=null!=this.activeTimers;return p&&(l=performance.now()),c="complex64"===r?mm(o.real.dataSync(),o.imag.dataSync()):this.getValuesFromTexture(t),p&&(this.downloadWaitMs+=performance.now()-l),this.convertAndCacheOnCPU(t,c)},t.prototype.read=function(t){return Bh(this,void 0,void 0,function(){var e,n,r,o,i,a,s,u,l,c,p,h,f,d,m,g,v,y,b,w,x,S,C;return Uh(this,function(E){switch(E.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise(function(t){return r.push(t)})];if(o=this.texData.get(t),i=o.texture,a=o.values,s=o.texShape,u=o.isPacked,l=o.shape,c=o.dtype,null!=o.slice)return p=new gy(l,"return x;"),h=this.compileAndRun(p,[{dataId:t,shape:l,dtype:c}]),f=this.read(h.dataId),h.dispose(),[2,f];if(null!=a)return[2,this.convertAndCacheOnCPU(t)];if(this.pendingRead.set(t,[]),!md.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===md.get("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=s[1],m=s[0],u&&(e=Ig(s[0],s[1]),d=e[0],m=e[1]),g=this.gpgpu.maybeCreateBufferFromTexture(i,m,d),[4,this.gpgpu.createAndWaitForFence()];case 1:return E.sent(),g instanceof WebGLTexture?v=this.getValuesFromTexture(t):(y=Jh(l),u?(b=uv(l),w=1,x=1,l.length&&(n=lv(l),w=n[0],x=n[1]),v=this.gpgpu.downloadPackedMatrixFromBuffer(g,b,w,x,s[0],s[1]).subarray(0,y)):v=this.gpgpu.downloadFloat32MatrixFromBuffer(g,s[0],s[1]).subarray(0,y)),S=this.convertAndCacheOnCPU(t,v),C=this.pendingRead.get(t),this.pendingRead.delete(t),C.forEach(function(t){return t(S)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)),[2,S]}})})},t.prototype.getValuesFromTexture=function(t){var e,n=this,r=this.texData.get(t),o=r.shape,i=r.dtype,a=r.texture,s=r.texShape,u=Jh(o);if(md.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")){if(this.texData.get(t).isPacked){var l=uv(o),c=1,p=1;return o.length&&(c=(e=lv(o))[0],p=e[1]),this.gpgpu.downloadMatrixFromPackedTexture(a,l,c,p,s[0],s[1]).subarray(0,u)}return this.gpgpu.downloadFloat32MatrixFromOutputTexture(a,s[0],s[1]).subarray(0,u)}var h=this.makeTensorHandle(o,"float32");h.size=Jh(o),this.texData.get(h.dataId).usage=mg.DOWNLOAD;var f=vd(function(){var e=new yg(o);return n.compileAndRun(e,[{shape:o,dtype:i,dataId:t}],h,null,!1)}),d=this.texData.get(f.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture,d.texShape[0],d.texShape[1]).subarray(0,u);return this.disposeData(h.dataId),m},t.prototype.time=function(t){return Bh(this,void 0,void 0,function(){var e,n,r,o,i,a,s;return Uh(this,function(u){switch(u.label){case 0:return e=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,t(),o=Qh(this.activeTimers.map(function(t){return t.query})).filter(function(t){return null!=t}),i=Qh(this.activeTimers.map(function(t){return t.name})).filter(function(t){return null!=t}),this.activeTimers=e,r&&(this.programTimersStack=null),[4,Promise.all(o)];case 1:return a=u.sent(),s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:Kh(a),getExtraProfileInfo:function(){return a.map(function(t,e){return{name:i[e],ms:t}}).map(function(t){return t.name+": "+t.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,s]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return md.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},t.prototype.endTimer=function(t){return md.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),t):(t.endMs=performance.now(),t)},t.prototype.getQueryTime=function(t){return Bh(this,void 0,void 0,function(){var e;return Uh(this,function(n){return md.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(e=t).endMs-e.startMs]})})},t.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t))if(this.pendingRead.has(t))this.pendingDisposal.add(t);else if(this.texData.has(t)){var e=this.texData.get(t),n=e.texture,r=e.dtype,o=e.texShape,i=e.usage,a=e.complexTensors,s=e.isPacked,u=e.slice;if(null!=n){var l=u&&u.origDataId||t,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),this.releaseTexture(t,n,o,i,r,s),this.texData.delete(t))}null!=a&&(a.real.dispose(),a.imag.dispose())}},t.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},t.prototype.getCPUBackend=function(){return md.get("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=md.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(t,e){var n=this;return void 0===e&&(e=128),null!=this.getCPUBackend()&&t.every(function(t){return null==n.texData.get(t.dataId).texture&&t.size<e})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.getCanvas=function(){return this.canvas},t.prototype.complex=function(t,e){var n=this.makeOutputArray(t.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:md.engine.keep(t.clone()),imag:md.engine.keep(e.clone())},n},t.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},t.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},t.prototype.slice=function(t,e,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,e,n);var r=this.texData.get(t.dataId).isPacked,o=Vd(t.shape,e,n);if(r||!o){var i=md.get("WEBGL_PACK_ARRAY_OPERATIONS")?new uy(n):new ay(n),a=i.getCustomSetupFunc(e);return this.compileAndRun(i,[t],null,a)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,e,n)},t.prototype.shallowSlice=function(t,e,n){var r=this.texData.get(t.dataId),o=Vf.make(n,{},t.dtype,this),i=this.texData.get(o.dataId);Object.assign(i,r),i.shape=n,i.dtype=t.dtype;var a=jd(e,t.strides);r.slice&&(a+=r.slice.flatOffset),i.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||t.dataId};var s=this.dataRefCount.get(i.slice.origDataId)||1;return this.dataRefCount.set(i.slice.origDataId,s+1),o},t.prototype.stridedSlice=function(t,e,n,r,o,i,a,s,u){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,e,n,r,o,i,a,s,u);var l=zd(t.shape,e,n,r,o,i,a,s,u),c=l[0],p=l[1],h=l[2],f=p.filter(function(t,e){return-1===h.indexOf(e)});if(f.some(function(t){return 0===t}))return Jd([],f);var d=new ly(c,r,p,h);return this.compileAndRun(d,[t])},t.prototype.reverse=function(t,e){var n=new ny(t.shape,e);return this.compileAndRun(n,[t])},t.prototype.concat=function(t,e){if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,e);if(1===t.length)return t[0];if(t.length>md.get("WEBGL_MAX_TEXTURES_IN_SHADER")){var n=Math.floor(t.length/2),r=this.concat(t.slice(0,n),e),o=this.concat(t.slice(n),e);return this.concat([r,o],e)}if(md.get("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var i=new eg(t.map(function(t){return t.shape}),e);return this.compileAndRun(i,t)}var a=Dd(t.map(function(t){return t.shape}),e),s=t.map(function(t){return t.as2D(-1,Jh(t.shape.slice(e)))}),u=new tg(s.map(function(t){return t.shape}));return this.compileAndRun(u,s).reshape(a)},t.prototype.neg=function(t){var e=new gy(t.shape,"return -x;");return this.compileAndRun(e,[t])},t.prototype.batchMatMul=function(t,e,n,r){var o=n?t.shape[2]:t.shape[1],i=r?e.shape[1]:e.shape[2],a=n?t.shape[1]:t.shape[2],s=t.shape[0];if((1===o||1===i)&&a>1e3){n&&(t=t.transpose([0,2,1])),r&&(e=e.transpose([0,2,1]));var u=1===i?t:t.as3D(s,a,1),l=1===i?2:1,c=1===i?e.as3D(s,1,a):e;return this.multiply(u,c).sum(l,!0)}var p=Yf(t.dtype,e.dtype),h=new jv(t.shape,[s,o,i],n,r),f=this.makePackedTensor(h.outputShape,p);return this.compileAndRun(h,[t,e],f)},t.prototype.fusedBatchMatMul=function(t,e,n,r,o,i){var a=n?t.shape[2]:t.shape[1],s=r?e.shape[1]:e.shape[2],u=t.shape[0],l=Yf(t.dtype,e.dtype),c=new jv(t.shape,[u,a,s],n,r,!!o,i?function(t,e){if(void 0===e&&(e=!1),"linear"===i)return"return x;";if("relu"===i)return e?by:vy;throw new Error("Activation "+i+" has not been implemented for the WebGL backend.")}(0,!0):null),p=this.makePackedTensor(c.outputShape,l),h=[t,e];return o&&h.push(o),this.compileAndRun(c,h,p)},t.prototype.multiply=function(t,e){if("complex64"===t.dtype){var n=this.texData.get(t.dataId),r=this.texData.get(e.dataId),o=new qm("return areal * breal - aimag * bimag;",t.shape,e.shape),i=new qm("return areal * bimag + aimag * breal;",t.shape,e.shape),a=[this.makeComplexComponentTensorHandle(t,n.complexTensors.real),this.makeComplexComponentTensorHandle(t,n.complexTensors.imag),this.makeComplexComponentTensorHandle(e,r.complexTensors.real),this.makeComplexComponentTensorHandle(e,r.complexTensors.imag)],s=this.compileAndRun(o,a),u=this.compileAndRun(i,a),l=this.complex(s,u);return s.dispose(),u.dispose(),l}if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.multiply(t,e);if(md.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,$m,t.dtype);var c=new Xm($m,t.shape,e.shape),p=this.makeOutputArray(c.outputShape,t.dtype);return this.compileAndRun(c,[t,e],p)},t.prototype.batchNormalization=function(t,e,n,r,o,i){var a=[t,e,n],s=null;null!=i&&(s=i.shape,a.push(i));var u=null;if(null!=o&&(u=o.shape,a.push(o)),md.get("WEBGL_PACK_BATCHNORMALIZATION")){var l=new Hm(t.shape,e.shape,n.shape,s,u,r);return this.compileAndRun(l,a)}var c=new Wm(t.shape,e.shape,n.shape,s,u,r);return this.compileAndRun(c,a)},t.prototype.localResponseNormalization4D=function(t,e,n,r,o){var i=new Bv(t.shape,e,n,r,o);return this.compileAndRun(i,[t])},t.prototype.LRNGrad=function(t,e,n,r,o,i,a){var s=new Uv(e.shape,r,o,i,a);return this.compileAndRun(s,[e,n,t])},t.prototype.tile=function(t,e){var n=new fy(t.shape,e);return this.compileAndRun(n,[t])},t.prototype.pad=function(t,e,n){var r=md.get("WEBGL_PACK_ARRAY_OPERATIONS")?new Kv(t.shape,e,n):new Gv(t.shape,e,n);return this.compileAndRun(r,[t])},t.prototype.transpose=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,e);var n=md.get("WEBGL_PACK_ARRAY_OPERATIONS")?new my(t.shape,e):new dy(t.shape,e);return this.compileAndRun(n,[t])},t.prototype.gather=function(t,e,n){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.gather(t,e,n);var r=new Sg(t.shape,e.size,n);return this.compileAndRun(r,[t,e])},t.prototype.batchToSpaceND=function(t,e,n){Xh(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var r=e.reduce(function(t,e){return t*e}),o=xd(t.shape,e,r),i=Sd(o.length,e.length),a=Cd(t.shape,e,r),s=Ed(n,e.length),u=Nd(a,n,e.length);return t.reshape(o).transpose(i).reshape(a).slice(s,u)},t.prototype.spaceToBatchND=function(t,e,n){Xh(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var r=e.reduce(function(t,e){return t*e}),o=[[0,0]];o.push.apply(o,n);for(var i=1+e.length;i<t.shape.length;++i)o.push([0,0]);var a=t.pad(o),s=xd(a.shape,e,r,!1),u=Sd(s.length,e.length,!1),l=Cd(a.shape,e,r,!1);return a.reshape(s).transpose(u).reshape(l)},t.prototype.reduce=function(t,e,n){var r=t.shape[0],o=t.shape[1],i=Ld(o),a=new Xv({windowSize:i,inSize:o,batchSize:r},e),s=a.outputShape,u=this.makeOutputArray([s[0],s[1]],n);return this.compileAndRun(a,[t],u),1===u.shape[1]?u:this.reduce(u,e,n)},t.prototype.argReduce=function(t,e,n){void 0===n&&(n=null);var r=t.shape[0],o=t.shape[1];null!=n&&(r=n.shape[0],o=n.shape[1]);var i=Ld(o),a=new Cm({windowSize:i,inSize:o,batchSize:r},e,null==n),s=a.outputShape,u=this.makeOutputArray([s[0],s[1]],"int32"),l=[t];return null!=n&&l.push(n),this.compileAndRun(a,l,u),1===u.shape[1]?u:this.argReduce(t,e,u)},t.prototype.argReducePacked=function(t,e,n){void 0===n&&(n=null);var r=null!=n?n.shape:t.shape,o=Ld(r[r.length-1]),i=new Vm(r,o,e,null==n),a=this.makePackedTensor(i.outputShape,"int32");return this.compileAndRun(i,null==n?[t]:[t,n],a),a.rank===t.rank?this.argReducePacked(t,e,a):a},t.prototype.sum=function(t,e){Ad("sum",e,t.rank);var n=Id(t.shape,e),r=n[0],o=Jh(n[1]),i=t.as2D(-1,o),a=Qf(t.dtype);return this.reduce(i,"sum",a).reshape(r)},t.prototype.prod=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,e);var n=Id(t.shape,e),r=n[0],o=Jh(n[1]),i=t.as2D(-1,o),a=Qf(t.dtype);return this.reduce(i,"prod",a).reshape(r)},t.prototype.unsortedSegmentSum=function(t,e,n){var r=0,o=kd([r],t.rank),i=t;null!=o&&(i=t.transpose(o),r=Od(1,t.rank)[0]);var a=function(t,e,n){for(var r=[],o=t.length,i=0;i<o;i++)r.push(i!==e?t[i]:n);return r}(i.shape,r,n),s=Jh([i.shape[r]]),u=i.as2D(-1,s),l=Qf(t.dtype),c=this.segOpCompute(u,"unsortedSegmentSum",e,l,n).reshape(a);return null!=o&&(c=c.transpose(Rd(o))),c},t.prototype.segOpCompute=function(t,e,n,r,o){var i=t.shape[0],a=t.shape[1],s=function(t,e){var n,r=!1;for(t<=Pd?(n=t,r=!0):n=Cf(t,Math.floor(Math.sqrt(t)));!r;){if(n>e||n===t){r=!0;break}n=Cf(t,n+1)}return n}(a,o),u=new oy({windowSize:s,inSize:a,batchSize:i,numSegments:o},e),l=u.outputShape,c=this.makeOutputArray([l[0],l[1]],r);return this.compileAndRun(u,[t,n],c),c.shape[1]===o?c:(n=lm(0,o).tile([a/s]),this.segOpCompute(c,e,n,r,o))},t.prototype.argMinMaxReduce=function(t,e,n){var r=[e];if(Ad("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,t.rank),!md.get("WEBGL_PACK_REDUCE")||t.rank<=2){var o=Id(t.shape,r),i=o[0],a=Jh(o[1]),s=t.as2D(-1,a);return this.argReduce(s,n).reshape(i)}return this.argReducePacked(t,n)},t.prototype.argMin=function(t,e){return this.argMinMaxReduce(t,e,"min")},t.prototype.argMax=function(t,e){return this.argMinMaxReduce(t,e,"max")},t.prototype.cumsum=function(t,e,n,r){if(e!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+e);var o=new fg(t.shape,n,r);return this.compileAndRun(o,[t])},t.prototype.equal=function(t,e){if(md.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(equal(a, b));\n","bool");var n=new Xm("return float(a == b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.notEqual=function(t,e){if(md.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(notEqual(a, b));\n","bool");var n=new Xm("return float(a != b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.less=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.less(t,e);if(md.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThan(a, b));\n","bool");var n=new Xm("return float(a < b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.lessEqual=function(t,e){if(md.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new Xm("return float(a <= b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.greater=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.greater(t,e);if(md.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new Xm("return float(a > b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.greaterEqual=function(t,e){if(md.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new Xm("return float(a >= b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.logicalNot=function(t){var e=new gy(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(e,[t])},t.prototype.logicalAnd=function(t,e){if(md.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new Xm("return float(a >= 1.0 && b >= 1.0);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.logicalOr=function(t,e){if(md.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new Xm("return float(a >= 1.0 || b >= 1.0);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.select=function(t,e,n){var r=new iy(t.rank,e.shape,e.rank),o=this.makeOutputArray(r.outputShape,Yf(e.dtype,n.dtype));return this.compileAndRun(r,[t,e,n],o)},t.prototype.where=function(t){wd("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var e=t.dataSync();return cb(t.shape,e)},t.prototype.topk=function(t,e,n){return Sm(t.dataSync(),t.shape,t.dtype,e)},t.prototype.min=function(t,e){Ad("min",e,t.rank);var n=Id(t.shape,e),r=n[0],o=Jh(n[1]),i=t.as2D(-1,o);return this.reduce(i,"min",i.dtype).reshape(r)},t.prototype.minimum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.minimum(t,e);var n=md.get("WEBGL_PACK_BINARY_OPERATIONS")?new Zm("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isNaN(a)) + vec4(isNaN(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Xm("\n  if (isNaN(a)) return a;\n  if (isNaN(b)) return b;\n\n  return min(a, b);\n",t.shape,e.shape),r=n.getCustomSetupFunc();return this.compileAndRun(n,[t,e],null,r)},t.prototype.mod=function(t,e){var n=md.get("WEBGL_PACK_BINARY_OPERATIONS")?new Zm("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Xm("if (b == 0.0) return NAN;\n  return mod(a, b);",t.shape,e.shape),r=n.getCustomSetupFunc();return this.compileAndRun(n,[t,e],null,r)},t.prototype.max=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,e);Ad("max",e,t.rank);var n=Id(t.shape,e),r=n[0],o=Jh(n[1]),i=t.as2D(-1,o);return this.reduce(i,"max",i.dtype).reshape(r)},t.prototype.maximum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.maximum(t,e);var n=md.get("WEBGL_PACK_BINARY_OPERATIONS")?new Zm("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isNaN(a)) + vec4(isNaN(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Xm("\n  if (isNaN(a)) return a;\n  if (isNaN(b)) return b;\n\n  return max(a, b);\n",t.shape,e.shape),r=n.getCustomSetupFunc();return this.compileAndRun(n,[t,e],null,r)},t.prototype.all=function(t,e){Ad("all",e,t.rank);var n=Id(t.shape,e),r=n[0],o=Jh(n[1]),i=t.as2D(-1,o);return this.reduce(i,"all",i.dtype).reshape(r)},t.prototype.any=function(t,e){Ad("any",e,t.rank);var n=Id(t.shape,e),r=n[0],o=Jh(n[1]),i=t.as2D(-1,o);return this.reduce(i,"any",i.dtype).reshape(r)},t.prototype.squaredDifference=function(t,e){var n=md.get("WEBGL_PACK_BINARY_OPERATIONS")?new Zm("return (a - b) * (a - b);",t.shape,e.shape):new Xm("return (a - b) * (a - b);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.realDivide=function(t,e){var n=new Xm("if (a == b) return 1.0;\n  return a / b;",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[t,e],r)},t.prototype.floorDiv=function(t,e){if(md.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  vec4 resultSign = sign(a) * sign(b);\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  ivec4 result = ia / ib;\n  ivec4 amodb = ia - ib * result;\n\n  // Vectorize INT_DIV\n  // if (resultSign < 0.0 && amodb != 0) result -= 1;\n  // return float(result);\n  return vec4(result -\n     ivec4(lessThan(resultSign, vec4(0.0))) * ivec4(notEqual(amodb, ivec4(0))));\n","int32");var n=new Xm("\n  float resultSign = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  int result = ia / ib;\n  int amodb = ia - ib * result;\n\n  if (resultSign < 0.0 && amodb != 0) {\n    result -= 1;\n  }\n  return float(result);\n",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"int32");return this.compileAndRun(n,[t,e],r)},t.prototype.add=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,Gm);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.add(t,e);var n=Yf(t.dtype,e.dtype);if(md.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,Gm,n);var r=new Xm(Gm,t.shape,e.shape),o=this.makeOutputArray(r.outputShape,n);return this.compileAndRun(r,[t,e],o)},t.prototype.packedBinaryOp=function(t,e,n,r){var o=new Zm(n,t.shape,e.shape),i=this.makePackedTensor(o.outputShape,r);return this.compileAndRun(o,[t,e],i)},t.prototype.complexSeparableBinaryOp=function(t,e,n){var r=this,o=this.texData.get(t.dataId),i=this.texData.get(e.dataId),a=[[o.complexTensors.real,i.complexTensors.real],[o.complexTensors.imag,i.complexTensors.imag]].map(function(o){var i=o[0],a=o[1],s=r.makeComplexComponentTensorHandle(t,i),u=r.makeComplexComponentTensorHandle(e,a),l=new Xm(n,t.shape,e.shape),c=r.makeOutputArray(l.outputShape,Yf(i.dtype,a.dtype));return r.compileAndRun(l,[s,u],c)}),s=a[0],u=a[1],l=this.complex(s,u);return s.dispose(),u.dispose(),l},t.prototype.makeComplexComponentTensorHandle=function(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}},t.prototype.addN=function(t){for(var e=t[0],n=1;n<t.length;n++)e=this.add(e,t[n]);return e},t.prototype.subtract=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,Km);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.subtract(t,e);var n=Yf(t.dtype,e.dtype);if(md.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,Km,t.dtype);var r=new Xm(Km,t.shape,e.shape),o=this.makeOutputArray(r.outputShape,n);return this.compileAndRun(r,[t,e],o)},t.prototype.pow=function(t,e){var n=md.get("WEBGL_PACK_BINARY_OPERATIONS"),r=n?new Zm("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Xm("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",t.shape,e.shape),o=Yf(t.dtype,e.dtype),i=n?this.makePackedTensor(r.outputShape,o):this.makeOutputArray(r.outputShape,o),a=r.getCustomSetupFunc();return this.compileAndRun(r,[t,e],i,a)},t.prototype.ceil=function(t){var e=new gy(t.shape,"return ceil(x);");return this.compileAndRun(e,[t])},t.prototype.floor=function(t){var e=new gy(t.shape,"return floor(x);");return this.compileAndRun(e,[t])},t.prototype.sign=function(t){var e=new gy(t.shape,"\n  if (isNaN(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(e,[t])},t.prototype.round=function(t){var e=new gy(t.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(e,[t])},t.prototype.exp=function(t){var e;return e=md.get("WEBGL_PACK")?new wy(t.shape,yy):new gy(t.shape,yy),this.compileAndRun(e,[t])},t.prototype.expm1=function(t){var e=new gy(t.shape,"return exp(x) - 1.0;");return this.compileAndRun(e,[t])},t.prototype.log=function(t){var e,n=(e=md.get("WEBGL_PACK")?new wy(t.shape,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n"):new gy(t.shape,"if (x < 0.0) return NAN;\n  return log(x);")).getCustomSetupFunc();return this.compileAndRun(e,[t],null,n)},t.prototype.log1p=function(t){var e=new gy(t.shape,"return log(1.0 + x);");return this.compileAndRun(e,[t])},t.prototype.sqrt=function(t){var e=new gy(t.shape,"return sqrt(x);");return this.compileAndRun(e,[t])},t.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var e=new gy(t.shape,"return inversesqrt(x);");return this.compileAndRun(e,[t])},t.prototype.square=function(t){var e=new gy(t.shape,"return x * x;");return this.compileAndRun(e,[t])},t.prototype.reciprocal=function(t){var e=new gy(t.shape,"return 1.0 / x;");return this.compileAndRun(e,[t])},t.prototype.relu=function(t){var e;return e=md.get("WEBGL_PACK")?new wy(t.shape,by):new gy(t.shape,vy),this.compileAndRun(e,[t])},t.prototype.prelu=function(t,e){var n=md.get("WEBGL_PACK_BINARY_OPERATIONS")?new Zm("\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",t.shape,e.shape):new Xm("return (a < 0.) ? b * a : a;",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.elu=function(t){var e=new gy(t.shape,"return (x >= 0.0) ? x : (exp(x) - 1.0);");return this.compileAndRun(e,[t])},t.prototype.eluDer=function(t,e){var n=md.get("WEBGL_PACK_BINARY_OPERATIONS")?new Zm("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",t.shape,e.shape):new Xm("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.selu=function(t){var e=new gy(t.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(e,[t])},t.prototype.int=function(t){var e=new gy(t.shape,"return float(int(x));"),n=this.makeOutputArray(e.outputShape,"int32");return this.compileAndRun(e,[t],n)},t.prototype.clip=function(t,e,n){var r,o=(r=md.get("WEBGL_PACK_CLIP")?new Qm(t.shape):new Ym(t.shape)).getCustomSetupFunc(e,n);return this.compileAndRun(r,[t],null,o)},t.prototype.abs=function(t){var e=new gy(t.shape,"return abs(x);");return this.compileAndRun(e,[t])},t.prototype.complexAbs=function(t){var e=this.texData.get(t.dataId),n=new Jm(t.shape),r=[this.makeComplexComponentTensorHandle(t,e.complexTensors.real),this.makeComplexComponentTensorHandle(t,e.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(t){var e=new gy(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(e,[t])},t.prototype.softplus=function(t){var e=new gy(t.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(e,[t])},t.prototype.sin=function(t){var e=new gy(t.shape,"if (isNaN(x)) return x;\n  return sin(x);\n");return this.compileAndRun(e,[t])},t.prototype.cos=function(t){var e=new gy(t.shape,"if (isNaN(x)) return x;\n  return cos(x);\n");return this.compileAndRun(e,[t])},t.prototype.tan=function(t){var e=new gy(t.shape,"return tan(x);");return this.compileAndRun(e,[t])},t.prototype.asin=function(t){var e=new gy(t.shape,"return asin(x);");return this.compileAndRun(e,[t])},t.prototype.acos=function(t){var e=new gy(t.shape,"return acos(x);");return this.compileAndRun(e,[t])},t.prototype.atan=function(t){var e=new gy(t.shape,"if (isNaN(x)) return x;\n  return atan(x);\n");return this.compileAndRun(e,[t])},t.prototype.atan2=function(t,e){var n=md.get("WEBGL_PACK_BINARY_OPERATIONS")?new Zm("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isNaN(a)) + vec4(isNaN(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Xm("\n  if (isNaN(a)) return a;\n  if (isNaN(b)) return b;\n\n  return atan(a, b);\n",t.shape,e.shape),r=n.getCustomSetupFunc();return this.compileAndRun(n,[t,e],null,r)},t.prototype.sinh=function(t){var e=new gy(t.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},t.prototype.cosh=function(t){var e=new gy(t.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},t.prototype.tanh=function(t){var e=new gy(t.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(e,[t])},t.prototype.asinh=function(t){var e=new gy(t.shape,"return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(e,[t])},t.prototype.acosh=function(t){var e=new gy(t.shape,"if (isNaN(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));"),n=e.getCustomSetupFunc();return this.compileAndRun(e,[t],null,n)},t.prototype.atanh=function(t){var e=new gy(t.shape,"if (isNaN(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;"),n=e.getCustomSetupFunc();return this.compileAndRun(e,[t],null,n)},t.prototype.erf=function(t){var e=new gy(t.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float t = 1.0 / (1.0 + p * x);\n  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);\n');return this.compileAndRun(e,[t])},t.prototype.step=function(t,e){var n=new gy(t.shape,function(t){return void 0===t&&(t=0),"if (isNaN(x)) return x;\n    return x > 0.0 ? 1.0 : float("+t+");\n  "}(e));return this.compileAndRun(n,[t])},t.prototype.conv2dByMatMul=function(t,e,n){var r=t.shape,o=this.texData.get(t.dataId);if(!md.get("WEBGL_LAZILY_UNPACK")||!md.get("WEBGL_PACK_BINARY_OPERATIONS")||r[2]%2==0||!o.isPacked){var i=this.reshape(t,[1,r[0]*r[1]*r[2],n.inChannels]),a=this.reshape(e,[1,n.inChannels,n.outChannels]);return this.reshape(this.batchMatMul(i,a,!1,!1),n.outShape)}var s=Vf.make([1,r[0]*r[1]*(r[2]+1),n.inChannels],{dataId:t.dataId},t.dtype,this),u=o.shape;o.shape=o.shape.slice(),o.shape[o.shape.length-2]++,Xh(hv(o.shape,s.shape),function(){return"packed reshape "+o.shape+" to "+s.shape+" isn't free"});var l=this.reshape(e,[1,n.inChannels,n.outChannels]),c=this.batchMatMul(s,l,!1,!1),p=this.texData.get(c.dataId);return Xh(p.isPacked,function(){return"batchMatMul result is expected to be packed"}),o.shape=u,p.shape=n.outShape,Vf.make(n.outShape,{dataId:c.dataId},c.dtype,this)},t.prototype.conv2dWithIm2Row=function(t,e,n){var r=n.outWidth,o=n.outHeight,i=n.filterWidth*n.filterHeight*n.inChannels,a=o*r,s=[i,a],u=t.squeeze([0]),l=e.reshape([1,i,-1]),c=new zv(s,u.shape,n),p=this.compileAndRun(c,[u]).reshape([1,s[0],s[1]]),h=new jv(p.shape,[1,a,n.outChannels],!0,!1);return this.compileAndRun(h,[p,l]).reshape([1,o,r,n.outChannels])},t.prototype.conv2d=function(t,e,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(t,e,n);if(md.get("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,e,n);var r=new ug(n);return this.compileAndRun(r,[t,e])},t.prototype.conv2dDerInput=function(t,e,n){var r=new rg(n);return this.compileAndRun(r,[t,e])},t.prototype.conv2dDerFilter=function(t,e,n){var r=new ng(n);return this.compileAndRun(r,[t,e])},t.prototype.depthwiseConv2D=function(t,e,n){var r;return md.get("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new pg(n),this.compileAndRun(r,[t,e],this.makePackedTensor(n.outShape,t.dtype))):(r=new cg(n),this.compileAndRun(r,[t,e]))},t.prototype.depthwiseConv2DDerInput=function(t,e,n){var r=new sg(n);return this.compileAndRun(r,[t,e])},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){var r=new ag(n);return this.compileAndRun(r,[t,e])},t.prototype.conv3d=function(t,e,n){var r=new lg(n);return this.compileAndRun(r,[t,e])},t.prototype.conv3dDerInput=function(t,e,n){var r=new ig(n);return this.compileAndRun(r,[t,e])},t.prototype.conv3dDerFilter=function(t,e,n){var r=new og(n);return this.compileAndRun(r,[t,e])},t.prototype.maxPool=function(t,e){var n=new $v(e,"max",!1),r=this.makeOutputArray(n.outputShape,t.dtype);return this.compileAndRun(n,[t],r)},t.prototype.avgPool=function(t,e){var n=new $v(e,"avg",!1),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[t],r)},t.prototype.maxPoolBackprop=function(t,e,n,r){var o=new $v(r,"max",!0),i=this.compileAndRun(o,[e]),a=new Vv(r),s=this.makeOutputArray(a.outputShape,e.dtype),u=this.compileAndRun(a,[t,i],s);return i.dispose(),u},t.prototype.avgPoolBackprop=function(t,e,n){var r=new jm(n),o=this.makeOutputArray(r.outputShape,e.dtype);return this.compileAndRun(r,[t],o)},t.prototype.cast=function(t,e){return fm(t,e,this)},t.prototype.unstack=function(t,e){for(var n=t.shape[e],r=new Array(t.rank-1),o=0,i=0;i<t.rank;i++)i!==e&&(r[o++]=t.shape[i]);var a=new Array(t.rank).fill(0),s=t.shape.slice();s[e]=1;var u=new Array(n);for(i=0;i<u.length;i++)a[e]=i,u[i]=this.slice(t,a,s).reshape(r);return u},t.prototype.reshape=function(t,e){var n=this.texData.get(t.dataId);return!n.isPacked||hv(t.shape,e)||null!==n.texture&&hv(n.shape,e)?dm(t,e):this.packedReshape(t,e)},t.prototype.resizeBilinear=function(t,e,n,r){var o=md.get("WEBGL_PACK_IMAGE_OPERATIONS")?new Jv(t.shape,e,n,r):new Qv(t.shape,e,n,r);return this.compileAndRun(o,[t])},t.prototype.resizeBilinearBackprop=function(t,e,n){var r=new Yv(t,e,n);return this.compileAndRun(r,[t])},t.prototype.resizeNearestNeighbor=function(t,e,n,r){var o=new ey(t.shape,e,n,r);return this.compileAndRun(o,[t])},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){var r=new ty(t,e,n);return this.compileAndRun(r,[t])},t.prototype.multinomial=function(t,e,n,r){var o=e?t:$d(t),i=new Wv(o.shape[0],o.shape[1],n),a=this.makeOutputArray(i.outputShape,"int32"),s=i.getCustomSetupFunc(r);return this.compileAndRun(i,[o],a,s)},t.prototype.oneHot=function(t,e,n,r){var o=new Hv(t.size,e,n,r);return this.compileAndRun(o,[t])},t.prototype.nonMaxSuppression=function(t,e,n,r,o){return wd("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),bm(t.dataSync(),e.dataSync(),n,r,o)},t.prototype.cropAndResize=function(t,e,n,r,o,i){var a=new hg(t.shape,e.shape,r,o,i);return this.compileAndRun(a,[t,e,n])},t.prototype.depthToSpace=function(t,e,n){Xh(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});var r=t.shape[0],o=("NHWC"===n?t.shape[1]:t.shape[2])*e,i=("NHWC"===n?t.shape[2]:t.shape[3])*e,a=("NHWC"===n?t.shape[3]:t.shape[1])/(e*e),s=new vg("NHWC"===n?[r,o,i,a]:[r,a,o,i],e,n);return this.compileAndRun(s,[t])},t.prototype.split=function(t,e,n){return xm(t,e,n)},t.prototype.scatterND=function(t,e,n){var r=Fd(0,t,n),o=r.sliceRank,i=r.numUpdates,a=r.sliceSize,s=r.strides,u=r.outputSize,l=[u/a,a],c=t.reshape([i,o]),p=e.reshape([i,a]);if(0===u)return dm(Jd([]),n);var h=tm(0),f=new ry(i,o,c.rank,p.rank,s,l);return this.compileAndRun(f,[p,c,h]).reshape(n)},t.prototype.sparseToDense=function(t,e,n,r){var o=Fd(0,t,n),i=new ry(o.numUpdates,o.sliceRank,t.rank,e.rank,o.strides,[o.outputSize,1],!1);return this.compileAndRun(i,[e,t,r]).reshape(n)},t.prototype.fft=function(t){return this.fftImpl(t,!1)},t.prototype.ifft=function(t){return this.fftImpl(t,!0)},t.prototype.fftImpl=function(t,e){var n=this.texData.get(t.dataId),r=new bg("return real * expR - imag * expI;",t.shape,e),o=new bg("return real * expI + imag * expR;",t.shape,e),i=[this.makeComplexComponentTensorHandle(t,n.complexTensors.real),this.makeComplexComponentTensorHandle(t,n.complexTensors.imag)],a=this.compileAndRun(r,i),s=this.compileAndRun(o,i),u=this.complex(a,s).as2D(t.shape[0],t.shape[1]);return a.dispose(),s.dispose(),u},t.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],o=Md(t,e),i=o[0],a=o[1],s=o[2],u=o[3],l=e.reshape([a,r]),c=t.reshape([t.size/s,s]),p=new Cg(r,u,[a,s]);return this.compileAndRun(p,[c,l]).reshape(i)},t.prototype.fill=function(t,e,n){if("string"===(n=n||xf(e))){var r=pf(n,Jh(t));return r.fill(e),Vf.make(t,{values:r},n)}var o=new wg(t,e),i=o.getCustomSetupFunc(e),a=this.makeOutputArray(t,n);return this.compileAndRun(o,[],a,i)},t.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},t.prototype.zerosLike=function(t){return this.fill(t.shape,"string"===t.dtype?"":0,t.dtype)},t.prototype.makeOutputArray=function(t,e){return Vf.make(t,{},e,this)},t.prototype.makePackedTensor=function(t,e){var n=Vf.make(t,{},e,this);return this.texData.get(n.dataId).isPacked=!0,n},t.prototype.unpackTensor=function(t){var e=new xy(t.shape);return this.compileAndRun(e,[t],Vf.make(e.outputShape,{},t.dtype,this))},t.prototype.packTensor=function(t){var e=new qv(t.shape);return this.compileAndRun(e,[t],this.makePackedTensor(t.shape,t.dtype))},t.prototype.packedReshape=function(t,e){var n=t.reshape([uv(t.shape)].concat(lv(t.shape))),r=[uv(e)].concat(lv(e)),o=new Zv(r,n.shape);return this.compileAndRun(o,[n]).reshape(e)},t.prototype.compileAndRun=function(t,e,n,r,o){var i=this;if(void 0===o&&(o=!0),null==n&&(n=t.usesPackedTextures?this.makePackedTensor(t.outputShape,e[0].dtype):this.makeOutputArray(t.outputShape,e[0].dtype)),0===n.size)return this.texData.get(n.dataId).values=cf(n.dtype,0),n;var a=e.map(function(e){if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=i.texData.get(e.dataId);if(null==n.texture){if(!t.usesPackedTextures&&Jh(e.shape)<=md.get("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:i.readSync(e.dataId)};t.usesPackedTextures&&(n.isPacked=!0,n.shape=e.shape)}else if(!!n.isPacked!=!!t.usesPackedTextures)e=n.isPacked?i.unpackTensor(e):i.packTensor(e),n=i.texData.get(e.dataId);else if(n.isPacked&&!hv(n.shape,e.shape)){var r=e,o=e.shape;e.shape=n.shape,e=i.packedReshape(e,o),n=i.texData.get(e.dataId),r.shape=o}return i.uploadToGPU(e.dataId),{shape:e.shape,texData:n,isUniform:!1}});this.uploadToGPU(n.dataId);var s,u={shape:n.shape,texData:this.texData.get(n.dataId),isUniform:!1},l=function(t,e,n){var r="";return a.concat(u).forEach(function(t){r+=t.shape+"_"+(t.isUniform?"uniform":t.texData.texShape)+"_"+(null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0)}),t.constructor.name+"_"+r+"_"+t.userCode}(t),c=this.getAndSaveBinary(l,function(){return function(t,e,n,r){for(var o=e.userCode,i=n.map(function(t,n){var r={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0&&(r.flatOffset=t.texData.slice.flatOffset),{name:e.variableNames[n],shapeInfo:r}}),a=i.map(function(t){return t.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=function(t,e,n,r){var o=[];t.forEach(function(t){var e=Jh(t.shapeInfo.logicalShape);t.shapeInfo.isUniform?o.push("uniform float "+t.name+(e>1?"["+e+"]":"")+";"):(o.push("uniform sampler2D "+t.name+";"),o.push("uniform int offset"+t.name+";"))});var i,a,s=o.join("\n"),u=t.map(function(t){return function(t,e,n){void 0===n&&(n=!1);var r="";return r+=n?function t(e){switch(e.shapeInfo.logicalShape.length){case 0:return function(t){var e=t.name;return"\n    vec4 get"+e.charAt(0).toUpperCase()+e.slice(1)+"() {\n      return "+Am().texture2D+"("+e+", halfCR);\n    }\n  "}(e);case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=t.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=Am();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return "+i.texture2D+"("+e+", uv);\n    }\n  "}(e);case 2:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t.shapeInfo.texShape,i=o[0],a=o[1],s=Am();if(null!=o&&tf(e,o))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+a+".0, "+i+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(e[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0])return"\n        "+t(Bm(e,n.slice(1)))+"\n        vec4 "+o+"(int b, int row, int col) {\n          return "+o+"("+Um(["b","row","col"],[1,2])+");\n        }\n      ";var s=a[0],u=a[1],l=Math.ceil(n[2]/2);return"\n    vec4 "+o+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+s+", "+u+", "+l*Math.ceil(n[1]/2)+", "+l+", b, row, col);\n      return "+Am().texture2D+"("+r+", uv);\n    }\n  "}(e);default:return function(t){for(var e=t.shapeInfo.logicalShape,n=e.length,r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape,a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],s=a[0],u=a[1],l=Math.ceil(e[n-1]/2),c=l*Math.ceil(e[n-2]/2),p="int b, int row, int col",h="b * "+c+" + (row / 2) * "+l+" + (col / 2)",f=2;f<n-1;f++)p="int b"+f+", "+p,h="b"+f+" * "+(c*=e[n-f-1])+" + "+h;return"\n    vec4 "+o+"("+p+") {\n      int index = "+h+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+Am().texture2D+"("+r+", uv);\n    }\n  "}(e)}}(t):function t(e){var n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"float "+n+"() {return "+e+";}";var r=t.shapeInfo.texShape;if(1===r[0]&&1===r[1])return"\n      float "+n+"() {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var o=t.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+o[0]+", "+o[1]+", "+Lm(e)+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(e);case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+Fm(t)+"\n      }\n    ";var r=t.shapeInfo.texShape,o=r[0],i=r[1];if(1===i&&1===o)return"\n      float "+n+"(int index) {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var a=Lm(e);return 1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+a+") + 0.5) / "+o+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+a+") + 0.5) / "+i+".0, 0.5);\n        return sampleTexture("+e+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+o+", "+i+", index + "+a+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(e);case 2:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&tf(n,i))return"\n    float "+o+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+i[1]+".0, "+i[0]+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ";var a=lf(n),s=a.keptDims,u=a.newShape;if(u.length<n.length)return"\n      "+t(Bm(e,u))+"\n      float "+o+"(int row, int col) {\n        return "+o+"("+Um(["row","col"],s)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+n[1]+", 1)));\n        "+Fm(e)+"\n      }\n    ";var l=i[0],c=i[1],p=Lm(r);return 1===c?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+l+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":1===l?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+c+".0, 0.5);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n  float "+o+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+n[1]+" + col + "+p+";\n    vec2 uv = uvFromFlat("+l+", "+c+", index);\n    return sampleTexture("+r+", uv);\n  }\n"}(e);case 3:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],a=n[2],s=lf(n),u=s.keptDims,l=s.newShape;if(l.length<n.length)return"\n        "+t(Bm(e,l))+"\n        float "+o+"(int row, int col, int depth) {\n          return "+o+"("+Um(["row","col","depth"],u)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+i+", "+a+", 1)));\n        "+Fm(e)+"\n      }\n    ";var c=e.shapeInfo.texShape,p=c[0],h=c[1],f=e.shapeInfo.flatOffset;return h===i&&null==f?"\n        float "+o+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+h+".0, "+p+".0);\n          return sampleTexture("+r+", uv);\n        }\n      ":h===a&&null==f?"\n    float "+o+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+n[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+h+".0, "+p+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n      float "+o+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+i+" + col * "+a+" + depth + "+Lm(r)+";\n        vec2 uv = uvFromFlat("+p+", "+h+", index);\n        return sampleTexture("+r+", uv);\n      }\n  "}(e);case 4:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],a=n[2]*i,s=n[1]*a,u=lf(n),l=u.newShape,c=u.keptDims;if(l.length<n.length)return"\n      "+t(Bm(e,l))+"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        return "+o+"("+Um(["row","col","depth","depth2"],c)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+s+", "+a+", "+i+", 1)));\n        "+Fm(e)+"\n      }\n    ";var p=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,f=h[0],d=h[1];return d===s&&null==p?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+d+".0, "+f+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":d===i&&null==p?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+n[1]*n[2]+", "+n[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+d+".0, "+f+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+a+" +\n          depth * "+i+" + depth2;\n      vec2 uv = uvFromFlat("+f+", "+d+", index + "+Lm(r)+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);case 5:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[4],a=n[3]*i,s=n[2]*a,u=n[1]*s,l=lf(n),c=l.newShape,p=l.keptDims;if(c.length<n.length)return"\n      "+t(Bm(e,c))+"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+o+"("+Um(["row","col","depth","depth2","depth3"],p)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+u+", "+s+", "+a+", "+i+")) +\n          depth3;\n        "+Fm(e)+"\n      }\n    ";var h=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,d=f[0],m=f[1];return m===u&&null==h?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+s+", "+a+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+d+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":m===i&&null==h?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]+",\n               "+n[2]*n[3]+", "+n[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+d+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+s+" + depth * "+a+" +\n          depth2 * "+i+" + depth3 + "+Lm(r)+";\n      vec2 uv = uvFromFlat("+d+", "+m+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);case 6:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=lf(n),a=i.newShape,s=i.keptDims;if(a.length<n.length)return"\n      "+t(Bm(e,a))+"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+o+"("+Um(["row","col","depth","depth2","depth3","depth4"],s)+");\n      }\n    ";var u=n[5],l=n[4]*u,c=n[3]*l,p=n[2]*c,h=n[1]*p;if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+h+", "+p+", "+c+", "+l+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+u+", 1)));\n        "+Fm(e)+"\n      }\n    ";var f=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,m=d[0],g=d[1];return g===h&&null==f?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+p+", "+c+", "+l+", "+u+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+g+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":g===u&&null==f?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]*n[4]+",\n               "+n[2]*n[3]*n[4]+",\n               "+n[3]*n[4]+",\n               "+n[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+g+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+h+" + col * "+p+" + depth * "+c+" +\n          depth2 * "+l+" + depth3 * "+u+" + depth4 + "+Lm(r)+";\n      vec2 uv = uvFromFlat("+m+", "+g+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);default:throw new Error(n.length+"-D input sampling is not yet supported")}}(t),t.shapeInfo.logicalShape.length<=e.logicalShape.length&&(r+=n?function(t,e){var n,r,o=t.name,i=o.charAt(0).toUpperCase()+o.slice(1),a="get"+i+"AtOutCoords",s=t.shapeInfo.logicalShape.length,u=e.logicalShape.length,l=_m(t.shapeInfo.logicalShape,e.logicalShape),c=zm(u),p=u-s,h=["x","y","z","w","u","v"];n=0===s?"":u<2&&l.length>=1?"coords = 0;":l.map(function(t){return"coords."+h[t+p]+" = 0;"}).join("\n"),r=u<2&&s>0?"coords":t.shapeInfo.logicalShape.map(function(t,e){return"coords."+h[e+p]}).join(", ");var f="return outputValue;";if(1===s&&u>1)f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";else if(0===s&&u>0)f=1===u?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(l.length){var d=s-2,m=s-1;l.indexOf(d)>-1&&l.indexOf(m)>-1?f="return vec4(outputValue.x);":l.indexOf(d)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":l.indexOf(m)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}return"\n    vec4 "+a+"() {\n      "+c+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+i+"("+r+");\n      "+f+"\n    }\n  "}(t,e):function(t,e){var n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),o="get"+r+"AtOutCoords",i=t.shapeInfo.logicalShape.length,a=e.logicalShape.length;if(!t.shapeInfo.isUniform&&i===a&&null==t.shapeInfo.flatOffset&&tf(t.shapeInfo.texShape,e.texShape))return"\n      float "+o+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var s=zm(a),u=_m(t.shapeInfo.logicalShape,e.logicalShape),l=a-i,c=["x","y","z","w","u","v"];return"\n    float "+o+"() {\n      "+s+" coords = getOutputCoords();\n      "+(0===i?"":a<2&&u.length>=1?"coords = 0;":u.map(function(t){return"coords."+c[t+l]+" = 0;"}).join("\n"))+"\n      return get"+r+"("+(a<2&&i>0?"coords":t.shapeInfo.logicalShape.map(function(t,e){return"coords."+c[e+l]}).join(", "))+");\n    }\n  "}(t,e)),r}(t,e,r)}).join("\n"),l=e.texShape,c=Am(),p="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+c.texture2D+"(textureSampler, uv).r;\n    }\n  ",h=function(t){var e;return e=md.get("PROD")?"\n      bool isNaN(float val) {\n        return false;\n      }\n\n      bool hasNaN(vec4 values) {\n        return false;\n      }\n    ":"\n      bool isNaN(float val) {\n        return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;\n      }\n\n      bvec4 isNaN(vec4 val) {\n        return bvec4(\n          isNaN(val.x),\n          isNaN(val.y),\n          isNaN(val.z),\n          isNaN(val.w)\n        );\n      }\n\n      bool hasNaN(vec4 values) {\n        return any(bvec4(\n          isNaN(values.x),\n          isNaN(values.y),\n          isNaN(values.z),\n          isNaN(values.w)\n        ));\n      }\n    ",t.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+t.varyingFs+" vec2 resultUV;\n    "+t.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    "+e+"\n\n    float getNaN(vec4 values) {\n      return dot(vec4(1), values);\n    }\n\n    "+t.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+Om+"\n    "+Dm+"\n    "+Mm+"\n  "}(c);return e.isPacked?(i=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return resTexRC.x * "+n[1]+" + resTexRC.y;\n    }\n  "}(0,e);case 2:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(tf(t,e))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(t[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[2]/2),o=r*Math.ceil(t[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  "}(t,e);default:return function(t,e){for(var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),o=r*Math.ceil(t[t.length-2]/2),i=o,a="",s="b, r, c",u=2;u<t.length-1;u++)a="\n      int b"+u+" = index / "+(i*=t[t.length-u-1])+";\n      index -= b"+u+" * "+i+";\n    "+a,s="b"+u+", "+s;return"\n    ivec"+t.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+a+"\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+t.length+"("+s+");\n    }\n  "}(t,e)}}(e.logicalShape,l),a="\n    void setOutput(vec4 val) {\n      "+c.output+" = val;\n    }\n  "):(i=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){return 1===e[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+e[1]+".0);\n      }\n    ":1===e[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+e[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      return resTexRC.x * "+e[1]+" + resTexRC.y;\n    }\n  "}(0,e);case 2:return function(t,e){return tf(t,e)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+e[0]+", "+e[1]+"));\n      }\n    ":1===t[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===t[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+t[1]+";\n      int c = index - r * "+t[1]+";\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return function(t,e){var n=km(["r","c","d"],t);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+n+"\n      return ivec3(r, c, d);\n    }\n  "}(t,e);case 4:return function(t,e){var n=km(["r","c","d","d2"],t);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(t,e);case 5:return function(t,e){var n=km(["r","c","d","d2","d3"],t);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+e[0]+",\n                             "+e[1]+"));\n\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(t,e);case 6:return function(t,e){var n=km(["r","c","d","d2","d3","d4"],t);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(t,e);default:throw new Error(t.length+"-D output sampling is not yet supported")}}(e.logicalShape,l),a="\n    void setOutput(float val) {\n      "+c.output+" = vec4(val, 0, 0, 0);\n    }\n  "),r&&(h+=Pm),[h,p,a,s,i,u,n].join("\n")}(i,s,o,e.usesPackedTextures),l=t.createProgram(u),c={},p=0;p<e.variableNames.length;p++){var h=e.variableNames[p];c[h]=t.getUniformLocation(l,h,!1),c["offset"+h]=t.getUniformLocation(l,"offset"+h,!1)}return{program:e,source:u,webGLProgram:l,uniformLocations:c,gpgpu:t,inShapeInfos:a,outShapeInfo:s}}(i.gpgpu,t,a,u)}),p=null!=this.activeTimers;p&&(s=this.startTimer()),function(t,e,n,r){Fv(t.inShapeInfos,e),Fv([t.outShapeInfo],[n]);var o=n.texData.texture,i=n.texData.texShape,a=t.gpgpu;n.texData.isPacked?a.setOutputPackedMatrixTexture(o,i[0],i[1]):a.setOutputMatrixTexture(o,i[0],i[1]),a.setProgram(t.webGLProgram),e.forEach(function(e,n){var r=t.program.variableNames[n],o=t.uniformLocations[r],i=t.uniformLocations["offset"+r];if(null!=o)if(e.isUniform)if(1===Jh(e.shape))a.gl.uniform1f(o,e.uniformValues[0]);else{var s=e.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),a.gl.uniform1fv(o,s)}else null!=e.texData.slice&&null!=i&&a.gl.uniform1i(i,e.texData.slice.flatOffset),a.setInputMatrixTexture(e.texData.texture,o,n)}),null!=r&&r(a,t.webGLProgram),a.executeProgram()}(c,a,u,r);var h=1024*md.get("WEBGL_NUM_MB_BEFORE_PAGING");if(o&&this.numBytesInGPU>h)for(var f=this.numBytesInGPU-h;f>0&&this.lruDataGPU.length>0;){var d=this.lruDataGPU.shift(),m=this.texData.get(d);f-=this.computeBytes(m.texShape,m.dtype),this.read(d)}return p&&(s=this.endTimer(s),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(s)})),md.get("WEBGL_LAZILY_UNPACK")||!this.texData.get(n.dataId).isPacked||t.isPackShader?n:this.unpackTensor(n)},t.prototype.getAndSaveBinary=function(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){if(!this.disposed){for(var t in this.binaryCache)this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram);this.textureManager.dispose(),this.canvas.remove(),null!=this.fromPixels2DContext&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&this.gpgpu.dispose(),this.disposed=!0}},t.prototype.floatPrecision=function(){var t=this;return vd(function(){var e=md.get("DEBUG");md.set("DEBUG",!1);var n=t.abs(tm(1e-8)).dataSync()[0];return md.set("DEBUG",e),n>0?32:16})},t.prototype.uploadToGPU=function(t){var e,n=this.texData.get(t),r=n.shape,o=n.dtype,i=n.values,a=n.usage,s=n.isPacked;if(null==n.texture){var u,l=null!=this.activeTimers;l&&(u=performance.now());var c=cv(r,s);n.texShape=c;var p=this.acquireTexture(t,c,a,o,s);if(n.texture=p,null!=i){if(s){var h=uv(r),f=1,d=1;r.length&&(f=(e=lv(r))[0],d=e[1]),this.gpgpu.uploadMatrixToPackedTexture(p,h,f,d,c[0],c[1],hb(i))}else this.gpgpu.uploadMatrixToTexture(p,c[0],c[1],hb(i));n.values=null,l&&(this.uploadWaitMs+=performance.now()-u)}}else md.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY&&this.lruDataGPU.indexOf(t)>=0&&(this.lruDataGPU.splice(this.lruDataGPU.indexOf(t),1),this.lruDataGPU.push(t))},t.prototype.convertAndCacheOnCPU=function(t,e){var n=this.texData.get(t),r=n.texture,o=n.dtype;return null!=r&&(this.releaseTexture(t,r,n.texShape,n.usage,o,n.isPacked),n.texture=null,n.texShape=null,n.isPacked=!1),n.usage=mg.UPLOAD,null!=e&&(n.values=function(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){for(var n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length),r=0;r<n.length;++r)n[r]=Math.round(t[r]);return n}throw new Error("Unknown dtype "+e)}(e,o)),n.values},t.prototype.releaseTexture=function(t,e,n,r,o,i){if(md.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY){var a=this.lruDataGPU.indexOf(t);a>=0&&this.lruDataGPU.splice(a,1)}this.numBytesInGPU-=this.computeBytes(n,o),this.textureManager.releaseTexture(e,n,r,i)},t.prototype.acquireTexture=function(t,e,n,r,o){return md.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY&&this.lruDataGPU.push(t),this.numBytesInGPU+=this.computeBytes(e,r),this.textureManager.acquireTexture(e,n,o)},t.prototype.computeBytes=function(t,e){return t[0]*t[1]*gf(e)},t}();function hb(t){return t instanceof Float32Array?t:new Float32Array(t)}md.get("IS_BROWSER")&&md.registerBackend("webgl",function(){return new pb},2);var fb=Kd({abs_:function(t){var e=qd(t,"x","abs");return"complex64"===e.dtype?md.engine.runKernel(function(t){return t.complexAbs(e)},{$x:e}):md.engine.runKernel(function(t){return t.abs(e)},{$x:e},function(t){return{$x:function(){return t.mulStrict(e.toFloat().step(-1))}}})}}),db=Kd({acos_:function(t){var e=qd(t,"x","acos");return md.engine.runKernel(function(t){return t.acos(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(tm(1).sub(e.toFloat().square()).sqrt()).neg()}}})}}),mb=Kd({acosh_:function(t){var e=qd(t,"x","acosh");return md.engine.runKernel(function(t){return t.acosh(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(e.toFloat().square().sub(1).sqrt())}}})}}),gb=Kd({asin_:function(t){var e=qd(t,"x","asin");return md.engine.runKernel(function(t){return t.asin(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(tm(1).sub(e.toFloat().square()).sqrt())}}})}}),vb=Kd({asinh_:function(t){var e=qd(t,"x","asinh");return md.engine.runKernel(function(t){return t.asinh(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(tm(1).add(e.toFloat().square()).sqrt())}}})}}),yb=Kd({atan_:function(t){var e=qd(t,"x","atan");return md.engine.runKernel(function(t){return t.atan(e)},{$x:e},function(t){return{$x:function(){return t.div(e.toFloat().square().add(1))}}})}}),bb=Kd({atanh_:function(t){var e=qd(t,"x","atanh");return md.engine.runKernel(function(t){return t.atanh(e)},{$x:e},function(t){return{$x:function(){return t.div(tm(1).sub(e.toFloat().square()))}}})}}),wb=Kd({ceil_:function(t){var e=qd(t,"x","ceil");return md.engine.runKernel(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return pm(t)}}})}}),xb=Kd({clipByValue_:function(t,e,n){var r=qd(t,"x","clipByValue");return Xh(e<=n,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+n+")."}),md.engine.runKernel(function(t){return t.clip(r,e,n)},{$x:r},function(t){return{$x:function(){return t.where(r.greaterEqual(e).logicalAnd(r.lessEqual(n)),pm(t))}}})}}),Sb=Kd({cos_:function(t){var e=qd(t,"x","cos");return md.engine.runKernel(function(t){return t.cos(e)},{$x:e},function(t){return{$x:function(){return e.toFloat().sin().neg().mulStrict(t)}}})}}),Cb=Kd({cosh_:function(t){var e=qd(t,"x","cosh");return md.engine.runKernel(function(t){return t.cosh(e)},{$x:e},function(t){return{$x:function(){return e.toFloat().sinh().mulStrict(t)}}})}}),Eb=Kd({erf_:function(t){var e=qd(t,"x","erf");return Xh("int32"===e.dtype||"float32"===e.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===e.dtype&&(e=e.toFloat()),md.engine.runKernel(function(t){return t.erf(e)},{$x:e},function(t){return{$x:function(){return t.mul(e.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Nb=Kd({exp_:function(t){var e=qd(t,"x","exp");return md.engine.runKernel(function(t,n){return n(t.exp(e))},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mulStrict(n)}}})}}),_b=Kd({expm1_:function(t){var e=qd(t,"x","expm1");return md.engine.runKernel(function(t){return t.expm1(e)},{$x:e},function(t){return{$x:function(){return t.mulStrict(e.exp())}}})}}),Ib=Kd({floor_:function(t){var e=qd(t,"x","floor");return md.engine.runKernel(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return pm(t)}}})}}),Tb=Kd({log_:function(t){var e=qd(t,"x","log");return md.engine.runKernel(function(t){return t.log(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(e.toFloat())}}})}}),Ab=Kd({log1p_:function(t){var e=qd(t,"x","log1p");return md.engine.runKernel(function(t){return t.log1p(e)},{$x:e},function(t){return{$x:function(){return t.div(e.add(1))}}})}}),kb=Kd({logSigmoid_:function(t){var e=qd(t,"x","logSigmoid");return md.engine.runKernel(function(t){return t.softplus(e.neg()).neg()},{$x:e},function(t){return{$x:function(){return t.mulStrict(e.neg().sigmoid())}}})}}),Rb=Kd({neg_:function(t){var e=qd(t,"x","neg");return md.engine.runKernel(function(t){return t.neg(e)},{$x:e},function(t){return{$x:function(){return t.neg()}}})}}),Ob=Kd({reciprocal_:function(t){var e=qd(t,"x","reciprocal");return md.engine.runKernel(function(t){return t.reciprocal(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(e.square().neg())}}})}}),Db=Kd({round_:function(t){var e=qd(t,"x","round");return md.engine.runKernel(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return pm(t)}}})}}),Mb=Kd({rsqrt_:function(t){var e=qd(t,"x","rsqrt");return md.engine.runKernel(function(t){return t.rsqrt(e)},{$x:e},function(t){return{$x:function(){return t.div(e.pow(1.5).mul(2)).neg()}}})}}),Pb=Kd({sigmoid_:function(t){var e=qd(t,"x","sigmoid");return md.engine.runKernel(function(t,n){return n(t.sigmoid(e))},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.mul(tm(1).sub(n)))}}})}}),Lb=Kd({sign_:function(t){var e=qd(t,"x","sign");return md.engine.runKernel(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return pm(t)}}})}}),Fb=Kd({sin_:function(t){var e=qd(t,"x","sin");return md.engine.runKernel(function(t){return t.sin(e)},{$x:e},function(t){return{$x:function(){return e.toFloat().cos().mulStrict(t)}}})}}),zb=Kd({sinh_:function(t){var e=qd(t,"x","sinh");return md.engine.runKernel(function(t){return t.sinh(e)},{$x:e},function(t){return{$x:function(){return e.toFloat().cosh().mulStrict(t)}}})}}),Bb=Kd({softplus_:function(t){var e=qd(t,"x","softplus");return md.engine.runKernel(function(t){return t.softplus(e)},{$x:e},function(t){return{$x:function(){return t.mulStrict(e.sigmoid())}}})}}),Ub=Kd({sqrt_:function(t){var e=qd(t,"x","sqrt");return md.engine.runKernel(function(t){return t.sqrt(e)},{$x:e},function(t){return{$x:function(){return t.div(e.toFloat().sqrt().mul(2))}}})}}),Vb=Kd({square_:function(t){var e=qd(t,"x","square");return md.engine.runKernel(function(t){return t.square(e)},{$x:e},function(t){return{$x:function(){return t.mul(e.toFloat().mul(2))}}})}}),jb=Kd({step_:function(t,e){void 0===e&&(e=0);var n=qd(t,"x","step");return md.engine.runKernel(function(t){return t.step(n,e)},{$x:n},function(t){return{$x:function(){return pm(t)}}})}}),Wb=Kd({tan_:function(t){var e=qd(t,"x","tan");return md.engine.runKernel(function(t){return t.tan(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(e.cos().square())}}})}}),Hb=Kd({tanh_:function(t){var e=qd(t,"x","tanh");return md.engine.runKernel(function(t,n){return n(t.tanh(e))},{$x:e},function(t,e){var n=e[0];return{$x:function(){return tm(1).sub(n.square()).mulStrict(t)}}})}});function qb(t,e,n,r,o,i){var a,s,u=qd(t,"x","batchNorm"),l=qd(e,"mean","batchNorm"),c=qd(n,"variance","batchNorm");return null!=o&&(a=qd(o,"scale","batchNorm")),null!=r&&(s=qd(r,"offset","batchNorm")),Xh(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),Xh(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),Xh(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),null!=a&&Xh(2===a.rank||1===a.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),null!=s&&Xh(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),$b(u,l,c,s,a,i)}function Gb(t,e,n,r,o,i){var a,s,u=qd(t,"x","batchNorm"),l=qd(e,"mean","batchNorm"),c=qd(n,"variance","batchNorm");return null!=o&&(a=qd(o,"scale","batchNorm")),null!=r&&(s=qd(r,"offset","batchNorm")),Xh(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),Xh(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),Xh(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),null!=a&&Xh(3===a.rank||1===a.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),null!=s&&Xh(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),$b(u,l,c,s,a,i)}function Kb(t,e,n,r,o,i){var a,s,u=qd(t,"x","batchNorm"),l=qd(e,"mean","batchNorm"),c=qd(n,"variance","batchNorm");return null!=o&&(a=qd(o,"scale","batchNorm")),null!=r&&(s=qd(r,"offset","batchNorm")),Xh(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),Xh(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),Xh(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),null!=a&&Xh(4===a.rank||1===a.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),null!=s&&Xh(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),$b(u,l,c,s,a,i)}function $b(t,e,n,r,o,i){null==i&&(i=.001);var a,s,u,l=qd(t,"x","batchNorm"),c=qd(e,"mean","batchNorm"),p=qd(n,"variance","batchNorm");return null!=o&&(a=qd(o,"scale","batchNorm")),null!=r&&(s=qd(r,"offset","batchNorm")),Xh(c.rank===p.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),Xh(null==s||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),Xh(null==a||c.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===l.rank||1===l.rank?l.as4D(1,1,1,l.size):2===l.rank?l.as4D(1,1,l.shape[0],l.shape[1]):3===l.rank?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l,md.engine.runKernel(function(t){return t.batchNormalization(u,Xb(c),Xb(p),i,Xb(a),Xb(s))},{$x:l,$mean:c,$variance:p,$scale:a,$offset:s},function(t){var e=null==a?tm(1):a,n=Im(c.shape,u.shape),r=[];if(1===c.rank){for(var o=0;o<u.shape.length-1;++o)r.push(u.shape[o]);r.push(1)}var s=l.sub(c),h=t.mul(e),f=Mb(p.add(tm(i))),d=f.mul(f).mul(f).mul(tm(-.5));return{$x:function(){return 1===c.rank?t.mul(ab(f.as4D(1,1,1,c.shape[0]),r)).mul(e).reshape(l.shape):t.mul(f).mul(e).reshape(l.shape)},$mean:function(){var t=f.mul(tm(-1)).mul(h);return 1===c.rank&&(t=t.sum(n)),t.reshape(c.shape)},$variance:function(){var t=d.mul(s).mul(h);return 1===c.rank&&(t=t.sum(n)),t.reshape(c.shape)},$scale:function(){var e=s.mul(f),r=t.mul(e);return 1===c.rank&&(r=r.sum(n)),r.reshape(c.shape)},$offset:function(){var e=t;return 1===c.rank&&(e=e.sum(n)),e.reshape(c.shape)}}}).reshape(l.shape)}function Xb(t){return null==t?null:0===t.rank?t.as1D():1===t.rank?t:2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}function Zb(){dd("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Yb=Kd({batchNormalization2d_:function(t,e,n,r,o,i){return void 0===r&&(r=.001),Zb(),qb(t,e,n,i,o,r)}}),Qb=Kd({batchNormalization3d_:function(t,e,n,r,o,i){return void 0===r&&(r=.001),Zb(),Gb(t,e,n,i,o,r)}}),Jb=Kd({batchNormalization4d_:function(t,e,n,r,o,i){return void 0===r&&(r=.001),Zb(),Kb(t,e,n,i,o,r)}}),tw=Kd({batchNormalization_:function(t,e,n,r,o,i){return void 0===r&&(r=.001),Zb(),$b(t,e,n,i,o,r)}}),ew=Kd({batchNorm_:$b}),nw=Kd({batchNorm2d_:qb}),rw=Kd({batchNorm3d_:Gb}),ow=Kd({batchNorm4d_:Kb});function iw(t,e,n,r,o,i,a){void 0===a&&(a="channelsLast");var s,u=uw(e),l=u[0],c=u[1];if("channelsLast"===a)s=[l,c,t[3],t[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);s=[l,c,t[1],t[1]]}return aw(t,s,n,r,o,i,!1,a)}function aw(t,e,n,r,o,i,a,s){void 0===a&&(a=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],p=u[2],h=u[3];if("channelsLast"===s)l=t[0],c=t[1],p=t[2],h=t[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);l=t[0],h=t[1],c=t[2],p=t[3]}var f,d=e[0],m=e[1],g=e[3],v=uw(n),y=v[0],b=v[1],w=uw(r),x=w[0],S=w[1],C=cw(d,x),E=cw(m,S),N=function(t,e,n,r,o,i,a,s){var u,l,c;if("number"==typeof t){u={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};var p=function(t,e,n,r,o,i){null==o&&(o=function(t,e,n,r){void 0===r&&(r=1);var o=cw(e,r);return Math.floor((t[0]*(n-1)-n+o)/2)}(t,e,r));var a=t[1],s=pw((t[0]-e+2*o)/r+1,i);Xh(ef(s),function(){return"The output # of rows ("+s+") must be an integer. Change the stride and/or zero pad parameters"});var u=pw((a-e+2*o)/r+1,i);return Xh(ef(u),function(){return"The output # of columns ("+u+") must be an integer. Change the stride and/or zero pad parameters"}),[s,u,1]}([e,n,1],i,0,r,t,s);l=p[0],c=p[1]}else if("same"===t){l=Math.ceil(e/r),c=Math.ceil(n/o);var h=Math.max(0,(l-1)*r+i-e),f=Math.max(0,(c-1)*o+a-n),d=Math.floor(h/2),m=h-d,g=Math.floor(f/2);u={top:d,bottom:m,left:g,right:f-g,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);u={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/r),c=Math.ceil((n-a+1)/o)}return{padInfo:u,outHeight:l,outWidth:c}}(o,c,p,y,b,C,E,i),_=N.outHeight,I=N.outWidth,T=a?g*h:g;return"channelsFirst"===s?f=[l,T,_,I]:"channelsLast"===s&&(f=[l,_,I,T]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:p,inChannels:h,outHeight:_,outWidth:I,outChannels:T,padInfo:N.padInfo,strideHeight:y,strideWidth:b,filterHeight:d,filterWidth:m,effectiveFilterHeight:C,effectiveFilterWidth:E,dilationHeight:x,dilationWidth:S,inShape:t,outShape:f,filterShape:e}}function sw(t,e,n,r,o,i,a){void 0===i&&(i=!1),void 0===a&&(a="channelsLast");var s=[-1,-1,-1,-1,-1],u=s[0],l=s[1],c=s[2],p=s[3],h=s[4];if("channelsLast"===a)u=t[0],l=t[1],c=t[2],p=t[3],h=t[4];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);u=t[0],h=t[1],l=t[2],c=t[3],p=t[4]}var f,d=e[0],m=e[1],g=e[2],v=e[4],y=lw(n),b=y[0],w=y[1],x=y[2],S=lw(r),C=S[0],E=S[1],N=S[2],_=function(t,e,n,r,o,i,a,s,u,l){var c,p,h,f;if("same"===t){var d=((p=Math.ceil(e/o))-1)*o+s-e,m=((h=Math.ceil(n/i))-1)*i+u-n,g=((f=Math.ceil(r/a))-1)*a+l-r,v=Math.floor(d/2),y=d-v,b=Math.floor(m/2),w=m-b,x=Math.floor(g/2);c={top:b,bottom:w,left:x,right:g-x,front:v,back:y,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);c={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((e-s+1)/o),h=Math.ceil((n-u+1)/i),f=Math.ceil((r-l+1)/a)}return{padInfo:c,outDepth:p,outHeight:h,outWidth:f}}(o,l,c,p,b,w,x,cw(d,C),cw(m,E),cw(g,N)),I=_.outDepth,T=_.outHeight,A=_.outWidth,k=i?v*h:v;return"channelsFirst"===a?f=[u,k,I,T,A]:"channelsLast"===a&&(f=[u,I,T,A,k]),{batchSize:u,dataFormat:a,inDepth:l,inHeight:c,inWidth:p,inChannels:h,outDepth:I,outHeight:T,outWidth:A,outChannels:k,padInfo:_.padInfo,strideDepth:b,strideHeight:w,strideWidth:x,filterDepth:d,filterHeight:m,filterWidth:g,dilationDepth:C,dilationHeight:E,dilationWidth:N,inShape:t,outShape:f,filterShape:e}}function uw(t){return"number"==typeof t?[t,t]:t}function lw(t){return"number"==typeof t?[t,t,t]:t}function cw(t,e){return e<=1?t:t+(t-1)*(e-1)}function pw(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}function hw(t){var e=uw(t);return 1===e[0]&&1===e[1]}function fw(t,e){return hw(t)||hw(e)}function dw(t,e,n,r,o,i){Xh(t.length===e.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"});var a=t,s=e,u=!1;3===e.rank&&(u=!0,s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,t[0],t[1],t[2]]);var l=a[3],c=s.shape[3];Xh(4===a.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."}),Xh(4===s.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+s.rank}),Xh(4===n.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}),Xh(l===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."}),Xh(c===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[3]+"."}),null!=i&&Xh(ef(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var p=aw(a,n.shape,r,1,o,i),h=md.engine.runKernel(function(t){return t.conv2dDerInput(s,n,p)},{dy4D:s,filter:n},function(t){return{dy4D:function(){return yw(t,n,r,o,"NHWC",1,i)},filter:function(){return ww(t,s,n.shape,r,o,i)}}});return u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function mw(t,e,n,r,o,i){var a=t;3===t.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var s=e;3===s.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),Xh(4===a.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."}),Xh(4===s.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+s.shape+"."}),Xh(4===n.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}),Xh(a.shape[3]===n[2],function(){return"Error in conv2dDerFilter: depth of input "+a.shape[3]+") must match input depth in filter ("+n[2]+"."}),Xh(s.shape[3]===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+s.shape[3]+") must match output depth for filter ("+n[3]+")."}),null!=i&&Xh(ef(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var u=aw(a.shape,n,r,1,o,i);return md.engine.runKernel(function(t){return t.conv2dDerFilter(a,s,u)},{x4D:a,dy4D:s})}function gw(t){var e=function(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}(t);return 1===e[0]&&1===e[1]&&1===e[2]}var vw=Kd({conv1d_:function(t,e,n,r,o,i,a){void 0===o&&(o="NWC"),void 0===i&&(i=1);var s=qd(t,"x","conv1d"),u=qd(e,"filter","conv1d"),l=s,c=!1;2===s.rank&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),Xh(3===l.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),Xh(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=a&&Xh(ef(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),Xh(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),Xh(fw(n,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+i+"'"}),Xh("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var p=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),h=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),f=yw(h,p,[1,n],r,"NHWC",[1,i],a);return c?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}}),yw=Kd({conv2d_:function(t,e,n,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=qd(t,"x","conv2d"),u=qd(e,"filter","conv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),Xh(4===l.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),Xh(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=a&&Xh(ef(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),Xh(l.shape[3]===u.shape[2],function(){return"Error in conv2d: depth of input ("+l.shape[3]+") must match input depth for filter "+u.shape[2]+"."}),Xh(fw(n,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),Xh("NHWC"===o,function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."});var p=aw(l.shape,u.shape,n,i,r,a),h=md.engine.runKernel(function(t){return t.conv2d(l,u,p)},{x:l,$filter:u},function(t){return Xh(hw(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return dw(l.shape,t,u,n,r)},$filter:function(){return mw(l,t,u.shape,n,r)}}});return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),bw=Kd({conv3d_:function(t,e,n,r,o,i){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1,1]);var a=qd(t,"x","conv3d"),s=qd(e,"filter","conv3d"),u=a,l=!1;4===a.rank&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),Xh(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),Xh(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),Xh(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),Xh(function(t,e){return gw(n)||gw(e)}(0,i),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),Xh("NHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NHWC is currently supported."});var c=sw(u.shape,s.shape,n,i,r),p=md.engine.runKernel(function(t){return t.conv3d(u,s,c)},{x:u,$filter:s},function(t){return Xh(gw(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return function(t,e,n,r,o){Xh(t.length===e.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"});var i=t,a=e,s=!1;4===e.rank&&(s=!0,a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),i=[1,t[0],t[1],t[2],t[3]]);var u=i[4],l=a.shape[4];Xh(5===i.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),Xh(5===a.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),Xh(5===n.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),Xh(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),Xh(l===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[4]+"."});var c=sw(i,n.shape,r,1,o),p=md.engine.runKernel(function(t){return t.conv3dDerInput(a,n,c)},{dy5D:a});return s?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}(u.shape,t,s,n,r)},$filter:function(){return function(t,e,n,r,o){var i=u;4===u.rank&&(i=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]));var a=e;4===a.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3])),Xh(5===i.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+i.shape+"."}),Xh(5===a.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+a.shape+"."}),Xh(5===n.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."}),Xh(i.shape[4]===n[3],function(){return"Error in conv3dDerFilter: depth of input "+i.shape[4]+") must match input depth in filter ("+n[3]+"."}),Xh(a.shape[4]===n[4],function(){return"Error in conv3dDerFilter: depth of dy ("+a.shape[4]+") must match output depth for filter ("+n[4]+")."});var s=sw(i.shape,n,r,1,o);return md.engine.runKernel(function(t){return t.conv3dDerFilter(i,a,s)},{x5D:i,dy5D:a})}(0,t,s.shape,n,r)}}});return l?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),ww=Kd({conv2dDerFilter_:mw}),xw=Kd({depthwiseConv2d_:function(t,e,n,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=qd(t,"x","depthwiseConv2d"),u=qd(e,"filter","depthwiseConv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),Xh(4===l.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),Xh(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),Xh(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==i&&(i=[1,1]),Xh(fw(n,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),null!=a&&Xh(ef(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var p=aw(l.shape,u.shape,n,i,r,a,!0),h=md.engine.runKernel(function(t){return t.depthwiseConv2D(l,u,p)},{x:l,$filter:u},function(t){return Xh(hw(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"}),{x:function(){return function(t,e,n,r){var o=e,i=!1;3===e.rank&&(i=!0,o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=md.engine.runKernel(function(t){return t.depthwiseConv2DDerInput(o,n,r)},{dy4D:o});return i?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}(0,t,u,p)},$filter:function(){return function(t,e,n,r){var o=l;3===l.rank&&(o=l.as4D(1,l.shape[0],l.shape[1],l.shape[2]));var i=e;return 3===i.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),md.engine.runKernel(function(t){return t.depthwiseConv2DDerFilter(o,i,r)},{x4D:o,dy4D:i})}(0,t,0,p)}}});return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),Sw=Kd({separableConv2d_:function(t,e,n,r,o,i,a){void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC");var s=qd(t,"x","separableConv2d"),u=qd(e,"depthwiseFilter","separableConv2d"),l=qd(n,"pointwiseFilter","separableConv2d"),c=s,p=!1;if(3===s.rank&&(p=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Xh(4===c.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),Xh(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),Xh(4===l.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),Xh(1===l.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),Xh(1===l.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var h=u.shape[2],f=u.shape[3];Xh(l.shape[2]===h*f,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+h*f+", but got "+l.shape[2]+"."});var d=xw(c,u,r,o,a,i),m=yw(d,l,1,"valid",a);return p?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),Cw=Kd({conv2dTranspose_:function(t,e,n,r,o,i){return dw(n,qd(t,"x","conv2dTranspose"),qd(e,"filter","conv2dTranspose"),r,o,i)}}),Ew=Kd({matMul_:function(t,e,n,r){var o;void 0===n&&(n=!1),void 0===r&&(r=!1);var i=qd(t,"a","matMul"),a=qd(e,"b","matMul");o=Jf(i,a),i=o[0],a=o[1];var s=n?i.shape[i.rank-2]:i.shape[i.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],l=n?i.shape[i.rank-1]:i.shape[i.rank-2],c=r?a.shape[a.rank-2]:a.shape[a.rank-1],p=i.shape.slice(0,-2),h=a.shape.slice(0,-2),f=Jh(p),d=Jh(h);Xh(i.rank>=2&&a.rank>=2&&i.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+a.rank+"."}),Xh(tf(p,h),function(){return"Error in matMul: outer dimensions ("+p+") and ("+h+") of Tensors with shapes "+i.shape+" and "+a.shape+" must match."}),Xh(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+a.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var m=i.shape.slice(0,-2).concat([l,c]),g=n?i.as3D(f,s,l):i.as3D(f,l,s),v=r?a.as3D(d,c,u):a.as3D(d,u,c);return md.engine.runKernel(function(t){return t.batchMatMul(g,v,n,r)},{$a:g,$b:v},function(t){return n||r?!n&&r?{$a:function(){return t.matMul(v,!1,!1)},$b:function(){return t.matMul(g,!0,!1)}}:n&&!r?{$a:function(){return v.matMul(t,!1,!0)},$b:function(){return g.matMul(t,!1,!1)}}:{$a:function(){return v.matMul(t,!0,!0)},$b:function(){return t.matMul(g,!0,!0)}}:{$a:function(){return t.matMul(v,!1,!0)},$b:function(){return g.matMul(t,!0,!1)}}}).reshape(m)}}),Nw=Kd({dot_:function(t,e){var n=qd(t,"t1","dot"),r=qd(e,"t2","dot");Xh(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var o=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];return Xh(o===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."}),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),_w=Kd({outerProduct_:function(t,e){var n=qd(t,"v1","outerProduct"),r=qd(e,"v2","outerProduct");return Xh(1===n.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),Iw=Kd({reverse_:function(t,e){var n=qd(t,"x","reverse");if(0===n.rank)return n.clone();var r=uf(e,n.shape);return md.engine.runKernel(function(t){return t.reverse(n,r)},{$x:n},function(t){return{$x:function(){return t.reverse(r)}}}).reshapeAs(n)}}),Tw=Kd({reverse1d_:function(t){var e=qd(t,"x","reverse");return Xh(1===e.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),Iw(e,0)}}),Aw=Kd({reverse2d_:function(t,e){var n=qd(t,"x","reverse");return Xh(2===n.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),Iw(n,e)}}),kw=Kd({reverse3d_:function(t,e){var n=qd(t,"x","reverse");return Xh(3===n.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),Iw(n,e)}}),Rw=Kd({reverse4d_:function(t,e){var n=qd(t,"x","reverse");return Xh(4===n.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),Iw(n,e)}});function Ow(t,e,n,r,o,i){var a=qd(t,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),null==r&&(r=[1,1]),Xh(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),Xh(fw(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),null!=i&&Xh(ef(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var l=iw(s.shape,e,n,r,o,i),c=md.engine.runKernel(function(t,e){return e(t.maxPool(s,l))},{x:s},function(t,i){var a=i[0];return{x:function(){return function(t,e,n,r,o,i,a,s){var u=qd(t,"dy","maxPoolBackprop"),l=qd(e,"input","maxPoolBackprop"),c=qd(n,"output","maxPoolBackprop");Xh(l.rank===u.rank,function(){return"Rank of input ("+l.rank+") does not match rank of dy ("+u.rank+")"}),null==i&&(i=[1,1]),Xh(fw(o,i),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"}),Xh(4===u.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."}),Xh(4===l.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+l.rank+"."});var p=iw(l.shape,r,o,i,a,void 0);return md.engine.runKernel(function(t){return t.maxPoolBackprop(u,l,c,p)},{$dy:u,$input:l})}(t,s,a,e,n,r,o)}}});return u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function Dw(t,e,n,r,o,i){var a=qd(t,"x","avgPool","float32");null==r&&(r=[1,1]),Xh(fw(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),Xh(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=i&&Xh(ef(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var l=iw(s.shape,e,n,r,o,i),c=md.engine.runKernel(function(t){return t.avgPool(s,l)},{x:s},function(t){return{x:function(){return function(t,e,n,r,o,i){var a=qd(t,"dy","avgPoolBackprop"),s=qd(e,"input","avgPoolBackprop");Xh(s.rank===a.rank,function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+a.rank+")"}),null==o&&(o=[1,1]),Xh(fw(r,o),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"});var u=s,l=a,c=!1;3===s.rank&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),l=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),Xh(4===l.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."}),Xh(4===u.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."});var p=iw(u.shape,n,r,o,i),h=md.engine.runKernel(function(t){return t.avgPoolBackprop(l,u,p)},{dy4D:l,input4D:u});return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}(t,s,e,n,r,o)}}});return c=c.cast(a.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var Mw=Kd({maxPool_:function(t,e,n,r,o){return Ow(t,e,n,1,r,o)}}),Pw=Kd({avgPool_:function(t,e,n,r,o){return Dw(t,e,n,1,r,o)}}),Lw=Kd({pool_:function(t,e,n,r,o,i){null==o&&(o=[1,1]),null==i&&(i=1),0===r&&(r="valid");var a=qd(t,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),Xh(fw(i,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"});var l,c=iw(s.shape,e,i,o,r),p=[c.dilationHeight,c.dilationWidth];l="same"===r?function(t,e){var n=[c.filterHeight,c.filterWidth].map(function(t,n){return t+(t-1)*(e[n]-1)}).map(function(t){return t-1}),r=n.map(function(t){return Math.floor(t/2)}),o=n.map(function(t,e){return t-r[e]});return n.map(function(t,e){return[r[e],o[e]]})}(0,p):[[0,0],[0,0]];var h=1===p[0]&&1===p[1],f=function(t,e,n){var r=n.map(function(t){return t[0]}),o=n.map(function(t){return t[1]}),i=t.concat(r,o),a=e.map(function(t,e){return(t-i[e]%t)%t}),s=o.map(function(t,e){return t+a[e]});return[e.map(function(t,e){return[r[e],s[e]]}),e.map(function(t,e){return[0,a[e]]})]}([c.inHeight,c.inWidth],p,l),d=f[1],m=h?r:"valid",g=h?s:rb(s,p,f[0]),v=("avg"===n?function(){return Dw(g,e,i,1,m)}:function(){return Ow(g,e,i,1,m)})(),y=h?v:By(v,p,d);return u?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),Fw=Kd({slice_:function(t,e,n){var r,o,i=qd(t,"x","slice");if(0===i.rank)throw new Error("Slicing scalar is not possible");r="number"==typeof e?[e].concat(new Array(i.rank-1).fill(0)):e.length<i.rank?e.concat(new Array(i.rank-e.length).fill(0)):e.slice(),o=(o=null==n?new Array(i.rank).fill(-1):"number"==typeof n?[n].concat(new Array(i.rank-1).fill(-1)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(-1)):n).map(function(t,e){return t>=0?t:(Xh(-1===t,function(){return"Bad value in size"}),i.shape[e]-r[e])}),function(t,e,n){Xh(t.rank===e.length,function(){return"Error in slice"+t.rank+"D: Length of begin "+e+" must match the rank of the array ("+t.rank+")."}),Xh(t.rank===n.length,function(){return"Error in slice"+t.rank+"D: Length of size "+n+" must match the rank of the array ("+t.rank+")."});for(var r=function(r){Xh(e[r]+n[r]<=t.shape[r],function(){return"Error in slice"+t.rank+"D: begin["+r+"] + size["+r+"] ("+(e[r]+n[r])+") would overflow input.shape["+r+"] ("+t.shape[r]+")"})},o=0;o<t.rank;++o)r(o)}(i,r,o);var a=i.shape;return md.engine.runKernel(function(t){return t.slice(i,r,o)},{$x:i},function(t){for(var e=[],n=0;n<t.rank;n++)e.push([r[n],a[n]-r[n]-o[n]]);return{$x:function(){return t.pad(e)}}})}}),zw=Kd({slice1d_:function(t,e,n){var r=qd(t,"x","slice1d");return Xh(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Fw(r,[e],[n])}}),Bw=Kd({slice2d_:function(t,e,n){var r=qd(t,"x","slice2d");return Xh(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Fw(r,e,n)}}),Uw=Kd({slice3d_:function(t,e,n){var r=qd(t,"x","slice3d");return Xh(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Fw(r,e,n)}}),Vw=Kd({slice4d_:function(t,e,n){var r=qd(t,"x","slice4d");return Xh(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Fw(r,e,n)}});function jw(t,e,n,r,o){var i=e[0];return i.rank<n.rank&&(i=i.reshape(Td(i.shape,r))),t.rank<n.rank&&(t=t.reshape(Td(t.shape,r))),{$x:function(){var e=t.mul(n.equal(i).cast(t.dtype));return null==o?e:e.transpose(o)}}}var Ww=Kd({all_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=qd(t,"x","all","bool"),o=uf(e,r.shape),i=o,a=kd(i,r.rank);null!=a&&(r=r.transpose(a),i=Od(i.length,r.rank));var s=md.engine.runKernel(function(t){return t.all(r,i)},{$x:r});if(n){var u=Td(s.shape,o);return s.reshape(u)}return s}}),Hw=Kd({any_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=qd(t,"x","any","bool"),o=uf(e,r.shape),i=o,a=kd(i,r.rank);null!=a&&(r=r.transpose(a),i=Od(i.length,r.rank));var s=md.engine.runKernel(function(t){return t.any(r,i)},{$x:r});if(n){var u=Td(s.shape,o);return s.reshape(u)}return s}}),qw=Kd({argMax_:function(t,e){void 0===e&&(e=0);var n=qd(t,"x","argMax");null==e&&(e=0);var r=uf(e,n.shape),o=kd(r,n.rank);return null!=o&&(n=n.transpose(o),r=Od(r.length,n.rank)),md.engine.runKernel(function(t){return t.argMax(n,r[0])},{$x:n},function(t){return{$x:function(){return pm(n)}}})}}),Gw=Kd({argMin_:function(t,e){void 0===e&&(e=0);var n=qd(t,"x","argMin");null==e&&(e=0);var r=uf(e,n.shape),o=kd(r,n.rank);return null!=o&&(n=n.transpose(o),r=Od(r.length,n.rank)),md.engine.runKernel(function(t){return t.argMin(n,r[0])},{$x:n},function(t){return{$x:function(){return pm(n)}}})}}),Kw=Kd({logSumExp_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=qd(t,"x","logSumExp"),o=uf(e,r.shape),i=r.max(o,!0),a=r.sub(i).exp().sum(o).log(),s=i.reshape(a.shape).add(a);if(n){var u=Td(s.shape,o);return s.reshape(u)}return s}}),$w=Kd({max_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=qd(t,"x","max"),o=r,i=uf(e,r.shape),a=i,s=kd(a,r.rank);null!=s&&(r=r.transpose(s),a=Od(a.length,r.rank));var u=md.engine.runKernel(function(t,e){return e(t.max(r,a))},{$x:r},function(t,e){return jw(t,e,o,i,s)});if(n){var l=Td(u.shape,i);u=u.reshape(l)}return u}}),Xw=Kd({mean_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=qd(t,"x","mean"),o=uf(e,r.shape),i=Jh(Id(r.shape,o)[1]);return gd(function(t){var r=tm(i);return{value:(r.dtype===t.dtype?t:t.cast(r.dtype)).div(r).sum(e,n),gradFunc:function(e){var n=t.shape.slice();return o.forEach(function(t){n[t]=1}),e.reshape(n).mul(im(t.shape,"float32")).div(r)}}})(r)}}),Zw=Kd({min_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=qd(t,"x","min"),o=r,i=uf(e,r.shape),a=i,s=kd(a,r.rank);null!=s&&(r=r.transpose(s),a=Od(a.length,r.rank));var u=md.engine.runKernel(function(t,e){return e(t.min(r,a))},{$x:r},function(t,e){return jw(t,e,o,i,s)});if(n){var l=Td(u.shape,i);u=u.reshape(l)}return u}}),Yw=Kd({moments_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=uf(e,(t=qd(t,"x","moments")).shape),o=t.mean(r,n),i=o.shape;return n||(i=Td(o.shape,r)),{mean:o,variance:t.toFloat().sub(o.reshape(i)).square().mean(r,n)}}}),Qw=Kd({sum_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=qd(t,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=uf(e,r.shape);return gd(function(t){var e=kd(o,t.rank),r=o,i=t;null!=e&&(i=t.transpose(e),r=Od(r.length,t.rank));var a=md.engine.runKernel(function(t){return t.sum(i,r)},{permutedX:i});if(n){var s=Td(a.shape,o);a=a.reshape(s)}return{value:a,gradFunc:function(e){var n=t.shape.slice();return o.forEach(function(t){n[t]=1}),e.reshape(n).mul(im(t.shape,"float32"))}}})(r)}}),Jw=Kd({prod_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=qd(t,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=uf(e,r.shape),i=kd(o,r.rank),a=o,s=r;null!=i&&(s=r.transpose(i),a=Od(a.length,r.rank));var u=md.engine.runKernel(function(t){return t.prod(s,a)},{permutedX:s});if(n){var l=Td(u.shape,o);u=u.reshape(l)}return u}}),tx=Kd({equal_:function(t,e){var n,r=qd(t,"a","equal"),o=qd(e,"b","equal");return n=Jf(r,o),Tm((r=n[0]).shape,(o=n[1]).shape),md.engine.runKernel(function(t){return t.equal(r,o)},{$a:r,$b:o})}}),ex=Kd({equalStrict_:function(t,e){var n=qd(t,"a","equalStrict"),r=qd(e,"b","equalStrict");return Zh(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),nx=Kd({greater_:function(t,e){var n,r=qd(t,"a","greater"),o=qd(e,"b","greater");return n=Jf(r,o),Tm((r=n[0]).shape,(o=n[1]).shape),md.engine.runKernel(function(t){return t.greater(r,o)},{$a:r,$b:o})}}),rx=Kd({greaterEqual_:function(t,e){var n,r=qd(t,"a","greaterEqual"),o=qd(e,"b","greaterEqual");return n=Jf(r,o),Tm((r=n[0]).shape,(o=n[1]).shape),md.engine.runKernel(function(t){return t.greaterEqual(r,o)},{$a:r,$b:o},function(t){return{$a:function(){return pm(r)},$b:function(){return pm(o)}}})}}),ox=Kd({greaterEqualStrict_:function(t,e){var n=qd(t,"a","greaterEqualStrict"),r=qd(e,"b","greaterEqualStrict");return Zh(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),ix=Kd({greaterStrict_:function(t,e){var n=qd(t,"a","greaterStrict"),r=qd(e,"b","greaterStrict");return Zh(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),ax=Kd({less_:function(t,e){var n,r=qd(t,"a","less"),o=qd(e,"b","less");return n=Jf(r,o),Tm((r=n[0]).shape,(o=n[1]).shape),md.engine.runKernel(function(t){return t.less(r,o)},{$a:r,$b:o})}}),sx=Kd({lessEqual_:function(t,e){var n,r=qd(t,"a","lessEqual"),o=qd(e,"b","lessEqual");return n=Jf(r,o),Tm((r=n[0]).shape,(o=n[1]).shape),md.engine.runKernel(function(t){return t.lessEqual(r,o)},{$a:r,$b:o})}}),ux=Kd({lessEqualStrict_:function(t,e){var n=qd(t,"a","lessEqualStrict"),r=qd(e,"b","lessEqualStrict");return Zh(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),lx=Kd({lessStrict_:function(t,e){var n=qd(t,"a","lessStrict"),r=qd(e,"b","lessStrict");return Zh(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),cx=Kd({notEqual_:function(t,e){var n,r=qd(t,"a","notEqual"),o=qd(e,"b","notEqual");return n=Jf(r,o),Tm((r=n[0]).shape,(o=n[1]).shape),md.engine.runKernel(function(t){return t.notEqual(r,o)},{$a:r,$b:o})}}),px=Kd({notEqualStrict_:function(t,e){var n=qd(t,"a","notEqualStrict"),r=qd(e,"b","notEqualStrict");return Zh(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}}),hx=Kd({add_:function(t,e){var n,r=qd(t,"a","add"),o=qd(e,"b","add");n=Jf(r,o);var i=Tm((r=n[0]).shape,(o=n[1]).shape);return md.engine.runKernel(function(t){return t.add(r,o)},{$a:r,$b:o},function(t){return{$a:function(){var e=t,n=Im(r.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},$b:function(){var e=t,n=Im(o.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(o.shape)}}})}}),fx=Kd({addN_:function(t){Xh(Array.isArray(t),function(){return"The argument passed to tf.addN() must be a list of tensors"}),Xh(t.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length});var e=t.map(function(t,e){return qd(t,"tensors"+e,"addN")}),n=e[0];return e.forEach(function(t){if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(t){if(!tf(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}),md.engine.runKernel(function(t){return t.addN(e)},e,function(t){var n={};return e.forEach(function(e,r){n[r]=function(){return t.clone()}}),n})}}),dx=Kd({addStrict_:function(t,e){var n=qd(t,"a","addStrict"),r=qd(e,"b","addStrict");return Zh(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),mx=Kd({atan2_:function(t,e){var n,r=qd(t,"a","atan2"),o=qd(e,"b","atan2");n=Jf(r,o);var i=Tm((r=n[0]).shape,(o=n[1]).shape);return md.engine.runKernel(function(t){return t.atan2(r,o)},{$a:r,$b:o},function(t){return{$a:function(){var e=hx(r.square(),o.square()),n=t.mul(o.div(e)),a=Im(r.shape,i);return a.length>0&&(n=n.sum(a)),n.reshape(r.shape)},$b:function(){var e=hx(r.square(),o.square()),n=Rb(t.mul(r.div(e))),a=Im(o.shape,i);return a.length>0&&(n=n.sum(a)),n.reshape(o.shape)}}})}}),gx=Kd({div_:function(t,e){var n,r,o=qd(t,"a","div"),i=qd(e,"b","div");if(n=Jf(o,i),i=n[1],"int32"===(o=n[0]).dtype&&"int32"===i.dtype)return yx(o,i);r=function(t){return t.realDivide(o,i)};var a=Tm(o.shape,i.shape);return md.engine.runKernel(r,{$a:o,$b:i},function(t){return{$a:function(){var e=t.div(i.toFloat()),n=Im(o.shape,a);return n.length>0?e.sum(n).reshape(o.shape):e},$b:function(){var e=t.mul(o.toFloat()),n=Im(i.shape,a);n.length>0&&(e=e.sum(n).reshape(i.shape));var r=i.square();return e.div(r.toFloat()).neg()}}})}}),vx=Kd({divStrict_:function(t,e){var n=qd(t,"a","div"),r=qd(e,"b","div");return Zh(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),yx=Kd({floorDiv_:function(t,e){var n,r=qd(t,"a","floorDiv"),o=qd(e,"b","floorDiv");n=Jf(r,o);var i=Tm((r=n[0]).shape,(o=n[1]).shape);return md.engine.runKernel(function(t){return t.floorDiv(r,o)},{$a:r,$b:o},function(t){return{$a:function(){var e=t.div(o.toFloat()),n=Im(r.shape,i);return n.length>0?e.sum(n).reshape(r.shape):e},$b:function(){var e=t.mul(r.toFloat()),n=Im(o.shape,i);n.length>0&&(e=e.sum(n).reshape(o.shape));var a=o.square();return e.div(a.toFloat()).neg()}}})}}),bx=Kd({maximum_:function(t,e){var n,r=qd(t,"a","maximum"),o=qd(e,"b","maximum");return n=Jf(r,o),o=n[1],"bool"===(r=n[0]).dtype&&(r=r.toInt(),o=o.toInt()),Tm(r.shape,o.shape),md.engine.runKernel(function(t){return t.maximum(r,o)},{$a:r,$b:o},function(t){return{$a:function(){return t.mul(r.greaterEqual(o).toFloat())},$b:function(){return t.mul(r.less(o).toFloat())}}})}}),wx=Kd({maximumStrict_:function(t,e){var n=qd(t,"a","maximumStrict"),r=qd(e,"b","maximumStrict");return Zh(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),xx=Kd({minimum_:function(t,e){var n,r=qd(t,"a","minimum"),o=qd(e,"b","minimum");return n=Jf(r,o),o=n[1],"bool"===(r=n[0]).dtype&&(r=r.toInt(),o=o.toInt()),Tm(r.shape,o.shape),md.engine.runKernel(function(t){return t.minimum(r,o)},{$a:r,$b:o},function(t){return{$a:function(){return t.mul(r.lessEqual(o).toFloat())},$b:function(){return t.mul(r.greater(o).toFloat())}}})}}),Sx=Kd({minimumStrict_:function(t,e){var n=qd(t,"a","minimumStrict"),r=qd(e,"b","minimumStrict");return Zh(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),Cx=Kd({mod_:function(t,e){var n,r=qd(t,"a","mod"),o=qd(e,"b","mod");n=Jf(r,o);var i=Tm((r=n[0]).shape,(o=n[1]).shape);return md.engine.runKernel(function(t){return t.mod(r,o)},{$a:r,$b:o},function(t){return{$a:function(){var e=Im(r.shape,i);return e.length>0?t.sum(e).reshape(r.shape):t},$b:function(){var e=t.mul(r.div(o).floor().neg()),n=Im(o.shape,i);return n.length>0?e.sum(n).reshape(o.shape):e}}})}}),Ex=Kd({modStrict_:function(t,e){var n=qd(t,"a","modStrict"),r=qd(e,"b","modStrict");return Zh(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),Nx=Kd({mul_:function(t,e){var n,r=qd(t,"a","mul"),o=qd(e,"b","mul");n=Jf(r,o);var i=Tm((r=n[0]).shape,(o=n[1]).shape);return md.engine.runKernel(function(t){return t.multiply(r,o)},{$a:r,$b:o},function(t){return{$a:function(){var e=t.mul(o.toFloat()),n=Im(r.shape,i);return n.length>0?e.sum(n).reshape(r.shape):e},$b:function(){var e=t.mul(r.toFloat()),n=Im(o.shape,i);return n.length>0?e.sum(n).reshape(o.shape):e}}})}}),_x=Kd({mulStrict_:function(t,e){var n=qd(t,"a","mul"),r=qd(e,"b","mul");return Zh(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),Ix=Kd({pow_:function(t,e){var n=qd(t,"base","pow"),r=qd(e,"exp","pow"),o=Tm(n.shape,r.shape);return t=n.cast(Yf(n.dtype,r.dtype)),e=r.cast(Yf(n.dtype,r.dtype)),md.engine.runKernel(function(t,e){return e(t.pow(n,r))},{$base:n,$exp:r},function(t,e){var i=e[0];return{$base:function(){var e=r.toFloat(),i=t.mul(e.mul(n.pow(e.sub(tm(1))))),a=Im(n.shape,o);return a.length>0&&(i=i.sum(a)),i.reshape(n.shape)},$exp:function(){var e=n.greater(0),a=n.log().where(e,pm(n)),s=t.mul(i.mul(a)),u=Im(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}})}}),Tx=Kd({powStrict_:function(t,e){return Zh(t.shape,e.shape,"Error in powStrict: "),t.pow(e)}}),Ax=Kd({squaredDifference_:function(t,e){var n,r=qd(t,"a","squaredDifference"),o=qd(e,"b","squaredDifference");return n=Jf(r,o),Tm((r=n[0]).shape,(o=n[1]).shape),md.engine.runKernel(function(t){return t.squaredDifference(r,o)},{$a:r,$b:o},function(t){var e=tm(2);return{$a:function(){return t.mul(r.sub(o).mul(e))},$b:function(){return t.mul(o.sub(r).mul(e))}}})}}),kx=Kd({squaredDifferenceStrict_:function(t,e){var n=qd(t,"a","squaredDifferenceStrict"),r=qd(e,"b","squaredDifferenceStrict");return Zh(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),Rx=Kd({sub_:function(t,e){var n,r=qd(t,"a","sub"),o=qd(e,"b","sub");n=Jf(r,o);var i=Tm((r=n[0]).shape,(o=n[1]).shape);return md.engine.runKernel(function(t){return t.subtract(r,o)},{$a:r,$b:o},function(t){return{$a:function(){var e=t,n=Im(r.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},$b:function(){var e=t,n=Im(o.shape,i);return n.length>0&&(e=e.sum(n)),e.neg().reshape(o.shape)}}})}}),Ox=Kd({subStrict_:function(t,e){var n=qd(t,"a","subStrict"),r=qd(e,"b","subStrict");return Zh(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),Dx=Kd({logicalAnd_:function(t,e){var n=qd(t,"a","logicalAnd","bool"),r=qd(e,"b","logicalAnd","bool");return Tm(n.shape,r.shape),md.engine.runKernel(function(t){return t.logicalAnd(n,r)},{$a:n,$b:r})}}),Mx=Kd({logicalNot_:function(t){var e=qd(t,"x","logicalNot","bool");return md.engine.runKernel(function(t){return t.logicalNot(e)},{$x:e})}}),Px=Kd({logicalOr_:function(t,e){var n=qd(t,"a","logicalOr","bool"),r=qd(e,"b","logicalOr","bool");return Tm(n.shape,r.shape),md.engine.runKernel(function(t){return t.logicalOr(n,r)},{$a:n,$b:r})}}),Lx=Kd({logicalXor_:function(t,e){var n=qd(t,"a","logicalXor","bool"),r=qd(e,"b","logicalXor","bool");return Tm(n.shape,r.shape),Px(t,e).logicalAnd(Dx(t,e).logicalNot())}}),Fx=Kd({where_:function(t,e,n){var r=qd(e,"a","where"),o=qd(n,"b","where"),i=qd(t,"condition","where","bool");return Zh(r.shape,o.shape,"Error in where: "),1===i.rank?Xh(i.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Zh(i.shape,o.shape,"Error in where: "),md.engine.runKernel(function(t){return t.select(i,r,o)},{$condition:i,$a:r,$b:o},function(t){return{$condition:function(){return pm(i).toFloat()},$a:function(){return t.mul(i.cast(t.dtype))},$b:function(){return t.mul(i.logicalNot().cast(t.dtype))}}})}}),zx=function(t){return Bh(this,void 0,void 0,function(){var e,n,r;return Uh(this,function(o){switch(o.label){case 0:return[4,(e=qd(t,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=cb(e.shape,n),t!==e&&e.dispose(),[2,r]}})})},Bx=Kd({elu_:function(t){var e=qd(t,"x","elu");return md.engine.runKernel(function(t,n){return n(t.elu(e))},{$x:e},function(t,e){var n=e[0];return{$x:function(){return md.engine.runKernel(function(e){return e.eluDer(t,n)},{dy:t,y:n})}}})}}),Ux=Kd({leakyRelu_:function(t,e){void 0===e&&(e=.2);var n=qd(t,"x","leakyRelu");return bx(tm(e).mul(n),n)}}),Vx=Kd({prelu_:function(t,e){var n=qd(t,"x","prelu"),r=qd(e,"alpha","prelu");return md.engine.runKernel(function(t){return t.prelu(n,r)},{$x:n,$alpha:r},function(t){var e=n.greater(0);return{$x:function(){return Fx(e,t,t.mul(r))},$alpha:function(){var o=Fx(e,pm(t),t.mul(n)),i=Im(r.shape,t.shape);return i.length>0&&(o=o.sum(i)),o.reshape(r.shape)}}})}}),jx=Kd({relu_:function(t){var e=qd(t,"x","relu");return"bool"===e.dtype?e.toInt():md.engine.runKernel(function(t){return t.relu(e)},{$x:e},function(t){var n=e.step();return{$x:function(){return t.mulStrict(n.toFloat())}}})}}),Wx=Kd({selu_:function(t){var e=qd(t,"x","selu");return md.engine.runKernel(function(t){return t.selu(e)},{$x:e},function(t){return{$x:function(){var n=e.greater(tm(0)),r=tm(1.7580993408473768),o=tm(1.0507009873554805),i=t.mul(o),a=t.mul(r).mul(e.toFloat().exp());return Fx(n,i,a)}}})}}),Hx=Kd({transpose_:function(t,e){var n=qd(t,"x","transpose");return null==e&&(e=n.shape.map(function(t,e){return e}).reverse()),Xh(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+e+"."}),e.forEach(function(t){Xh(t>=0&&t<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+e})}),n.rank<=1?n.clone():md.engine.runKernel(function(t){return t.transpose(n,e)},{$x:n},function(t){var n=Rd(e);return{$x:function(){return t.transpose(n)}}})}}),qx=Kd({localResponseNormalization_:function(t,e,n,r,o){void 0===e&&(e=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===o&&(o=.5);var i=qd(t,"x","localResponseNormalization");Xh(4===i.rank||3===i.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+i.rank+"."}),Xh(ef(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var a=i,s=!1;3===i.rank&&(s=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=md.engine.runKernel(function(t,i){return i(t.localResponseNormalization4D(a,e,n,r,o))},{x4D:a},function(t,i){var s=i[0];return{x4D:function(){return md.engine.runKernel(function(i){return i.LRNGrad(t,a,s,e,n,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Gx=Kd({norm_:function(t,e,n,r){void 0===e&&(e="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var o=function t(e,n,r){if(void 0===r&&(r=null),0===e.rank)return e.abs();if(1!==e.rank&&null===r)return t(e.reshape([-1]),n,r);if(1===e.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return e.abs().sum(r);if(n===1/0)return e.abs().max(r);if(n===-1/0)return e.abs().min(r);if("euclidean"===n||2===n)return e.abs().pow(tm(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return e.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return e.abs().sum(r[1]).max(r[0]);if(n===-1/0)return e.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return e.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(t=qd(t,"x","norm"),e,n),i=o.shape;if(r){var a=uf(n,t.shape);i=Td(o.shape,a)}return o.reshape(i)}});function Kx(t,e){for(var n=[],r=t;r<e;++r)n.push(r);return n}function $x(t){for(var e=[],n=0;n<t.length;++n)for(var r=0;r<t[n].length;++r)e.push(t[n][r]);return e}var Xx,Zx=Kd({gather_:function(t,e,n){void 0===n&&(n=0);var r=qd(t,"x","gather"),o=qd(e,"indices","gather","int32");n=uf(n,r.shape)[0];var i=function(t,e,n){for(var r=t.shape[n],o=[],i=1,a=1,s=0;s<n;s++)o.push(t.shape[s]),i*=t.shape[s];for(s=0;s<e.rank;s++)o.push(e.shape[s]);for(s=n+1;s<t.rank;s++)o.push(t.shape[s]),a*=t.shape[s];return{batchSize:i,sliceSize:a,dimSize:r,outputShape:o}}(r,o,n);return md.engine.runKernel(function(t){return t.gather(r,o.flatten(),n)},{$x:r},function(t){return{$x:function(){var e=r.shape,i=o.size,a=e.slice(0,n),s=a.length,u=e.slice(n,e.length).slice(1),l=u.length,c=Kx(0,s),p=Kx(s+1,s+1+l),h=$x([a,[i],u]),f=t.reshape(h),d=o.reshape([i]),m=$x([[s],c,p]),g=f.transpose(m),v=Yx(g,d,r.shape[n]),y=Rd(m);return v.transpose(y)}}}).reshape(i.outputShape)}}),Yx=Kd({unsortedSegmentSum_:function(t,e,n){var r=qd(t,"x","unsortedSegmentSum"),o=qd(e,"segmentIds","unsortedSegmentSum","int32");return Xh(ef(n),function(){return"numSegments must be of dtype int"}),md.engine.runKernel(function(t){return t.unsortedSegmentSum(r,o,n)},{$x:r},function(t){return{$x:function(){return function(t,e){for(var n=bx(e,pm(e)),r=Zx(t,n),o=rx(e,tm(0,"int32")),i=r.rank-o.rank,a=0;a<i;++a)o=Hy(o,a+1);o=Dx(o,im(r.shape,"bool"));var s=pm(r);return Fx(o,r,s)}(t,o)}}})}}),Qx=Kd({basicLSTMCell_:function(t,e,n,r,o,i){var a=qd(t,"forgetBias","basicLSTMCell"),s=qd(e,"lstmKernel","basicLSTMCell"),u=qd(n,"lstmBias","basicLSTMCell"),l=qd(r,"data","basicLSTMCell"),c=qd(o,"c","basicLSTMCell"),p=qd(i,"h","basicLSTMCell"),h=l.concat(p,1).matMul(s).add(u),f=h.shape[1]/4,d=[h.shape[0],f],m=h.slice([0,0],d),g=h.slice([0,f],d),v=h.slice([0,2*f],d),y=h.slice([0,3*f],d),b=m.sigmoid().mulStrict(g.tanh()).addStrict(c.mulStrict(a.add(v).sigmoid()));return[b,b.tanh().mulStrict(y.sigmoid())]}}),Jx=Kd({multiRNNCell_:function(t,e,n,r){for(var o=qd(e,"data","multiRNNCell"),i=Gd(n,"c","multiRNNCell"),a=Gd(r,"h","multiRNNCell"),s=o,u=[],l=0;l<t.length;l++){var c=t[l](s,i[l],a[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var p=[],h=[];for(l=0;l<u.length;l+=2)p.push(u[l]),h.push(u[l+1]);return[p,h]}}),tS=Kd({movingAverage_:function(t,e,n,r,o){void 0===o&&(o=!0);var i=qd(t,"v","movingAverage"),a=qd(e,"x","movingAverage"),s=qd(n,"decay","movingAverage");(function(t,e){Xh(t.dtype===e.dtype,function(){return"The dtypes of the first("+t.dtype+") and second("+e.dtype+") input must match"})})(i,a),Xh(tf(i.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=tm(1),l=u.sub(s),c=a.sub(i).mul(l);if(o){Xh(null!=r,function(){return"When using zeroDebias: true, step is required."});var p=qd(r,"step","movingAverage");c=c.div(u.sub(Ix(s,p)))}return i.add(c)}}),eS=Kd({stridedSlice_:function(t,e,n,r,o,i,a,s,u){if(void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),0!==a)throw new Error("ellipsis mask is not yet supported");if(0!==s)throw new Error("new axis mask is not yet supported");var l=qd(t,"x","stridedSlice");if(r.every(function(t){return 1===t})){var c=zd(l.shape,e,n,r,o,i,a,s,u),p=c[0],h=c[1],f=c[2],d=h.filter(function(t,e){return-1===f.indexOf(e)});return Fw(l,p,h).reshape(d)}return md.engine.runKernel(function(t){return t.stridedSlice(l,e,n,r,o,i,a,s,u)},{$x:l})}}),nS=Kd({topk_:function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!0);var r=qd(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(e>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+e);var i=md.engine.runKernel(function(t){return t.topk(r,e,n)},{$x:r});return{values:i[0],indices:i[1]}}}),rS=Kd({scatterND_:function(t,e,n){var r=qd(t,"indices","scatterND","int32"),o=qd(e,"updates","scatterND");return function(t,e,n){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==e.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===e.size)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(0===t.size)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}!function(t,e,n){var r=e.rank>1?e.shape[e.rank-1]:1,o=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+e.shape+", shape: "+t+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(i+" update.rank < "+o+". ");if(t.length<r+(n.rank-o))throw new Error(i+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+t.length-r)throw new Error(i+" update.rank != "+(o+t.length-r));for(var a=0;a<o;++a)if(n.shape[a]!==e.shape[a])throw new Error(i+" updates.shape["+a+"] ("+n.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+").");for(a=0;a<n.rank-o;++a)if(n.shape[a+o]!==t[a+r])throw new Error(i+" updates.shape["+(a+o)+"] ("+n.shape[a+o]+") != shape["+(a+o)+"] ("+t[a+o]+")")}(n,e,t)}(o,r,n),md.engine.runKernel(function(t){return t.scatterND(r,o,n)},{$indices:r,$updates:o})}}),oS=Kd({fft_:function(t){Xh("complex64"===t.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+t.dtype+"."});var e=t.shape[t.shape.length-1],n=t.as2D(t.size/e,e);return md.engine.runKernel(function(t){return t.fft(n)},{input:t}).reshape(t.shape)}}),iS=Kd({ifft_:function(t){Xh("complex64"===t.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+t.dtype+"."});var e=t.shape[t.shape.length-1],n=t.as2D(t.size/e,e);return md.engine.runKernel(function(t){return t.ifft(n)},{input:t}).reshape(t.shape)}}),aS=Kd({rfft_:function(t){Xh("float32"===t.dtype,function(){return"The dtype for rfft() must be real value but got "+t.dtype});var e=t.shape[t.shape.length-1],n=t.size/e,r=t.zerosLike(),o=Zd(t,r).as2D(n,e),i=oS(o),a=Math.floor(e/2)+1,s=Yd(i),u=Qd(i),l=s.split([a,e-a],s.shape.length-1),c=u.split([a,e-a],u.shape.length-1),p=t.shape.slice();return p[t.shape.length-1]=a,Zd(l[0],c[0]).reshape(p)}}),sS=Kd({irfft_:function(t){var e=t.shape[t.shape.length-1],n=t.size/e;if(e<=2){var r=t.as2D(n,e),o=iS(r);return Yd(o)}var i=[n,2*(e-1)],a=Yd(t).as2D(n,e),s=Qd(t).as2D(n,e),u=a.slice([0,1],[n,e-2]).reverse(1),l=s.slice([0,1],[n,e-2]).reverse(1).mul(tm(-1)),c=a.concat(u,1),p=s.concat(l,1);return r=Zd(c,p).as2D(i[0],i[1]),o=iS(r),Yd(o)}}),uS=Object.freeze({fft:oS,ifft:iS,rfft:aS,irfft:sS}),lS=Kd({sparseToDense_:function(t,e,n,r){void 0===r&&(r=0);var o=qd(t,"sparseIndices","sparseToDense","int32"),i=qd(e,"sparseValues","sparseToDense"),a=qd(r,"defaultValue","sparseToDense",i.dtype);return function(t,e,n,r){if("int32"!==t.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+t.shape+".");var o=t.rank>0?t.shape[0]:1,i=t.rank>1?t.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+i+".");if(0!==e.rank&&(1!==e.rank||e.size!==o))throw new Error("sparseValues has incorrect shape "+e.shape+", should be [] or ["+o+"]");if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,i,n,a),md.engine.runKernel(function(t){return t.sparseToDense(o,i,n,a)},{$sparseIndices:o,$sparseValues:i,$defaultValue:a})}}),cS=Kd({gatherND_:function(t,e){var n=qd(e,"indices","gatherND","int32"),r=qd(t,"x","gatherND");return md.engine.runKernel(function(t){return t.gatherND(r,n)},{$x:r,$indices:n})}});!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Xx||(Xx={}));var pS=Kd({absoluteDifference_:function(t,e,n,r){void 0===r&&(r=Xx.SUM_BY_NONZERO_WEIGHTS);var o=qd(t,"labels","absoluteDifference"),i=qd(e,"predictions","absoluteDifference"),a=null;null!=n&&(a=qd(n,"weights","absoluteDifference")),Zh(o.shape,i.shape,"Error in absoluteDifference: ");var s=o.sub(i).abs();return hS(s,a,r)}}),hS=Kd({computeWeightedLoss_:function(t,e,n){void 0===n&&(n=Xx.SUM_BY_NONZERO_WEIGHTS);var r=qd(t,"losses","computeWeightedLoss"),o=null;null!=e&&(o=qd(e,"weights","computeWeightedLoss"));var i=null==o?r:r.mul(o);if(n===Xx.NONE)return i;if(n===Xx.SUM)return i.sum();if(n===Xx.MEAN){if(null==o)return i.mean();var a=Jh(r.shape)/Jh(o.shape),s=i.sum().div(o.sum());return a>1?s.div(tm(a)):s}if(n===Xx.SUM_BY_NONZERO_WEIGHTS){if(null==o)return i.sum().div(tm(r.size));var u=o.mul(im(r.shape)).notEqual(tm(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+n)}}),fS=Kd({cosineDistance_:function(t,e,n,r,o){void 0===o&&(o=Xx.SUM_BY_NONZERO_WEIGHTS);var i=qd(t,"labels","cosineDistance"),a=qd(e,"predictions","cosineDistance"),s=null;null!=r&&(s=qd(r,"weights","cosineDistance")),Zh(i.shape,a.shape,"Error in cosineDistance: ");var u=tm(1).sub(i.mul(a).sum(n,!0));return hS(u,s,o)}}),dS=Kd({hingeLoss_:function(t,e,n,r){void 0===r&&(r=Xx.SUM_BY_NONZERO_WEIGHTS);var o=qd(t,"labels","hingeLoss"),i=qd(e,"predictions","hingeLoss"),a=null;null!=n&&(a=qd(n,"weights","hingeLoss")),Zh(o.shape,i.shape,"Error in hingeLoss: ");var s=tm(1);o=tm(2).mul(o).sub(s);var u=s.sub(o.mul(i)).relu();return hS(u,a,r)}}),mS=Kd({huberLoss_:function(t,e,n,r,o){void 0===r&&(r=1),void 0===o&&(o=Xx.SUM_BY_NONZERO_WEIGHTS);var i=qd(t,"labels","huberLoss"),a=qd(e,"predictions","huberLoss"),s=null;null!=n&&(s=qd(n,"weights","huberLoss")),Zh(i.shape,a.shape,"Error in huberLoss: ");var u=tm(r),l=a.sub(i).abs(),c=xx(l,u),p=l.sub(c),h=tm(.5).mul(c.square()).add(u.mul(p));return hS(h,s,o)}}),gS=Kd({logLoss_:function(t,e,n,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=Xx.SUM_BY_NONZERO_WEIGHTS);var i=qd(t,"labels","logLoss"),a=qd(e,"predictions","logLoss"),s=null;null!=n&&(s=qd(n,"weights","logLoss")),Zh(i.shape,a.shape,"Error in logLoss: ");var u=tm(1),l=tm(r),c=i.mul(a.add(l).log()).neg().sub(u.sub(i).mul(u.sub(a).add(l).log()));return hS(c,s,o)}}),vS=Kd({meanSquaredError_:function(t,e,n,r){void 0===r&&(r=Xx.SUM_BY_NONZERO_WEIGHTS);var o=qd(t,"labels","meanSquaredError"),i=qd(e,"predictions","meanSquaredError"),a=null;null!=n&&(a=qd(n,"weights","meanSquaredError")),Zh(o.shape,i.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(i);return hS(s,a,r)}}),yS=Kd({sigmoidCrossEntropy_:function(t,e,n,r,o){void 0===r&&(r=0),void 0===o&&(o=Xx.SUM_BY_NONZERO_WEIGHTS);var i=qd(t,"multiClassLabels","sigmoidCrossEntropy"),a=qd(e,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=qd(n,"weights","sigmoidCrossEntropy")),Zh(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=tm(r),l=tm(1),c=tm(.5);i=i.mul(l.sub(u)).add(c.mul(u))}var p=function(t,e){var n=qd(t,"labels","sigmoidCrossEntropyWithLogits"),r=qd(e,"logits","sigmoidCrossEntropyWithLogits");Zh(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),i=r.mul(n),a=r.abs().neg().exp().log1p();return o.sub(i).add(a)}(i,a);return hS(p,s,o)}}),bS=Kd({softmaxCrossEntropy_:function(t,e,n,r,o){void 0===r&&(r=0),void 0===o&&(o=Xx.SUM_BY_NONZERO_WEIGHTS);var i=qd(t,"onehotLabels","softmaxCrossEntropy"),a=qd(e,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=qd(n,"weights","softmaxCrossEntropy")),Zh(i.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=tm(r),l=tm(1),c=tm(i.shape[1]);i=i.mul(l.sub(u)).add(u.div(c))}var p=function(t,e,n){if(void 0===n&&(n=-1),-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+e.rank+" and dim was "+n);return gd(function(t,e){var r=e.logSumExp([n],!0),o=e.toFloat().sub(r);return{value:o.mul(t).neg().sum([n]),gradFunc:function(e){var r=Td(e.shape,[n]);return[e.reshape(r).mul(t.toFloat().sub(o.exp())),e.reshape(r).mul(o.exp().sub(t.toFloat()))]}}})(t,e)}(i,a);return hS(p,s,o)}}),wS=Object.freeze({get Reduction(){return Xx},absoluteDifference:pS,computeWeightedLoss:hS,cosineDistance:fS,hingeLoss:dS,huberLoss:mS,logLoss:gS,meanSquaredError:vS,sigmoidCrossEntropy:yS,softmaxCrossEntropy:bS});function xS(t,e){return void 0===e&&(e=!1),md.engine.tidy(function(){if(2!==t.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var n=t.shape[0],r=t.shape[1],o=qy(n),i=t.clone(),a=nm([[1]],[1,1]),s=a.clone(),u=n>=r?r:n,l=function(t){var e,u=i,l=s,c=o;e=md.engine.tidy(function(){var e=i.slice([t,t],[n-t,1]),u=e.norm(),l=i.slice([t,t],[1,1]),c=l.sign().neg(),p=l.sub(c.mul(u)),h=e.div(p);s=1===h.shape[0]?a.clone():a.concat(h.slice([1,0],[h.shape[0]-1,h.shape[1]]),0);var f=c.matMul(p).div(u).neg(),d=i.slice([t,0],[n-t,r]),m=f.mul(s);i=0===t?d.sub(m.matMul(s.transpose().matMul(d))):i.slice([0,0],[t,r]).concat(d.sub(m.matMul(s.transpose().matMul(d))),0);var g=o.slice([0,t],[n,o.shape[1]-t]);return o=0===t?g.sub(g.matMul(s).matMul(m.transpose())):o.slice([0,0],[n,t]).concat(g.sub(g.matMul(s).matMul(m.transpose())),1),[s,i,o]}),s=e[0],i=e[1],o=e[2],bd([u,l,c])},c=0;c<u;++c)l(c);return!e&&n>r&&(o=o.slice([0,0],[n,r]),i=i.slice([0,0],[r,r])),[o,i]})}var SS=Kd({gramSchmidt_:function(t){var e;if(Array.isArray(t)){e=!1,Xh(null!=t&&t.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=t[0].shape[0],r=function(e){Xh(t[e].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+t[e].shape[0]+" vs. "+n+")"})},o=1;o<t.length;++o)r(o)}else e=!0,t=Iy(t,t.shape[0],0).map(function(t){return ob(t,[0])});Xh(t.length<=t[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+t.length+") exceeds number of dimensions ("+t[0].shape[0]+")."});var i=[],a=t,s=function(t){i.push(md.engine.tidy(function(){var e=a[t];if(t>0)for(var n=0;n<t;++n){var r=Qw(i[n].mulStrict(e)).mul(i[n]);e=e.sub(r)}return e.div(Gx(e,"euclidean"))}))};for(o=0;o<t.length;++o)s(o);return e?ib(i,0):i}}),CS=Kd({qr_:function(t,e){if(void 0===e&&(e=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(2===t.rank)return xS(t,e);var n=t.shape.slice(0,t.shape.length-2).reduce(function(t,e){return t*e}),r=[],o=[];return ub(t.reshape([n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0).forEach(function(t){var n=xS(t,e),i=n[1];r.push(n[0]),o.push(i)}),[ib(r,0).reshape(t.shape),ib(o,0).reshape(t.shape)]}}),ES=Object.freeze({gramSchmidt:SS,qr:CS});function NS(t,e,n,r,o){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY);var i=t.shape[0];return n=Math.min(n,i),Xh(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),Xh(2===t.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+t.rank+"'"}),Xh(4===t.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]}),Xh(1===e.rank,function(){return"scores must be a 1D tensor"}),Xh(e.shape[0]===i,function(){return"scores has incompatible shape with boxes. Expected "+i+", but was "+e.shape[0]}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o}}var _S=Kd({resizeBilinear_:function(t,e,n){void 0===n&&(n=!1);var r=qd(t,"images","resizeBilinear");Xh(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),Xh(2===e.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=md.engine.runKernel(function(t,e){return t.resizeBilinear(o,a,s,n)},{batchImages:o},function(t,e){return{batchImages:function(){return md.engine.runKernel(function(e){return e.resizeBilinearBackprop(t,o,n)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),IS=Kd({resizeNearestNeighbor_:function(t,e,n){void 0===n&&(n=!1);var r=qd(t,"images","resizeNearestNeighbor");Xh(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),Xh(2===e.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),Xh("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=md.engine.runKernel(function(t,e){return t.resizeNearestNeighbor(o,a,s,n)},{batchImages:o},function(t,e){return{batchImages:function(){return md.engine.runKernel(function(e){return e.resizeNearestNeighborBackprop(t,o,n)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),TS=Kd({nonMaxSuppression_:function(t,e,n,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var i=qd(t,"boxes","nonMaxSuppression"),a=qd(e,"scores","nonMaxSuppression"),s=NS(i,a,n,r,o);return n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,md.engine.runKernel(function(t){return t.nonMaxSuppression(i,a,n,r,o)},{$boxes:i})}}),AS=Kd({cropAndResize_:function(t,e,n,r,o,i){var a=qd(t,"image","cropAndResize","float32"),s=qd(e,"boxes","cropAndResize","float32"),u=qd(n,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var l=s.shape[0];return Xh(4===a.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),Xh(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),Xh(1===u.rank&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),Xh(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),Xh(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),Xh("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o}),md.engine.runKernel(function(t,e){return t.cropAndResize(a,s,u,r,o,i)},{$image:a,$boxes:s})}}),kS=Object.freeze({resizeBilinear:_S,resizeNearestNeighbor:IS,nonMaxSuppression:TS,nonMaxSuppressionAsync:function(t,e,n,r,o){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),Bh(this,void 0,void 0,function(){var i,a,s,u,l,c;return Uh(this,function(p){switch(p.label){case 0:return i=qd(t,"boxes","nonMaxSuppressionAsync"),a=qd(e,"scores","nonMaxSuppressionAsync"),s=NS(i,a,n,r,o),n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,i.data()];case 1:return u=p.sent(),[4,a.data()];case 2:return l=p.sent(),c=bm(u,l,n,r,o),i!==t&&i.dispose(),a!==e&&a.dispose(),[2,c]}})})},cropAndResize:AS}),RS=Kd({matMul_:function(t,e,n,r,o,i){var a;void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===i&&(i="linear");var s=qd(t,"a","fused matMul"),u=qd(e,"b","fused matMul");a=Jf(s,u),s=a[0],u=a[1];var l=n?s.shape[s.rank-2]:s.shape[s.rank-1],c=r?u.shape[u.rank-1]:u.shape[u.rank-2],p=n?s.shape[s.rank-1]:s.shape[s.rank-2],h=r?u.shape[u.rank-2]:u.shape[u.rank-1],f=s.shape.slice(0,-2),d=u.shape.slice(0,-2),m=Jh(f),g=Jh(d);Xh(s.rank>=2&&u.rank>=2&&s.rank===u.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+s.rank+" and "+u.rank+"."}),Xh(tf(f,d),function(){return"Error in fused matMul: outer dimensions ("+f+") and ("+d+") of Tensors with shapes "+s.shape+" and "+u.shape+" must match."}),Xh(l===c,function(){return"Error in fused matMul: inner shapes ("+l+") and ("+c+") of Tensors with shapes "+s.shape+" and "+u.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var v,y=s.shape.slice(0,-2).concat([p,h]),b=n?s.as3D(m,l,p):s.as3D(m,p,l),w=r?u.as3D(g,h,c):u.as3D(g,c,h);null!=o&&Tm(y,(v=Jf(v=qd(o,"bias","fused matMul"),s)[0]).shape);var x={$a:b,$b:w};return null!=o&&(x.$bias=v),md.engine.runKernel(function(t,e){return e(t.fusedBatchMatMul(b,w,n,r,v,i))},x,function(t,e){var a,s=e[0];if(null==i||"linear"===i)a=t;else{if("relu"!==i)throw new Error("Gradient for activation "+i+" has not been implemented yet.");a=t.mul(s.step())}var u={};return null!=o&&(u={$bias:function(){var t=a,e=Im(v.shape,a.shape);return e.length>0&&(t=t.sum(e)),t.reshape(v.shape)}}),n||r?!n&&r?Object.assign({$a:function(){return a.matMul(w,!1,!1)},$b:function(){return a.matMul(b,!0,!1)}},u):n&&!r?Object.assign({$a:function(){return w.matMul(a,!1,!0)},$b:function(){return b.matMul(a,!1,!1)}},u):Object.assign({$a:function(){return w.matMul(a,!0,!0)},$b:function(){return a.matMul(b,!0,!0)}},u):Object.assign({$a:function(){return a.matMul(w,!1,!0)},$b:function(){return b.matMul(a,!0,!1)}},u)}).reshape(y)}}),OS=Object.freeze({matMul:RS}),DS=Object.freeze({image:kS,linalg:ES,losses:wS,spectral:uS,fused:OS,op:Kd,batchNormalization2d:Yb,batchNormalization3d:Qb,batchNormalization4d:Jb,batchNormalization:tw,batchNorm:ew,batchNorm2d:nw,batchNorm3d:rw,batchNorm4d:ow,complex:Zd,real:Yd,imag:Qd,concat:Sy,concat1d:Cy,concat2d:Ey,concat3d:Ny,concat4d:_y,split:Iy,conv1d:vw,conv2d:yw,conv3d:bw,conv2dDerFilter:ww,depthwiseConv2d:xw,separableConv2d:Sw,conv2dTranspose:Cw,matMul:Ew,dot:Nw,outerProduct:_w,reverse:Iw,reverse1d:Tw,reverse2d:Aw,reverse3d:kw,reverse4d:Rw,maxPool:Mw,avgPool:Pw,pool:Lw,slice:Fw,slice1d:zw,slice2d:Bw,slice3d:Uw,slice4d:Vw,abs:fb,acos:db,acosh:mb,asin:gb,asinh:vb,atan:yb,atanh:bb,ceil:wb,clipByValue:xb,cos:Sb,cosh:Cb,erf:Eb,exp:Nb,expm1:_b,floor:Ib,log:Tb,log1p:Ab,logSigmoid:kb,neg:Rb,reciprocal:Ob,round:Db,rsqrt:Mb,sigmoid:Pb,sign:Lb,sin:Fb,sinh:zb,softplus:Bb,sqrt:Ub,square:Vb,step:jb,tan:Wb,tanh:Hb,all:Ww,any:Hw,argMax:qw,argMin:Gw,logSumExp:Kw,max:$w,mean:Xw,min:Zw,moments:Yw,sum:Qw,prod:Jw,equal:tx,equalStrict:ex,greater:nx,greaterEqual:rx,greaterEqualStrict:ox,greaterStrict:ix,less:ax,lessEqual:sx,lessEqualStrict:ux,lessStrict:lx,notEqual:cx,notEqualStrict:px,add:hx,addN:fx,addStrict:dx,atan2:mx,div:gx,divStrict:vx,floorDiv:yx,maximum:bx,maximumStrict:wx,minimum:xx,minimumStrict:Sx,mod:Cx,modStrict:Ex,mul:Nx,mulStrict:_x,pow:Ix,powStrict:Tx,squaredDifference:Ax,squaredDifferenceStrict:kx,sub:Rx,subStrict:Ox,elu:Bx,leakyRelu:Ux,prelu:Vx,relu:jx,selu:Wx,logicalAnd:Dx,logicalNot:Mx,logicalOr:Px,logicalXor:Lx,where:Fx,whereAsync:zx,buffer:zy,print:function(t,e){void 0===e&&(e=!1),console.log(t.toString(e))},batchToSpaceND:By,cast:Uy,clone:Vy,cumsum:jy,depthToSpace:Wy,expandDims:Hy,eye:qy,multinomial:Gy,oneHot:Ky,pad:$y,pad1d:Xy,pad2d:Zy,pad3d:Yy,pad4d:Qy,rand:Jy,randomNormal:tb,randomUniform:eb,reshape:nb,spaceToBatchND:rb,squeeze:ob,stack:ib,tile:ab,truncatedNormal:sb,unstack:ub,setdiff1dAsync:lb,fill:sm,linspace:um,ones:im,range:lm,scalar:tm,tensor:Jd,tensor1d:em,tensor2d:nm,tensor3d:rm,tensor4d:om,tensor5d:function(t,e,n){if(Yh(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Wd(t);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Jd(t,e=e||r,n)},tensor6d:function(t,e,n){if(Yh(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Wd(t);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Jd(t,e=e||r,n)},zeros:am,onesLike:cm,zerosLike:pm,transpose:Hx,softmax:$d,logSoftmax:Xd,localResponseNormalization:qx,norm:Gx,gather:Zx,unsortedSegmentSum:Yx,basicLSTMCell:Qx,multiRNNCell:Jx,movingAverage:tS,stridedSlice:eS,topk:nS,scatterND:rS,fft:oS,ifft:iS,rfft:aS,irfft:sS,sparseToDense:lS,gatherND:cS}),MS=function(){function t(){this.blockSize=48,this.firstUse=!0,md.get("IS_BROWSER")&&(this.fromPixels2DContext=document.createElement("canvas").getContext("2d"))}return t.prototype.setDataMover=function(t){this.data=new hm(t)},t.prototype.register=function(t,e,n){if(this.firstUse&&(this.firstUse=!1,md.get("IS_NODE")&&wd("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================\n")),this.data.has(t))throw new Error("Data buffer is already registered");this.data.set(t,{dtype:n})},t.prototype.write=function(t,e){if(null==e)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(t).values=e},t.prototype.fromPixels=function(t,e){if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n,r;if(md.get("IS_NODE")&&null==t.getContext)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(null!=t.getContext)n=t.getContext("2d").getImageData(0,0,t.width,t.height).data;else if(t instanceof ImageData)n=t.data;else{if(!(t instanceof HTMLImageElement||t instanceof HTMLVideoElement))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+t.constructor.name);if(null==this.fromPixels2DContext)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=t.width,this.fromPixels2DContext.canvas.height=t.height,this.fromPixels2DContext.drawImage(t,0,0,t.width,t.height),n=this.fromPixels2DContext.getImageData(0,0,t.width,t.height).data}if(4===e)r=new Int32Array(n);else{var o=t.width*t.height;r=new Int32Array(o*e);for(var i=0;i<o;i++)for(var a=0;a<e;++a)r[i*e+a]=n[4*i+a]}return rm(r,[t.height,t.width,e],"int32")},t.prototype.read=function(t){return Bh(this,void 0,void 0,function(){return Uh(this,function(e){return[2,this.readSync(t)]})})},t.prototype.readSync=function(t){var e=this.data.get(t),n=e.complexTensors;return"complex64"===e.dtype?mm(n.real.dataSync(),n.imag.dataSync()):this.data.get(t).values},t.prototype.disposeData=function(t){if(this.data.has(t)){var e=this.data.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.data.delete(t)}},t.prototype.time=function(t){return Bh(this,void 0,void 0,function(){var e;return Uh(this,function(n){return e=Af(),t(),[2,{kernelMs:Af()-e}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(t,e){var n=Vf.make(t.shape,{},"complex64");return this.data.get(n.dataId).complexTensors={real:md.engine.keep(t.clone()),imag:md.engine.keep(e.clone())},n},t.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},t.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},t.prototype.assertNotComplex=function(t,e){Array.isArray(t)||(t=[t]),t.forEach(function(t){null!=t&&Xh("complex64"!==t.dtype,function(){return e+" does not support complex64 tensors."})})},t.prototype.slice=function(t,e,n){if(this.assertNotComplex(t,"slice"),Vd(t.shape,e,n)){var r=jd(e,t.strides),o=Jh(n);return Jd(t.dataSync().subarray(r,r+o),n,t.dtype)}for(var i=zy(n,t.dtype),a=t.bufferSync(),s=0;s<i.size;++s){var u=i.indexToLoc(s).map(function(t,n){return t+e[n]});i.values[s]=a.get.apply(a,u)}return i.toTensor()},t.prototype.stridedSlice=function(t,e,n,r,o,i,a,s,u){this.assertNotComplex(t,"stridedSlice");var l=zd(t.shape,e,n,r,o,i,a,s,u),c=l[0],p=l[1],h=l[2],f=p.filter(function(t,e){return-1===h.indexOf(e)});if(f.some(function(t){return 0===t}))return Jd([],f);for(var d=zy(p,t.dtype),m=t.bufferSync(),g=0;g<d.size;g++){for(var v=d.indexToLoc(g),y=new Array(v.length),b=0;b<y.length;b++)y[b]=v[b]*r[b]+c[b];d.set.apply(d,[m.get.apply(m,y)].concat(v))}return d.toTensor().reshape(f)},t.prototype.unstack=function(t,e){for(var n=t.shape[e],r=new Array(t.rank-1),o=0,i=0;i<t.rank;i++)i!==e&&(r[o++]=t.shape[i]);var a=new Array(t.rank).fill(0),s=t.shape.slice();s[e]=1;var u=new Array(n);for(i=0;i<u.length;i++)a[e]=i,u[i]=this.slice(t,a,s).reshape(r);return u},t.prototype.reverse=function(t,e){this.assertNotComplex(t,"reverse");for(var n=zy(t.shape,t.dtype),r=t.bufferSync(),o=function(o){var i=n.indexToLoc(o),a=i.slice();e.forEach(function(e){return a[e]=t.shape[e]-1-a[e]}),n.set.apply(n,[r.get.apply(r,a)].concat(i))},i=0;i<n.size;i++)o(i);return n.toTensor()},t.prototype.concat=function(t,e){this.assertNotComplex(t,"concat");var n=t.map(function(t){var n=Jh(t.shape.slice(e));return t.as2D(-1,n)}),r=Dd(n.map(function(t){return t.shape}),1),o=zy(r,t[0].dtype).values;if(1===n[0].shape[0]){var i=0;n.forEach(function(t){o.set(t.dataSync(),i),i+=t.size})}else{var a=0;n.forEach(function(t){for(var e=t.dataSync(),n=0,i=0;i<t.shape[0];++i)for(var s=i*r[1]+a,u=0;u<t.shape[1];++u)o[s+u]=e[n++];a+=t.shape[1]})}var s=Dd(t.map(function(t){return t.shape}),e);return Jd(o,s,t[0].dtype)},t.prototype.neg=function(t){return this.assertNotComplex(t,"neg"),this.multiply(tm(-1),t)},t.prototype.add=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t+n,imag:e+r}}):this.broadcastedBinaryOp(t,e,Yf(t.dtype,e.dtype),function(t,e){return t+e})},t.prototype.addN=function(t){this.assertNotComplex(t,"addN");for(var e=t.map(function(t){return t.dataSync()}),n=zy(t[0].shape,t[0].dtype),r=n.values,o=0;o<t.length;o++)for(var i=e[o],a=0;a<r.length;a++)r[a]+=i[a];return n.toTensor()},t.prototype.subtract=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t-n,imag:e-r}}):this.broadcastedBinaryOp(t,e,Yf(t.dtype,e.dtype),function(t,e){return t-e})},t.prototype.pow=function(t,e){return this.assertNotComplex([t,e],"pow"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.pow(t,e)})},t.prototype.batchMatMul=function(t,e,n,r){this.assertNotComplex([t,e],"matMul");for(var o=n?t.shape[1]:t.shape[2],i=n?t.shape[2]:t.shape[1],a=r?e.shape[1]:e.shape[2],s=t.shape[0],u=t.dataSync(),l=e.dataSync(),c=n?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],p=c[0],h=c[1],f=c[2],d=r?[1,e.strides[1],e.strides[0]]:[e.strides[1],1,e.strides[0]],m=d[0],g=d[1],v=d[2],y=i*a,b=zy([s,i,a],t.dtype),w=b.values,x=this.blockSize,S=0;S<s;S++)for(var C=0;C<i;C+=x)for(var E=0;E<a;E+=x)for(var N=0;N<o;N+=x)for(var _=Math.min(C+x,i),I=Math.min(E+x,a),T=Math.min(N+x,o),A=C;A<_;A++)for(var k=E;k<I;k++){for(var R=0,O=N;O<T;O++)R+=u[S*p+A*h+O*f]*l[O*m+k*g+S*v];w[S*y+(A*a+k)]+=R}return b.toTensor()},t.prototype.fusedBatchMatMul=function(t,e,n,r,o,i){var a=this.batchMatMul(t,e,n,r);return o&&(a=this.add(a,o)),i&&(a=function(t,e,n){if("linear"===e)return t.linear(n);if("relu"===e)return t.relu(n);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}(this,i,a)),a},t.prototype.multiply=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t*n-e*r,imag:t*r+e*n}}):this.broadcastedBinaryOp(t,e,Yf(t.dtype,e.dtype),function(t,e){return t*e})},t.prototype.realDivide=function(t,e){return this.assertNotComplex([t,e],"realDivide"),this.broadcastedBinaryOp(t,e,"float32",function(t,e){return t/e})},t.prototype.floorDiv=function(t,e){return this.assertNotComplex([t,e],"floorDiv"),this.broadcastedBinaryOp(t,e,"int32",function(t,e){return Math.floor(t/e)})},t.prototype.sum=function(t,e){this.assertNotComplex(t,"sum"),Ad("sum",e,t.rank);for(var n=Id(t.shape,e),r=n[1],o=am(n[0],Yf(t.dtype,"int32")),i=Jh(r),a=o.dataSync(),s=t.dataSync(),u=0;u<a.length;++u){for(var l=u*i,c=0,p=0;p<i;++p)c+=s[l+p];a[u]=c}return o},t.prototype.prod=function(t,e){this.assertNotComplex(t,"sum");for(var n=Id(t.shape,e),r=n[1],o=am(n[0],Yf(t.dtype,"int32")),i=Jh(r),a=o.dataSync(),s=t.dataSync(),u=0;u<a.length;++u){for(var l=u*i,c=1,p=0;p<i;++p)c*=s[l+p];a[u]=c}return o},t.prototype.unsortedSegmentSum=function(t,e,n){this.assertNotComplex(t,"unsortedSegmentSum");for(var r=[],o=t.rank-e.rank,i=0;i<o;++i)e=e.expandDims(i+1);for(i=0;i<n;++i){var a=tm(i,"int32"),s=tx(a,e).asType("float32").mul(t).sum(0);r.push(s)}return ib(r)},t.prototype.argMin=function(t,e){this.assertNotComplex(t,"argMin");var n=[e];Ad("argMin",n,t.rank);for(var r=Id(t.shape,n),o=r[1],i=am(r[0],"int32"),a=Jh(o),s=i.dataSync(),u=t.dataSync(),l=0;l<s.length;++l){for(var c=l*a,p=u[c],h=0,f=0;f<a;++f){var d=u[c+f];d<p&&(p=d,h=f)}s[l]=h}return i},t.prototype.argMax=function(t,e){this.assertNotComplex(t,"argMax");var n=[e];Ad("argMax",n,t.rank);for(var r=Id(t.shape,n),o=r[1],i=am(r[0],"int32"),a=Jh(o),s=i.dataSync(),u=t.dataSync(),l=0;l<s.length;++l){for(var c=l*a,p=u[c],h=0,f=0;f<a;++f){var d=u[c+f];d>p&&(p=d,h=f)}s[l]=h}return i},t.prototype.cumsum=function(t,e,n,r){if(this.assertNotComplex(t,"cumsum"),e!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+e);for(var o=Yf(t.dtype,"int32"),i=am(t.shape,o),a=i.dataSync(),s=t.dataSync(),u=t.shape[t.rank-1],l=r?function(t,e){return t+u-e-1}:function(t,e){return t+e},c=0;c<s.length;c+=u)for(var p=0;p<u;p++){var h=l(c,p);if(0===p)a[h]=n?0:s[h];else{var f=l(c,p-1);a[h]=n?s[f]+a[f]:s[h]+a[f]}}return i},t.prototype.equal=function(t,e){return this.assertNotComplex([t,e],"equal"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t===e?1:0})},t.prototype.notEqual=function(t,e){return this.assertNotComplex([t,e],"notEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t!==e?1:0})},t.prototype.less=function(t,e){return this.assertNotComplex([t,e],"less"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<e?1:0})},t.prototype.lessEqual=function(t,e){return this.assertNotComplex([t,e],"lessEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<=e?1:0})},t.prototype.greater=function(t,e){return this.assertNotComplex([t,e],"greater"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>e?1:0})},t.prototype.greaterEqual=function(t,e){return this.assertNotComplex([t,e],"greaterEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>=e?1:0})},t.prototype.logicalNot=function(t){this.assertNotComplex(t,"logicalNot");for(var e=t.dataSync(),n=new Uint8Array(e.length),r=0;r<e.length;++r)n[r]=e[r]?0:1;return Vf.make(t.shape,{values:n},"bool")},t.prototype.logicalAnd=function(t,e){return this.assertNotComplex([t,e],"logicalAnd"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t&&e})},t.prototype.logicalOr=function(t,e){return this.assertNotComplex([t,e],"logicalOr"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t||e})},t.prototype.select=function(t,e,n){this.assertNotComplex([t,e,n],"select");for(var r=t.dataSync(),o=e.dataSync(),i=n.dataSync(),a=am(e.shape,Yf(e.dtype,n.dtype)),s=a.dataSync(),u=0,l=0===t.rank||t.rank>1||1===e.rank?1:e.shape[1],c=0;c<r.length;c++)for(var p=0;p<l;p++)s[u++]=1===r[c]?o[c]:i[c];return a},t.prototype.where=function(t){this.assertNotComplex([t],"where");var e=t.dataSync();return cb(t.shape,e)},t.prototype.topk=function(t,e,n){return this.assertNotComplex(t,"topk"),Sm(t.dataSync(),t.shape,t.dtype,e)},t.prototype.min=function(t,e){this.assertNotComplex(t,"min"),Ad("min",e,t.rank);for(var n=Id(t.shape,e),r=n[1],o=am(n[0],t.dtype),i=Jh(r),a=o.dataSync(),s=t.dataSync(),u=0;u<a.length;++u){for(var l=u*i,c=s[l],p=0;p<i;++p){var h=s[l+p];h<c&&(c=h)}a[u]=c}return o},t.prototype.minimum=function(t,e){return this.assertNotComplex([t,e],"minimum"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.min(t,e)})},t.prototype.mod=function(t,e){return this.assertNotComplex([t,e],"mod"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e})},t.prototype.max=function(t,e){this.assertNotComplex(t,"max"),Ad("max",e,t.rank);for(var n=Id(t.shape,e),r=n[1],o=am(n[0],t.dtype),i=Jh(r),a=o.dataSync(),s=t.dataSync(),u=0;u<a.length;++u){for(var l=u*i,c=s[l],p=0;p<i;++p){var h=s[l+p];h>c&&(c=h)}a[u]=c}return o},t.prototype.maximum=function(t,e){return this.assertNotComplex([t,e],"maximum"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.max(t,e)})},t.prototype.all=function(t,e){this.assertNotComplex(t,"all"),Ad("all",e,t.rank);for(var n=Id(t.shape,e),r=n[1],o=am(n[0],t.dtype),i=Jh(r),a=o.dataSync(),s=t.dataSync(),u=0;u<a.length;++u){for(var l=u*i,c=s[l],p=0;p<i;++p)c=c&&s[l+p];a[u]=c}return o},t.prototype.any=function(t,e){this.assertNotComplex(t,"any"),Ad("any",e,t.rank);for(var n=Id(t.shape,e),r=n[1],o=am(n[0],t.dtype),i=Jh(r),a=o.dataSync(),s=t.dataSync(),u=0;u<a.length;++u){for(var l=u*i,c=s[l],p=0;p<i;++p)c=c||s[l+p];a[u]=c}return o},t.prototype.squaredDifference=function(t,e){return this.assertNotComplex([t,e],"squaredDifference"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var n=t-e;return n*n})},t.prototype.ceil=function(t){this.assertNotComplex(t,"ceil");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.ceil(e[r]);return Vf.make(t.shape,{values:n})},t.prototype.floor=function(t){this.assertNotComplex(t,"floor");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.floor(e[r]);return Vf.make(t.shape,{values:n})},t.prototype.sign=function(t){this.assertNotComplex(t,"x");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=e[r]<0?-1:e[r]>0?1:0;return Vf.make(t.shape,{values:n})},t.prototype.round=function(t){this.assertNotComplex(t,"round");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=Math.floor(e[r]);n[r]=e[r]-o<.5?Math.floor(e[r]):e[r]-o>.5?Math.ceil(e[r]):o%2==0?o:o+1}return Vf.make(t.shape,{values:n})},t.prototype.exp=function(t){this.assertNotComplex(t,"exp");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.exp(e[r]);return Vf.make(t.shape,{values:n})},t.prototype.expm1=function(t){this.assertNotComplex(t,"expm1");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.expm1(e[r]);return Vf.make(t.shape,{values:n})},t.prototype.log=function(t){this.assertNotComplex(t,"log");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.log(e[r]);return Vf.make(t.shape,{values:n})},t.prototype.log1p=function(t){this.assertNotComplex(t,"log1p");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.log1p(e[r]);return Vf.make(t.shape,{values:n})},t.prototype.sqrt=function(t){this.assertNotComplex(t,"sqrt");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.sqrt(e[r]);return Vf.make(t.shape,{values:n})},t.prototype.rsqrt=function(t){this.assertNotComplex(t,"rsqrt");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=1/Math.sqrt(e[r]);return Vf.make(t.shape,{values:n})},t.prototype.square=function(t){this.assertNotComplex(t,"square");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=e[r];n[r]=o*o}return Vf.make(t.shape,{values:n})},t.prototype.reciprocal=function(t){this.assertNotComplex(t,"reciprocal");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=1/e[r];return Vf.make(t.shape,{values:n})},t.prototype.linear=function(t){return t},t.prototype.relu=function(t){this.assertNotComplex(t,"relu");for(var e=am(t.shape,t.dtype),n=e.dataSync(),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.max(0,r[o]);return e},t.prototype.prelu=function(t,e){return this.assertNotComplex([t,e],"prelu"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return t<0?e*t:t})},t.prototype.elu=function(t){this.assertNotComplex(t,"elu");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r){var o=n[r];e[r]=o>=0?o:Math.exp(o)-1}return Vf.make(t.shape,{values:e})},t.prototype.eluDer=function(t,e){this.assertNotComplex([t,e],"eluDer");for(var n=new Float32Array(e.size),r=e.dataSync(),o=t.dataSync(),i=0;i<r.length;++i){var a=r[i];n[i]=a>=1?o[i]:o[i]*(a+1)}return Vf.make(e.shape,{values:n})},t.prototype.selu=function(t){this.assertNotComplex(t,"selu");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r){var o=n[r];e[r]=o>=0?1.0507009873554805*o:1.7580993408473768*(Math.exp(o)-1)}return Vf.make(t.shape,{values:e})},t.prototype.clip=function(t,e,n){this.assertNotComplex(t,"clip");for(var r=new Float32Array(t.size),o=t.dataSync(),i=0;i<o.length;++i){var a=o[i];r[i]=a>n?n:a<e?e:a}return Vf.make(t.shape,{values:r})},t.prototype.abs=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.abs(n[r]);return Vf.make(t.shape,{values:e})},t.prototype.complexAbs=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<t.size;++r)e[r]=Math.hypot(n[2*r],n[2*r+1]);return Vf.make(t.shape,{values:e})},t.prototype.int=function(t){this.assertNotComplex(t,"int");for(var e=new Int32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=n[r];return Vf.make(t.shape,{values:e},"int32")},t.prototype.sigmoid=function(t){this.assertNotComplex(t,"sigmoid");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=1/(1+Math.exp(-n[r]));return Vf.make(t.shape,{values:e})},t.prototype.softplus=function(t){this.assertNotComplex(t,"softplus");for(var e=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o){var i,a=r[o]>-e,s=r[o]<e,u=Math.exp(r[o]);i=s?u:a?r[o]:Math.log(1+u),n[o]=i}return Vf.make(t.shape,{values:n})},t.prototype.sin=function(t){this.assertNotComplex(t,"sin");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.sin(n[r]);return Vf.make(t.shape,{values:e})},t.prototype.cos=function(t){this.assertNotComplex(t,"cos");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.cos(n[r]);return Vf.make(t.shape,{values:e})},t.prototype.tan=function(t){this.assertNotComplex(t,"tan");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.tan(n[r]);return Vf.make(t.shape,{values:e})},t.prototype.asin=function(t){this.assertNotComplex(t,"asin");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.asin(n[r]);return Vf.make(t.shape,{values:e})},t.prototype.acos=function(t){this.assertNotComplex(t,"acos");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.acos(n[r]);return Vf.make(t.shape,{values:e})},t.prototype.atan=function(t){this.assertNotComplex(t,"atan");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.atan(n[r]);return Vf.make(t.shape,{values:e})},t.prototype.atan2=function(t,e){return this.assertNotComplex([t,e],"atan2"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.atan2(t,e)})},t.prototype.sinh=function(t){this.assertNotComplex(t,"sinh");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.sinh(n[r]);return Vf.make(t.shape,{values:e})},t.prototype.cosh=function(t){this.assertNotComplex(t,"cosh");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.cosh(n[r]);return Vf.make(t.shape,{values:e})},t.prototype.tanh=function(t){this.assertNotComplex(t,"tanh");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=nf(n[r]);return Vf.make(t.shape,{values:e})},t.prototype.asinh=function(t){this.assertNotComplex(t,"asinh");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.asinh(n[r]);return Vf.make(t.shape,{values:e})},t.prototype.acosh=function(t){this.assertNotComplex(t,"acosh");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.acosh(n[r]);return Vf.make(t.shape,{values:e})},t.prototype.atanh=function(t){this.assertNotComplex(t,"atanh");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.atanh(n[r]);return Vf.make(t.shape,{values:e})},t.prototype.erf=function(t){this.assertNotComplex(t,"erf");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r){var o=n[r],i=1/(1+.3275911*o);e[r]=1-((((1.061405429*i-1.453152027)*i+1.421413741)*i-.284496736)*i+.254829592)*i*Math.exp(-o*o)}return Vf.make(t.shape,{values:e})},t.prototype.step=function(t,e){void 0===e&&(e=0),this.assertNotComplex(t,"step");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o){var i=r[o];n[o]=isNaN(i)?NaN:i>0?1:e}return Vf.make(t.shape,{values:n})},t.prototype.conv2d=function(t,e,n){this.assertNotComplex([t,e],"conv2d");for(var r=n.filterHeight,o=n.filterWidth,i=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=zy(n.outShape,t.dtype),c=t.dataSync(),p=e.dataSync(),h=l.values,f=0;f<n.batchSize;++f)for(var d=f*t.strides[0],m=f*l.strides[0],g=0;g<n.outHeight;++g)for(var v=m+g*l.strides[1],y=g*n.strideHeight-s,b=0;b<r;b++){var w=y+b*i;if(!(w<0||w>=n.inHeight))for(var x=b*e.strides[0],S=d+w*t.strides[1],C=0;C<n.outWidth;++C)for(var E=v+C*n.outChannels,N=C*n.strideWidth-u,_=0;_<o;_++){var I=N+_*a;if(!(I<0||I>=n.inWidth))for(var T=S+I*n.inChannels,A=x+_*e.strides[1],k=0;k<n.inChannels;++k){for(var R=c[T+k],O=0;O<n.outChannels;++O)h[E+O]+=R*p[A+O];A+=n.outChannels}}}return l.toTensor()},t.prototype.conv3d=function(t,e,n){for(var r=n.filterDepth,o=n.filterHeight,i=n.filterWidth,a=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,l=n.padInfo.front,c=n.padInfo.left,p=n.padInfo.top,h=zy(n.outShape,t.dtype),f=t.dataSync(),d=e.dataSync(),m=h.values,g=0;g<n.batchSize;++g)for(var v=g*t.strides[0],y=g*h.strides[0],b=0;b<n.outDepth;++b)for(var w=y+b*h.strides[1],x=b*n.strideDepth-l,S=0;S<r;S++){var C=x+S*a;if(!(C<0||C>=n.inDepth))for(var E=S*e.strides[0],N=v+C*t.strides[1],_=0;_<n.outHeight;++_)for(var I=w+_*h.strides[2],T=_*n.strideHeight-p,A=0;A<o;A++){var k=T+A*s;if(!(k<0||k>=n.inHeight))for(var R=E+A*e.strides[1],O=N+k*t.strides[2],D=0;D<n.outWidth;++D)for(var M=I+D*n.outChannels,P=D*n.strideWidth-c,L=0;L<i;L++){var F=P+L*u;if(!(F<0||F>=n.inWidth))for(var z=O+F*n.inChannels,B=R+L*e.strides[2],U=0;U<n.inChannels;++U){for(var V=f[z+U],j=0;j<n.outChannels;++j)m[M+j]+=V*d[B+j];B+=n.outChannels}}}}return h.toTensor()},t.prototype.conv2dDerInput=function(t,e,n){this.assertNotComplex([t,e],"conv2dDerInput");for(var r=zy(n.inShape,"float32"),o=r.values,i=r.strides,a=i[0],s=i[1],u=i[2],l=t.dataSync(),c=t.strides,p=c[0],h=c[1],f=c[2],d=e.dataSync(),m=e.strides,g=m[0],v=m[1],y=m[2],b=n.batchSize,w=n.filterHeight,x=n.filterWidth,S=n.inChannels,C=n.inHeight,E=n.inWidth,N=n.outChannels,_=n.outHeight,I=n.outWidth,T=n.strideHeight,A=n.strideWidth,k=w-1-n.padInfo.top,R=x-1-n.padInfo.left,O=0;O<b;++O)for(var D=0;D<S;++D)for(var M=0;M<C;++M)for(var P=M-k,L=Math.max(0,Math.ceil(P/T)),F=Math.min(_,(w+P)/T),z=0;z<E;++z){for(var B=z-R,U=Math.max(0,Math.ceil(B/A)),V=Math.min(I,(x+B)/A),j=0,W=L;W<F;++W)for(var H=W*T-P,q=U;q<V;++q)for(var G=p*O+h*W+f*q,K=g*(w-1-H)+v*(x-1-(q*A-B))+y*D,$=0;$<N;++$)j+=l[G+$]*d[K+$];o[a*O+s*M+u*z+D]=j}return r.toTensor()},t.prototype.conv3dDerInput=function(t,e,n){for(var r=zy(n.inShape,"float32"),o=r.values,i=r.strides,a=i[0],s=i[1],u=i[2],l=i[3],c=t.dataSync(),p=t.strides,h=p[0],f=p[1],d=p[2],m=p[3],g=e.dataSync(),v=e.strides,y=v[0],b=v[1],w=v[2],x=v[3],S=n.batchSize,C=n.filterDepth,E=n.filterHeight,N=n.filterWidth,_=n.inChannels,I=n.inDepth,T=n.inHeight,A=n.inWidth,k=n.outChannels,R=n.outDepth,O=n.outHeight,D=n.outWidth,M=n.strideDepth,P=n.strideHeight,L=n.strideWidth,F=C-1-n.padInfo.front,z=E-1-n.padInfo.top,B=N-1-n.padInfo.left,U=0;U<S;++U)for(var V=0;V<_;++V)for(var j=0;j<I;++j)for(var W=j-F,H=Math.max(0,Math.ceil(W/M)),q=Math.min(R,(C+W)/M),G=0;G<T;++G)for(var K=G-z,$=Math.max(0,Math.ceil(K/P)),X=Math.min(O,(E+K)/P),Z=0;Z<A;++Z){for(var Y=Z-B,Q=Math.max(0,Math.ceil(Y/L)),J=Math.min(D,(N+Y)/L),tt=0,et=H;et<q;++et)for(var nt=et*M-W,rt=$;rt<X;++rt)for(var ot=rt*P-K,it=Q;it<J;++it)for(var at=h*U+f*et+d*rt+m*it,st=y*(C-1-nt)+b*(E-1-ot)+w*(N-1-(it*L-Y))+x*V,ut=0;ut<k;++ut)tt+=c[at+ut]*g[st+ut];o[a*U+s*j+u*G+l*Z+V]=tt}return r.toTensor()},t.prototype.conv2dDerFilter=function(t,e,n){this.assertNotComplex([t,e],"conv2dDerFilter");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s=zy(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=t.bufferSync(),p=e.bufferSync(),h=0;h<i;++h)for(var f=Math.max(0,Math.ceil((l-h)/r)),d=Math.min(n.outHeight,(n.inHeight+l-h)/r),m=0;m<a;++m)for(var g=Math.max(0,Math.ceil((u-m)/o)),v=Math.min(n.outWidth,(n.inWidth+u-m)/o),y=0;y<n.inChannels;++y)for(var b=0;b<n.outChannels;++b){for(var w=0,x=0;x<n.batchSize;++x)for(var S=f;S<d;++S)for(var C=h+S*r-l,E=g;E<v;++E)w+=c.get(x,C,m+E*o-u,y)*p.get(x,S,E,b);s.set(w,h,m,y,b)}return s.toTensor()},t.prototype.conv3dDerFilter=function(t,e,n){for(var r=n.strideDepth,o=n.strideHeight,i=n.strideWidth,a=n.filterDepth,s=n.filterHeight,u=n.filterWidth,l=zy(n.filterShape,"float32"),c=l.values,p=l.strides,h=p[0],f=p[1],d=p[2],m=p[3],g=e.dataSync(),v=e.strides,y=v[0],b=v[1],w=v[2],x=v[3],S=t.dataSync(),C=t.strides,E=C[0],N=C[1],_=C[2],I=C[3],T=n.padInfo.front,A=n.padInfo.left,k=n.padInfo.top,R=0;R<a;++R)for(var O=Math.max(0,Math.ceil((T-R)/r)),D=Math.min(n.outDepth,(n.inDepth+T-R)/r),M=R*h,P=0;P<s;++P)for(var L=Math.max(0,Math.ceil((k-P)/o)),F=Math.min(n.outHeight,(n.inHeight+k-P)/o),z=P*f+M,B=0;B<u;++B)for(var U=Math.max(0,Math.ceil((A-B)/i)),V=Math.min(n.outWidth,(n.inWidth+A-B)/i),j=B*d+z,W=0;W<n.inChannels;++W)for(var H=W*m+j,q=0;q<n.outChannels;++q){for(var G=0,K=0;K<n.batchSize;++K)for(var $=K*E,X=K*y,Z=O;Z<D;++Z)for(var Y=(R+Z*r-T)*N+$,Q=Z*b+X,J=L;J<F;++J)for(var tt=(P+J*o-k)*_+Y,et=J*w+Q,nt=U;nt<V;++nt)G+=S[(B+nt*i-A)*I+tt+W]*g[nt*x+et+q];c[H+q]=G}return l.toTensor()},t.prototype.depthwiseConv2D=function(t,e,n){this.assertNotComplex([t,e],"depthwiseConv2D");for(var r=n.filterHeight,o=n.filterWidth,i=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=n.outChannels/n.inChannels,c=zy(n.outShape,t.dtype),p=t.dataSync(),h=e.dataSync(),f=c.values,d=0;d<n.batchSize;++d)for(var m=d*t.strides[0],g=d*c.strides[0],v=0;v<n.outHeight;++v)for(var y=g+v*c.strides[1],b=v*n.strideHeight-s,w=0;w<r;++w){var x=b+w*i;if(!(x<0||x>=n.inHeight))for(var S=w*e.strides[0],C=m+x*t.strides[1],E=0;E<n.outWidth;++E)for(var N=y+E*c.strides[2],_=E*n.strideWidth-u,I=0;I<o;++I){var T=_+I*a;if(!(T<0||T>=n.inWidth))for(var A=C+T*n.inChannels,k=N,R=S+I*e.strides[1],O=0;O<n.inChannels;++O){for(var D=p[A+O],M=0;M<l;++M)f[k+M]+=D*h[R+M];k+=l,R+=l}}}return c.toTensor()},t.prototype.depthwiseConv2DDerInput=function(t,e,n){this.assertNotComplex([t,e],"depthwiseConv2DDerInput");for(var r=zy(n.inShape,"float32"),o=r.values,i=r.strides,a=i[0],s=i[1],u=i[2],l=t.dataSync(),c=t.strides,p=c[0],h=c[1],f=c[2],d=e.dataSync(),m=e.strides,g=m[0],v=m[1],y=m[2],b=n.batchSize,w=n.filterHeight,x=n.filterWidth,S=n.inChannels,C=n.inHeight,E=n.inWidth,N=n.outHeight,_=n.outWidth,I=n.strideHeight,T=n.strideWidth,A=w-1-n.padInfo.top,k=x-1-n.padInfo.left,R=n.outChannels/S,O=0;O<b;++O)for(var D=0;D<S;++D)for(var M=0;M<C;++M)for(var P=M-A,L=Math.max(0,Math.ceil(P/I)),F=Math.min(N,(w+P)/I),z=0;z<E;++z){for(var B=z-k,U=Math.max(0,Math.ceil(B/T)),V=Math.min(_,(x+B)/T),j=0,W=L;W<F;++W)for(var H=W*I-P,q=U;q<V;++q)for(var G=p*O+h*W+f*q,K=g*(w-1-H)+v*(x-1-(q*T-B))+y*D,$=0;$<R;++$)j+=l[G+(D*R+$)]*d[K+$];o[a*O+s*M+u*z+D]=j}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){this.assertNotComplex([t,e],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s=zy(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=n.outChannels/n.inChannels,p=t.bufferSync(),h=e.bufferSync(),f=0;f<i;++f)for(var d=Math.max(0,Math.ceil((l-f)/r)),m=Math.min(n.outHeight,(n.inHeight+l-f)/r),g=0;g<a;++g)for(var v=Math.max(0,Math.ceil((u-g)/o)),y=Math.min(n.outWidth,(n.inWidth+u-g)/o),b=0;b<n.outChannels;++b){for(var w=Math.trunc(b/c),x=b%c,S=0,C=0;C<n.batchSize;++C)for(var E=d;E<m;++E)for(var N=f+E*r-l,_=v;_<y;++_)S+=p.get(C,N,g+_*o-u,w)*h.get(C,E,_,b);s.set(S,f,g,w,x)}return s.toTensor()},t.prototype.tile=function(t,e){this.assertNotComplex(t,"tile");for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];var o=zy(n,t.dtype),i=t.bufferSync();for(r=0;r<o.values.length;++r){for(var a=o.indexToLoc(r),s=new Array(t.rank),u=0;u<s.length;u++)s[u]=a[u]%t.shape[u];var l=i.locToIndex(s);o.values[r]=i.values[l]}return o.toTensor()},t.prototype.pad=function(t,e,n){this.assertNotComplex(t,"pad");var r=e.map(function(e,n){return e[0]+t.shape[n]+e[1]}),o=e.map(function(t){return t[0]}),i=t.bufferSync(),a=zy(r,t.dtype);0!==n&&a.values.fill(n);for(var s=0;s<t.size;s++){var u=i.indexToLoc(s),l=u.map(function(t,e){return t+o[e]});a.set.apply(a,[i.get.apply(i,u)].concat(l))}return a.toTensor()},t.prototype.transpose=function(t,e){this.assertNotComplex(t,"transpose");for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[e[r]];var o=t.dataSync(),i=zy(n,t.dtype),a=t.bufferSync();for(r=0;r<t.size;++r){for(var s=a.indexToLoc(r),u=new Array(s.length),l=0;l<u.length;l++)u[l]=s[e[l]];var c=i.locToIndex(u);i.values[c]=o[r]}return i.toTensor()},t.prototype.gather=function(t,e,n){this.assertNotComplex([t,e],"gather");var r=t.shape.slice(),o=e.dataSync();r[n]=o.length;for(var i=zy(r,t.dtype),a=t.bufferSync(),s=0;s<i.size;++s){var u=i.indexToLoc(s),l=u.slice();l[n]=o[u[n]];var c=a.locToIndex(l);i.values[s]=a.values[c]}return i.toTensor()},t.prototype.batchToSpaceND=function(t,e,n){this.assertNotComplex([t],"batchToSpaceND");var r=e.reduce(function(t,e){return t*e}),o=xd(t.shape,e,r),i=Sd(o.length,e.length),a=Cd(t.shape,e,r),s=Ed(n,e.length),u=Nd(a,n,e.length);return t.reshape(o).transpose(i).reshape(a).slice(s,u)},t.prototype.spaceToBatchND=function(t,e,n){this.assertNotComplex([t],"spaceToBatchND");var r=e.reduce(function(t,e){return t*e}),o=[[0,0]];o.push.apply(o,n);for(var i=1+e.length;i<t.shape.length;++i)o.push([0,0]);var a=t.pad(o),s=xd(a.shape,e,r,!1),u=Sd(s.length,e.length,!1),l=Cd(a.shape,e,r,!1);return a.reshape(s).transpose(u).reshape(l)},t.prototype.pool=function(t,e,n){this.assertNotComplex(t,"pool");for(var r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=e.padInfo.top,c=e.padInfo.left,p="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,h=t.dataSync(),f=zy(e.outShape,t.dtype),d=f.values,m=e.outShape[1]*e.outShape[2]*e.outShape[3],g=e.outShape[2]*e.outShape[3],v=e.outShape[3],y=0;y<e.batchSize;++y)for(var b=y*m,w=y*t.strides[0],x=0;x<e.inChannels;++x)for(var S=0;S<e.outHeight;++S)for(var C=S*r-l,E=Math.max(0,C),N=Math.min(e.inHeight,s+C),_=b+S*g,I=0;I<e.outWidth;++I){for(var T=I*o-c,A=Math.max(0,T),k=Math.min(e.inWidth,u+T),R=p,O=0,D=0,M=E;M<N;M+=i){for(var P=w+M*t.strides[1],L=A;L<k;L+=a){var F=h[P+L*t.strides[2]+x];"max"===n&&F>R?R=F:"avg"===n&&(O+=F,D++)}if(isNaN(R))break}d[_+I*v+x]="avg"===n?O/D:R}return f.toTensor()},t.prototype.maxPool=function(t,e){return this.pool(t,e,"max")},t.prototype.maxPoolPositions=function(t,e){for(var n=zy(e.outShape,"int32"),r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=e.padInfo.top,c=e.padInfo.left,p=t.bufferSync(),h=0;h<e.batchSize;++h)for(var f=0;f<e.inChannels;++f)for(var d=0;d<e.outHeight;++d){for(var m=d*r-l,g=m;g<0;)g+=i;for(var v=Math.min(e.inHeight,s+m),y=0;y<e.outWidth;++y){for(var b=y*o-c,w=b;w<0;)w+=a;for(var x=Math.min(e.inWidth,u+b),S=Number.NEGATIVE_INFINITY,C=-1,E=g;E<v;E+=i)for(var N=E-m,_=w;_<x;_+=a){var I=_-b,T=p.get(h,E,_,f);T>S&&(S=T,C=N*u+I)}n.set(C,h,d,y,f)}}return n.toTensor()},t.prototype.maxPoolBackprop=function(t,e,n,r){this.assertNotComplex([e,n],"maxPoolBackprop");for(var o=this.maxPoolPositions(e,r),i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,p=c-1-r.padInfo.left,h=l-1-r.padInfo.top,f=zy(e.shape,"float32"),d=o.bufferSync(),m=t.bufferSync(),g=0;g<r.batchSize;++g)for(var v=0;v<r.inChannels;++v)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var w=y-h,x=b-p,S=0,C=0;C<l;C+=s){var E=(w+C)/i;if(!(E<0||E>=r.outHeight||Math.floor(E)!==E))for(var N=0;N<c;N+=u){var _=(x+N)/a;if(!(_<0||_>=r.outWidth||Math.floor(_)!==_)){var I=l*c-1-d.get(g,E,_,v)===C*c+N?1:0;0!==I&&(S+=m.get(g,E,_,v)*I)}}}f.set(S,g,y,b,v)}return f.toTensor()},t.prototype.avgPoolBackprop=function(t,e,n){this.assertNotComplex([t,e],"avgPoolBackprop");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,p=c-1-n.padInfo.left,h=l-1-n.padInfo.top,f=zy(e.shape,"float32"),d=1/(i*a),m=t.bufferSync(),g=0;g<n.batchSize;++g)for(var v=0;v<n.inChannels;++v)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var w=y-h,x=b-p,S=0,C=0;C<l;C+=s){var E=(w+C)/r;if(!(E<0||E>=n.outHeight||Math.floor(E)!==E))for(var N=0;N<c;N+=u){var _=(x+N)/o;_<0||_>=n.outWidth||Math.floor(_)!==_||(S+=m.get(g,E,_,v))}}f.set(S*d,g,y,b,v)}return f.toTensor()},t.prototype.cast=function(t,e){return fm(t,e,this)},t.prototype.reshape=function(t,e){return dm(t,e)},t.prototype.avgPool=function(t,e){return this.assertNotComplex(t,"avgPool"),this.pool(t,e,"avg").toFloat()},t.prototype.resizeBilinear=function(t,e,n,r){this.assertNotComplex(t,"resizeBilinear");for(var o=t.shape,i=o[0],a=o[1],s=o[2],u=o[3],l=t.dataSync(),c=new Float32Array(Jh([i,e,n,u])),p=[r&&e>1?a-1:a,r&&n>1?s-1:s],h=[r&&e>1?e-1:e,r&&n>1?n-1:n],f=0,d=p[0]/h[0],m=p[1]/h[1],g=0;g<i;g++)for(var v=0;v<e;v++)for(var y=d*v,b=Math.floor(y),w=y-b,x=Math.min(a-1,Math.ceil(y)),S=g*t.strides[0]+b*t.strides[1],C=g*t.strides[0]+x*t.strides[1],E=0;E<n;E++)for(var N=m*E,_=Math.floor(N),I=N-_,T=Math.min(s-1,Math.ceil(N)),A=S+_*t.strides[2],k=C+_*t.strides[2],R=S+ +T*t.strides[2],O=C+T*t.strides[2],D=0;D<u;D++){var M=l[A+D],P=l[k+D],L=M+(l[R+D]-M)*I;c[f++]=L+(P+(l[O+D]-P)*I-L)*w}return Jd(c,[i,e,n,u])},t.prototype.resizeBilinearBackprop=function(t,e,n){this.assertNotComplex([t,e],"resizeBilinearBackprop");for(var r=e.shape,o=r[0],i=r[1],a=r[2],s=r[3],u=t.shape,l=u[1],c=u[2],p=new Float32Array(o*i*a*s),h=[n&&l>1?i-1:i,n&&c>1?a-1:a],f=[n&&l>1?l-1:l,n&&c>1?c-1:c],d=h[0]/f[0],m=h[1]/f[1],g=t.dataSync(),v=0,y=0;y<o;y++)for(var b=y*e.strides[0],w=0;w<l;w++)for(var x=w*d,S=Math.floor(x),C=Math.min(Math.ceil(x),i-1),E=b+S*e.strides[1],N=b+C*e.strides[1],_=x-S,I=1-_,T=0;T<c;T++)for(var A=T*m,k=Math.floor(A),R=Math.min(Math.ceil(A),a-1),O=A-k,D=1-O,M=E+k*e.strides[2],P=E+R*e.strides[2],L=N+k*e.strides[2],F=N+R*e.strides[2],z=I*D,B=I*O,U=_*D,V=_*O,j=0;j<s;j++){var W=g[v++];p[M+j]+=W*z,p[P+j]+=W*B,p[L+j]+=W*U,p[F+j]+=W*V}return om(p,[o,a,i,s],e.dtype)},t.prototype.resizeNearestNeighbor=function(t,e,n,r){this.assertNotComplex(t,"resizeNearestNeighbor");for(var o=t.shape,i=o[0],a=o[1],s=o[2],u=o[3],l=t.dataSync(),c=new Float32Array(i*e*n*u),p=[r&&e>1?a-1:a,r&&n>1?s-1:s],h=[r&&e>1?e-1:e,r&&n>1?n-1:n],f=p[0]/h[0],d=p[1]/h[1],m=0,g=0;g<i;g++)for(var v=g*t.strides[0],y=0;y<e;y++)for(var b=f*y,w=v+Math.min(a-1,r?Math.round(b):Math.floor(b))*t.strides[1],x=0;x<n;x++)for(var S=d*x,C=w+Math.min(s-1,r?Math.round(S):Math.floor(S))*t.strides[2],E=0;E<u;E++)c[m++]=l[C+E];return Jd(c,[i,e,n,u],t.dtype)},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){this.assertNotComplex([t,e],"resizeNearestNeighborBackprop");for(var r=e.shape,o=r[0],i=r[1],a=r[2],s=r[3],u=t.shape,l=u[1],c=u[2],p=new Float32Array(o*i*a*s),h=t.dataSync(),f=[n&&l>1?i-1:i,n&&c>1?a-1:a],d=[n&&l>1?l-1:l,n&&c>1?c-1:c],m=f[0]/d[0],g=f[1]/d[1],v=1/m,y=1/g,b=2*Math.ceil(v)+2,w=2*Math.ceil(y)+2,x=0;x<o;x++)for(var S=x*e.strides[0],C=0;C<i;C++)for(var E=S+C*e.strides[1],N=Math.floor(C*v),_=Math.floor(N-b/2),I=0;I<a;I++)for(var T=E+I*e.strides[2],A=Math.floor(I*y),k=Math.floor(A-w/2),R=0;R<s;R++){for(var O=0,D=0;D<b;D++){var M=D+_;if(!(M<0||M>=l)){var P=S+M*t.strides[1],L=M*m;if(C===Math.min(i-1,n?Math.round(L):Math.floor(L)))for(var F=0;F<w;F++){var z=F+k;if(!(z<0||z>=c)){var B=P+z*t.strides[2],U=z*g;I===Math.min(a-1,n?Math.round(U):Math.floor(U))&&(O+=h[B+R])}}}}p[T+R]=O}return om(p,e.shape,e.dtype)},t.prototype.batchNormalization=function(t,e,n,r,o,i){this.assertNotComplex([t,e,n,o,i],"batchNorm");for(var a=t.dataSync(),s=e.dataSync(),u=n.dataSync(),l=o?o.dataSync():new Float32Array([1]),c=i?i.dataSync():new Float32Array([0]),p=new Float32Array(a.length),h=c.length,f=l.length,d=u.length,m=s.length,g=0,v=0,y=0,b=0,w=0;w<a.length;++w)p[w]=c[g++]+(a[w]-s[v++])*l[y++]/Math.sqrt(u[b++]+r),g>=h&&(g=0),v>=m&&(v=0),y>=f&&(y=0),b>=d&&(b=0);return om(p,t.shape)},t.prototype.localResponseNormalization4D=function(t,e,n,r,o){this.assertNotComplex(t,"localResponseNormalization4D");var i=t.shape[3],a=i-1,s=t.dataSync(),u=Jh(t.shape),l=new Float32Array(u);function c(t){for(var n=t%i,r=t-n+Math.max(0,n-e),o=t-n+Math.min(n+e,a),u=0;r<=o;r++){var l=s[r];u+=l*l}return u}for(var p=0;p<u;p++){var h=c(p),f=s[p]*Math.pow(n+r*h,-o);l[p]=f}return om(l,t.shape)},t.prototype.LRNGrad=function(t,e,n,r,o,i,a){this.assertNotComplex(t,"LRNGrad");for(var s=t.shape[3],u=t.dataSync(),l=e.dataSync(),c=n.dataSync(),p=new Float32Array(Jh(t.shape)),h=Jh(t.shape),f=0;f<h;f++){for(var d=f%s,m=f-d+Math.max(0,d-r),g=f-d+Math.min(s,d+r+1),v=0,y=m;y<g;y++)v+=Math.pow(l[y],2);for(v=i*v+o,y=m;y<g;y++){var b=-2*i*a*l[y]*c[f]/v;f===y&&(b+=Math.pow(v,-a)),p[y]+=b*=u[f]}}return om(p,t.shape)},t.prototype.multinomial=function(t,e,n,r){this.assertNotComplex(t,"multinomial");for(var o=e?t:$d(t),i=o.shape[0],a=o.shape[1],s=am([i,n],"int32"),u=s.dataSync(),l=o.dataSync(),c=0;c<i;++c){var p=c*a,h=new Float32Array(a-1);h[0]=l[p];for(var f=1;f<h.length;++f)h[f]=h[f-1]+l[p+f];for(var d=Ly(r.toString()),m=c*n,g=0;g<n;++g){var v=d();u[m+g]=h.length;for(var y=0;y<h.length;y++)if(v<h[y]){u[m+g]=y;break}}}return s},t.prototype.oneHot=function(t,e,n,r){this.assertNotComplex(t,"oneHot");var o=new Float32Array(t.size*e);o.fill(r);for(var i=t.dataSync(),a=0;a<t.size;++a)i[a]>=0&&i[a]<e&&(o[a*e+i[a]]=n);return nm(o,[t.size,e],"int32")},t.prototype.nonMaxSuppression=function(t,e,n,r,o){return this.assertNotComplex(t,"nonMaxSuppression"),bm(t.dataSync(),e.dataSync(),n,r,o)},t.prototype.fft=function(t){return this.fftBatch(t,!1)},t.prototype.ifft=function(t){return this.fftBatch(t,!0)},t.prototype.fftBatch=function(t,e){for(var n=t.shape[0],r=t.shape[1],o=zy(t.shape,"float32"),i=zy(t.shape,"float32"),a=Yd(t).as2D(n,r),s=Qd(t).as2D(n,r),u=0;u<n;u++)for(var l=a.slice([u,0],[1,r]),c=s.slice([u,0],[1,r]),p=Zd(l,c),h=this.fftImpl(p,e).dataSync(),f=0;f<r;f++){var d=gm(h,f);o.values[u*r+f]=d.real,i.values[u*r+f]=d.imag}return Zd(o.toTensor(),i.toTensor()).as2D(n,r)},t.prototype.fftImpl=function(t,e){var n=t.as1D(),r=n.size;if(this.isExponentOf2(r)){var o=this.fftRadix2(n,r,e).as2D(t.shape[0],t.shape[1]);return e&&(o=Zd(Yd(o).div(tm(r)),Qd(o).div(tm(r)))),o}var i=t.dataSync(),a=function(t){for(var e=new Float32Array(t.length/2),n=new Float32Array(t.length/2),r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}}(this.fourierTransformByMatmul(i,r,e));return Zd(a.real,a.imag).as2D(t.shape[0],t.shape[1])},t.prototype.isExponentOf2=function(t){return 0==(t&t-1)},t.prototype.fftRadix2=function(t,e,n){if(1===e)return t;var r=t.dataSync(),o=e/2,i=function(t){for(var e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e),o=0;o<t.length;o+=4)n[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:n,imag:r}}(r),a=Zd(i.real,i.imag).as1D(),s=function(t){for(var e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e),o=2;o<t.length;o+=4)n[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:n,imag:r}}(r),u=Zd(s.real,s.imag).as1D();a=this.fftRadix2(a,o,n),u=this.fftRadix2(u,o,n);var l=function(t,e){for(var n=new Float32Array(t/2),r=new Float32Array(t/2),o=0;o<Math.ceil(t/2);o++){var i=(e?2:-2)*Math.PI*(o/t);n[o]=Math.cos(i),r[o]=Math.sin(i)}return{real:n,imag:r}}(e,n),c=Zd(l.real,l.imag).mul(u),p=a.add(c),h=a.sub(c),f=Yd(p).concat(Yd(h)),d=Qd(p).concat(Qd(h));return Zd(f,d).as1D()},t.prototype.fourierTransformByMatmul=function(t,e,n){for(var r=new Float32Array(2*e),o=0;o<e;o++){for(var i=0,a=0,s=0;s<e;s++){var u=ym(o*s,e,n),l=gm(t,s);i+=l.real*u.real-l.imag*u.imag,a+=l.real*u.imag+l.imag*u.real}n&&(i/=e,a/=e),vm(r,i,a,o)}return r},t.prototype.depthToSpace=function(t,e,n){Xh("NHWC"===n,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n}),Xh(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});for(var r=t.shape[0],o=t.shape[1],i=t.shape[2],a=t.shape[3],s=o*e,u=i*e,l=a/(e*e),c=t.dataSync(),p=new Float32Array(r*s*u*l),h=0,f=0;f<r;++f)for(var d=0;d<s;++d)for(var m=Math.floor(d/e),g=d%e,v=0;v<u;++v)for(var y=Math.floor(v/e),b=(g*e+v%e)*l,w=0;w<l;++w)p[h++]=c[w+b+a*(y+i*(m+o*f))];return om(p,[r,s,u,l])},t.prototype.broadcastedBinaryOp=function(t,e,n,r){var o=Tm(t.shape,e.shape),i=zy(o,n),a=t.dataSync(),s=e.dataSync(),u=_m(t.shape,o),l=_m(e.shape,o),c=i.values;if(u.length+l.length===0)for(var p=0;p<c.length;++p)c[p]=r(a[p%a.length],s[p%s.length]);else{var h=t.bufferSync(),f=e.bufferSync(),d=function(n){var o=i.indexToLoc(n),p=o.slice(-t.rank);u.forEach(function(t){return p[t]=0});var d=h.locToIndex(p),m=o.slice(-e.rank);l.forEach(function(t){return m[t]=0});var g=f.locToIndex(m);c[n]=r(a[d],s[g])};for(p=0;p<c.length;++p)d(p)}return i.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(t,e,n){var r=Tm(t.shape,e.shape),o=zy(r,"float32"),i=zy(r,"float32"),a=t.dataSync(),s=e.dataSync(),u=_m(t.shape,r),l=_m(e.shape,r),c=o.values,p=i.values;if(u.length+l.length===0)for(var h=0;h<c.length;h++){var f=h%a.length,d=h%s.length,m=n(a[2*f],a[2*f+1],s[2*d],s[2*d+1]);c[h]=m.real,p[h]=m.imag}else{var g=this.data.get(t.dataId).complexTensors.real.bufferSync(),v=this.data.get(e.dataId).complexTensors.real.bufferSync(),y=function(r){var i=o.indexToLoc(r),h=i.slice(-t.rank);u.forEach(function(t){return h[t]=0});var f=g.locToIndex(h),d=i.slice(-e.rank);l.forEach(function(t){return d[t]=0});var m=v.locToIndex(d),y=n(a[2*f],a[2*f+1],s[2*m],s[2*m+1]);c[r]=y.real,p[r]=y.imag};for(h=0;h<c.length;h++)y(h)}return this.complex(o.toTensor(),i.toTensor())},t.prototype.split=function(t,e,n){return xm(t,e,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.cropAndResize=function(t,e,n,r,o,i){for(var a=t.shape,s=a[0],u=a[1],l=a[2],c=a[3],p=e.shape[0],h=r[0],f=r[1],d=zy([p,h,f,c],t.dtype),m=e.dataSync(),g=n.dataSync(),v=t.dataSync(),y=t.strides,b=d.strides,w=0;w<p;w++){var x=4*w,S=m[x],C=m[x+1],E=m[x+2],N=m[x+3],_=g[w];if(!(_>=s))for(var I=h>1?(E-S)*(u-1)/(h-1):0,T=f>1?(N-C)*(l-1)/(f-1):0,A=0;A<h;A++){var k=h>1?S*(u-1)+A*I:.5*(S+E)*(u-1);if(k<0||k>u-1)for(var R=0;R<f;R++)for(var O=0;O<c;O++){var D=O+R*b[2]+A*b[1]+w*b[0];d.values[D]=i}else if("bilinear"===o){var M=Math.floor(k),P=Math.ceil(k),L=k-M;for(R=0;R<f;R++)if((q=f>1?C*(l-1)+R*T:.5*(C+N)*(l-1))<0||q>l-1)for(O=0;O<c;O++)d.values[D=O+R*b[2]+A*b[1]+w*b[0]]=i;else{var F=Math.floor(q),z=Math.ceil(q),B=q-F;for(O=0;O<c;O++){var U=v[D=O+F*y[2]+M*y[1]+_*y[0]],V=v[D=O+z*y[2]+M*y[1]+_*y[0]],j=v[D=O+F*y[2]+P*y[1]+_*y[0]],W=U+(V-U)*B,H=j+(v[D=O+z*y[2]+P*y[1]+_*y[0]]-j)*B;d.values[D=O+R*b[2]+A*b[1]+w*b[0]]=W+(H-W)*L}}}else for(R=0;R<f;++R){var q;if((q=f>1?C*(l-1)+R*T:.5*(C+N)*(l-1))<0||q>l-1)for(O=0;O<c;O++)d.values[D=O+R*b[2]+A*b[1]+w*b[0]]=i;else{var G=Math.round(q),K=Math.round(k);for(O=0;O<c;O++)d.values[O+R*b[2]+A*b[1]+w*b[0]]=v[O+G*y[2]+K*y[1]+_*y[0]]}}}}return d.toTensor()},t.prototype.sparseToDense=function(t,e,n,r){var o=Fd(0,t,n);return this.scatter(t,e,n,o.outputSize,o.sliceSize,o.numUpdates,o.sliceRank,o.strides,r,!1)},t.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],o=Md(t,e),i=o[0],a=o[1],s=o[2],u=o[3];if(0===a)return Jd([],i,t.dtype);for(var l=new Ff([a,s],t.dtype),c=e.dataSync(),p=t.dataSync(),h=0;h<a;h++){for(var f=[],d=0,m=0;m<r;m++){var g=c[h*r+m];d+=g*u[m],f.push(g)}if(d<0||d>=t.size/s)throw new Error("Invalid indices: "+f+" does not index into "+t.shape);for(var v=0;v<s;v++)l.values[h*s+v]=p[d*s+v]}return l.toTensor().reshape(i)},t.prototype.scatterND=function(t,e,n){var r=Fd(0,t,n),o=r.sliceRank,i=r.numUpdates,a=r.sliceSize,s=r.strides,u=r.outputSize,l=tm(0);return this.scatter(t,e,n,u,a,i,o,s,l,!0)},t.prototype.fill=function(t,e,n){var r=pf(n=n||xf(e),Jh(t));return r.fill(e),Vf.make(t,{values:r},n)},t.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},t.prototype.zerosLike=function(t){var e=pf(t.dtype,Jh(t.shape));return Vf.make(t.shape,{values:e},t.dtype)},t.prototype.scatter=function(t,e,n,r,o,i,a,s,u,l){var c=[r/o,o],p=t.dataSync(),h=e.dataSync();if(0===r)return Jd([],n,e.dtype);var f=new Ff(c,e.dtype);f.values.fill(u.dataSync()[0]);for(var d=0;d<i;d++){for(var m=[],g=0,v=0;v<a;v++){var y=p[d*a+v];m.push(y),g+=y*s[v]}if(g<0||g>=r/o)throw new Error("Invalid indices: "+m+" does not index into "+n);for(var b=0;b<o;b++)l?f.values[g*o+b]+=h[d*o+b]:f.values[g*o+b]=0===e.rank?h[0]:h[d*o+b]}return f.toTensor().reshape(n)},t}();md.registerBackend("cpu",function(){return new MS},1);var PS="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:function(t){return t()};function LS(){return new Promise(function(t){return PS(function(){return t()})})}var FS={float32:4,int32:4,uint16:2,uint8:1,bool:1};function zS(t,e){for(var n={},r=0,o=function(e){var o=e.name,i=e.dtype,a=e.shape,s=Jh(a),u=void 0;if("quantization"in e){var l=e.quantization;if("uint8"!==l.dtype&&"uint16"!==l.dtype)throw new Error("Weight "+e.name+" has unknown quantization dtype "+l.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var c=FS[l.dtype],p=t.slice(r,r+s*c),h="uint8"===l.dtype?new Uint8Array(p):new Uint16Array(p);if("float32"===i)u=Float32Array.from(h,function(t){return t*l.scale+l.min});else{if("int32"!==i)throw new Error("Unsupported dtype in weight '"+o+"': "+i);u=Int32Array.from(h,function(t){return Math.round(t*l.scale+l.min)})}r+=s*c}else{var f=FS[i];if(p=t.slice(r,r+s*f),"float32"===i)u=new Float32Array(p);else if("int32"===i)u=new Int32Array(p);else{if("bool"!==i)throw new Error("Unsupported dtype in weight '"+o+"': "+i);u=new Uint8Array(p)}r+=s*f}var d=void 0;if("float32"===i)d=Jd(u,a,"float32");else if("int32"===i)d=Jd(u,a,"int32");else{if("bool"!==i)throw new Error("Unsupported dtype in weight '"+o+"': "+i);d=Jd(u,a,"bool")}n[o]=d},i=0,a=e;i<a.length;i++)o(a[i]);return n}function BS(t){if(null===t)throw new Error("Invalid input value: "+JSON.stringify(t));var e=0,n=[];t.forEach(function(t){if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+t.constructor.name)});var r=new Uint8Array(e),o=0;return n.forEach(function(t){r.set(new Uint8Array(t.buffer),o),o+=t.byteLength}),r.buffer}var US="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function VS(t){return US?Buffer.byteLength(t):new Blob([t]).size}function jS(t){var e=0;t.forEach(function(t){e+=t.byteLength});var n=new Uint8Array(e),r=0;return t.forEach(function(t){n.set(new Uint8Array(t),r),r+=t.byteLength}),n.buffer}function WS(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);var e=t.split("/");return e[e.length-1]}function HS(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:VS(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:VS(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}var qS=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerSaveRouter=function(e){t.getInstance().saveRouters.push(e)},t.registerLoadRouter=function(e){t.getInstance().loadRouters.push(e)},t.getSaveHandlers=function(e){return t.getHandlers(e,"save")},t.getLoadHandlers=function(e,n){return t.getHandlers(e,"load",n)},t.getHandlers=function(e,n,r){var o=[];return("load"===n?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(function(t){var n=t(e,r);null!==n&&o.push(n)}),o},t}(),GS="://",KS=function(){function t(){this.managers={}}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerManager=function(e,n){Xh(null!=e,function(){return"scheme must not be undefined or null."}),e.endsWith(GS)&&(e=e.slice(0,e.indexOf(GS))),Xh(e.length>0,function(){return"scheme must not be an empty string."});var r=t.getInstance();Xh(null==r.managers[e],function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=n},t.getManager=function(t){var e=this.getInstance().managers[t];if(null==e)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();function $S(t){if(-1===t.indexOf(GS))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+KS.getSchemes().join(","));return{scheme:t.split(GS)[0],path:t.split(GS)[1]}}function XS(t,e,n){return void 0===n&&(n=!1),Bh(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,p;return Uh(this,function(h){switch(h.label){case 0:return Xh(t!==e,function(){return"Old path and new path are the same: '"+t+"'"}),Xh((r=qS.getLoadHandlers(t)).length>0,function(){return"Copying failed because no load handler is found for source URL "+t+"."}),Xh(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+t+"."}),o=r[0],Xh((i=qS.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),Xh(i.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."}),a=i[0],s=$S(t).scheme,u=$S(t).path,l=s===$S(t).scheme,[4,o.load()];case 1:return c=h.sent(),n&&l?[4,KS.getManager(s).removeModel(u)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,a.save(c)];case 4:return p=h.sent(),!n||l?[3,6]:[4,KS.getManager(s).removeModel(u)];case 5:h.sent(),h.label=6;case 6:return[2,p.modelArtifactsInfo]}})})}var ZS="models_store",YS="model_info_store";function QS(){if(!md.get("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function JS(t){var e=t.result;e.createObjectStore(ZS,{keyPath:"modelPath"}),e.createObjectStore(YS,{keyPath:"modelPath"})}var tC=function(){function t(t){if(this.indexedDB=QS(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return t.prototype.save=function(t){return Bh(this,void 0,void 0,function(){return Uh(this,function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},t.prototype.load=function(){return Bh(this,void 0,void 0,function(){return Uh(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},t.prototype.databaseAction=function(t,e){var n=this;return new Promise(function(t,r){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return JS(o)},o.onsuccess=function(){var i=o.result;if(null==e){var a=i.transaction(ZS,"readonly"),s=a.objectStore(ZS).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));t(s.result.modelArtifacts)},s.onerror=function(t){return i.close(),r(s.error)},a.oncomplete=function(){return i.close()}}else{var u,l=HS(e),c=i.transaction(YS,"readwrite"),p=c.objectStore(YS),h=p.put({modelPath:n.modelPath,modelArtifactsInfo:l});h.onsuccess=function(){var o=(u=i.transaction(ZS,"readwrite")).objectStore(ZS).put({modelPath:n.modelPath,modelArtifacts:e,modelArtifactsInfo:l});o.onsuccess=function(){return t({modelArtifactsInfo:l})},o.onerror=function(t){var e=(p=c.objectStore(YS)).delete(n.modelPath);e.onsuccess=function(){return i.close(),r(o.error)},e.onerror=function(t){return i.close(),r(o.error)}}},h.onerror=function(t){return i.close(),r(h.error)},c.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},o.onerror=function(t){return r(o.error)}})},t.URL_SCHEME="indexeddb://",t}(),eC=function(t){return md.get("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(tC.URL_SCHEME)?function(t){return new tC(t)}(t.slice(tC.URL_SCHEME.length)):null};qS.registerSaveRouter(eC),qS.registerLoadRouter(eC);var nC=function(){function t(){this.indexedDB=QS()}return t.prototype.listModels=function(){return Bh(this,void 0,void 0,function(){var t=this;return Uh(this,function(e){return[2,new Promise(function(e,n){var r=t.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return JS(r)},r.onsuccess=function(){var t=r.result,o=t.transaction(YS,"readonly"),i=o.objectStore(YS).getAll();i.onsuccess=function(){for(var t={},n=0,r=i.result;n<r.length;n++){var o=r[n];t[o.modelPath]=o.modelArtifactsInfo}e(t)},i.onerror=function(e){return t.close(),n(i.error)},o.oncomplete=function(){return t.close()}},r.onerror=function(t){return n(r.error)}})]})})},t.prototype.removeModel=function(t){return Bh(this,void 0,void 0,function(){var e=this;return Uh(this,function(n){return t=function(t){return t.startsWith(tC.URL_SCHEME)?t.slice(tC.URL_SCHEME.length):t}(t),[2,new Promise(function(n,r){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return JS(o)},o.onsuccess=function(){var e,i=o.result,a=i.transaction(YS,"readwrite"),s=a.objectStore(YS),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var o=s.delete(t),a=function(){var o=(e=i.transaction(ZS,"readwrite")).objectStore(ZS).delete(t);o.onsuccess=function(){return n(u.result.modelArtifactsInfo)},o.onerror=function(t){return r(u.error)}};o.onsuccess=a,o.onerror=function(t){return a(),i.close(),r(u.error)}},u.onerror=function(t){return i.close(),r(u.error)},a.oncomplete=function(){null==e?i.close():e.oncomplete=function(){return i.close()}}},o.onerror=function(t){return r(o.error)}})]})})},t}();if(md.get("IS_BROWSER"))try{KS.registerManager(tC.URL_SCHEME,new nC)}catch($f){}var rC="/",oC="tensorflowjs_models",iC="info",aC="model_topology",sC="weight_specs",uC="weight_data",lC="model_metadata";function cC(t){return{info:[oC,t,iC].join(rC),topology:[oC,t,aC].join(rC),weightSpecs:[oC,t,sC].join(rC),weightData:[oC,t,uC].join(rC),modelMetadata:[oC,t,lC].join(rC)}}function pC(t){var e=t.split(rC);if(e.length<3)throw new Error("Invalid key format: "+t);return e.slice(1,e.length-1).join(rC)}var hC=function(){function t(t){if(!md.get("IS_BROWSER")||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=cC(this.modelPath)}return t.prototype.save=function(t){return Bh(this,void 0,void 0,function(){var e,n,r,o;return Uh(this,function(i){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=HS(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){return US?Buffer.from(t).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(t)))}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy})),[2,{modelArtifactsInfo:r}]}catch(t){for(o in this.keys)this.LS.removeItem(this.keys[o]);throw new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]})})},t.prototype.load=function(){return Bh(this,void 0,void 0,function(){var t,e,n,r,o,i,a;return Uh(this,function(s){if(null==(t=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=r,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(i=JSON.parse(o),e.format=i.format,e.generatedBy=i.generatedBy,e.convertedBy=i.convertedBy),null==(a=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(t){if(US){var e=Buffer.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var n=atob(t),r=new Uint8Array(n.length),o=0;o<n.length;++o)r.set([n.charCodeAt(o)],o);return r.buffer}(a),[2,e]})})},t.URL_SCHEME="localstorage://",t}(),fC=function(t){return md.get("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(hC.URL_SCHEME)?function(t){return new hC(t)}(t.slice(hC.URL_SCHEME.length)):null};qS.registerSaveRouter(fC),qS.registerLoadRouter(fC);var dC=function(){function t(){Xh(md.get("IS_BROWSER"),function(){return"Current environment is not a web browser"}),Xh(void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return t.prototype.listModels=function(){return Bh(this,void 0,void 0,function(){var t,e,n,r,o,i;return Uh(this,function(a){for(t={},e=oC+rC,n=rC+iC,r=0;r<this.LS.length;++r)(o=this.LS.key(r)).startsWith(e)&&o.endsWith(n)&&(i=pC(o),t[i]=JSON.parse(this.LS.getItem(o)));return[2,t]})})},t.prototype.removeModel=function(t){return Bh(this,void 0,void 0,function(){var e,n;return Uh(this,function(r){if(t=function(t){return t.startsWith(hC.URL_SCHEME)?t.slice(hC.URL_SCHEME.length):t}(t),e=cC(t),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+t+"'");return n=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,n]})})},t}();if(md.get("IS_BROWSER"))try{KS.registerManager(hC.URL_SCHEME,new dC)}catch($f){}var mC="model",gC=".json",vC=".weights.bin",yC=function(){function t(e){if(!md.get("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),null!=e&&0!==e.length||(e=mC),this.modelTopologyFileName=e+gC,this.weightDataFileName=e+vC}return t.prototype.save=function(t){return Bh(this,void 0,void 0,function(){var e,n,r,o;return Uh(this,function(i){if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");return n=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]})],{type:"application/json"})),(r=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,r.href=n,r.click(),null!=t.weightData&&((o=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,o.href=e,o.click()),[2,{modelArtifactsInfo:HS(t)}]})})},t.URL_SCHEME="downloads://",t}(),bC=function(){function t(t){if(null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return t.prototype.load=function(){return Bh(this,void 0,void 0,function(){var t,e,n=this;return Uh(this,function(r){return t=this.files[0],e=this.files.slice(1),[2,new Promise(function(r,o){var i=new FileReader;i.onload=function(i){var a=JSON.parse(i.target.result),s=a.modelTopology;if(null!=s){0===e.length&&r({modelTopology:s});var u=a.weightsManifest;if(null!=u){var l;try{l=n.checkManifestAndWeightFiles(u,e)}catch(t){return void o(t)}var c=[],p=[],h=[];u.forEach(function(t){t.paths.forEach(function(t){p.push(t),h.push(null)}),c.push.apply(c,t.weights)}),u.forEach(function(t){t.paths.forEach(function(t){var e=new FileReader;e.onload=function(e){var n=e.target.result,o=p.indexOf(t);h[o]=n,-1===h.indexOf(null)&&r({modelTopology:s,weightSpecs:c,weightData:jS(h)})},e.onerror=function(e){return o("Failed to weights data from file of path '"+t+"'.")},e.readAsArrayBuffer(l[t])})})}else o(new Error("weightManifest field is missing from file "+t.name))}else o(new Error("modelTopology field is missing from file "+t.name))},i.onerror=function(e){return o("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},i.readAsText(t)})]})})},t.prototype.checkManifestAndWeightFiles=function(t,e){for(var n=[],r=e.map(function(t){return WS(t.name)}),o={},i=0,a=t;i<a.length;i++)a[i].paths.forEach(function(t){var i=WS(t);if(-1!==n.indexOf(i))throw new Error("Duplicate file basename found in weights manifest: '"+i+"'");if(n.push(i),-1===r.indexOf(i))throw new Error("Weight file with basename '"+i+"' is not provided.");o[t]=e[r.indexOf(i)]});if(n.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+e.length+").");return o},t}();function wC(t,e,n,r){!function(t){Xh(null!=t&&Array.isArray(t)&&t.length>0,function(){return"promises must be a none empty array"})}(t),function(t,e){Xh(t>=0&&t<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+t}),Xh(e>=0&&e<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+e}),Xh(e>=t,function(){return"startFraction must be no more than endFraction, but got startFraction "+t+" and endFraction "+e})}(n=null==n?0:n,r=null==r?1:r);var o=0;return Promise.all(t.map(function(i){return i.then(function(i){var a=n+ ++o/t.length*(r-n);return e(a),i}),i}))}function xC(t,e){return Bh(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c;return Uh(this,function(p){switch(p.label){case 0:return null==e&&(e={}),n=null==e.fetchFunc?fetch:e.fetchFunc,r=t.map(function(t){return n(t,e.requestInit)}),o=0,i=.5,null!=e.onProgress?[3,2]:[4,Promise.all(r)];case 1:return a=p.sent(),[3,4];case 2:return[4,wC(r,e.onProgress,o,i)];case 3:a=p.sent(),p.label=4;case 4:return s=a.map(function(t){return t.arrayBuffer()}),u=.5,l=1,null!=e.onProgress?[3,6]:[4,Promise.all(s)];case 5:return c=p.sent(),[3,8];case 6:return[4,wC(s,e.onProgress,u,l)];case 7:c=p.sent(),p.label=8;case 8:return[2,c]}})})}function SC(t){var e=this;return function(n,r,o){return void 0===r&&(r=""),Bh(e,void 0,void 0,function(){var e,i,a,s,u,l,c,p,h,f;return Uh(this,function(d){switch(d.label){case 0:if(e=n.map(function(){return!1}),i={},a=null!=o?o.map(function(){return!1}):[],s=[],n.forEach(function(t,n){var r=0;t.weights.forEach(function(t){var u=FS["quantization"in t?t.quantization.dtype:t.dtype]*Jh(t.shape),l=function(){e[n]=!0,null==i[n]&&(i[n]=[]),i[n].push({manifestEntry:t,groupOffset:r,sizeBytes:u})};null!=o?o.forEach(function(e,n){e===t.name&&(l(),a[n]=!0)}):l(),s.push(t.name),r+=u})}),!a.every(function(t){return t}))throw u=o.filter(function(t,e){return!a[e]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return l=e.reduce(function(t,e,n){return e&&t.push(n),t},[]),c=[],l.forEach(function(t){n[t].paths.forEach(function(t){var e=r+(r.endsWith("/")?"":"/")+t;c.push(e)})}),[4,t(c)];case 1:return p=d.sent(),h={},f=0,l.forEach(function(t){for(var e=n[t].paths.length,r=0,o=0;o<e;o++)r+=p[f+o].byteLength;for(var a=new ArrayBuffer(r),s=new Uint8Array(a),u=0,l=0;l<e;l++){var c=new Uint8Array(p[f+l]);s.set(c,u),u+=c.byteLength}i[t].forEach(function(t){var e=zS(a.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(var n in e)h[n]=e[n]}),f+=e}),[2,h]}})})}}qS.registerSaveRouter(function(t){return md.get("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(yC.URL_SCHEME)?function(t){return void 0===t&&(t="model"),new yC(t)}(t.slice(yC.URL_SCHEME.length)):null});var CC=function(){function t(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,null==e.fetchFunc){if("undefined"==typeof fetch)throw new Error("browserHTTPRequest is not supported outside the web browser without a fetch polyfill.");e.fetchFunc=fetch.bind("undefined"==typeof window?null:window)}else Xh("function"==typeof e.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"});if(this.fetchFunc=function(t,n){return e.fetchFunc(t,n).catch(function(e){throw new Error("Request for "+t+" failed due to error: "+e)})},Xh(null!=t&&t.length>0,function(){return"URL path for browserHTTPRequest must not be null, undefined or empty."}),Array.isArray(t)&&Xh(2===t.length,function(){return"URL paths for browserHTTPRequest must have a length of 2, (actual length is "+t.length+")."}),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return t.prototype.save=function(t){return Bh(this,void 0,void 0,function(){var e,n;return Uh(this,function(r){switch(r.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,e.body.append("model.json",new Blob([JSON.stringify({modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:[{paths:["./model.weights.bin"],weights:t.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.getFetchFunc()(this.path,e)];case 1:if((n=r.sent()).ok)return[2,{modelArtifactsInfo:HS(t),responses:[n]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+n.status+".")}})})},t.prototype.load=function(){return Bh(this,void 0,void 0,function(){var t,e,n,r,o,i,a,s;return Uh(this,function(u){switch(u.label){case 0:return[4,this.getFetchFunc()(this.path,this.requestInit)];case 1:if(!(t=u.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");u.label=2;case 2:return u.trys.push([2,4,,5]),[4,t.json()];case 3:return e=u.sent(),[3,5];case 4:throw u.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(o=e.weightsManifest,null==(r=e.modelTopology)&&null==o)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==o?[3,7]:[4,this.loadWeights(o)];case 6:s=u.sent(),i=s[0],a=s[1],u.label=7;case 7:return[2,{modelTopology:r,weightSpecs:i,weightData:a}]}})})},t.prototype.loadWeights=function(t){return Bh(this,void 0,void 0,function(){var e,n,r,o,i,a,s,u,l,c;return Uh(this,function(p){switch(p.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,n=function(t){var e=t.lastIndexOf("/"),n=t.lastIndexOf("?");return[t.substring(0,e)+"/",n>e?t.substring(n):""]}(e),r=n[0],o=n[1],i=this.weightPathPrefix||r,a=[],s=0,u=t;s<u.length;s++)a.push.apply(a,u[s].weights);return l=[],t.forEach(function(t){t.paths.forEach(function(t){l.push(i+t+o)})}),[4,xC(l,{requestInit:this.requestInit,fetchFunc:this.getFetchFunc(),onProgress:this.onProgress})];case 1:return c=p.sent(),[2,[a,jS(c)]]}})})},t.prototype.getFetchFunc=function(){return this.fetchFunc},t.URL_SCHEME_REGEX=/^https?:\/\//,t}();function EC(t){return null!=t.match(CC.URL_SCHEME_REGEX)}var NC=function(t,e){return"undefined"==typeof fetch?null:(Array.isArray(t)?t.every(function(t){return EC(t)}):EC(t))?_C(t,{onProgress:e}):null};function _C(t,e){return new CC(t,e)}qS.registerSaveRouter(NC),qS.registerLoadRouter(NC);var IC=function(){function t(t,e,n){this.modelTopology=t,this.weightSpecs=e,this.weightData=n}return t.prototype.load=function(){return Bh(this,void 0,void 0,function(){var t;return Uh(this,function(e){return t={},null!=this.modelTopology&&(t=zh({modelTopology:this.modelTopology},t)),null!=this.weightSpecs&&this.weightSpecs.length>0&&(t=zh({weightSpecs:this.weightSpecs},t)),null!=this.weightData&&this.weightData.byteLength>0&&(t=zh({weightData:this.weightData},t)),[2,t]})})},t}(),TC=function(){function t(t){this.saveHandler=t}return t.prototype.save=function(t){return Bh(this,void 0,void 0,function(){return Uh(this,function(e){return[2,this.saveHandler(t)]})})},t}(),AC=Object.freeze({browserFiles:function(t){return new bC(t)},browserHTTPRequest:_C,concatenateArrayBuffers:jS,decodeWeights:zS,encodeWeights:function(t){return Bh(this,void 0,void 0,function(){var e,n,r,o;return Uh(this,function(i){switch(i.label){case 0:for(r in e=[],n=[],t){if("float32"!==(o=t[r]).dtype&&"int32"!==o.dtype&&"bool"!==o.dtype)throw new Error("Unsupported dtype in weight '"+r+"': "+o.dtype);e.push({name:r,shape:o.shape,dtype:o.dtype}),n.push(o.data())}return[4,Promise.all(n)];case 1:return[2,{data:BS(i.sent()),specs:e}]}})})},fromMemory:function(t,e,n){return new IC(t,e,n)},getLoadHandlers:function(t,e){return qS.getLoadHandlers(t)},getModelArtifactsInfoForJSON:HS,getSaveHandlers:function(t){return qS.getSaveHandlers(t)},isHTTPScheme:EC,loadWeights:function(t,e,n,r){return void 0===e&&(e=""),Bh(this,void 0,void 0,function(){return Uh(this,function(o){return[2,SC(function(t){return xC(t,{requestInit:r})})(t,e,n)]})})},registerLoadRouter:function(t){return qS.registerLoadRouter(t)},registerSaveRouter:function(t){return qS.registerSaveRouter(t)},weightsLoaderFactory:SC,withSaveHandler:function(t){return new TC(t)},copyModel:function(t,e){return Bh(this,void 0,void 0,function(){return Uh(this,function(n){switch(n.label){case 0:return[4,XS(t,e,!1)];case 1:return[2,n.sent()]}})})},listModels:function(){return Bh(this,void 0,void 0,function(){var t,e,n,r,o,i,a;return Uh(this,function(s){switch(s.label){case 0:t=KS.getSchemes(),e={},n=0,r=t,s.label=1;case 1:return n<r.length?[4,KS.getManager(o=r[n]).listModels()]:[3,4];case 2:for(a in i=s.sent())e[o+GS+a]=i[a];s.label=3;case 3:return n++,[3,1];case 4:return[2,e]}})})},moveModel:function(t,e){return Bh(this,void 0,void 0,function(){return Uh(this,function(n){switch(n.label){case 0:return[4,XS(t,e,!0)];case 1:return[2,n.sent()]}})})},removeModel:function(t){return Bh(this,void 0,void 0,function(){var e;return Uh(this,function(n){switch(n.label){case 0:return e=$S(t),[4,KS.getManager(e.scheme).removeModel(e.path)];case 1:return[2,n.sent()]}})})}}),kC=Kd({confusionMatrix_:function(t,e,n){var r=qd(t,"labels","confusionMatrix"),o=qd(e,"predictions","confusionMatrix");Xh(null==n||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),Xh(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),Xh(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),Xh(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),Xh(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var i=Ky(r.asType("int32"),n),a=Ky(o.asType("int32"),n);return i.transpose().matMul(a).asType("int32")}});Object.freeze({confusionMatrix:kC});var RC=Kd({fromPixels_:function(t,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return md.engine.fromPixels(t,e)}}),OC=Object.freeze({toPixels:function(t,e){return Bh(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c,p,h,f,d,m,g,v,y,b,w,x;return Uh(this,function(S){switch(S.label){case 0:if(n=qd(t,"img","toPixels"),t instanceof Vf||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],i=r[1],(a=2===n.rank?1:n.shape[2])>4||2===a)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return s=n.min(),u=n.max(),[4,s.data()];case 1:return l=S.sent()[0],[4,u.data()];case 2:if(c=S.sent()[0],s.dispose(),u.dispose(),"float32"===n.dtype){if(l<0||c>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+l+" - "+c+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(l<0||c>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+l+" - "+c+"].")}return[4,n.data()];case 3:for(p=S.sent(),h="float32"===n.dtype?255:1,f=new Uint8ClampedArray(i*o*4),d=0;d<o*i;++d)m=void 0,g=void 0,v=void 0,y=void 0,1===a?(m=p[d]*h,g=p[d]*h,v=p[d]*h,y=255):3===a?(m=p[3*d]*h,g=p[3*d+1]*h,v=p[3*d+2]*h,y=255):4===a&&(m=p[4*d]*h,g=p[4*d+1]*h,v=p[4*d+2]*h,y=p[4*d+3]*h),f[0+(b=4*d)]=Math.round(m),f[b+1]=Math.round(g),f[b+2]=Math.round(v),f[b+3]=Math.round(y);return null!=e&&(e.width=i,e.height=o,w=e.getContext("2d"),x=new ImageData(f,i,o),w.putImageData(x,0,0)),n!==t&&n.dispose(),[2,f]}})})},fromPixels:RC}),DC=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(t,e){return new t(e)},t}(),MC=function(){function t(){this.classNameMap={}}return t.getMap=function(){return null==t.instance&&(t.instance=new t),t.instance},t.register=function(e){t.getMap().classNameMap[e.className]=[e,e.fromConfig]},t}();function PC(t){Xh(null!=t.className,function(){return"Class being registered does not have the static className property defined."}),Xh("string"==typeof t.className,function(){return"className is required to be a string, but got type "+typeof t.className}),Xh(t.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),MC.register(t)}var LC=Object.freeze({Serializable:DC,SerializationMap:MC,registerClass:PC});function FC(t,e,n){return null==n&&(n=md.get("TEST_EPSILON")),zC(t,"number"==typeof e||"boolean"==typeof e?[e]:e,function(t,e){return BC(t,Number(e),n)})}function zC(t,e,n){if(t instanceof Vf||e instanceof Vf){if(t instanceof Vf&&e instanceof Vf){if(t.dtype!==e.dtype)throw new Error("Arrays are of different type actual: "+t.dtype+" vs expected: "+e.dtype+".");if(!tf(t.shape,e.shape))throw new Error("Arrays are of different shape actual: "+t.shape+" vs expected: "+e.shape+".")}}else{var r=t.constructor.name,o=e.constructor.name;if(r!==o)throw new Error("Arrays are of different type actual: "+r+" vs expected: "+o)}var i,a;if(i=t instanceof Vf?t.dataSync():t,a=e instanceof Vf?e.dataSync():e,i.length!==a.length)throw new Error("Arrays have different lengths actual: "+i.length+" vs expected: "+a.length+".\nActual:   "+i+".\nExpected: "+a+".");for(var s=0;s<a.length;++s){var u=i[s],l=a[s];if(!n(u,l))throw new Error("Arrays differ: actual["+s+"] = "+u+", expected["+s+"] = "+l+".\nActual:   "+i+".\nExpected: "+a+".")}}function BC(t,e,n){return!(!isNaN(t)||!isNaN(e))||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}Object.freeze({WEBGL_ENVS:{HAS_WEBGL:!0},PACKED_ENVS:{WEBGL_PACK:!0},NODE_ENVS:{IS_NODE:!0},CHROME_ENVS:{IS_CHROME:!0},BROWSER_ENVS:{IS_BROWSER:!0},CPU_ENVS:{HAS_WEBGL:!1},ALL_ENVS:{},expectArraysClose:FC,expectPromiseToFail:function(t,e){t().then(function(){return e.fail()},function(){return e()})},expectArraysEqual:function(t,e){var n="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return t instanceof Vf&&"string"===t.dtype||e instanceof Vf&&"string"===e.dtype||Array.isArray(t)&&yf(t[0])||Array.isArray(e)&&yf(e[0])?zC(t,n,function(t,e){return t==e}):FC(t,e,0)},expectNumbersClose:function(t,e,n){if(null==n&&(n=md.get("TEST_EPSILON")),!BC(t,e,n))throw new Error("Numbers differ: actual === "+t+", expected === "+e)},expectValuesInRange:function(t,e,n){var r;r=t instanceof Vf?t.dataSync():t;for(var o=0;o<r.length;o++)if(r[o]<e||r[o]>n)throw new Error("Value out of range:"+r[o]+" low: "+e+", high: "+n)},expectArrayBuffersEqual:function(t,e){expect(new Float32Array(t)).toEqual(new Float32Array(e))}}),Object.freeze({gpgpu_util:Pv,webgl_util:fv,MathBackendWebGL:pb,GPGPUContext:Lv});var UC=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Fh(e,t),e.prototype.minimize=function(t,e,n){void 0===e&&(e=!1);var r=this.computeGradients(t,n),o=r.value,i=r.grads;return this.applyGradients(i),Object.keys(i).forEach(function(t){return i[t].dispose()}),e?o:(o.dispose(),null)},e.prototype.computeGradients=function(t,e){return function(t,e){if(Xh(Sf(t),function(){return"The f passed in variableGrads(f) must be a function"}),Xh(null==e||Array.isArray(e)&&e.every(function(t){return t instanceof jf}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}),null==e)for(var n in e=[],md.engine.registeredVariables)e.push(md.engine.registeredVariables[n]);var r=e.length;Xh((e=e.filter(function(t){return t.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+r+" variables is trainable."});var o=md.engine.gradients(t,e,null,!0),i=o.value,a=o.grads;Xh(a.some(function(t){return null!=t}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),Xh(0===i.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+i.rank+" tensor"});var s={};return e.forEach(function(t,e){null!=a[e]&&(s[t.name]=a[e])}),{value:i,grads:s}}(t,e)},e.prototype.dispose=function(){},e}(DC);Object.defineProperty(UC,Symbol.hasInstance,{value:function(t){return null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients}});var VC=function(t){function e(e,n,r){void 0===r&&(r=null);var o=t.call(this)||this;return o.learningRate=e,o.rho=n,o.epsilon=r,o.accumulatedGrads={},o.accumulatedUpdates={},o.c=yd(tm(-e)),o.rhoScalar=yd(tm(n)),o.oneMinusRho=yd(tm(1-n)),null===r&&(r=md.get("EPSILON")),o.epsilonScalar=yd(tm(r)),o}return Fh(e,t),e.prototype.applyGradients=function(t){var e=this,n=function(n){var o=md.engine.registeredVariables[n];null==r.accumulatedGrads[n]&&vd(function(){e.accumulatedGrads[n]=pm(o).variable(!1)}),null==r.accumulatedUpdates[n]&&vd(function(){e.accumulatedUpdates[n]=pm(o).variable(!1)});var i=t[n],a=r.accumulatedGrads[n],s=r.accumulatedUpdates[n];vd(function(){var t=e.rhoScalar.mul(a).add(e.oneMinusRho.mul(i.square())),r=s.add(e.epsilonScalar).sqrt().div(a.add(e.epsilonScalar).sqrt()).mul(i),u=e.rhoScalar.mul(s).add(e.oneMinusRho.mul(r.square()));e.accumulatedGrads[n].assign(t),e.accumulatedUpdates[n].assign(u);var l=e.c.mul(r).add(o);o.assign(l)})},r=this;for(var o in t)n(o)},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsilonScalar.dispose(),this.rhoScalar.dispose(),this.oneMinusRho.dispose(),null!=this.accumulatedUpdates&&(Object.keys(this.accumulatedUpdates).forEach(function(e){return t.accumulatedUpdates[e].dispose()}),Object.keys(this.accumulatedGrads).forEach(function(e){return t.accumulatedGrads[e].dispose()}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.rho,e.epsilon)},e.className="AdadeltaOptimizer",e}(UC);PC(VC);var jC=function(t){function e(e,n){void 0===n&&(n=.1);var r=t.call(this)||this;return r.learningRate=e,r.initialAccumulatorValue=n,r.accumulatedGrads={},r.c=yd(tm(-e)),r.epsilon=yd(tm(md.get("EPSILON"))),r}return Fh(e,t),e.prototype.applyGradients=function(t){var e=this,n=function(n){var o=md.engine.registeredVariables[n];null==r.accumulatedGrads[n]&&vd(function(){e.accumulatedGrads[n]=sm(o.shape,e.initialAccumulatorValue).variable(!1)});var i=t[n],a=r.accumulatedGrads[n];vd(function(){var t=a.add(i.square());e.accumulatedGrads[n].assign(t);var r=e.c.mul(i.div(t.add(e.epsilon).sqrt())).add(o);o.assign(r)})},r=this;for(var o in t)n(o)},e.prototype.dispose=function(){var t=this;this.epsilon.dispose(),this.c.dispose(),null!=this.accumulatedGrads&&Object.keys(this.accumulatedGrads).forEach(function(e){return t.accumulatedGrads[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,e){return new t(e.learningRate,e.initialAccumulatorValue)},e.className="AdagradOptimizer",e}(UC);PC(jC);var WC=function(t){function e(e,n,r,o){void 0===o&&(o=null);var i=t.call(this)||this;return i.learningRate=e,i.beta1=n,i.beta2=r,i.epsilon=o,i.accumulatedFirstMoment={},i.accumulatedSecondMoment={},i.c=yd(tm(-e)),i.beta1Scalar=yd(tm(n)),i.beta2Scalar=yd(tm(r)),vd(function(){i.accBeta1=tm(n).variable(),i.accBeta2=tm(r).variable()}),i.oneMinusBeta1=yd(tm(1-n)),i.oneMinusBeta2=yd(tm(1-r)),i.one=yd(tm(1)),null===o&&(o=md.get("EPSILON")),i.epsScalar=yd(tm(o)),i}return Fh(e,t),e.prototype.applyGradients=function(t){var e=this;vd(function(){var n=e.one.sub(e.accBeta1),r=e.one.sub(e.accBeta2);for(var o in t){var i=md.engine.registeredVariables[o];if(null==e.accumulatedFirstMoment[o]){var a=!1;e.accumulatedFirstMoment[o]=pm(i).variable(a)}null==e.accumulatedSecondMoment[o]&&(a=!1,e.accumulatedSecondMoment[o]=pm(i).variable(a));var s=t[o],u=e.accumulatedSecondMoment[o],l=e.beta1Scalar.mul(e.accumulatedFirstMoment[o]).add(e.oneMinusBeta1.mul(s)),c=e.beta2Scalar.mul(u).add(e.oneMinusBeta2.mul(s.square())),p=l.div(n),h=c.div(r);e.accumulatedFirstMoment[o].assign(l),e.accumulatedSecondMoment[o].assign(c);var f=e.c.mul(p.div(e.epsScalar.add(h.sqrt()))).add(i);i.assign(f)}e.accBeta1.assign(e.accBeta1.mul(e.beta1Scalar)),e.accBeta2.assign(e.accBeta2.mul(e.beta2Scalar))})},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsScalar.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(e){return t.accumulatedFirstMoment[e].dispose()}),null!=this.accumulatedSecondMoment&&Object.keys(this.accumulatedSecondMoment).forEach(function(e){return t.accumulatedSecondMoment[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)},e.className="AdamOptimizer",e}(UC);PC(WC);var HC=function(t){function e(e,n,r,o,i){void 0===o&&(o=null),void 0===i&&(i=0);var a=t.call(this)||this;return a.learningRate=e,a.beta1=n,a.beta2=r,a.epsilon=o,a.decay=i,a.accumulatedFirstMoment={},a.accumulatedWeightedInfNorm={},a.c=yd(tm(-e)),a.beta1Scalar=yd(tm(n)),a.beta2Scalar=yd(tm(r)),a.decayScalar=yd(tm(i)),vd(function(){a.iteration=tm(0).variable(),a.accBeta1=tm(n).variable()}),a.oneMinusBeta1=yd(tm(1-n)),a.one=yd(tm(1)),null===o&&(o=md.get("EPSILON")),a.epsScalar=yd(tm(o)),a}return Fh(e,t),e.prototype.applyGradients=function(t){var e=this;vd(function(){var n=e.one.sub(e.accBeta1),r=e.c.div(e.one.add(e.decayScalar.mul(e.iteration)));for(var o in t){var i=md.engine.registeredVariables[o];if(null==e.accumulatedFirstMoment[o]){var a=!1;e.accumulatedFirstMoment[o]=pm(i).variable(a)}null==e.accumulatedWeightedInfNorm[o]&&(a=!1,e.accumulatedWeightedInfNorm[o]=pm(i).variable(a));var s=t[o],u=e.accumulatedWeightedInfNorm[o],l=e.beta1Scalar.mul(e.accumulatedFirstMoment[o]).add(e.oneMinusBeta1.mul(s)),c=e.beta2Scalar.mul(u),p=s.abs(),h=c.maximum(p);e.accumulatedFirstMoment[o].assign(l),e.accumulatedWeightedInfNorm[o].assign(h);var f=r.div(n).mul(l.div(e.epsScalar.add(h))).add(i);i.assign(f)}e.iteration.assign(e.iteration.add(e.one)),e.accBeta1.assign(e.accBeta1.mul(e.beta1Scalar))})},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsScalar.dispose(),this.accBeta1.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.oneMinusBeta1.dispose(),this.decayScalar.dispose(),this.iteration.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(e){return t.accumulatedFirstMoment[e].dispose()}),null!=this.accumulatedWeightedInfNorm&&Object.keys(this.accumulatedWeightedInfNorm).forEach(function(e){return t.accumulatedWeightedInfNorm[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)},e.className="AdamaxOptimizer",e}(UC);PC(HC);var qC=function(t){function e(e){var n=t.call(this)||this;return n.learningRate=e,n.setLearningRate(e),n}return Fh(e,t),e.prototype.applyGradients=function(t){var e=this;Object.keys(t).forEach(function(n){var r=t[n],o=md.engine.registeredVariables[n];vd(function(){var t=e.c.mul(r).add(o);o.assign(t)})})},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=yd(tm(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,e){return new t(e.learningRate)},e.className="SGDOptimizer",e}(UC);PC(qC);var GC=function(t){function e(e,n,r){void 0===r&&(r=!1);var o=t.call(this,e)||this;return o.learningRate=e,o.momentum=n,o.useNesterov=r,o.m=tm(o.momentum),o.accumulations={},o}return Fh(e,t),e.prototype.applyGradients=function(t){var e=this,n=function(n){var o=md.engine.registeredVariables[n];null==r.accumulations[n]&&vd(function(){e.accumulations[n]=pm(o).variable(!1)});var i=r.accumulations[n],a=t[n];vd(function(){var t,r=e.m.mul(i).add(a);t=e.useNesterov?e.c.mul(a.add(r.mul(e.m))).add(o):e.c.mul(r).add(o),e.accumulations[n].assign(r),o.assign(t)})},r=this;for(var o in t)n(o)},e.prototype.dispose=function(){if(t.prototype.dispose.call(this),this.m.dispose(),null!=this.accumulations)for(var e in this.accumulations)this.accumulations[e].dispose()},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)},e.className="MomentumOptimizer",e}(qC);PC(GC);var KC=function(t){function e(e,n,r,o,i){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===i&&(i=!1);var a=t.call(this)||this;return a.learningRate=e,a.decay=n,a.momentum=r,a.epsilon=o,a.accumulatedMeanSquares={},a.accumulatedMeanGrads={},a.accumulatedMoments={},a.c=yd(tm(e)),a.decayScalar=yd(tm(n)),a.momentumScalar=yd(tm(r)),a.oneMinusDecay=yd(tm(1-n)),a.centered=i,null===o&&(o=md.get("EPSILON")),a.epsilonScalar=yd(tm(o)),a}return Fh(e,t),e.prototype.applyGradients=function(t){var e=this,n=function(n){var o=md.engine.registeredVariables[n];null==r.accumulatedMeanSquares[n]&&vd(function(){e.accumulatedMeanSquares[n]=pm(o).variable(!1)}),null==r.accumulatedMeanGrads[n]&&r.centered&&vd(function(){e.accumulatedMeanGrads[n]=pm(o).variable(!1)}),null==r.accumulatedMoments[n]&&vd(function(){e.accumulatedMoments[n]=pm(o).variable(!1)});var i=r.accumulatedMeanSquares[n],a=r.accumulatedMeanGrads[n],s=r.accumulatedMoments[n],u=t[n];vd(function(){var t=e.decayScalar.mul(i).add(e.oneMinusDecay.mul(u.square()));if(e.centered){var r=e.decayScalar.mul(a).add(e.oneMinusDecay.mul(u)),l=e.momentumScalar.mul(s).add(e.c.mul(u).div(t.sub(r.square().add(e.epsilonScalar)).sqrt()));e.accumulatedMeanSquares[n].assign(t),e.accumulatedMeanGrads[n].assign(r),e.accumulatedMoments[n].assign(l);var c=o.sub(l);o.assign(c)}else{var p=e.decayScalar.mul(i).add(e.oneMinusDecay.mul(u.square()));l=e.momentumScalar.mul(s).add(e.c.mul(u).div(p.add(e.epsilonScalar).sqrt())),e.accumulatedMeanSquares[n].assign(p),e.accumulatedMoments[n].assign(l),c=o.sub(l),o.assign(c)}})},r=this;for(var o in t)n(o)},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsilonScalar.dispose(),this.decayScalar.dispose(),this.momentumScalar.dispose(),this.oneMinusDecay.dispose(),null!=this.accumulatedMeanSquares&&Object.keys(this.accumulatedMeanSquares).forEach(function(e){return t.accumulatedMeanSquares[e].dispose()}),null!=this.accumulatedMeanGrads&&this.centered&&Object.keys(this.accumulatedMeanGrads).forEach(function(e){return t.accumulatedMeanGrads[e].dispose()}),null!=this.accumulatedMoments&&Object.keys(this.accumulatedMoments).forEach(function(e){return t.accumulatedMoments[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)},e.className="RMSPropOptimizer",e}(UC);PC(KC);var $C=function(){function t(){}return t.sgd=function(t){return new qC(t)},t.momentum=function(t,e,n){return void 0===n&&(n=!1),new GC(t,e,n)},t.rmsprop=function(t,e,n,r,o){return void 0===e&&(e=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===o&&(o=!1),new KC(t,e,n,r,o)},t.adam=function(t,e,n,r){return void 0===t&&(t=.001),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new WC(t,e,n,r)},t.adadelta=function(t,e,n){return void 0===t&&(t=.001),void 0===e&&(e=.95),void 0===n&&(n=null),new VC(t,e,n)},t.adamax=function(t,e,n,r,o){return void 0===t&&(t=.002),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===o&&(o=0),new HC(t,e,n,r,o)},t.adagrad=function(t,e){return void 0===e&&(e=.1),new jC(t,e)},t}(),XC={sgd:$C.sgd,momentum:$C.momentum,adadelta:$C.adadelta,adagrad:$C.adagrad,rmsprop:$C.rmsprop,adamax:$C.adamax,adam:$C.adam},ZC=hd.memory;Bf=DS;var YC=function(t,e){return(YC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function QC(t,e){function n(){this.constructor=t}YC(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var JC,tE=function(){return(tE=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function eE(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function nE(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function rE(){return null==JC&&(JC=md.get("EPSILON")),JC}var oE=0;function iE(){return oE++}var aE={};function sE(t){return void 0===t&&(t=""),t in aE||(aE[t]=0),aE[t]+=1,t+aE[t].toString()}var uE={},lE="float32";function cE(t,e){return void 0===e&&(e=lE),null==uE[e]&&(uE[e]={}),null==uE[e][t]&&(uE[e][t]=tm(t,e),yd(uE[e][t])),uE[e][t]}var pE=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return QC(e,t),e}(Error),hE=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return QC(e,t),e}(Error),fE=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return QC(e,t),e}(Error),dE=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return QC(e,t),e}(Error),mE=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return QC(e,t),e}(Error);function gE(t,e){if(Array.isArray(t)){for(var n=[],r=0;r<e;r++)n=n.concat(t);return n}return(n=new Array(e)).fill(t),n}function vE(t,e){if(!t)throw new mE(e)}function yE(t,e){for(var n=0,r=0,o=t;r<o.length;r++)o[r]===e&&n++;return n}function bE(t){return 1===t.length?t[0]:t}function wE(t){return Array.isArray(t)?t:[t]}function xE(t){var e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==e[0]?e:"private"+e}function SE(t){return t.length<=1?t:-1===t.indexOf("_")?t:t.replace(/[_]+(\w|$)/g,function(t,e){return e.toUpperCase()})}!function(t){QC(function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r},t)}(Error);var CE={};function EE(t){if(null==t)return null;var e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function NE(t,e,n,r,o){var i,a,s;if(void 0===e&&(e={}),void 0===n&&(n={}),void 0===r&&(r="object"),void 0===o&&(o=!1),"string"==typeof t){var u=void 0;if(t in n)u=n[t];else if(t in CE)u=CE[t];else if(null==(u=e[t]))throw new fE("Unknown "+r+": "+t+". This may be due to one of the following reasons:\n1. The "+r+" is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom "+r+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");return u}var l=t;if(null==l.className||null==l.config)throw new fE(r+": Improper config format: "+JSON.stringify(l)+".\n'className' and 'config' must set.");var c=l.className,p=void 0,h=void 0;if(c in n?(p=(i=n.get(c))[0],h=i[1]):c in CE?(p=(a=CE.className)[0],h=a[1]):c in e&&(p=(s=e[c])[0],h=s[1]),null==p)throw new fE("Unknown "+r+": "+c+". This may be due to one of the following reasons:\n1. The "+r+" is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom "+r+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");if(null!=h){for(var f={},d=0,m=Object.keys(CE);d<m.length;d++)f[x=m[d]]=CE[x];for(var g=0,v=Object.keys(n);g<v.length;g++)f[x=v[g]]=n[x];l.config.customObjects=f;for(var y=tE({},CE),b=0,w=Object.keys(n);b<w.length;b++){var x=w[b];CE[x]=n[x]}!function t(e){if(null!=e&&"object"==typeof e)if(Array.isArray(e))e.forEach(function(e){return t(e)});else for(var n=0,r=Object.keys(e);n<r.length;n++){var o=r[n],i=e[o];null!=i&&"object"==typeof i&&(Array.isArray(i)||"ndarray"!==i.type||"number"!=typeof i.value?t(i):e[o]=i.value)}}(l.config);var S=h(p,l.config,n,o);return CE=tE({},y),S}y=tE({},CE);for(var C=0,E=Object.keys(n);C<E.length;C++)CE[x=E[C]]=n[x];return S=new p(l.config),CE=tE({},y),S}function _E(t,e){return-1*function(t,e){return t<e?-1:t>e?1:0}(t,e)}function IE(t){if(null==t)return t;for(var e=[],n=0,r=t;n<r.length;n++){var o=r[n];-1===e.indexOf(o)&&e.push(o)}return e}function TE(t){if(null==t)throw new fE("Invalid value in obj: "+JSON.stringify(t));for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function AE(t,e,n){if(null!=n&&t.indexOf(n)<0)throw new fE(n+" is not a valid "+e+".  Valid values are "+t+" or null/undefined.")}function kE(t,e,n,r){return void 0===n&&(n=0),void 0===r&&(r=1/0),vE(n>=0),vE(r>=n),Array.isArray(t)&&t.length>=n&&t.length<=r&&t.every(function(t){return typeof t===e})}function RE(t,e){Array.isArray(t)?(Rf.assert(t.length>0,function(){return e+" is unexpectedly an empty array."}),t.forEach(function(t,n){return RE(t,"element "+(n+1)+" of "+e)})):Rf.assert(Number.isInteger(t)&&t>0,function(){return"Expected "+e+" to be a positive integer, but got "+function t(e){return null===e?"null":Array.isArray(e)?"["+e.map(function(e){return t(e)}).join(",")+"]":"string"==typeof e?'"'+e+'"':""+e}(t)+"."})}function OE(t,e){return vd(function(){return Ub(Qw(_x(t,t),e,!0))})}var DE=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.getConfig=function(){return{}},e}(LC.Serializable),ME=function(t){function e(e){var n=t.call(this)||this;return n.defaultMaxValue=2,n.defaultAxis=0,n.maxValue=null!=e.maxValue?e.maxValue:n.defaultMaxValue,n.axis=null!=e.axis?e.axis:n.defaultAxis,n}return QC(e,t),e.prototype.apply=function(t){var e=this;return vd(function(){var n=OE(t,e.axis),r=xb(n,0,e.maxValue);return Nx(t,gx(r,hx(cE(rE()),n)))})},e.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},e.className="MaxNorm",e}(DE);LC.registerClass(ME);var PE=function(t){function e(e){var n=t.call(this)||this;return n.defaultAxis=0,n.axis=null!=e.axis?e.axis:n.defaultAxis,n}return QC(e,t),e.prototype.apply=function(t){var e=this;return vd(function(){return gx(t,hx(cE(rE()),OE(t,e.axis)))})},e.prototype.getConfig=function(){return{axis:this.axis}},e.className="UnitNorm",e}(DE);LC.registerClass(PE);var LE=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.apply=function(t){return jx(t)},e.className="NonNeg",e}(DE);LC.registerClass(LE);var FE=function(t){function e(e){var n=t.call(this)||this;return n.defaultMinValue=0,n.defaultMaxValue=1,n.defaultRate=1,n.defaultAxis=0,n.minValue=null!=e.minValue?e.minValue:n.defaultMinValue,n.maxValue=null!=e.maxValue?e.maxValue:n.defaultMaxValue,n.rate=null!=e.rate?e.rate:n.defaultRate,n.axis=null!=e.axis?e.axis:n.defaultAxis,n}return QC(e,t),e.prototype.apply=function(t){var e=this;return vd(function(){var n=OE(t,e.axis),r=hx(Nx(cE(e.rate),xb(n,e.minValue,e.maxValue)),Nx(cE(1-e.rate),n));return Nx(t,gx(r,hx(cE(rE()),n)))})},e.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},e.className="MinMaxNorm",e}(DE);LC.registerClass(FE);var zE={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function BE(t){return EE(t)}function UE(t,e){return void 0===e&&(e={}),NE(t,LC.SerializationMap.getMap().classNameMap,e,"constraint")}function VE(t){return null==t?null:"string"==typeof t?UE({className:t in zE?zE[t]:t,config:{}}):t instanceof DE?t:UE(t)}Object.freeze({maxNorm:function(t){return new ME(t)},unitNorm:function(t){return new PE(t)},nonNeg:function(){return new LE},minMaxNorm:function(t){return new FE(t)}});var jE=["channelsFirst","channelsLast"],WE=["valid","same","causal"],HE=["max","avg"],qE=["sum","mul","concat","ave"],GE=new Map;function KE(t){AE(jE,"DataFormat",t)}function $E(t){AE(WE,"PaddingMode",t)}var XE=[],ZE="/";function YE(t,e){XE.push(t);try{var n=e();return XE.pop(),n}catch(t){throw XE.pop(),t}}function QE(t){if(!eN(t))throw new Error("Not a valid tensor name: '"+t+"'");return(0===XE.length?"":XE.join(ZE)+ZE)+t}function JE(t){if(!eN(t))throw new Error("Not a valid tensor name: '"+t+"'");GE.has(t)||GE.set(t,0);var e=GE.get(t);if(GE.set(t,GE.get(t)+1),e>0){var n=t+"_"+e;return GE.set(n,1),n}return t}var tN=new RegExp(/^[A-Za-z][-A-Za-z0-9\._\/]*$/);function eN(t){return!!t.match(tN)}function nN(t){return t===parseInt(t.toString(),10)}function rN(t,e,n){null==e&&(e=0),null==n&&(n=t.length);for(var r=1,o=e;o<n;++o)r*=t[o];return r}function oN(t){return em(t=Array.isArray(t)?new Float32Array(t):t)}function iN(t){return Zw(oN(t)).dataSync()[0]}function aN(t){return $w(oN(t)).dataSync()[0]}function sN(t,e){if(e<t)throw new fE("end ("+e+") < begin ("+t+") is forbidden.");for(var n=[],r=t;r<e;++r)n.push(r);return n}function uN(t,e){return t.asType(e)}function lN(t,e){void 0===e&&(e=-1);var n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),t.reshape(n)}function cN(t,e,n){return vd(function(){switch(t.rank){case 1:return zw(t,e,n);case 2:return Bw(t,[e,0],[n,t.shape[1]]);case 3:return Uw(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return Vw(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);default:throw new fE("sliceAlongFirstAxis() received an unsupported tensor rank: "+t.rank)}})}function pN(t,e,n){return vd(function(){switch(t.rank){case 1:return zw(t,e,n);case 2:return Bw(t,[0,e],[t.shape[0],n]);case 3:return Uw(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return Vw(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new fE("sliceAlongLastAxis() received an unsupported tensor rank: "+t.rank)}})}function hN(t,e,n,r){return vd(function(){switch(t.rank){case 1:return zw(t,e,n);case 2:switch(r){case 1:return cN(t,e,n);case 2:return pN(t,e,n);default:throw new fE("The axis is not within the rank of the tensor "+r)}case 3:switch(r){case 1:return cN(t,e,n);case 2:return Uw(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return pN(t,e,n);default:throw new fE("The axis is not within the rank of the tensor "+r)}case 4:switch(r){case 1:return cN(t,e,n);case 2:return Vw(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return Vw(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return pN(t,e,n);default:throw new fE("The axis is not within the rank of the tensor "+r)}default:throw new fE("sliceAlongLastAxis() received an unsupported tensor rank: "+t.rank)}})}function fN(t,e){var n;return void 0===e&&(e=-1),e<0&&(e=0!==(n=t[0].rank)?n:0),e===t[0].rank&&(e=-1),Sy(t,e)}function dN(t,e){switch(t.rank){case 1:return Cy([t,e]);case 2:return Ey([t,e],0);case 3:return Ny([t,e],0);case 4:return _y([t,e],0);default:throw new fE("concatAlongFirstAxis() received an unsupported tensor rank: "+t.rank)}}function mN(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new fE("The length of input n ("+e.length+") does not match the number of dimensions in input x ("+t.rank+")");return ab(t,e)}function gN(t,e,n,r,o){return void 0===e&&(e=0),void 0===n&&(n=1),tb(t,e,n,r,o)}function vN(t,e){if(t.rank<2||e.rank<2)throw new dE("dot requires both inputs to be rank >= 2 but got x shape = "+t.shape+" and y shape = "+e.shape);if(e.rank>=3&&(r=t.shape.slice(-1)[0])!==(a=e.shape.slice(-2)[0]))throw new dE("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = "+t.shape+" and  y shape = "+e.shape);if(2===t.rank&&2===e.rank)return Ew(t,e);var n=t.shape.slice(),r=n.pop();t=t.reshape([-1,r]);var o=e.shape.slice(),i=o.pop(),a=o.pop(),s=o.concat([i]),u=Array.from({length:e.rank},function(t,n){return 0===n?e.rank-2:n<=e.rank-2?n-1:n});e=e.transpose(u).reshape([a,-1]);var l=n.concat(s);return Ew(t,e).reshape(l)}function yN(t,e,n){return vd(function(){return e=Array.isArray(e)?em(e,"int32"):e.toInt(),Zx(t,e,n)})}function bN(t){return _x(t,t)}function wN(t,e,n){return vd(function(){if(null==n&&(n="channelsLast"),KE(n),1!==e.rank&&e.rank!==t.rank)throw new fE("Unexpected bias dimensions: "+e.rank+"; expected it to be 1 or "+t.rank);var r,o=e.shape;if(5===t.rank)"channelsFirst"===n?r=t.add(e.reshape(1===o.length?[1,o[0],1,1,1]:[1,o[3],o[0],o[1],o[2]])):"channelsLast"===n&&(r=t.add(e.reshape(1===o.length?[1,1,1,1,o[0]]:[1].concat(o))));else if(4===t.rank)"channelsFirst"===n?r=t.add(e.reshape(1===o.length?[1,o[0],1,1]:[1,o[2],o[0],o[1]])):"channelsLast"===n&&(r=t.add(e.reshape(1===o.length?[1,1,1,o[0]]:[1].concat(o))));else if(3===t.rank)"channelsFirst"===n?r=t.add(e.reshape(1===o.length?[1,o[0],1]:[1,o[1],o[0]])):"channelsLast"===n&&(r=t.add(e.reshape(1===o.length?[1,1,o[0]]:[1].concat(o))));else{if(!(t.rank<3))throw new fE("Unsupported input rank by biasAdd: "+t.rank);r=t.add(e)}return r})}function xN(t,e,n,r){return vd(function(){if(null!=n&&!Rf.arraysEqual(t.shape,n))throw new dE("Non-default noise shape is not implemented yet: "+JSON.stringify(n));if(null!=r)throw new dE("seed is not implemented for dropout yet.");var o=jb(hx(Rb(e),eb(t.shape,0,1,"float32")));return o=Nx(gx(cE(1),Rx(cE(1),e)),o),Nx(t,o)})}function SN(t,e,n){return void 0===n&&(n=!1),n?t():e()}var CN=["fanIn","fanOut","fanAvg"],EN=["normal","uniform"],NN=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.fromConfigUsesCustomObjects=function(){return!1},e.prototype.getConfig=function(){return{}},e}(LC.Serializable),_N=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.apply=function(t,e){return am(t,e)},e.className="Zeros",e}(NN);LC.registerClass(_N);var IN=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.apply=function(t,e){return im(t,e)},e.className="Ones",e}(NN);LC.registerClass(IN);var TN=function(t){function e(e){var n=t.call(this)||this;if("object"!=typeof e)throw new fE("Expected argument of type ConstantConfig but got "+e);if(void 0===e.value)throw new fE("config must have value set but got "+e);return n.value=e.value,n}return QC(e,t),e.prototype.apply=function(t,e){var n=this;return vd(function(){return Nx(tm(n.value),im(t,e))})},e.prototype.getConfig=function(){return{value:this.value}},e.className="Constant",e}(NN);LC.registerClass(TN);var AN=function(t){function e(e){var n=t.call(this)||this;return n.DEFAULT_MINVAL=-.05,n.DEFAULT_MAXVAL=.05,n.minval=e.minval||n.DEFAULT_MINVAL,n.maxval=e.maxval||n.DEFAULT_MAXVAL,n.seed=e.seed,n}return QC(e,t),e.prototype.apply=function(t,e){return eb(t,this.minval,this.maxval,e)},e.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},e.className="RandomUniform",e}(NN);LC.registerClass(AN);var kN=function(t){function e(e){var n=t.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=e.mean||n.DEFAULT_MEAN,n.stddev=e.stddev||n.DEFAULT_STDDEV,n.seed=e.seed,n}return QC(e,t),e.prototype.apply=function(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new dE("randomNormal does not support dType "+e+".");return gN(t,this.mean,this.stddev,e,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e.className="RandomNormal",e}(NN);LC.registerClass(kN);var RN=function(t){function e(e){var n=t.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=e.mean||n.DEFAULT_MEAN,n.stddev=e.stddev||n.DEFAULT_STDDEV,n.seed=e.seed,n}return QC(e,t),e.prototype.apply=function(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new dE("truncatedNormal does not support dType "+e+".");return sb(t,this.mean,this.stddev,e,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e.className="TruncatedNormal",e}(NN);LC.registerClass(RN);var ON=function(t){function e(e){var n=t.call(this)||this;return n.gain=null!=e.gain?tm(e.gain):cE(1),n}return QC(e,t),e.prototype.apply=function(t,e){var n=this;return vd(function(){if(2!==t.length||t[0]!==t[1])throw new fE("Identity matrix initializer can only be used for 2D square matrices.");return Nx(n.gain,qy(t[0]))})},e.prototype.getConfig=function(){return{gain:this.gain.dataSync()[0]}},e.className="Identity",e}(NN);LC.registerClass(ON);var DN=function(t){function e(e){var n=t.call(this)||this;if(e.scale<0)throw new fE("scale must be a positive float. Got: "+e.scale);return n.scale=null==e.scale?1:e.scale,n.mode=e.mode,AE(CN,"FanMode",n.mode),n.distribution=e.distribution,AE(EN,"Distribution",n.distribution),n.seed=e.seed,n}return QC(e,t),e.prototype.apply=function(t,e){var n=function(t,e){var n,r;if(void 0===e&&(e="channelsLast"),KE(e),2===t.length)n=t[0],r=t[1];else if(-1!==[3,4,5].indexOf(t.length))if("channelsFirst"===e){var o=rN(t,2);n=t[1]*o,r=t[0]*o}else"channelsLast"===e&&(o=rN(t,0,t.length-2),n=t[t.length-2]*o,r=t[t.length-1]*o);else{var i=rN(t);n=Math.sqrt(i),r=Math.sqrt(i)}return[n,r]}(t),r=n[0],o=n[1],i=this.scale;if(i/="fanIn"===this.mode?Math.max(1,r):"fanOut"===this.mode?Math.max(1,o):Math.max(1,(r+o)/2),"normal"===this.distribution){var a=Math.sqrt(i);if("float32"!==(e=e||"float32")&&"int32"!==e)throw new dE(this.getClassName()+" does not support dType "+e+".");return sb(t,0,a,e,this.seed)}var s=Math.sqrt(3*i);return eb(t,-s,s,e)},e.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},e.className="VarianceScaling",e}(NN);LC.registerClass(DN);var MN=function(t){function e(e){return t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})||this}return QC(e,t),e.prototype.getClassName=function(){return DN.className},e.className="GlorotUniform",e}(DN);LC.registerClass(MN);var PN=function(t){function e(e){return t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})||this}return QC(e,t),e.prototype.getClassName=function(){return DN.className},e.className="GlorotNormal",e}(DN);LC.registerClass(PN);var LN=function(t){function e(e){return t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})||this}return QC(e,t),e.prototype.getClassName=function(){return DN.className},e.className="HeNormal",e}(DN);LC.registerClass(LN);var FN=function(t){function e(e){return t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})||this}return QC(e,t),e.prototype.getClassName=function(){return DN.className},e.className="HeUniform",e}(DN);LC.registerClass(FN);var zN=function(t){function e(e){return t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})||this}return QC(e,t),e.prototype.getClassName=function(){return DN.className},e.className="LeCunNormal",e}(DN);LC.registerClass(zN);var BN=function(t){function e(e){return t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})||this}return QC(e,t),e.prototype.getClassName=function(){return DN.className},e.className="LeCunNormal",e}(DN);LC.registerClass(BN);var UN=function(t){function e(e){var n=t.call(this)||this;if(n.DEFAULT_GAIN=1,n.gain=null==e.gain?n.DEFAULT_GAIN:e.gain,n.seed=e.seed,null!=n.seed)throw new dE("Random seed is not implemented for Orthogonal Initializer yet.");return n}return QC(e,t),e.prototype.apply=function(t,e){var n=this;return vd(function(){if(2!==t.length)throw new dE("The Orthogonal Initializer does not support non-2D shapes yet.");t[0]*t[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 ("+t[0]*t[1]+") elements: Slowness may result.");var e=gN(t[0]>t[1]?[t[1],t[0]]:t,0,1,"float32"),r=ES.gramSchmidt(e);return t[0]>t[1]&&(r=r.transpose()),Nx(cE(n.gain),r)})},e.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},e.className="Orthogonal",e}(NN);LC.registerClass(UN);var VN={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function jN(t,e){return void 0===e&&(e={}),NE(t,LC.SerializationMap.getMap().classNameMap,e,"initializer")}function WN(t){return EE(t)}function HN(t){if("string"==typeof t){var e=t in VN?VN[t]:t;if("GlorotNormal"===e)return new PN;if("GlorotUniform"===e)return new MN;if("HeNormal"===e)return new LN;if("HeUniform"===e)return new FN;if("LeCunNormal"===e)return new zN;if("LeCunUniform"===e)return new BN;var n={};return n.className=e,n.config={},jN(n)}return t instanceof NN?t:jN(t)}function qN(t){return Array.isArray(t)&&Array.isArray(t[0])}function GN(t){return 0===t.length?[]:Array.isArray(t[0])?t:[t]}function KN(t){var e;if(Array.isArray(t)){if(1!==t.length)throw new fE("Expected Tensor length to be 1; got "+t.length);e=t[0]}else e=t;return e}function $N(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(1===t.length)return(t=t)[0];throw new fE("Expected exactly 1 Shape; got "+t.length)}return t}function XN(t){for(var e=0,n=0,r=t;n<r.length;n++){var o=r[n];e+=0===o.shape.length?1:o.shape.reduce(function(t,e){return t*e})}return e}Object.freeze({zeros:function(){return new _N},ones:function(){return new IN},constant:function(t){return new TN(t)},randomUniform:function(t){return new AN(t)},randomNormal:function(t){return new kN(t)},truncatedNormal:function(t){return new RN(t)},identity:function(t){return new ON(t)},varianceScaling:function(t){return new DN(t)},glorotUniform:function(t){return new MN(t)},glorotNormal:function(t){return new PN(t)},heNormal:function(t){return new LN(t)},heUniform:function(t){return new FN(t)},leCunNormal:function(t){return new zN(t)},leCunUniform:function(t){return new BN(t)},orthogonal:function(t){return new UN(t)}});var ZN="Variable",YN=function(){function t(t,e,n,r,o){void 0===e&&(e="float32"),void 0===n&&(n=ZN),void 0===r&&(r=!0),void 0===o&&(o=null),this.dtype=null==e?"float32":e,this.shape=t.shape,this.id=iE(),this.originalName=QE(n=null==n?ZN:n),this.name=JE(this.originalName),this.trainable_=r,this.constraint=o,this.val=Xf(t,this.trainable_,this.name,this.dtype)}return t.prototype.read=function(){return this.assertNotDisposed(),this.val},t.prototype.write=function(t){return this.assertNotDisposed(),function(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}(this.val,t),this.val.id!==t.id&&(this.val.assign(t),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this},t.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},t.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},Object.defineProperty(t.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this.trainable_=t,this.val.trainable=t},enumerable:!0,configurable:!0}),t}();function QN(t){return t.map(function(t){return t.read()})}function JN(t){t.forEach(function(t){t[0].write(t[1])})}var t_,e_=function(t){this.dtype=t.dtype,this.shape=t.shape,this.ndim=null!=t.shape?t.shape.length:t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}},n_=function(t,e,n,r,o,i,a){this.dtype=t,this.shape=e,this.sourceLayer=n,this.inputs=r,this.callArgs=o,this.outputTensorIndex=a,this.id=iE(),null!=i&&(this.originalName=QE(i),this.name=JE(this.originalName)),this.rank=e.length},r_=0,o_=function(){function t(t,e){this.callArgs=e,this.id=r_++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(var n=0,r=t.inboundLayers;n<r.length;n++){var o=r[n];null!=o&&o.outboundNodes.push(this)}t.outboundLayer.inboundNodes.push(this)}return t.prototype.getConfig=function(){for(var t=[],e=0,n=this.inboundLayers;e<n.length;e++){var r=n[e];t.push(null!=r?r.name:null)}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},t}(),i_=0,a_=function(t){function e(e){var n=t.call(this)||this;n._callHook=null,n._addedWeightNames=[],n._stateful=!1,n.id=i_++,n.activityRegularizer=null,n.inputSpec=null,n.supportsMasking=!1,n._trainableWeights=[],n._nonTrainableWeights=[],n._losses=[],n._updates=[],n._built=!1,n.inboundNodes=[],n.outboundNodes=[];var r=e.name;if(!r){var o=n.getClassName();r=xE(o)+"_"+sE(o)}if(n.name=r,n.trainable_=null==e.trainable||e.trainable,n.updatable=null==e.updatable||e.updatable,null!=e.inputShape||null!=e.batchInputShape){var i=void 0;if(null!=e.batchInputShape)i=e.batchInputShape;else if(null!=e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),i=[a].concat(e.inputShape)}n.batchInputShape=i;var s=e.dtype;null==s&&(s=e.inputDType),null==s&&(s="float32"),n.dtype=s}return n.initialWeights=null!=e.weights?e.weights:null,n._refCount=null,n.fastWeightInitDuringBuild=!1,n}return QC(e,t),e.nodeKey=function(t,e){return t.name+"_ib-"+e.toString()},e.prototype.getNodeAtIndex=function(t,e){if(0===this.inboundNodes.length)throw new hE("The layer has never been called and thus has no defined "+e+".");if(this.inboundNodes.length<=t)throw new fE("Asked to get "+e+" at node "+t+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[t]},e.prototype.getInputAt=function(t){return bE(this.getNodeAtIndex(t,"input").inputTensors)},e.prototype.getOutputAt=function(t){return bE(this.getNodeAtIndex(t,"output").outputTensors)},Object.defineProperty(e.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new pE("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new pE("Layer "+this.name+" is not connected, no input to return.");return bE(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){if(0===this.inboundNodes.length)throw new pE("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new pE("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return bE(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),e.prototype.calculateLosses=function(){return this.losses.map(function(t){return t()})},Object.defineProperty(e.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"built",{get:function(){return this._built},set:function(t){this._built=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this._trainableWeights.forEach(function(e){e.trainable=t}),this.trainable_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights:[]},set:function(t){this._trainableWeights=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable_?this._nonTrainableWeights:this._trainableWeights.concat(this._nonTrainableWeights)},set:function(t){this._nonTrainableWeights=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),e.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},e.prototype.assertInputCompatibility=function(t){if(t=wE(t),null!=this.inputSpec&&0!==this.inputSpec.length){var e=wE(this.inputSpec);if(t.length!==e.length)throw new fE("Layer "+this.name+" expects "+e.length+" inputs, but it received "+t.length+" input tensors. Input received: "+t);for(var n=0;n<t.length;n++){var r=t[n],o=e[n];if(null!=o){var i=r.rank;if(null!=o.ndim&&i!==o.ndim)throw new fE("Input "+n+" is incompatible with layer "+this.name+": expected ndim="+o.ndim+", found ndim="+i);if(null!=o.maxNDim&&i>o.maxNDim)throw new fE("Input "+n+" is incompatible with layer "+this.name+": expected max_ndim="+o.maxNDim+", found ndim="+i);if(null!=o.minNDim&&i<o.minNDim)throw new fE("Input "+n+" is incompatible with layer "+this.name+": expected min_ndim="+o.minNDim+", found ndim="+i+".");if(null!=o.dtype&&r.dtype!==o.dtype)throw new fE("Input "+n+" is incompatible with layer "+this.name+" : expected dtype="+o.dtype+", found dtype="+r.dtype+".");if(o.axes){var a=r.shape;for(var s in o.axes){var u=Number(s),l=o.axes[s];if(null!=l&&-1===[l,null].indexOf(u>=0?a[u]:a[a.length+u]))throw new fE("Input "+n+" is incompatible with layer "+this.name+": expected axis "+u+" of input shape to have value "+l+" but got shape "+a+".")}}if(null!=o.shape)for(var c=0;c<o.shape.length;++c){var p=o.shape[c],h=r.shape[c];if(null!=p&&null!=h&&p!==h)throw new fE("Input "+n+" is incompatible with layer "+this.name+": expected shape="+o.shape+", found shape=${xShape}.")}}}}},e.prototype.call=function(t,e){return t},e.prototype.invokeCallHook=function(t,e){null!=this._callHook&&this._callHook(t,e)},e.prototype.setCallHook=function(t){this._callHook=t},e.prototype.clearCallHook=function(){this._callHook=null},e.prototype.apply=function(t,e){var n=this;e=e||{},this.assertNotDisposed();for(var r=wE(t),o=!0,i=0,a=r;i<a.length;i++)if(!(a[i]instanceof n_)){o=!1;break}for(var s=!0,u=0,l=r;u<l.length;u++)if(l[u]instanceof n_){s=!1;break}if(o===s)throw new fE("Arguments to apply() must be all SymbolicTensors or all Tensors");return YE(this.name,function(){if(!n.built){n.assertInputCompatibility(t);for(var o=[],i=0,a=wE(t);i<a.length;i++)o.push(a[i].shape);n.build(bE(o)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&s&&(n._refCount=1)}if(n.assertInputCompatibility(t),s){for(var u=[],l=0,c=wE(d=n.call(t,e));l<c.length;l++){var p=c[l];-1!==r.indexOf(p)&&(p=p.clone()),u.push(p)}if(d=bE(u),null!=n.activityRegularizer)throw new dE("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return d}var h=function(t){for(var e=[],n=0,r=t=wE(t);n<r.length;n++)e.push(r[n].shape);return bE(e)}(t),f=n.computeOutputShape(h),d=void 0,m="float32";if(n.warnOnIncompatibleInputShape(Array.isArray(t)?h[0]:h),d=null!=f&&f.length>0&&Array.isArray(f[0])?f.map(function(r,o){return new n_(m,r,n,wE(t),e,n.name,o)}):new n_(m,f,n,wE(t),e,n.name),n.addInboundNode(t,d,null,null,h,f,e),n._refCount++,null!=n.activityRegularizer)throw new dE("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return d})},e.prototype.warnOnIncompatibleInputShape=function(t){if(null!=this.batchInputShape)if(t.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(t)+") does not match that of the batchInputShape ("+JSON.stringify(this.batchInputShape)+") of the layer "+this.name);else{var e=!1;this.batchInputShape.forEach(function(n,r){null!=n&&null!=t[r]&&t[r]!==n&&(e=!0)}),e&&console.warn("The shape of the input tensor ("+JSON.stringify(t)+") does not match the expectation of layer "+this.name+": "+JSON.stringify(this.batchInputShape))}},Object.defineProperty(e.prototype,"outputShape",{get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new pE("The layer "+this.name+" has never been called and thus has no defined output shape.");for(var t=[],e=0,n=this.inboundNodes;e<n.length;e++){var r=JSON.stringify(n[e].outputShapes);-1===t.indexOf(r)&&t.push(r)}if(1===t.length){var o=this.inboundNodes[0].outputShapes;return Array.isArray(o)&&Array.isArray(o[0])&&1===o.length?o[0]:o}throw new pE("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "outut shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),e.prototype.countParams=function(){if(!this.built)throw new hE("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return XN(this.weights)},e.prototype.build=function(t){this.built=!0},e.prototype.getWeights=function(t){return void 0===t&&(t=!1),QN(t?this.trainableWeights:this.weights)},e.prototype.setWeights=function(t){var e=this;vd(function(){var n=e.weights;if(n.length!==t.length)throw new fE('You called setWeights(weights) on layer "'+e.name+'" with a weight list of length '+t.length+", but the layer was expecting "+n.length+" weights. Provided weights: "+t+"...");if(0!==n.length){for(var r=[],o=QN(n),i=0;i<o.length;++i){var a=o[i],s=n[i],u=t[i];if(!Rf.arraysEqual(a.shape,u.shape))throw new fE("Layer weight shape "+a.shape+" not compatible with provided weight shape "+u.shape);r.push([s,u])}JN(r)}})},e.prototype.addWeight=function(t,e,n,r,o,i,a){if(-1!==this._addedWeightNames.indexOf(t))throw new fE("Duplicate weight name "+t+" for layer "+this.name);this._addedWeightNames.push(t),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=HN("zeros"));var s=r.apply(e,n),u=new YN(s,n,t,i,a);return s.dispose(),null!=o&&this.addLoss(function(){return o.apply(u.read())}),null==i&&(i=!0),i?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u},e.prototype.setFastWeightInitDuringBuild=function(t){this.fastWeightInitDuringBuild=t},e.prototype.addLoss=function(t){var e;null==t||Array.isArray(t)&&0===t.length||(t=wE(t),null!=this._losses&&(e=this.losses).push.apply(e,t))},e.prototype.computeOutputShape=function(t){return t},e.prototype.computeMask=function(t,e){var n=this;if(!this.supportsMasking){if(null!=e){if(!Array.isArray(e))throw new TypeError("Layer "+this.name+" does not support masking, but was passed an inputMask.");e.forEach(function(t){if(null!=t)throw new TypeError("Layer "+n.name+" does not support masking, but was passed an inputMask.")})}return null}return e},e.prototype.addInboundNode=function(t,e,n,r,o,i,a){void 0===a&&(a=null);var s=wE(t);e=wE(e),n=wE(n),r=wE(r),o=GN(o),i=GN(i);for(var u=[],l=[],c=[],p=0,h=s;p<h.length;p++){var f=h[p];u.push(f.sourceLayer),l.push(f.nodeIndex),c.push(f.tensorIndex)}new o_({outboundLayer:this,inboundLayers:u,nodeIndices:l,tensorIndices:c,inputTensors:s,outputTensors:e,inputMasks:n,outputMasks:r,inputShapes:o,outputShapes:i},a);for(var d=0;d<e.length;d++)e[d].sourceLayer=this,e[d].nodeIndex=this.inboundNodes.length-1,e[d].tensorIndex=d},e.prototype.getConfig=function(){var t={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(t.batchInputShape=this.batchInputShape),null!=this.dtype&&(t.dtype=this.dtype),t},e.prototype.disposeWeights=function(){return this.weights.forEach(function(t){return t.dispose()}),this.weights.length},e.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Layer '"+this.name+"' is already disposed.")},e.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var t=0;return 0==--this._refCount&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}},e}(LC.Serializable),s_=function(t){function e(e){var n=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:sE("input").toString()})||this;if(null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),n.trainable=!1,n.built=!0,n.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new fE("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var r=e.batchInputShape;if(null==r){if(null==e.inputShape)throw new fE("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");r=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new fE("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var o=e.dtype||"float32";n.batchInputShape=r,n.dtype=o,n.inputSpec=[{shape:r}];var i=new n_(n.dtype,n.batchInputShape,n,[],{},n.name);return i.nodeIndex=0,i.tensorIndex=0,new o_({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[r],outputShapes:[r]}),n}return QC(e,t),e.prototype.apply=function(t,e){throw new fE("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},e.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},e.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},e.className="InputLayer",e}(a_);function u_(t){if(null==t.batchShape&&null==t.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=t.batchShape&&null!=t.shape)throw new fE("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var e=t.batchShape;null!=t.shape&&null==e&&(e=[null].concat(t.shape));var n=t.dtype;return null==n&&(n="float32"),new s_({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}function l_(t){return eE(this,void 0,void 0,function(){var e,n,r,o,i,a,s,u;return nE(this,function(l){switch(l.label){case 0:if(null==t)return[2];for(o in e=[],n=[],r=[],t)"number"!=typeof(i=t[o])&&(e.push((a=i).data()),n.push(o),r.push(a));return[4,Promise.all(e)];case 1:for(s=l.sent(),u=0;u<s.length;++u)t[n[u]]=s[u][0];return bd(r),[2]}})})}function c_(t){if(null!=t)for(var e in t){var n=t[e];"number"!=typeof n&&n.dispose()}}LC.registerClass(s_),function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"}(t_||(t_={}));var p_=function(){function t(){this.validationData=null}return t.prototype.setParams=function(t){this.params=t},t.prototype.onEpochBegin=function(t,e){return eE(this,void 0,void 0,function(){return nE(this,function(t){return[2]})})},t.prototype.onEpochEnd=function(t,e){return eE(this,void 0,void 0,function(){return nE(this,function(t){return[2]})})},t.prototype.onBatchBegin=function(t,e){return eE(this,void 0,void 0,function(){return nE(this,function(t){return[2]})})},t.prototype.onBatchEnd=function(t,e){return eE(this,void 0,void 0,function(){return nE(this,function(t){return[2]})})},t.prototype.onTrainBegin=function(t){return eE(this,void 0,void 0,function(){return nE(this,function(t){return[2]})})},t.prototype.onTrainEnd=function(t){return eE(this,void 0,void 0,function(){return nE(this,function(t){return[2]})})},t.prototype.setModel=function(t){},t}(),h_=function(){function t(t,e){void 0===e&&(e=10),null==t&&(t=[]),this.callbacks=t,this.queueLength=e}return t.prototype.append=function(t){this.callbacks.push(t)},t.prototype.setParams=function(t){for(var e=0,n=this.callbacks;e<n.length;e++)n[e].setParams(t)},t.prototype.setModel=function(t){for(var e=0,n=this.callbacks;e<n.length;e++)n[e].setModel(t)},t.prototype.onEpochBegin=function(t,e){return eE(this,void 0,void 0,function(){var n,r;return nE(this,function(o){switch(o.label){case 0:null==e&&(e={}),n=0,r=this.callbacks,o.label=1;case 1:return n<r.length?[4,r[n].onEpochBegin(t,e)]:[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.onEpochEnd=function(t,e){return eE(this,void 0,void 0,function(){var n,r;return nE(this,function(o){switch(o.label){case 0:null==e&&(e={}),n=0,r=this.callbacks,o.label=1;case 1:return n<r.length?[4,r[n].onEpochEnd(t,e)]:[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.onBatchBegin=function(t,e){return eE(this,void 0,void 0,function(){var n,r;return nE(this,function(o){switch(o.label){case 0:null==e&&(e={}),n=0,r=this.callbacks,o.label=1;case 1:return n<r.length?[4,r[n].onBatchBegin(t,e)]:[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.onBatchEnd=function(t,e){return eE(this,void 0,void 0,function(){var n,r;return nE(this,function(o){switch(o.label){case 0:null==e&&(e={}),n=0,r=this.callbacks,o.label=1;case 1:return n<r.length?[4,r[n].onBatchEnd(t,e)]:[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.onTrainBegin=function(t){return eE(this,void 0,void 0,function(){var e,n;return nE(this,function(r){switch(r.label){case 0:null==t&&(t={}),e=0,n=this.callbacks,r.label=1;case 1:return e<n.length?[4,n[e].onTrainBegin(t)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},t.prototype.onTrainEnd=function(t){return eE(this,void 0,void 0,function(){var e,n;return nE(this,function(r){switch(r.label){case 0:null==t&&(t={}),e=0,n=this.callbacks,r.label=1;case 1:return e<n.length?[4,n[e].onTrainEnd(t)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},t}(),f_=function(){function t(t){this.yieldEvery=t,this.batchCount=0,this.batchDurationsMillis=[],this.autoYieldEveryBatches=null,this.batchStartMillis=Rf.now()}return t.prototype.maybeYieldOnBatch=function(e){return eE(this,void 0,void 0,function(){var e,n;return nE(this,function(r){switch(r.label){case 0:return"auto"!==this.yieldEvery?[3,5]:(this.batchCount++,null!=this.autoYieldEveryBatches?[3,2]:(e=Rf.now(),[4,LS()]));case 1:return r.sent(),this.batchCount>t.SKIP_FIRST_BATCHES&&(this.batchDurationsMillis.push(e-this.batchStartMillis),this.batchDurationsMillis.length>=t.DECISION_BATCH_COUNT&&(n=this.batchDurationsMillis.reduce(function(t,e){return t+e})/this.batchDurationsMillis.length,this.autoYieldEveryBatches=Math.round(t.THRESHOLD_MILLIS/n),this.autoYieldEveryBatches<1&&(this.autoYieldEveryBatches=1))),this.batchStartMillis=Rf.now(),this.lastYieldBatchCount=this.batchCount,[3,4];case 2:return this.batchCount-this.lastYieldBatchCount>=this.autoYieldEveryBatches?[4,LS()]:[3,4];case 3:r.sent(),this.lastYieldBatchCount=this.batchCount,r.label=4;case 4:return[3,7];case 5:return"batch"!==this.yieldEvery?[3,7]:[4,LS()];case 6:r.sent(),r.label=7;case 7:return[2]}})})},t.prototype.maybeYieldOnEpoch=function(){return eE(this,void 0,void 0,function(){return nE(this,function(t){switch(t.label){case 0:return"epoch"!==this.yieldEvery?[3,2]:[4,LS()];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.SKIP_FIRST_BATCHES=1,t.DECISION_BATCH_COUNT=2,t.THRESHOLD_MILLIS=16,t}(),d_=function(t){function e(e){var n=t.call(this)||this;return n.yieldEvery=e||"auto",n}return QC(e,t),e.prototype.onTrainBegin=function(t){return eE(this,void 0,void 0,function(){return nE(this,function(t){return this.autoYielder=new f_(this.yieldEvery),[2]})})},e.prototype.onEpochBegin=function(t){return eE(this,void 0,void 0,function(){return nE(this,function(t){return this.seen=0,this.totals={},[2]})})},e.prototype.onBatchEnd=function(t,e){return eE(this,void 0,void 0,function(){var t,n,r,o,i=this;return nE(this,function(a){switch(a.label){case 0:return[4,this.autoYielder.maybeYieldOnBatch(e)];case 1:for(o in a.sent(),null==e&&(e={}),this.seen+=t=null==e.size?0:e.size,n=function(n){var o=e[n];if("number"==typeof o)r.totals.hasOwnProperty(n)||(r.totals[n]=0),r.totals[n]=r.totals[n]+o*t;else{var a=void 0;n in r.totals?a=r.totals[n]:r.totals[n]=cE(0),r.totals[n]=vd(function(){return hx(i.totals[n],Nx(o,cE(t)))}),null!=a&&a.dispose()}},r=this,e)n(o);return[2]}})})},e.prototype.onEpochEnd=function(t,e){return eE(this,void 0,void 0,function(){var t,n,r,o,i=this;return nE(this,function(a){switch(a.label){case 0:return[4,this.autoYielder.maybeYieldOnEpoch()];case 1:if(a.sent(),null!=e)for(t=function(t){if(null==n.totals[t])return"continue";"number"==typeof n.totals[t]?e[t]=n.totals[t]/n.seen:vd(function(){e[t]=Nx(gx(cE(1),cE(i.seen)),i.totals[t]),i.totals[t].dispose(),yd(e[t])})},n=this,r=0,o=this.params.metrics;r<o.length;r++)t(o[r]);return[2]}})})},e}(p_),m_=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.onTrainBegin=function(t){return eE(this,void 0,void 0,function(){return nE(this,function(t){return this.epoch=[],this.history={},[2]})})},e.prototype.onEpochEnd=function(t,e){return eE(this,void 0,void 0,function(){var n;return nE(this,function(r){for(n in null==e&&(e={}),this.epoch.push(t),e)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(e[n]);return[2]})})},e.prototype.syncData=function(){return eE(this,void 0,void 0,function(){var t,e,n,r,o,i,a,s;return nE(this,function(u){switch(u.label){case 0:for(r in t=[],e=[],n=[],this.history)for(o=this.history[r],i=0;i<o.length;++i)"number"!=typeof o[i]&&(t.push(o[i].data()),e.push(r),n.push(i));return[4,Promise.all(t)];case 1:for(a=u.sent(),s=0;s<a.length;++s)this.history[e[s]][n[s]].dispose(),this.history[e[s]][n[s]]=a[s][0];return[2]}})})},e}(p_),g_=function(t){function e(e){var n=t.call(this)||this;return n.trainBegin=e.onTrainBegin,n.trainEnd=e.onTrainEnd,n.epochBegin=e.onEpochBegin,n.epochEnd=e.onEpochEnd,n.batchBegin=e.onBatchBegin,n.batchEnd=e.onBatchEnd,n}return QC(e,t),e.prototype.onEpochBegin=function(t,e){return eE(this,void 0,void 0,function(){return nE(this,function(n){switch(n.label){case 0:return null==this.epochBegin?[3,3]:[4,l_(e)];case 1:return n.sent(),[4,this.epochBegin(t,e)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onEpochEnd=function(t,e){return eE(this,void 0,void 0,function(){return nE(this,function(n){switch(n.label){case 0:return null==this.epochEnd?[3,3]:[4,l_(e)];case 1:return n.sent(),[4,this.epochEnd(t,e)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onBatchBegin=function(t,e){return eE(this,void 0,void 0,function(){return nE(this,function(n){switch(n.label){case 0:return null==this.batchBegin?[3,3]:[4,l_(e)];case 1:return n.sent(),[4,this.batchBegin(t,e)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onBatchEnd=function(t,e){return eE(this,void 0,void 0,function(){return nE(this,function(n){switch(n.label){case 0:return null==this.batchEnd?[3,3]:[4,l_(e)];case 1:return n.sent(),[4,this.batchEnd(t,e)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onTrainBegin=function(t){return eE(this,void 0,void 0,function(){return nE(this,function(e){switch(e.label){case 0:return null==this.trainBegin?[3,3]:[4,l_(t)];case 1:return e.sent(),[4,this.trainBegin(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.onTrainEnd=function(t){return eE(this,void 0,void 0,function(){return nE(this,function(e){switch(e.label){case 0:return null==this.trainEnd?[3,3]:[4,l_(t)];case 1:return e.sent(),[4,this.trainEnd(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e}(p_);function v_(t){return null==t?null:t instanceof p_?[t]:Array.isArray(t)&&t[0]instanceof p_?t:wE(t).map(function(t){return new g_(t)})}var y_=function(){function t(){}return t.registerCallbackConstructor=function(e,n){Rf.assert(e>=0&&Number.isInteger(e),function(){return"Verbosity level is expected to be an integer >= 0, but got "+e}),t.checkForDuplicate(n),null==t.constructors[e]&&(t.constructors[e]=[]),t.constructors[e].push(n)},t.checkForDuplicate=function(e){for(var n in t.constructors)t.constructors[+n].forEach(function(t){if(t===e)throw new fE("Duplicate callback constructor.")})},t.clear=function(){t.constructors={}},t.createCallbacks=function(e){var n=[];for(var r in t.constructors){var o=+r;e>=o&&n.push.apply(n,t.constructors[o])}return n.map(function(t){return new t})},t.constructors={},t}();function b_(t,e,n,r,o,i,a,s,u,l){var c=new m_,p=[new d_(e)].concat(y_.createCallbacks(n));null!=t&&p.push.apply(p,t),p.push(c);var h=new h_(p);return h.setParams({epochs:r,initialEpoch:o,samples:i,steps:a,batchSize:s,verbose:n,doValidation:u,metrics:l}),{callbackList:h,history:c}}function w_(t,e){return vd(function(){var n=Qw(bN(t),e,!0),r=Nx(tm(rE()),cm(t)),o=Ub(bx(n,r));return gx(t,o)})}function x_(t,e){return vd(function(){return Xw(bN(Rx(e,t)),-1)})}function S_(t,e){return vd(function(){return Xw(fb(Rx(e,t)),-1)})}function C_(t,e){return vd(function(){var n=Rx(t,e),r=xb(fb(t),rE(),Number.MAX_VALUE),o=fb(gx(n,r));return Nx(cE(100),Xw(o,-1))})}function E_(t,e){return vd(function(){var n=cE(1),r=xb(e,rE(),Number.MAX_VALUE),o=Tb(hx(n,r)),i=xb(t,rE(),Number.MAX_VALUE),a=Tb(hx(n,i));return Xw(bN(Rx(o,a)),-1)})}function N_(t,e){return vd(function(){var n=cE(0),r=cE(1),o=bx(n,Rx(r,Nx(t,e)));return Xw(bN(o),-1)})}function __(t,e){return vd(function(){var n=cE(0),r=cE(1),o=bx(n,Rx(r,Nx(t,e)));return Xw(o,-1)})}function I_(t,e){return vd(function(){var n=cE(0),r=cE(1),o=Qw(Nx(t,e),-1),i=$w(Nx(Rx(r,t),e),-1);return bx(n,hx(r,Rx(i,o)))})}function T_(t,e){return vd(function(){var n=cE(Math.log(2)),r=Rx(e,t),o=Rx(hx(r,Bb(Nx(cE(-2),r))),n);return Xw(o,-1)})}function A_(t,e,n){return void 0===n&&(n=!1),vd(function(){if(n)e=$d(e);else{var r=Qw(e,e.shape.length-1,!0);e=gx(e,r)}return e=xb(e,rE(),1-rE()),Rb(Qw(Nx(t.toFloat(),Tb(e)),e.shape.length-1))})}function k_(t,e){return vd(function(){var n=Ib(function(t){var e=[rN(t.shape)];return t.reshape(e)}(t)).toInt(),r=(e=xb(e,rE(),1-rE())).shape;return A_(Ky(n,r[r.length-1]).reshape(r),e,!1)})}function R_(t,e){return vd(function(){var n;return n=xb(e,rE(),1-rE()),n=Tb(gx(n,Rx(cE(1),n))),Xw(function(t,e){if(!Rf.arraysEqual(t.shape,e.shape))throw new fE("logits and labels must have the same shape, but got shapes "+JSON.stringify(t.shape)+" and "+JSON.stringify(e.shape));return vd(function(){var n=e.relu(),r=e.abs().neg();return n.sub(e.mul(t)).add(r.exp().log1p())})}(t,n),-1)})}function O_(t,e){return vd(function(){var n=xb(t,rE(),1),r=xb(e,rE(),1);return Qw(Nx(t,Tb(gx(n,r))),-1)})}function D_(t,e){return vd(function(){var n=Tb(hx(cE(rE()),e));return Xw(Rx(e,Nx(t,n)),-1)})}function M_(t,e){return vd(function(){var n=w_(t,-1),r=w_(e,-1),o=Nx(n,r);return Rb(Qw(o,-1))})}function P_(t){var e={meanSquaredError:x_,meanAbsoluteError:S_,meanAbsolutePercentageError:C_,meanSquaredLogarithmicError:E_,squaredHinge:N_,hinge:__,categoricalHinge:I_,logcosh:T_,categoricalCrossentropy:A_,sparseCategoricalCrossentropy:k_,binaryCrossentropy:R_,kullbackLeiblerDivergence:O_,poisson:D_,cosineProximity:M_};if("string"==typeof t){if(t in e)return e[t];var n="Unknown loss "+t;throw t.toLowerCase().includes("softmaxcrossentropy")&&(n="Unknown loss "+t+'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new fE(n)}return t}function L_(t,e){return vd(function(){var n=Nx(cE(.5),cm(e)),r=uN(nx(e,n),t.dtype);return Xw(tx(t,r),-1)})}function F_(t,e){return vd(function(){return uN(tx(qw(t,-1),qw(e,-1)),"float32")})}function z_(t,e){return vd(function(){var n=cE(1);return Dx(t.equal(n),e.equal(n)).sum().cast("float32")})}function B_(t,e){return vd(function(){var n=cE(0),r=z_(t,e),o=function(t,e){return vd(function(){var n=cE(1),r=cE(0);return Dx(t.equal(r),e.equal(n)).sum().cast("float32")})}(t,e),i=r.add(o);return Fx(nx(i,n),r.div(i),n).cast("float32")})}function U_(t,e){return R_(t,e)}function V_(t,e){return t.rank===e.rank&&(t=t.squeeze([t.rank-1])),(e=e.argMax(-1)).dtype!==t.dtype&&(e=e.asType(t.dtype)),tx(t,e).asType("float32")}var j_=x_,W_=x_,H_=S_,q_=S_,G_=C_,K_=C_,$_=A_,X_=M_,Z_=k_;function Y_(t,e,n){void 0===n&&(n=console.log);for(var r="",o=0;o<t.length;++o)o>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=t[o]).slice(0,e[o]),r+=" ".repeat(e[o]-r.length);n(r)}function Q_(t,e,n){var r;try{r=JSON.stringify(t.outputShape)}catch(t){r="multiple"}Y_([t.name+" ("+t.getClassName()+")",r,t.countParams().toString()],e,n)}function J_(t,e,n,r){var o;try{o=JSON.stringify(t.outputShape)}catch(t){o="multiple"}for(var i=[],a=0,s=t.inboundNodes;a<s.length;a++){var u=s[a];if(!(null!=n&&n.length>0&&-1===n.indexOf(u)))for(var l=0;l<u.inboundLayers.length;++l)i.push(u.inboundLayers[l].name+"["+u.nodeIndices[l]+"]["+u.tensorIndices[l]+"]")}var c=t.name,p=t.getClassName(),h=0===i.length?"":i[0];for(Y_([c+" ("+p+")",o,t.countParams().toString(),h],e,r),l=1;l<i.length;++l)Y_(["","","",i[l]],e,r)}function tI(t,e,n){return void 0===e&&(e={}),void 0===n&&(n=!1),NE(t,LC.SerializationMap.getMap().classNameMap,e,"layer",n)}function eI(t,e,n){return("inboundNodes"===t||"outputLayers"===t||"inputLayers"===t)&&0===e&&"string"==typeof n}function nI(t,e){if(null===t)return null;if("string"==typeof t)return SE(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){for(var n=[],r=t.length,o=0;o<r;++o){var i=t[o];eI(e,o,i)?n.push(i):n.push(nI(i,e))}return n}for(var a={},s=0,u=Object.keys(t);s<u.length;s++){var l=u[s],c=t[l];if("name"===l&&"string"==typeof c)a[l]=c;else{var p=SE(l);a[p]=nI(c,p)}}return a}var rI=function(){function t(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof t)for(var n in e.id2Value)this.id2Value[n]=e.id2Value[n],n in e.id2Mask&&(this.id2Mask[n]=e.id2Mask[n]);else{if(null==e)return;for(var r=0,o=e;r<o.length;r++){var i=o[r];this.add(i.key,i.value)}}}return t.prototype.add=function(t,e,n){if(null!=this.id2Value[t.id])throw new fE("Duplicate key: name="+t.name+", id="+t.id);return this.id2Value[t.id]=function(t,e){if(null==t.dtype||t.dtype===e.dtype)return e;try{return Uy(e,t.dtype)}catch(n){throw new fE("The dtype of the feed ("+e.dtype+") can not be cast to the dtype of the key '"+t.name+"' ("+t.dtype+").")}}(t,e),this.name2Id[t.name]=t.id,null!=n&&(this.id2Mask[t.id]=n),this},t.prototype.addFeed=function(t){this.add(t.key,t.value)},t.prototype.hasKey=function(t){return null!=this.id2Value[t.id]},t.prototype.names=function(){return Object.keys(this.name2Id)},t.prototype.getValue=function(t){if(t instanceof n_){if(null==this.id2Value[t.id])throw new fE("Nonexistent key: "+t.name);return this.id2Value[t.id]}var e=this.name2Id[t];if(null==e)throw new fE("Feed dict has no SymbolicTensor name: "+t);return this.id2Value[e]},t.prototype.getMask=function(t){if(t instanceof n_){if(null==this.id2Value[t.id])throw new fE("Nonexistent key: "+t.name);return this.id2Mask[t.id]}var e=this.name2Id[t];if(null==e)throw new fE("Feed dict has no SymbolicTensor name: "+t);return this.id2Mask[e]},t.prototype.disposeMasks=function(){null!=this.id2Mask&&bd(this.id2Mask)},t}(),oI={},iI={};function aI(t,e,n,r){for(var o=null!=n&&n.training,i=Array.isArray(t),a=i?t:[t],s=a.map(function(t){return t.name}),u=[],l=e.names(),c=0,p=s;c<p.length;c++){var h=p[c];-1!==l.indexOf(h)?u.push(e.getValue(h)):u.push(null)}null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var f,d,m=s.join(",")+"|"+e.names().join(",");if(null==oI[m]){var g=function(t,e){Rf.assert(null!=t&&t.length>0,function(){return"Expected at least one fetch, got none"});var n=[],r={};if(1===t.length){var o=uI(t[0],e);n=o.sorted,r=o.recipientMap}else for(var i=new Set,a=0,s=t;a<s.length;a++){for(var u=uI(s[a],e),l=u.recipientMap,c=0,p=u.sorted;c<p.length;c++){var h=p[c];i.has(h.name)||(n.push(h),i.add(h.name))}var f=function(t){null==r[t]&&(r[t]=new Set),l[t].forEach(function(e){return r[t].add(e)})};for(var d in l)f(d)}return{sorted:n,recipientCounts:sI(r)}}(a,e);d=g.recipientCounts,oI[m]=f=g.sorted,iI[m]=d}f=oI[m],d={},o||Object.assign(d,iI[m]);for(var v=new rI(e),y=0;y<f.length;++y){if(null!=r){var b=ZC().numTensors;b>r.maxNumTensors&&(r.maxNumTensors=b),b<r.minNumTensors&&(r.minNumTensors=b)}var w=f[y],x=w.sourceLayer;if(!(x instanceof s_)){for(var S=[],C=[],E=[],N=!1,_=0,I=w.inputs;_<I.length;_++){var T=I[_],A=v.getValue(T),k=v.getMask(T);S.push(A),C.push(k),null!=k&&(N=!0),o||(d[T.name]--,0!==d[T.name]||e.hasKey(T)||-1!==s.indexOf(T.name)||A.isDisposed||E.push(A))}N&&((n=n||{}).mask=C[0]);var R=wE(x.apply(S,n)),O=null;x.supportsMasking&&(O=x.computeMask(S,C));for(var D=lI(w),M=Array.isArray(D)?D:[D],P=0;P<M.length;++P){v.hasKey(M[P])||v.add(M[P],R[P],Array.isArray(O)?O[0]:O);var L=s.indexOf(M[P].name);-1!==L&&(u[L]=R[P])}o||bd(E)}}return v.disposeMasks(),i?u:u[0]}function sI(t){var e={};for(var n in t)e[n]=t[n].size;return e}function uI(t,e){for(var n=new Set,r=[],o={},i=0,a=e.names();i<a.length;i++)n.add(a[i]);var s=[],u=[];for(s.push(t);s.length>0;){var l=s[s.length-1];if(n.has(l.name))s.pop();else{var c=u[u.length-1]===s.length-1;if(0===l.inputs.length||c)s.pop(),r.push(l),n.add(l.name),c&&u.pop();else{u.push(s.length-1);for(var p=0,h=l.inputs;p<h.length;p++){var f=h[p];null==o[f.name]&&(o[f.name]=new Set),o[f.name].add(l.name),n.has(f.name)||s.push(f)}}}}return{sorted:r,recipientMap:o}}function lI(t){var e;if(1===t.sourceLayer.inboundNodes.length)e=t.sourceLayer.output;else{for(var n=null,r=0;r<t.sourceLayer.inboundNodes.length;++r)for(var o=0,i=t.sourceLayer.inboundNodes[r].outputTensors;o<i.length;o++)if(i[o].id===t.id){n=r;break}e=t.sourceLayer.getOutputAt(n)}return e}var cI=function(t){function e(n){var r=t.call(this,{})||this;if(r.containerNodes=new Set,r.name=n.name,null==r.name){var o=r.getClassName().toLowerCase();r.name=sE(o)}if(r.supportsMasking=!1,r.trainable_=!0,r.updatable=!0,r.inputs=Array.isArray(n.inputs)?n.inputs.slice():[n.inputs],r.outputs=Array.isArray(n.outputs)?n.outputs.slice():[n.outputs],IE(r.inputs).length!==r.inputs.length)throw new fE("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+r.inputs.map(function(t){return t.name}));IE(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+r.outputs.map(function(t){return t.name})),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[];for(var i=0,a=r.outputs;i<a.length;i++){var s=(_=a[i]).sourceLayer,u=_.nodeIndex,l=_.tensorIndex;r.outputLayers.push(s),r.outputLayersNodeIndices.push(u),r.outputLayersTensorIndices.push(l)}for(var c=0,p=r.inputs;c<p.length;c++)s=(_=p[c]).sourceLayer,l=_.tensorIndex,vE(0===(u=_.nodeIndex),"input layer has >1 nodes"),vE(0===l,"input layer has >1 tensors"),r.inputLayers.push(s),r.inputLayersNodeIndices.push(u),r.inputLayersTensorIndices.push(l);r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var h=0;h<r.inputLayers.length;h++){if(!((s=r.inputLayers[h])instanceof s_))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: "+n.inputs+". Input "+h+" (0-based) originates from layer type "+s.getClassName()+".");r.inputNames.push(s.name),r.feedInputShapes.push(s.batchInputShape),r.feedInputNames.push(s.name)}for(var f=0,d=r.outputLayers;f<d.length;f++)r.outputNames.push((s=d[f]).name);r.internalInputShapes=r.inputs.map(function(t){return t.shape}),r.internalOutputShapes=r.outputs.map(function(t){return t.shape});for(var m={},g={},v={},y={},b={},w=[],x=function(t,n,o,i,a,s){null!=i&&null!=a&&null!=s||(i=t.sourceLayer,a=t.nodeIndex,s=t.tensorIndex);var u=i.inboundNodes[a];if(-1!==o.indexOf(u))throw new hE("The tensor "+t.name+' at layer "'+i.name+'" is part of a cycle.');if(-1===n.indexOf(u)){r.containerNodes.add(e.nodeKey(i,a)),i.id in b||(b[i.id]=Object.keys(b).length),-1===o.indexOf(u)&&o.push(u);for(var l=u.inboundLayers.length,c=0;c<l;c++)x(u.inputTensors[c],n,o,u.inboundLayers[c],u.nodeIndices[c],u.tensorIndices[c]);for(n.push(u);o.indexOf(u)>=0;)o.splice(o.indexOf(u),1);w.push(u)}},S=[],C=[],E=0,N=r.outputs;E<N.length;E++){var _=N[E];x(_,S,C)}for(var I=0,T=w.slice().reverse();I<T.length;I++){g[(K=T[I]).id]=K,K.id in m||(m[K.id]=0);var A=m[K.id];for(A=Math.max(A,null==v[K.outboundLayer.id]?0:v[K.outboundLayer.id]),v[K.outboundLayer.id]=A,y[K.outboundLayer.id]=K.outboundLayer,m[K.id]=A,h=0;h<K.inboundLayers.length;h++){var k=K.inboundLayers[h].inboundNodes[u=K.nodeIndices[h]];m[k.id]=Math.max(A+1,null==m[k.id]?0:m[k.id]),g[k.id]=k}}var R={};for(var O in m)(A=m[O])in R||(R[A]=[]),R[A].push(g[O]);var D={};for(var M in v)(A=v[M])in D||(D[A]=[]),D[A].push(y[M]);var P=Object.keys(D).map(function(t){return parseInt(t,10)}).sort(_E);r.layers=[];for(var L=0,F=P;L<F.length;L++){var z=D[A=F[L]];z.sort(function(t,e){var n=b[t.id],r=b[e.id];return n<r?-1:n>r?1:0});for(var B=0,U=z;B<U.length;B++)r.layers.push(s=U[B])}r.layersByDepth=D,P=Object.keys(R).map(function(t){return parseInt(t,10)}).sort(_E);for(var V=r.inputs.slice(),j=[],W=0,H=P;W<H.length;W++)for(var q=0,G=R[A=H[W]];q<G.length;q++){var K;if(null!=(s=(K=G[q]).outboundLayer)){for(var $=0,X=K.inputTensors;$<X.length;$++)if(-1===V.indexOf(_=X[$]))throw new hE("Graph disconnected: cannot obtain value for tensor "+_+' at layer "'+s.name+'". The following previous layers were accessed without issue: '+j);for(var Z=0,Y=K.outputTensors;Z<Y.length;Z++)V.push(_=Y[Z]);j.push(s.name)}}r.nodesByDepth=R;for(var Q=r.layers.map(function(t){return t.name}),J=function(t){var e=Q.filter(function(e){return e===t}).length;if(1!==e)throw new hE('The name "'+t+'" is used '+e+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(Q))},tt=0,et=Q;tt<et.length;tt++)J(et[tt]);return r.outboundNodes=[],r.inboundNodes=[],new o_({outboundLayer:r,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map(function(t){return null}),outputMasks:r.outputs.map(function(t){return null}),inputShapes:r.inputs.map(function(t){return t.shape}),outputShapes:r.outputs.map(function(t){return t.shape})}),r.built=!0,r._refCount=1,r}return QC(e,t),e.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Container '"+this.name+"' is already disposed.")},e.prototype.dispose=function(){this.assertNotDisposed();var t={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount)for(var e=0,n=this.layers;e<n.length;e++)t.numDisposedVariables+=n[e].dispose().numDisposedVariables;return t.refCountAfterDispose=this._refCount,t},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){if(this._trainableWeights.length>0)throw new fE("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];for(var t=[],e=0,n=this.layers;e<n.length;e++)t=t.concat(n[e].trainableWeights);return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){for(var t=[],e=0,n=this.layers;e<n.length;e++){var r=n[e];t.push.apply(t,r.nonTrainableWeights)}if(!this.trainable){for(var o=[],i=0,a=this.layers;i<a.length;i++)o.push.apply(o,(r=a[i]).trainableWeights);return o.concat(t)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),e.prototype.loadWeights=function(t,e){void 0===e&&(e=!0);for(var n={},r=0,o=0,i=this.layers;o<i.length;o++)for(var a=0,s=i[o].weights;a<s.length;a++){var u=s[a];if(null!=n[u.originalName])throw new fE("Duplicate weight name: "+u.originalName);n[u.originalName]=u,r++}var l=[];for(var c in t){if(null!=n[c])l.push([n[c],t[c]]);else if(e)throw new fE("Provided weight data has no target variable: "+c);delete n[c]}if(e){var p=[];for(var h in n)p.push(h);if(p.length>0)throw new fE(p.length+" of "+r+" weights are not set: "+p)}JN(l)},e.prototype.updatedConfig=function(){var t=this.getConfig(),e={};return e.className=this.getClassName(),e.config=t,e.kerasVersion="tfjs-layers 1.0.0",e.backend="TensorFlow.js",e},e.prototype.toJSON=function(t,e){void 0===e&&(e=!0);var n=function t(e,n){if(null==e)return null;if("string"==typeof e)return xE(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var r=[],o=e.length,i=0;i<o;++i){var a=e[i];eI(n,i,a)?r.push(a):r.push(t(a,n))}return r}for(var s={},u=0,l=Object.keys(e);u<l.length;u++){var c=l[u],p=e[c];s[xE(c)]="name"!==c&&"className"!==c||"string"!=typeof p?t(p,c):p}return s}(this.updatedConfig());return e?JSON.stringify(n):n},e.prototype.call=function(t,e){var n=this;return vd(function(){t=wE(t);for(var r=new rI,o=0;o<n.inputs.length;++o)r.add(n.inputs[o],t[o]);return aI(n.outputs,r,e)})},e.prototype.computeMask=function(t,e){var n=this;return vd(function(){var r;return t=wE(t),r=null==e?gE(null,t.length):wE(e),n.runInternalGraph(t,r)[1]})},e.prototype.computeOutputShape=function(t){var e=GN(t);if(e.length!==this.inputLayers.length)throw new fE("Invalid inputShape argument "+t+": model has "+this.inputLayers.length+" tensor inputs.");for(var n={},r=0;r<e.length;r++){var o=this.inputLayers[r];n[b=o.name+"_0_0"]=e[r]}var i=Object.keys(this.nodesByDepth).map(function(t){return parseInt(t,10)}).sort(_E);if(i.length>1)for(var a=0,s=i;a<s.length;a++)for(var u=0,l=this.nodesByDepth[s[a]];u<l.length;u++){var c=l[u];if(o=c.outboundLayer,-1===this.inputLayers.map(function(t){return t.id}).indexOf(o.id)){for(var p=[],h=0;h<c.inboundLayers.length;h++){var f=c.tensorIndices[h],d=n[b=c.inboundLayers[h].name+"_"+c.nodeIndices[h]+"_"+f];p.push(d)}var m=GN(o.computeOutputShape(bE(p))),g=o.inboundNodes.indexOf(c);for(h=0;h<m.length;h++)n[b=o.name+"_"+g+"_"+h]=m[h]}}var v=[],y=[];for(r=0;r<this.outputLayers.length;r++){var b=(o=this.outputLayers[r]).name+"_"+(g=this.outputLayersNodeIndices[r])+"_"+(f=this.outputLayersTensorIndices[r]);y.push(b)}for(r=0;r<y.length;r++){var w=y[r];vE(w in n),v.push(n[w])}return bE(v)},e.prototype.runInternalGraph=function(t,e){null==e&&(e=gE(null,t.length));for(var n={},r=0;r<this.inputs.length;++r){var o=this.inputs[r],i=t[r],a=e[r];n[o.id]=[i,a]}for(var s=0,u=Object.keys(this.nodesByDepth).map(function(t){return parseInt(t,10)}).sort(_E);s<u.length;s++)for(var l=0,c=this.nodesByDepth[u[s]];l<c.length;l++){for(var p=c[l],h=p.outboundLayer,f=p.inputTensors,d=p.outputTensors,m=new Array,g=0,v=f;g<v.length;g++)(o=v[g]).id in n&&m.push(n[o.id]);if(m.length===f.length){var y={},b=void 0,w=void 0,x=void 0,S=void 0;if(null!=p.callArgs&&(y=p.callArgs),1===m.length){var C=m[0],E=C[0],N=C[1];null==y.mask&&(y.mask=N),x=wE(h.call(E,y)),S=wE(h.computeMask(E,N)),b=[E],w=[N]}else b=m.map(function(t){return t[0]}),w=m.map(function(t){return t[1]}),null==y.mask&&(y.mask=w),x=wE(h.call(b,y)),S=wE(h.computeMask(b,w));if(h.activityRegularizer)throw new dE("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(r=0;r<d.length;++r)n[(o=d[r]).id]=[i=x[r],a=S[r]]}}for(var _=[],I=[],T=[],A=0,k=this.outputs;A<k.length;A++){vE((o=k[A]).id in n,"Could not compute output "+o.name+" : "+o.id);var R=n[o.id],O=R[0];a=R[1],T.push(O.shape),_.push(O),I.push(a)}return[_,I,T]},e.prototype.buildNodeConversionMap=function(t){for(var n,r={},o=0,i=this.layers;o<i.length;o++){var a=i[o];n=a instanceof e?1:0;for(var s=0;s<a.inboundNodes.length;s++){var u=e.nodeKey(a,s);this.containerNodes.has(u)&&(r[u]=n,n+=1)}}return r},e.prototype.getLayer=function(t,e){if(null!=e){if(this.layers.length<=e)throw new fE("Was asked to retrieve layer at index "+e+", but model only has "+this.layers.length+" layer(s).");return this.layers[e]}if(null==t)throw new fE("Provide either a layer name or layer index");for(var n=0,r=this.layers;n<r.length;n++){var o=r[n];if(o.name===t)return o}throw new fE("No such layer: "+t)},e.prototype.calculateLosses=function(){var t=this;return vd(function(){for(var n=[],r=0,o=t.layers;r<o.length;r++)for(var i=o[r],a=0;a<i.inboundNodes.length;++a){var s=e.nodeKey(i,a);t.containerNodes.has(s)&&n.push.apply(n,i.calculateLosses())}return n})},e.prototype.getConfig=function(){for(var t={name:this.name},n=this.buildNodeConversionMap(this.layers),r=[],o=0,i=this.layers;o<i.length;o++){for(var a=(w=i[o]).getClassName(),s=w.getConfig(),u=[],l=0;l<w.inboundNodes.length;l++){var c=w.inboundNodes[l],p=e.nodeKey(w,l),h={};if(this.containerNodes.has(p)){if(c.callArgs)try{JSON.stringify(c.callArgs),h=c.callArgs}catch(t){console.warn("Layer "+w.name+" was passed non-serializable keyword arguments: "+c.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),h={}}if(c.inboundLayers.length>0){for(var f=[],d=0;d<c.inboundLayers.length;d++){var m=c.inboundLayers[d],g=c.nodeIndices[d],v=c.tensorIndices[d];null==(S=n[e.nodeKey(m,g)])&&(S=0),f.push([m.name,S,v,h])}u.push(f)}}}var y={};y.name=w.name,y.className=a,y.config=s,y.inboundNodes=u,r.push(y)}t.layers=r;var b=[];for(d=0;d<this.inputLayers.length;d++){var w=this.inputLayers[d];p=e.nodeKey(w,g=this.inputLayersNodeIndices[d]),this.containerNodes.has(p)&&(null!==(S=n[p])&&void 0!==S||(S=0),b.push([w.name,S,v=this.inputLayersTensorIndices[d]]))}t.inputLayers=b;var x=[];for(d=0;d<this.outputLayers.length;d++){var S;p=e.nodeKey(w=this.outputLayers[d],g=this.outputLayersNodeIndices[d]),this.containerNodes.has(p)&&(null!==(S=n[p])&&void 0!==S||(S=0),x.push([w.name,S,v=this.outputLayersTensorIndices[d]]))}return t.outputLayers=x,t},e.fromConfig=function(t,e,n,r){void 0===n&&(n={}),void 0===r&&(r=!1);var o={},i={};function a(t,e){t.name in i?i[t.name].push(e):i[t.name]=[e]}function s(t,e){for(var n,r=[],i=0,s=e;i<s.length;i++){var u=s[i],l=u[0],c=u[1],p=u[2];if(3===u.length)n={};else{if(4!==u.length)throw new fE("Improperly formatted model config for layer "+JSON.stringify(t)+": "+JSON.stringify(u));n=u[3]}if(!(l in o))return void a(t,e);var h=o[l];if(h.inboundNodes.length<=c)return void a(t,e);r.push(h.inboundNodes[c].outputTensors[p])}r.length>0&&t.apply(bE(r),n)}function u(t){var n=t.name,i=tI(t,null!=e.customObjects?e.customObjects:{});i.setFastWeightInitDuringBuild(r),o[n]=i;for(var s=0,u=t.inboundNodes;s<u.length;s++){var l=u[s];if(!(l instanceof Array))throw new fE("Corrupted configuration, expected array for nodeData: "+l);a(i,l)}}for(var l=e.name,c=e.layers,p=0,h=c;p<h.length;p++)u(m=h[p]);for(;!TE(i);)for(var f=0,d=c;f<d.length;f++){var m=d[f];if((A=o[m.name]).name in i){var g=i[A.name];delete i[A.name];for(var v=0,y=g;v<y.length;v++)s(A,y[v])}}for(var b=[],w=[],x=0,S=e.inputLayers;x<S.length;x++){var C=(m=S[x])[0],E=m[1],N=m[2];vE(C in o);var _=(A=o[C]).inboundNodes[E].outputTensors;b.push(_[N])}for(var I=0,T=e.outputLayers;I<T.length;I++){var A;C=(m=T[I])[0],E=m[1],N=m[2],vE(C in o),_=(A=o[C]).inboundNodes[E].outputTensors,w.push(_[N])}return new t({inputs:b,outputs:w,name:l})},Object.defineProperty(e.prototype,"stateful",{get:function(){if(this._stateful)throw new fE("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(var t=0,e=this.layers;t<e.length;t++)if(e[t].stateful)return!0;return!1},enumerable:!0,configurable:!0}),e.prototype.resetStates=function(){var t=this;vd(function(){t.layers.forEach(function(t){t.stateful&&t.resetStates()})})},e}(a_),pI=32;function hI(t,e){var n,r;r=e.ys,Rf.assert(null!=(n=e.xs)&&null!=r,function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+e});var o=fI("input",t.inputNames,n),i=fI("output",t.outputNames,r),a=o[0].shape[0];for(var s in Rf.assert(o.length===t.inputs.length,function(){return"LayersModel has "+t.inputs.length+" inputs, but the dataset provides "+o.length+" inputs.  (Expected input keys: "+JSON.stringify(t.inputNames)+")"}),Rf.assert(i.length===t.outputs.length,function(){return"LayersModel has "+t.outputs.length+" outputs, but the dataset provides "+i.length+" outputs.  (Expected output keys: "+JSON.stringify(t.outputNames)+")"}),o)Rf.assert(o[s].shape[0]===a,function(){return"Batch size mismatch: input "+t.inputNames[s]+" has "+o[s].shape[0]+"; expected  "+a+" based on input "+t.inputNames[0]+"."});for(var u in i)Rf.assert(i[u].shape[0]===a,function(){return"Batch size mismatch: output "+t.outputNames[u]+" has "+i[u].shape[0]+"; expected  "+a+" based on input "+t.inputNames[0]+"."});return o.concat(i)}function fI(t,e,n){if(n instanceof Vf)return[n];if(Array.isArray(n))return Rf.assert(n.length===e.length,function(){return"Received an array of "+n.length+" Tensors, but expected "+e.length+" to match the "+t+" keys "+e+"."}),n;for(var r=[],o=0,i=e;o<i.length;o++){var a=i[o];if(null==n[a])throw new fE("The feature data generated by the dataset lacks the required "+t+" key '"+a+"'.");r.push(n[a])}return r}function dI(t,e,n){return eE(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,p,h,f,d,m,g,v,y,b,w,x,S,C,E,N,_,I;return nE(this,function(T){switch(T.label){case 0:if(r=null!=n.batchesPerEpoch,Rf.assert(null!=t.optimizer,function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."}),Rf.assert(null!=n,function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."}),Rf.assert(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got "+n.epochs}),Rf.assert(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+n.batchesPerEpoch}),Rf.assert(null==n.validationSplit,function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."}),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0,T.label=1;case 1:return T.trys.push([1,,22,23]),i=void 0,a=void 0,(o=null!=n.validationData)&&(mI(n.validationData)?Rf.assert(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+n.validationBatches}):(s=function(t){if(3===t.length)throw new dE("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}(n.validationData),i=s.xs,a=s.ys)),u=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),c=o?l.slice().concat(l.map(function(t){return"val_"+t})):l.slice(),p=v_(n.callbacks),h=b_(p,n.yieldEvery,null==n.verbose?1:n.verbose,n.epochs,null,null,function(t,e){var n=null;return null!=e.batchesPerEpoch?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size),n}(e,n),null,o,c),d=h.history,(f=h.callbackList).setModel(t),t.history=d,[4,f.onTrainBegin()];case 2:return T.sent(),t.stopTraining_=!1,m=null==n.initialEpoch?0:n.initialEpoch,[4,e.iterator()];case 3:g=T.sent(),T.label=4;case 4:return m<n.epochs?(v={},[4,f.onEpochBegin(m)]):[3,19];case 5:return T.sent(),y=0,b=0,r?[3,7]:[4,e.iterator()];case 6:g=T.sent(),T.label=7;case 7:return!r||y<n.batchesPerEpoch?[4,g.next()]:[3,17];case 8:return w=T.sent(),r&&w.done?(console.warn("You provided `batchesPerEpoch` as "+n.batchesPerEpoch+", but your dataset iterator ran out of data after "+y+" batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+n.batchesPerEpoch*n.epochs+" batches). You may need to use the repeat() function when building your dataset."),[3,17]):null==w.value?[3,11]:(x=hI(t,w.value),(S={}).batch=b,S.size=x[0].shape[0],[4,f.onBatchBegin(b,S)]);case 9:for(T.sent(),C=u(x),bd(x),I=0;I<l.length;++I)S[l[I]]=E=C[I],yd(E);return[4,f.onBatchEnd(b,S)];case 10:T.sent(),c_(S),b++,y++,T.label=11;case 11:return(r?y>=n.batchesPerEpoch:w.done)?o?(N=void 0,mI(n.validationData)?(_=wE,[4,t.evaluateDataset(n.validationData,{batches:n.validationBatches})]):[3,13]):[3,15]:[3,16];case 12:return N=_.apply(void 0,[T.sent()]),[3,14];case 13:N=wE(t.evaluate(i,a,{batchSize:null==n.validationBatchSize?pI:n.validationBatchSize,verbose:0})),T.label=14;case 14:for(I=0;I<t.metricsNames.length;++I)v["val_"+t.metricsNames[I]]=N[I];T.label=15;case 15:return[3,17];case 16:return t.stopTraining_?[3,17]:[3,7];case 17:return[4,f.onEpochEnd(m,v)];case 18:return T.sent(),m++,t.stopTraining_?[3,19]:[3,4];case 19:return[4,f.onTrainEnd()];case 20:return T.sent(),[4,t.history.syncData()];case 21:return T.sent(),[2,t.history];case 22:return t.isTraining=!1,[7];case 23:return[2]}})})}function mI(t){return"function"==typeof t.iterator}function gI(t,e,n){return eE(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,p,h;return nE(this,function(f){switch(f.label){case 0:if(r=null!=(n=n||{}).batches,o=t.testFunction,i=[],n.verbose>0)throw new dE("Verbose mode is not implemented yet.");return Rf.assert(!r||n.batches>0&&Number.isInteger(n.batches),function(){return"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(n.batches)}),"function"==typeof e.next?(s=e,[3,3]):[3,1];case 1:return[4,e.iterator()];case 2:s=f.sent(),f.label=3;case 3:a=s,u=0,l=0,c=function(){var e,s,c,p,h,f;return nE(this,function(d){switch(d.label){case 0:return[4,a.next()];case 1:if((e=d.sent()).value){if(s=hI(t,e.value),c=vd(function(){return o(s)}),bd(s),0===l)for(f=0;f<c.length;++f)i.push(cE(0));for(p=s[0].shape[0],h=function(t){var e=c[t],n=i[t];i[t]=vd(function(){return hx(i[t],Nx(cE(p),e))}),l>0&&bd(n)},f=0;f<c.length;++f)h(f);bd(c),u+=p,++l}return e.done?(r&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, "+n.batches+" batches). You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},f.label=4;case 4:return!r||l<n.batches?[5,c()]:[3,6];case 5:return"break"===f.sent()?[3,6]:[3,4];case 6:for(p=function(t){var e=i[t];i[t]=vd(function(){return gx(i[t],cE(u))}),bd(e)},h=0;h<i.length;++h)p(h);return[2,bE(i)]}})})}function vI(t){Rf.assert(t>0&&Number.isInteger(t),function(){return"batchSize is required to be a positive integer, but got "+t})}function yI(t,e,n){return null==t?[null]:Array.isArray(t)?t.map(function(t){return cN(t,e,n-e)}):cN(t,e,n-e)}function bI(t,e){return vd(function(){return null==t?null:Array.isArray(t)?t.map(function(t){return bI(t,e)}):yN(t,"int32"===e.dtype?e:e.toInt())})}function wI(t,e){for(var n=[],r=0,o=null;r<t;)(o=r+e)>=t&&(o=t),n.push([r,o]),r=o;return n}function xI(t,e,n,r,o,i,a,s,u,l,c,p,h,f,d,m){return eE(this,void 0,void 0,function(){var g,v,y,b,w,x,S,C;return nE(this,function(E){switch(E.label){case 0:if(null==o&&(o=32),null==i&&(i=1),null==c&&(c=!0),null==h&&(h=0),g=!1,null!=u&&null!=l&&(g=!0),null!=d&&(g=!0,null==f))throw new fE("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return null!=(v=t.checkNumSamples(n,o,f,"steps_per_epoch"))&&(y=sN(0,v)),null==a&&(a=1),b=b_(s,m,a,i,h,v,f,o,g,p),x=b.history,(w=b.callbackList).setModel(t),t.history=x,[4,w.onTrainBegin()];case 1:E.sent(),t.stopTraining_=!1,S=function(i){var a,s,p,h,d;return nE(this,function(m){switch(m.label){case 0:return[4,w.onEpochBegin(i)];case 1:if(m.sent(),a={},null==f)return[3,2];throw new dE("stepsPerEpoch mode is not implemented yet.");case 2:if("batch"===c)throw new dE("batch shuffling is not implemneted yet");c&&Rf.shuffle(y),s=em(y),p=wI(v,o),h=function(i){var c;return nE(this,function(h){switch(h.label){case 0:return[4,w.onBatchBegin(i,c={})];case 1:return h.sent(),vd(function(){var h=p[i][0],f=p[i][1],d=cN(s,h,f-h);c.batch=i,c.size=f-h;for(var m=bI(n,d),v=e(m),y=0;y<r.length;++y){var b=r[y],w=v[y];c[b]=w,yd(w)}if(i===p.length-1&&g){var x=t.testLoop(u,l,o);for(y=0;y<r.length;++y)b=r[y],yd(w=x[y]),a["val_"+b]=w}}),[4,w.onBatchEnd(i,c)];case 2:return h.sent(),c_(c),t.stopTraining_?[2,"break"]:[2]}})},d=0,m.label=3;case 3:return d<p.length?[5,h(d)]:[3,6];case 4:if("break"===m.sent())return[3,6];m.label=5;case 5:return++d,[3,3];case 6:s.dispose(),m.label=7;case 7:return[4,w.onEpochEnd(i,a)];case 8:return m.sent(),t.stopTraining_?[2,"break"]:[2]}})},C=h,E.label=2;case 2:return C<i?[5,S(C)]:[3,5];case 3:if("break"===E.sent())return[3,5];E.label=4;case 4:return++C,[3,2];case 5:return[4,w.onTrainEnd()];case 6:return E.sent(),[4,t.history.syncData()];case 7:return E.sent(),[2,t.history]}})})}function SI(t,e,n,r){return void 0===r&&(r={}),eE(this,void 0,void 0,function(){var o,i,a,s,u,l,c,p,h,f,d,m,g,v,y,b,w,x,S;return nE(this,function(C){switch(C.label){case 0:if(t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0,C.label=1;case 1:if(C.trys.push([1,,3,4]),vI(c=null==r.batchSize?32:r.batchSize),p=t.standardizeUserData(e,n,!1,c),o=p[0],i=p[1],h=!1,f=void 0,null!=r.validationData&&r.validationData.length>0){if(h=!0,2!==r.validationData.length)throw 3===r.validationData.length?new dE("validationData including sample weights is not supported yet."):new fE("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+r.validationData+" is invalid.");d=t.standardizeUserData(a=r.validationData[0],s=r.validationData[1],!0,c),f=(u=d[0]).concat(l=d[1])}else null!=r.validationSplit&&r.validationSplit>0&&r.validationSplit<1?(h=!0,m=Math.floor(o[0].shape[0]*(1-r.validationSplit)),u=yI(o,m,g=o[0].shape[0]),o=yI(o,0,m),l=yI(i,m,g),i=yI(i,0,m),f=u.concat(l)):null!=r.validationSteps&&(h=!0);return v=o.concat(i),t.checkTrainableWeightsConsistency(),y=t.makeTrainFunction(),b=t.getDedupedMetricsNames(),w=void 0,x=void 0,h?(t.makeTestFunction(),w=t.testFunction,x=b.slice().concat(b.map(function(t){return"val_"+t}))):(w=null,f=[],x=b.slice()),S=v_(r.callbacks),[4,xI(t,y,v,b,c,r.epochs,r.verbose,S,w,f,r.shuffle,x,r.initialEpoch,null,null,r.yieldEvery)];case 2:return[2,C.sent()];case 3:return t.isTraining=!1,EI(o,e),EI(i,n),EI(u,a),EI(l,s),[7];case 4:return[2]}})})}function CI(t){var e=[];t instanceof Vf&&(t=[t]);for(var n=0;n<t.length;++n){var r=t[n];if(1===r.rank)e.push(lN(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function EI(t,e){if(null!=t){var n=[];if(e instanceof Vf)n.push(e.id);else if(Array.isArray(e))e.forEach(function(t){return n.push(t.id)});else if(null!=e)for(var r in e)n.push(e[r].id);var o=[];if(t instanceof Vf)-1===n.indexOf(t.id)&&o.push(t);else if(Array.isArray(t))t.forEach(function(t){-1===n.indexOf(t.id)&&o.push(t)});else if(null!=t)for(var i in t){var a=t[i];-1===n.indexOf(a.id)&&o.push(a)}o.forEach(function(t){t.isDisposed||t.dispose()})}}function NI(t){return Array.isArray(t)}function _I(t){return!function(t){return t instanceof Vf}(t)&&!NI(t)}function II(t,e,n,r,o){if(void 0===r&&(r=!0),void 0===o&&(o=""),null==e||0===e.length){if(null!=t){var i=!1;if(NI(t)&&t.length>0)i=!0;else if(_I(t)){for(var a in t)if(t.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new fE("Error when checking model "+o+" expected no data, but got "+t)}return[]}if(null==t)return e.map(function(t){return null});var s;if(_I(t)){t=t,s=[];for(var u=0,l=e;u<l.length;u++){var c=l[u];if(null==t[c])throw new fE('No data provided for "'+c+'". Need data for each key in: '+e);s.push(t[c])}}else if(NI(t)){if((t=t).length!==e.length)throw new fE("Error when checking model "+o+": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see "+e.length+" Tensor(s), but instead got the following list of Tensor(s): "+t);s=t}else{if(t=t,e.length>1)throw new fE("The model "+o+" expects "+e.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+t.shape);s=[t]}if(s=CI(s),null!=n)for(var p=0;p<e.length;++p)if(null!=n[p]){var h=s[p];if(h.shape.length!==n[p].length)throw new fE("Error when checking "+o+": expected "+e[p]+" to have "+n[p].length+" dimension(s). but got array with shape "+h.shape);for(var f=0;f<n[p].length;++f)if(0!==f||r){var d=n[p][f];if(null!=d&&d>=0&&h.shape[f]!==d)throw new fE("Error when checking "+o+": expected "+e[p]+" to have shape ["+n[p]+"], but got array with shape ["+h.shape+"].")}}return s}function TI(t,e,n,r,o){var i;if(void 0===r&&(r=!0),void 0===o&&(o=""),Array.isArray(t)){if(t.length!==e.length)throw new fE("Error when checking model "+o+": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see "+e.length+" Tensor(s), but instead got "+t.length+" Tensors(s).");i=t}else{if(e.length>1)throw new fE("The model expects "+e.length+" "+o+" Tensors, but only received one Tensor. Found: array with shape "+JSON.stringify(t.shape)+".");i=[t]}if(null!=n)for(var a=0;a<e.length;++a)if(null!=n[a]){var s=i[a];if(s.shape.length!==n[a].length)throw new fE("Error when checking "+o+": expected "+e[a]+" to have "+n[a].length+" dimension(s), but got array with shape "+JSON.stringify(s.shape));for(var u=0;u<n[a].length;++u)if(0!==u||r){var l=n[a][u];if(null!=l&&l!==s.shape[u])throw new fE("Error when checking "+o+": expected "+e[a]+" to have shape "+JSON.stringify(n[a])+" but got array with shape "+JSON.stringify(s.shape)+".")}}}var AI=function(t){function e(e){var n=t.call(this,e)||this;return n.isTraining=!1,n}return QC(e,t),e.prototype.summary=function(t,e,n){if(void 0===n&&(n=console.log),!this.built)throw new fE("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");!function(t,e,n,r){void 0===r&&(r=console.log);var o,i=function(t){var e=!0,n=[],r=[];for(var o in t.nodesByDepth)n.push(t.nodesByDepth[o]);for(var i=0,a=n;i<a.length;i++){var s=a[i];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){e=!1;break}r.push.apply(r,s)}if(e)for(var u=0,l=t.layers;u<l.length;u++){for(var c=!1,p=0,h=l[u].inboundNodes;p<h.length;p++)if(-1!==r.indexOf(h[p])){if(c){e=!1;break}c=!0}if(!e)break}return e}(t),a=["Layer (type)","Output shape","Param #"];if(i?(e=e||65,n=n||[.45,.85,1]):(e=e||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map(function(t){return Math.floor(e*t)})),!i)for(var s in a.push("Receives inputs"),o=[],t.nodesByDepth)o.push.apply(o,t.nodesByDepth[s]);r("_".repeat(e)),Y_(a,n,r),r("=".repeat(e));for(var u=t.layers,l=0;l<u.length;++l)i?Q_(u[l],n,r):J_(u[l],n,o,r),r((l===u.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();var c=function(t){return XN(null!=t.collectedTrainableWeights?t.collectedTrainableWeights:t.trainableWeights)}(t),p=XN(t.nonTrainableWeights);r("Total params: "+(c+p)),r("Trainable params: "+c),r("Non-trainable params: "+p),r("_".repeat(e))}(this,t,e,n)},e.prototype.compile=function(t){var e=this;if(null==t.loss&&(t.loss=[]),this.loss=t.loss,"string"==typeof t.optimizer)this.optimizer=function(t){var e={Adagrad:function(){return XC.adagrad(.01)},Adadelta:function(){return XC.adadelta(1,.95,rE())},Adam:function(){return XC.adam(.001,.9,.999,rE())},Adamax:function(){return XC.adamax(.002,.9,.999,rE(),0)},RMSProp:function(){return XC.rmsprop(.001,.9,0,rE())},SGD:function(){return XC.sgd(.01)}};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new fE("Unknown Optimizer "+t)}(t.optimizer);else{if(!(t.optimizer instanceof UC))throw new fE("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer=t.optimizer}var n=[];if(Array.isArray(t.loss)||"string"==typeof t.loss||"function"==typeof t.loss)if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new fE("When passing an Array as loss, it should have one entry per model output. The model has "+this.outputs.length+" output(s), but you passed loss="+t.loss+".");n=t.loss.map(function(t){return P_(t)})}else{var r=P_(t.loss);this.outputs.forEach(function(t){n.push(r)})}else{for(var o in t.loss=t.loss,t.loss)if(-1===this.outputNames.indexOf(o))throw new fE('Unknown entry in loss dictionary: "'+o+'". Only expected the following keys: '+this.outputNames);for(var i=0,a=this.outputNames;i<a.length;i++){var s=a[i];null==t.loss[s]&&console.warn('Output "'+s+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to '+s+" during training"),n.push(P_(t.loss[s]))}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var u=0;u<this.outputs.length;++u){var l=this.internalOutputShapes[u];this.feedOutputNames.push(this.outputNames[u]),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[u])}var c=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],YE("loss",function(){for(var t=0;t<e.outputs.length;++t)-1===c.indexOf(t)&&e.outputs.length>1&&(e.metricsTensors.push([e.lossFunctions[t],t]),e.metricsNames.push(e.outputNames[t]+"_loss"))});var p=function(t,e){if(null==t||Array.isArray(t)&&0===t.length)return e.map(function(t){return[]});if(Array.isArray(t))return e.map(function(e){return t});if(null!=t){for(var n=[],r=0,o=e;r<o.length;r++){var i=o[r],a=t.hasOwnProperty(i)?t[i]:[];Array.isArray(a)||(a=[a]),n.push(a)}return n}throw new TypeError("Type of metrics argument not understood. Expected an Array or Object, found: "+t)}(t.metrics,this.outputNames);YE("metric",function(){for(var t=function(t){if(-1!==c.indexOf(t))return"continue";!function(n){for(var r,o,i,a=function(n){if(-1!==["accuracy","acc","crossentropy","ce"].indexOf(n)){var a=e.internalOutputShapes[t];1===a[a.length-1]||e.lossFunctions[t]===R_?-1!==["accuracy","acc"].indexOf(n)?o=L_:-1!==["crossentropy","ce"].indexOf(n)&&(o=U_):e.lossFunctions[t]===k_?-1!==["accuracy","acc"].indexOf(n)?o=V_:-1!==["crossentropy","ce"].indexOf(n)&&(o=Z_):-1!==["accuracy","acc"].indexOf(n)?o=F_:-1!==["crossentropy","ce"].indexOf(n)&&(o=$_);var s=void 0;-1!==["accuracy","acc"].indexOf(n)?s="acc":-1!==["crossentropy","ce"].indexOf(n)&&(s="ce"),i=o,r=""+s}else{var u=function(t){var e={binaryAccuracy:L_,categoricalAccuracy:F_,precision:B_,categoricalCrossentropy:$_,sparseCategoricalCrossentropy:Z_,mse:j_,MSE:W_,mae:H_,MAE:q_,mape:G_,MAPE:K_,cosine:X_};if("string"==typeof n&&n in e)return e[n];if("string"!=typeof n&&null!=n)return n;throw new fE("Unknown metric "+n)}();i=u,r=""+n}var l;YE(r,function(){l=i}),function(t,n,r){e.outputNames.length>1&&(n=e.outputNames[t]+"_"+n),e.metricsNames.push(n),e.metricsTensors.push([r,t])}(t,r,l)},s=0,u=p[t];s<u.length;s++)a(u[s])}()},n=0;n<e.outputs.length;++n)t(n)}),this.collectedTrainableWeights=this.trainableWeights},e.prototype.checkTrainableWeightsConsistency=function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},e.prototype.evaluate=function(t,e,n){void 0===n&&(n={});var r=null==n.batchSize?32:n.batchSize;vI(r);var o=this.standardizeUserData(t,e,!0,r);try{var i=o[0].concat(o[1]);return this.makeTestFunction(),bE(this.testLoop(this.testFunction,i,r,n.verbose,n.steps))}finally{EI(o[0],t),EI(o[1],e)}},e.prototype.evaluateDataset=function(t,e){return eE(this,void 0,void 0,function(){return nE(this,function(n){return this.makeTestFunction(),[2,gI(this,t,e)]})})},e.prototype.checkNumSamples=function(t,e,n,r){var o;if(void 0===r&&(r="steps"),null!=n){if(o=null,null!=e)throw new fE("If "+r+" is set, batchSize must be null or undefined.Got batchSize = "+e)}else{if(null==t)throw new fE("Either the input data should have a defined shape, or "+r+" shoud be specified.");o=Array.isArray(t)?t[0].shape[0]:t.shape[0]}return o},e.prototype.execute=function(t,e){if(Array.isArray(e)&&0===e.length)throw new fE("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(e),r=this.retrieveSymbolicTensors(n?e:[e]),o=new rI;if(t instanceof Vf&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new fE("The number of inputs provided ("+t.length+") does not match the number of inputs of this model ("+this.inputs.length+").");for(var i=0;i<this.inputs.length;++i)o.add(this.inputs[i],t[i])}else for(var a=0,s=this.inputs;a<s.length;a++){var u=s[a],l=t[u.name];if(null==l)throw new fE("No value is provided for the model's input "+u.name);o.add(u,l)}var c=aI(r,o);return n?c:c[0]},e.prototype.retrieveSymbolicTensors=function(t){for(var e=gE(null,t.length),n=t.length,r=0,o=this.layers;r<o.length;r++){for(var i=o[r],a=Array.isArray(i.output)?i.output:[i.output],s=a.map(function(t){return t.name}),u=0;u<t.length;++u){var l=s.indexOf(t[u]);if(-1!==l&&(e[u]=a[l],n--),0===n)break}if(0===n)break}if(n>0){var c=[];throw e.forEach(function(e,n){null==e&&c.push(t[n])}),new fE("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(c))}return e},e.prototype.predictLoop=function(t,e,n){var r=this;return void 0===e&&(e=32),void 0===n&&(n=!1),vd(function(){var o=r.checkNumSamples(t);if(n)throw new dE("Verbose predictLoop() is not implemented yet.");for(var i=wI(o,e),a=r.outputs.map(function(t){return[]}),s=function(e){vd(function(){var n=yI(t,i[e][0],i[e][1]),o=[];if(Array.isArray(n))for(var a=0;a<n.length;++a)o.push({key:r.inputs[a],value:n[a]});else o.push({key:r.inputs[0],value:n});var s=new rI(o);return aI(r.outputs,s)}).forEach(function(t,e){return a[e].push(t)})},u=0;u<i.length;++u)s(u);return bE(a.map(function(t){return Sy(t,0)}))})},e.prototype.predict=function(t,e){void 0===e&&(e={});var n=CI(t);TI(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==e.batchSize?32:e.batchSize;return vI(r),this.predictLoop(n,r)}finally{EI(n,t)}},e.prototype.predictOnBatch=function(t){return TI(t,this.inputNames,this.feedInputShapes,!0),this.predictLoop(t,t.shape[0])},e.prototype.standardizeUserData=function(t,e,n,r){if(void 0===n&&(n=!0),null==this.optimizer)throw new hE("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var o=[],i=0;i<this.feedOutputShapes.length;++i){var a=this.feedOutputShapes[i];o.push(this.feedLossFns[i]===k_?a.slice(0,a.length-1).concat([1]):a)}if(function(t,e,n){var r=IE(t.map(function(t){return t.shape[0]}));r.sort();var o=IE(e.map(function(t){return t.shape[0]}));if(o.sort(),r.length>1)throw new fE("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(t.map(function(t){return t.shape})));if(o.length>1)throw new fE("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(e.map(function(t){return t.shape})));if(r.length>0&&o.length>0&&!Rf.arraysEqual(r,o))throw new fE("Input Tensors should have the same number of samples as target Tensors. Found "+r[0]+" input sample(s) and "+o[0]+" target sample(s).")}(t=II(t,this.feedInputNames,this.feedInputShapes,!1,"input"),e=II(e,this.feedOutputNames,o,!1,"target")),function(t,e,n){for(var r=[x_,R_,A_],o=0;o<t.length;++o){var i=t[o],a=e[o],s=n[o];if(null!=a){if(a===A_&&1===i.shape[i.shape.length-1])throw new fE("You are passing a target array of shape "+i.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(a))for(var u=i.shape.slice(1),l=s.slice(1),c=0;c<u.length;++c){var p=l[c];if(null!=p&&u[c]!==p)throw new fE("A target Tensor with shape "+i.shape+" was passed for an output of shape "+s+", while using a loss function that expects targets to have the same shape as the output.")}}}}(e,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=r&&r>0&&t[0].shape[0]%r!=0)throw new fE("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+r+". Found: "+t[0].shape[0]+" sample(s).");return[t,e,null]},e.prototype.testLoop=function(t,e,n,r,o){var i=this;return void 0===r&&(r=0),vd(function(){var a=i.checkNumSamples(e,n,o,"steps"),s=[];if(r>0)throw new dE("Verbose mode is not implemented yet.");if(null!=o)throw new dE("steps mode in testLoop() is not implemented yet");for(var u=wI(a,n),l=em(sN(0,a)),c=0;c<u.length;++c){var p=u[c][0],h=u[c][1],f=cN(l,p,h-p),d=bI(e,f),m=t(d);if(0===c)for(var g=0;g<m.length;++g)s.push(cE(0));for(g=0;g<m.length;++g){var v=m[g];s[g]=hx(s[g],Nx(cE(h-p),v))}}for(g=0;g<s.length;++g)s[g]=gx(s[g],cE(a));return s})},e.prototype.getDedupedMetricsNames=function(){for(var t=this.metricsNames,e=[],n=0;n<t.length;++n){var r=t[n],o=r;yE(t,r)>1&&(o+="_"+yE(t.slice(0,n),r)),e.push(o)}return e},e.prototype.makeTrainFunction=function(){var t=this;return function(e){var n=e.slice(0,t.inputs.length),r=e.slice(t.inputs.length,t.inputs.length+t.outputs.length),o=[],i=t.collectedTrainableWeights.map(function(t){return t.read()});return[t.optimizer.minimize(function(){for(var e=[],i=0;i<t.inputs.length;++i)e.push({key:t.inputs[i],value:n[i]});var a,s=new rI(e),u=aI(t.outputs,s,{training:!0});for(i=0;i<t.lossFunctions.length;++i){var l=(0,t.lossFunctions[i])(r[i],u[i]);Xw(l),a=0===i?l:hx(a,l)}for(i=0;i<t.metricsTensors.length;++i){var c=t.metricsTensors[i][1],p=Xw((0,t.metricsTensors[i][0])(r[c],u[c]));yd(p),o.push(p)}return a=Xw(a),t.calculateLosses().forEach(function(t){a=hx(a,t)}),a},!0,i)].concat(o)}},e.prototype.makeTestFunction=function(){var t=this;this.testFunction=function(e){return vd(function(){for(var n,r=[],o=e.slice(0,t.inputs.length),i=e.slice(t.inputs.length,t.inputs.length+t.outputs.length),a=[],s=0;s<t.inputs.length;++s)a.push({key:t.inputs[s],value:o[s]});var u=new rI(a),l=aI(t.outputs,u);for(s=0;s<t.lossFunctions.length;++s){var c=Xw((0,t.lossFunctions[s])(i[s],l[s]));n=0===s?c:hx(n,c),r.push(n)}for(s=0;s<t.metricsTensors.length;++s){var p=t.metricsTensors[s][1],h=Xw((0,t.metricsTensors[s][0])(i[p],l[p]));r.push(h)}return r})}},e.prototype.fit=function(t,e,n){return void 0===n&&(n={}),eE(this,void 0,void 0,function(){return nE(this,function(r){return[2,SI(this,t,e,n)]})})},e.prototype.fitDataset=function(t,e){return eE(this,void 0,void 0,function(){return nE(this,function(n){return[2,dI(this,t,e)]})})},e.prototype.trainOnBatch=function(t,e){return eE(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c;return nE(this,function(p){switch(p.label){case 0:n=this.standardizeUserData(t,e),r=n[0],o=n[1],i=this.makeTrainFunction(),a=i(r.concat(o)),s=[],u=0,l=a,p.label=1;case 1:return u<l.length?[4,l[u].data()]:[3,4];case 2:c=p.sent(),s.push(c[0]),p.label=3;case 3:return u++,[3,1];case 4:return bd(a),[2,bE(s)]}})})},e.prototype.getNamedWeights=function(t){for(var e={},n=null!=t&&t.trainableOnly,r=n?this.trainableWeights:this.weights,o=this.getWeights(n),i=0;i<r.length;++i)n&&!r[i].trainable||(e[r[i].originalName]=o[i]);return e},Object.defineProperty(e.prototype,"stopTraining",{set:function(t){this.stopTraining_=t},enumerable:!0,configurable:!0}),e.prototype.save=function(t,e){return eE(this,void 0,void 0,function(){var n,r,o;return nE(this,function(i){switch(i.label){case 0:if("string"==typeof t){if(0===(n=AC.getSaveHandlers(t)).length)throw new fE("Cannot find any save handlers for URL '"+t+"'");if(n.length>1)throw new fE("Found more than one ("+n.length+") save handlers for URL '"+t+"'");t=n[0]}if(null==t.save)throw new fE("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,AC.encodeWeights(this.getNamedWeights(e))];case 1:return r=i.sent(),o=this.toJSON(null,!1),[2,t.save({modelTopology:o,weightData:r.data,weightSpecs:r.specs,format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v1.0.0",convertedBy:null})]}})})},e.className="Model",e}(cI);function kI(t,e,n){return eE(this,void 0,void 0,function(){var r,o,i,a,s,u;return nE(this,function(l){switch(l.label){case 0:if(null==n&&(n={}),null==t.load)throw new fE("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,t.load()];case 1:if(r=l.sent(),null!=(o=r.modelTopology).model_config&&(o=o.model_config),i=null==n.strict||n.strict,a=null!=r.weightData&&null!=r.weightSpecs&&i,s=tI(nI(o),e,a),null!=r.weightData){if(null==r.weightSpecs)throw new fE("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");u=AC.decodeWeights(r.weightData,r.weightSpecs),s.loadWeights(u,i),bd(u)}return[2,s]}})})}LC.registerClass(AI);var RI=function(t){function e(e){var n=t.call(this,{inputs:[],outputs:[]})||this;if(e=e||{},n.trainable=!0,n._updatable=!0,n.built=!1,n.name=null!=e.name?e.name:sE("sequential_"),null!=e.layers)for(var r=0,o=e.layers;r<o.length;r++)n.add(o[r]);return n}return QC(e,t),e.prototype.checkShape=function(t){if(t.inboundNodes[0].outputTensors[0].shape.some(function(t){return t<0}))throw new fE("Negative dimension size caused by adding layer "+t.name+" with input shape ["+t.inboundNodes[0].inputTensors[0].shape+"]")},e.prototype.add=function(t){var n,r=t instanceof e||t instanceof AI;if(r){if(1!==(n=t).outputs.length)throw new fE("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new fE("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===t.inboundNodes.length){if(null==t.batchInputShape)throw new fE("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var o=u_({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(o)}if(r)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==t.inboundNodes.length)throw new fE("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer "+t.name+" which has "+t.inboundNodes.length+" pre-existing inbound connections.");if(1!==t.inboundNodes[0].outputTensors.length)throw new fE("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=function t(e,n,r){if((null==n||null!=r&&r>0)&&(n=e.sourceLayer,r=e.nodeIndex),0===n.inboundNodes.length)return[e];var o=n.inboundNodes[r];if(0===o.inboundLayers.length)return o.inputTensors;for(var i=[],a=0;a<o.inboundLayers.length;a++)for(var s=0,u=t(o.inputTensors[a],o.inboundLayers[a],o.nodeIndices[a]);s<u.length;s++){var l=u[s];-1===i.indexOf(l)&&i.push(l)}return i}(this.outputs[0])}this.inboundNodes=[],new o_({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:gE(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(t){return t.shape}),outputShapes:this.outputs[0].shape})}else{var i=t.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1},e.prototype.pop=function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},e.prototype.call=function(t,e){return null==this.model&&this.build(),this.model.call(t,e)},e.prototype.build=function(t){if($N(t),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new AI({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.model.updatable=this.updatable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},e.prototype.countParams=function(){return this.built||this.build(),t.prototype.countParams.call(this)},e.prototype.summary=function(e,n,r){void 0===r&&(r=console.log),this.built||this.build(),t.prototype.summary.call(this,e,n,r)},e.prototype.setWeights=function(t){null==this.model&&this.build(),this.model.setWeights(t)},Object.defineProperty(e.prototype,"updatable",{get:function(){return this._updatable},set:function(t){this.built&&(this.model.updatable=t),this._updatable=t},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t,e,n){if(void 0===n&&(n={}),!this.built)throw new hE("The model needs to be compiled before being used.");return this.model.evaluate(t,e,n)},e.prototype.evaluateDataset=function(t,e){return eE(this,void 0,void 0,function(){return nE(this,function(n){if(!this.built)throw new hE("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(t,e)]})})},e.prototype.predict=function(t,e){return void 0===e&&(e={}),null==this.model&&this.build(),this.model.predict(t,e)},e.prototype.predictOnBatch=function(t){return null==this.model&&this.build(),this.model.predictOnBatch(t)},e.prototype.compile=function(t){this.build(),this.model.compile(t),this.optimizer=this.model.optimizer,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},e.prototype.fit=function(t,e,n){return void 0===n&&(n={}),eE(this,void 0,void 0,function(){return nE(this,function(r){if(!this.built)throw new hE("The model needs to be compiled before being used.");return[2,this.model.fit(t,e,n)]})})},e.prototype.fitDataset=function(t,e){return eE(this,void 0,void 0,function(){return nE(this,function(n){if(!this.built)throw new hE("The model needs to be compiled before being used.");return[2,this.model.fitDataset(t,e)]})})},e.prototype.trainOnBatch=function(t,e){return eE(this,void 0,void 0,function(){return nE(this,function(n){return[2,this.model.trainOnBatch(t,e)]})})},e.fromConfig=function(t,n,r,o){var i;void 0===r&&(r={}),void 0===o&&(o=!1);var a={};if(n instanceof Array){if(null==n[0].className||"Merge"===n[0].className)throw new fE("Legacy serialization format not supported yet.");i=n}else Rf.assert(null!=n.layers,function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."}),i=n.layers,delete n.layers,a=n;var s=new t(a);if(!(s instanceof e))throw new dE("Sequential.fromConfig called on non-Sequential input: "+s);for(var u=0,l=i;u<l.length;u++){var c=tI(l[u],void 0,o);o&&c.setFastWeightInitDuringBuild(!0),s.add(c)}return s},Object.defineProperty(e.prototype,"stopTraining",{set:function(t){this.model.stopTraining=t},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){for(var t=[],e=0,n=this.layers;e<n.length;e++){var r=n[e],o={};o.className=r.getClassName(),o.config=r.getConfig(),t.push(o)}return t},e.className="Sequential",e}(AI);function OI(t,e){return null==e&&(e={}),function(t,e){return eE(this,void 0,void 0,function(){var n;return nE(this,function(r){if(null==e&&(e={}),"string"==typeof t){if(0===(n=AC.getLoadHandlers(t)).length)n.push(AC.browserHTTPRequest(t,e));else if(n.length>1)throw new fE("Found more than one ("+n.length+") load handlers for URL '"+t+"'");t=n[0]}return[2,kI(t,void 0,e)]})})}(t,e)}LC.registerClass(RI);var DI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.getConfig=function(){return{}},e}(LC.Serializable),MI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.apply=function(t,e){return void 0===e&&(e=1),function(t,e){if(void 0===e&&(e=1),1!==e)throw new dE("Support for alpha values other than 1 ("+e+") is not implemented yet.");return Bx(t)}(t,e)},e.className="elu",e}(DI);LC.registerClass(MI);var PI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.apply=function(t){return Wx(t)},e.className="selu",e}(DI);LC.registerClass(PI);var LI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.apply=function(t){return jx(t)},e.className="relu",e}(DI);LC.registerClass(LI);var FI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.apply=function(t){return vd(function(){return xx(cE(6),jx(t))})},e.className="relu6",e}(DI);LC.registerClass(FI);var zI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.apply=function(t){return t},e.className="linear",e}(DI);LC.registerClass(zI);var BI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.apply=function(t){return Pb(t)},e.className="sigmoid",e}(DI);LC.registerClass(BI);var UI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.apply=function(t){return function(t){return vd(function(){var e=hx(cE(.5),Nx(cE(.2),t));return xb(e,0,1)})}(t)},e.className="hardSigmoid",e}(DI);LC.registerClass(UI);var VI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.apply=function(t){return Bb(t)},e.className="softplus",e}(DI);LC.registerClass(VI);var jI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.apply=function(t){return function(t){return vd(function(){return gx(t,hx(cE(1),fb(t)))})}(t)},e.className="softsign",e}(DI);LC.registerClass(jI);var WI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.apply=function(t){return Hb(t)},e.className="tanh",e}(DI);LC.registerClass(WI);var HI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.apply=function(t,e){return void 0===e&&(e=-1),$d(t,e)},e.className="softmax",e}(DI);function qI(t){return t.getClassName()}function GI(t,e){return void 0===e&&(e={}),NE(t,LC.SerializationMap.getMap().classNameMap,e,"activation")}function KI(t){var e;return null==t?GI(e={className:"linear",config:{}}):"string"==typeof t?((e={}).className=t,e.config={},GI(e)):t instanceof DI?t:GI(t)}LC.registerClass(HI);var $I=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e}(LC.Serializable),XI=function(t){function e(e){var n=t.call(this)||this,r=null==e||null==e.l1?.01:e.l1,o=null==e||null==e.l2?.01:e.l2;return n.hasL1=0!==r,n.hasL2=0!==o,n.l1=cE(r),n.l2=cE(o),n}return QC(e,t),e.prototype.apply=function(t){var e=this;return vd(function(){var n=am([1]);return e.hasL1&&(n=hx(n,Qw(Nx(e.l1,fb(t))))),e.hasL2&&(n=hx(n,Qw(Nx(e.l2,bN(t))))),n.asScalar()})},e.prototype.getConfig=function(){return{l1:this.l1.dataSync()[0],l2:this.l2.dataSync()[0]}},e.fromConfig=function(t,e){return new t({l1:e.l1,l2:e.l2})},e.className="L1L2",e}($I);LC.registerClass(XI);var ZI={l1l2:"L1L2"};function YI(t){return EE(t)}function QI(t,e){return void 0===e&&(e={}),NE(t,LC.SerializationMap.getMap().classNameMap,e,"regularizer")}function JI(t){return null==t?null:"string"==typeof t?QI({className:t in ZI?ZI[t]:t,config:{}}):t instanceof $I?t:QI(t)}var tT=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;return n.supportsMasking=!0,null!=e&&(n.maxValue=e.maxValue),n}return QC(e,t),e.prototype.call=function(t,e){t=KN(t);var n=jx(t);return null!=this.maxValue&&(n=xb(n,0,this.maxValue)),n},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={maxValue:this.maxValue},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="ReLU",e}(a_);LC.registerClass(tT);var eT=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;return n.DEFAULT_ALPHA=.3,null==e&&(e={}),n.alpha=null==e.alpha?n.DEFAULT_ALPHA:e.alpha,n}return QC(e,t),e.prototype.call=function(t,e){var n=KN(t);return Ux(n,this.alpha)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={alpha:this.alpha},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="LeakyReLU",e}(a_);LC.registerClass(eT);var nT=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;if(n.DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),n.supportsMasking=!0,n.alphaInitializer=HN(e.alphaInitializer||n.DEFAULT_ALPHA_INITIALIZER),n.alphaRegularizer=JI(e.alphaRegularizer),n.alphaConstraint=VE(e.alphaConstraint),null==e.sharedAxes)n.sharedAxes=null;else if(Array.isArray(e.sharedAxes))n.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new fE("Expected sharedAxes to be a number or an array of numbers, but got "+e.sharedAxes);n.sharedAxes=[e.sharedAxes]}return n}return QC(e,t),e.prototype.build=function(t){var e=(t=$N(t)).slice(1);if(null!=this.sharedAxes)for(var n=0,r=this.sharedAxes;n<r.length;n++)e[(i=r[n])-1]=1;this.alpha=this.addWeight("alpha",e,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var o={};if(null!=this.sharedAxes)for(var i=1;i<t.length;++i)o[i]=t[i];this.inputSpec=[new e_({ndim:t.length,axes:o})],this.built=!0},e.prototype.call=function(t,e){return t=KN(t),Vx(t,this.alpha.read())},e.prototype.getConfig=function(){var e={alphaInitializer:WN(this.alphaInitializer),alphaRegularizer:YI(this.alphaRegularizer),alphaConstraint:BE(this.alphaConstraint),sharedAxes:this.sharedAxes},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="PReLU",e}(a_);LC.registerClass(nT);var rT=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;if(n.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==n.DEFAULT_ALPHA)throw new dE("Non-default alpha value ("+e.alpha+") is not supported by the ELU layer yet.");return n.alpha=null==e.alpha?n.DEFAULT_ALPHA:e.alpha,n}return QC(e,t),e.prototype.call=function(t,e){var n=KN(t);return Bx(n)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={alpha:this.alpha},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="ELU",e}(a_);LC.registerClass(rT);var oT=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;return n.DEFAULT_THETA=1,null==e&&(e={}),n.theta=null==e.theta?n.DEFAULT_THETA:e.theta,n.thetaTensor=cE(n.theta),n}return QC(e,t),e.prototype.call=function(t,e){var n=KN(t);return n.mul(uN(n.greater(this.thetaTensor),"float32"))},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={theta:this.theta},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="ThresholdedReLU",e}(a_);LC.registerClass(oT);var iT=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;return n.DEFAULT_AXIS=1,null==e&&(e={}),n.softmax=(new HI).apply,n.axis=null==e.axis?n.DEFAULT_AXIS:e.axis,n}return QC(e,t),e.prototype.call=function(t,e){var n=KN(t);return this.softmax(n,this.axis)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={axis:this.axis},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Softmax",e}(a_);function aT(t,e,n){if("number"==typeof t)return gE(t,e);if(t.length!==e)throw new fE("The "+n+" argument must be a tuple of "+e+" integers. Received: "+t.length+" elements.");for(var r=0;r<e;++r){var o=t[r];if(!nN(o))throw new fE("The "+n+" argument must be a tuple of "+e+" integers. Received: "+JSON.stringify(t)+" including a non-integer number "+o)}return t}function sT(t,e,n,r,o){return void 0===o&&(o=1),null==t?t:Math.floor((("same"===n?t:t-(e+(e-1)*(o-1))+1)+r-1)/r)}function uT(t,e,n,r){if(null==t)return null;if("valid"===r)t=t*e+aN([n-e,0]);else{if("same"!==r)throw new fE("Unsupport padding mode: "+r+".");t*=e}return t}function lT(t,e){return vd(function(){return KE(e),"channelsFirst"===e?Hx(t,[0,2,3,1]):t})}LC.registerClass(iT);var cT=function(t){function e(n,r){var o=t.call(this,r)||this;if(o.bias=null,o.DEFAULT_KERNEL_INITIALIZER="glorotNormal",o.DEFAULT_BIAS_INITIALIZER="zeros",e.verifyArgs(r),o.rank=n,RE(o.rank,"rank"),1!==o.rank&&2!==o.rank)throw new dE("Convolution layer for rank other than 1 or 2 ("+o.rank+") is not implemented yet.");if(o.kernelSize=aT(r.kernelSize,n,"kernelSize"),o.strides=aT(null==r.strides?1:r.strides,n,"strides"),o.padding=null==r.padding?"valid":r.padding,$E(o.padding),o.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,KE(o.dataFormat),o.activation=KI(r.activation),o.useBias=null==r.useBias||r.useBias,o.biasInitializer=HN(r.biasInitializer||o.DEFAULT_BIAS_INITIALIZER),o.biasConstraint=VE(r.biasConstraint),o.biasRegularizer=JI(r.biasRegularizer),o.activityRegularizer=JI(r.activityRegularizer),o.dilationRate=aT(null==r.dilationRate?1:r.dilationRate,n,"dilationRate"),1===o.rank&&Array.isArray(o.dilationRate)&&1!==o.dilationRate.length)throw new fE("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(o.dilationRate));if(2===o.rank)if("number"==typeof o.dilationRate)o.dilationRate=[o.dilationRate,o.dilationRate];else if(2!==o.dilationRate.length)throw new fE("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(o.dilationRate));return o}return QC(e,t),e.verifyArgs=function(t){if(vE("kernelSize"in t,"required key 'kernelSize' not in config"),"number"!=typeof t.kernelSize&&!kE(t.kernelSize,"number",1,2))throw new fE("BaseConv expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(t.kernelSize)+".")},e.prototype.getConfig=function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:qI(this.activation),useBias:this.useBias,biasInitializer:WN(this.biasInitializer),biasRegularizer:YI(this.biasRegularizer),activityRegularizer:YI(this.activityRegularizer),biasConstraint:BE(this.biasConstraint)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e}(a_),pT=function(t){function e(n,r){var o=t.call(this,n,r)||this;return o.kernel=null,e.verifyArgs(r),o.filters=r.filters,RE(o.filters,"filters"),o.kernelInitializer=HN(r.kernelInitializer||o.DEFAULT_KERNEL_INITIALIZER),o.kernelConstraint=VE(r.kernelConstraint),o.kernelRegularizer=JI(r.kernelRegularizer),o}return QC(e,t),e.prototype.build=function(t){var e;t=$N(t);var n="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[n])throw new fE("The channel dimension of the input should be defined. Found "+t[n]);var r=t[n],o=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(e={},e[n]=r,e)}],this.built=!0},e.prototype.call=function(t,e){var n=this;return vd(function(){var e;t=KN(t);var r=null==n.bias?null:n.bias.read();if(1===n.rank)e=function(t,e,n,r,o,i,a){return void 0===r&&(r=1),void 0===o&&(o="valid"),void 0===a&&(a=1),vd(function(){if(null==i&&(i="channelsLast"),KE(i),3!==t.shape.length)throw new fE("The input of a conv1dWithBias operation should be 3, but is "+t.shape.length+" instead.");if(3!==e.shape.length)throw new fE("The kernel for a conv1dWithBias operation should be 3, but is "+e.shape.length+" instead");if(null!=n&&1!==n.shape.length)throw new fE("The bias for a conv1dWithBias operation should be 1, but is "+e.shape.length+" instead");if("channelsFirst"===i&&(t=Hx(t,[0,2,1])),"causal"===o)throw new dE("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=vw(t,e,r,"same"===o?"same":"valid","NWC",a);return null!=n&&(s=wN(s,n)),s})}(t,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)e=function(t,e,n,r,o,i,a){return void 0===r&&(r=[1,1]),void 0===o&&(o="valid"),vd(function(){if(null==i&&(i="channelsLast"),KE(i),3!==t.rank&&4!==t.rank)throw new fE("conv2dWithBias expects input to be of rank 3 or 4, but received "+t.rank+".");if(3!==e.rank&&4!==e.rank)throw new fE("conv2dWithBias expects kernel to be of rank 3 or 4, but received "+t.rank+".");var s=lT(t,i);if("causal"===o)throw new dE("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return s=yw(s,e,r,"same"===o?"same":"valid","NHWC",a),null!=n&&(s=wN(s,n)),"channelsFirst"===i&&(s=Hx(s,[0,3,1,2])),s})}(t,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else if(3===n.rank)throw new dE("3D convolution is not implemented yet.");return null!=n.activation&&(e=n.activation.apply(e)),e})},e.prototype.computeOutputShape=function(t){t=$N(t);for(var e=[],n="channelsLast"===this.dataFormat?t.slice(1,t.length-1):t.slice(2),r=0;r<n.length;++r){var o=sT(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);e.push(o)}var i=[t[0]];return"channelsLast"===this.dataFormat?(i=i.concat(e)).push(this.filters):(i.push(this.filters),i=i.concat(e)),i},e.prototype.getConfig=function(){var e={filters:this.filters,kernelInitializer:WN(this.kernelInitializer),kernelRegularizer:YI(this.kernelRegularizer),kernelConstraint:BE(this.kernelConstraint)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.verifyArgs=function(t){if(!("filters"in t)||"number"!=typeof t.filters||t.filters<1)throw new fE("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(t.filters))},e}(cT),hT=function(t){function e(n){var r=t.call(this,2,n)||this;return e.verifyArgs(n),r}return QC(e,t),e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,e},e.verifyArgs=function(t){if("number"!=typeof t.kernelSize&&!kE(t.kernelSize,"number",1,2))throw new fE("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(t.kernelSize)+".")},e.className="Conv2D",e}(pT);LC.registerClass(hT);var fT=function(t){function e(e){var n=t.call(this,e)||this;if(n.inputSpec=[new e_({ndim:4})],"same"!==n.padding&&"valid"!==n.padding)throw new fE("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+n.padding);return n}return QC(e,t),e.prototype.build=function(t){var e;if(4!==(t=$N(t)).length)throw new fE("Input should have rank 4; Received input shape: "+JSON.stringify(t));var n="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[n])throw new fE("The channel dimension of the inputs should be defined. Found `None`.");var r=t[n],o=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new e_({ndim:4,axes:(e={},e[n]=r,e)})],this.built=!0},e.prototype.call=function(t,e){var n=this;return vd(function(){var e=KN(t);if(4!==e.shape.length)throw new fE("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+e.shape.length);var r,o,i=e.shape;"channelsFirst"===n.dataFormat?(r=2,o=3):(r=1,o=2);var a=i[o],s=n.kernelSize[1],u=n.strides[1],l=[i[0],uT(i[r],n.strides[0],n.kernelSize[0],n.padding),uT(a,u,s,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(e=Hx(e,[0,2,3,1]));var c=Cw(e,n.kernel.read(),l,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(c=Hx(c,[0,3,1,2])),null!=n.bias&&(c=wN(c,n.bias.read(),n.dataFormat)),null!=n.activation&&(c=n.activation.apply(c)),c})},e.prototype.computeOutputShape=function(t){var e,n,r,o=(t=$N(t)).slice();"channelsFirst"===this.dataFormat?(e=1,n=2,r=3):(e=3,n=1,r=2);var i=this.kernelSize[0],a=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return o[e]=this.filters,o[n]=uT(o[n],s,i,this.padding),o[r]=uT(o[r],u,a,this.padding),o},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.dilationRate,e},e.className="Conv2DTranspose",e}(hT);LC.registerClass(fT);var dT=function(t){function e(e){return t.call(this,2,e)||this}return QC(e,t),e.className="SeparableConv2D",e}(function(t){function e(e,n){var r=t.call(this,e,n)||this;if(r.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",r.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",r.depthwiseKernel=null,r.pointwiseKernel=null,null==n.filters)throw new fE("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=n.kernelInitializer||null!=n.kernelRegularizer||null!=n.kernelConstraint)throw new fE("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=n.padding&&"same"!==n.padding&&"valid"!==n.padding)throw new fE("SeparableConv"+r.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(n.padding));return r.depthMultiplier=null==n.depthMultiplier?1:n.depthMultiplier,r.depthwiseInitializer=HN(n.depthwiseInitializer||r.DEFAULT_DEPTHWISE_INITIALIZER),r.depthwiseRegularizer=JI(n.depthwiseRegularizer),r.depthwiseConstraint=VE(n.depthwiseConstraint),r.pointwiseInitializer=HN(n.depthwiseInitializer||r.DEFAULT_POINTWISE_INITIALIZER),r.pointwiseRegularizer=JI(n.pointwiseRegularizer),r.pointwiseConstraint=VE(n.pointwiseConstraint),r}return QC(e,t),e.prototype.build=function(t){var e;if((t=$N(t)).length<this.rank+2)throw new fE("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2)+", but received input shape: "+JSON.stringify(t));var n="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[n]||t[n]<0)throw new fE("The channel dimension of the inputs should be defined, but found "+JSON.stringify(t[n]));for(var r=t[n],o=this.kernelSize.concat([r,this.depthMultiplier]),i=[],a=0;a<this.rank;++a)i.push(1);i.push(r*this.depthMultiplier,this.filters),this.depthwiseKernel=this.addWeight("depthwise_kernel",o,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.bias=this.useBias?this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.inputSpec=[new e_({ndim:this.rank+2,axes:(e={},e[n]=r,e)})],this.built=!0},e.prototype.call=function(t,e){var n=this;return vd(function(){var e;if(t=KN(t),1===n.rank)throw new dE("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(t=Hx(t,[0,2,3,1])),e=Sw(t,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(e=wN(e,n.bias.read(),n.dataFormat)),null!=n.activation&&(e=n.activation.apply(e)),"channelsFirst"===n.dataFormat&&(e=Hx(e,[0,3,1,2])),e})},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=WN(this.depthwiseInitializer),e.pointwiseInitializer=WN(this.pointwiseInitializer),e.depthwiseRegularizer=YI(this.depthwiseRegularizer),e.pointwiseRegularizer=YI(this.pointwiseRegularizer),e.depthwiseConstraint=BE(this.depthwiseConstraint),e.pointwiseConstraint=BE(this.pointwiseConstraint),e},e.className="SeparableConv",e}(pT));LC.registerClass(dT);var mT=function(t){function e(n){var r=t.call(this,1,n)||this;return e.verifyArgs(n),r.inputSpec=[{ndim:3}],r}return QC(e,t),e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,delete e.dataFormat,e},e.verifyArgs=function(t){if("number"!=typeof t.kernelSize&&!kE(t.kernelSize,"number",1,1))throw new fE("Conv1D expects config.kernelSize to be number or number[] with length 1, but received "+JSON.stringify(t.kernelSize)+".")},e.className="Conv1D",e}(pT);LC.registerClass(mT);var gT=function(t){function e(e){var n=t.call(this,e)||this;return n.cropping="number"==typeof e.cropping?[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:e.cropping,n.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,n.inputSpec=[{ndim:4}],n}return QC(e,t),e.prototype.computeOutputShape=function(t){return"channelsFirst"===this.dataFormat?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]},e.prototype.call=function(t,e){var n=this;return vd(function(){return t=KN(t),"channelsLast"===n.dataFormat?hN(hN(t,n.cropping[0][0],t.shape[1]-n.cropping[0][0]-n.cropping[0][1],2),n.cropping[1][0],t.shape[2]-n.cropping[1][1]-n.cropping[1][0],3):hN(hN(t,n.cropping[0][0],t.shape[2]-n.cropping[0][0]-n.cropping[0][1],3),n.cropping[1][0],t.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)})},e.prototype.getConfig=function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Cropping2D",e}(a_);LC.registerClass(gT);var vT=function(t){function e(e){var n=t.call(this,e)||this;return n.DEFAULT_SIZE=[2,2],n.inputSpec=[{ndim:4}],n.size=null==e.size?n.DEFAULT_SIZE:e.size,n.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,n}return QC(e,t),e.prototype.computeOutputShape=function(t){if("channelsFirst"===this.dataFormat){var e=null==t[2]?null:this.size[0]*t[2],n=null==t[3]?null:this.size[1]*t[3];return[t[0],t[1],e,n]}return[t[0],e=null==t[1]?null:this.size[0]*t[1],n=null==t[2]?null:this.size[1]*t[2],t[3]]},e.prototype.call=function(t,e){var n=this;return vd(function(){var e=KN(t),r=e.shape;if("channelsFirst"===n.dataFormat){e=Hx(e,[0,2,3,1]);var o=n.size[0]*r[2],i=n.size[1]*r[3],a=e.resizeNearestNeighbor([o,i]);return Hx(a,[0,3,1,2])}return e.resizeNearestNeighbor([o=n.size[0]*r[1],i=n.size[1]*r[2]])})},e.prototype.getConfig=function(){var e={size:this.size,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="UpSampling2D",e}(a_);LC.registerClass(vT);var yT=function(t){function e(e){var n=t.call(this,2,e)||this;return n.depthwiseKernel=null,n.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,n.depthwiseInitializer=HN(e.depthwiseInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.depthwiseConstraint=VE(e.depthwiseConstraint),n.depthwiseRegularizer=JI(e.depthwiseRegularizer),n}return QC(e,t),e.prototype.build=function(t){if((t=$N(t)).length<4)throw new fE("Inputs to DepthwiseConv2D should have rank 4. Received input shape: "+JSON.stringify(t)+".");var e="channelsFirst"===this.dataFormat?1:3;if(null==t[e]||t[e]<0)throw new fE("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not ("+t[e]+").");var n=t[e];this.depthwiseKernel=this.addWeight("depthwise_kernel",[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier],null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.bias=this.useBias?this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0},e.prototype.call=function(t,e){var n=this;return vd(function(){var e=function(t,e,n,r,o,i){return void 0===n&&(n=[1,1]),void 0===r&&(r="valid"),vd(function(){null==o&&(o="channelsLast"),KE(o);var i=lT(t,o);if(4!==t.rank)throw new fE("Input for depthwiseConv2d is required to be 4-D, but is instead "+t.rank+"-D");if(4!==e.rank)throw new fE("depthwiseKernel is required to be 4-D, but is instead "+e.rank+"-D");return i=xw(i,e,n,"same"===r?"same":"valid","NHWC",null),"channelsFirst"===o&&(i=Hx(i,[0,3,1,2])),i})}(t=KN(t),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat);return n.useBias&&(e=wN(e,n.bias.read(),n.dataFormat)),null!=n.activation&&(e=n.activation.apply(e)),e})},e.prototype.computeOutputShape=function(t){t=$N(t);var e="channelsFirst"===this.dataFormat?t[3]:t[2],n="channelsFirst"===this.dataFormat?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,r=sT("channelsFirst"===this.dataFormat?t[2]:t[1],this.kernelSize[0],this.padding,this.strides[0]),o=sT(e,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[t[0],n,r,o]:[t[0],r,o,n]},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=WN(this.depthwiseInitializer),e.depthwiseRegularizer=YI(this.depthwiseRegularizer),e.depthwiseConstraint=BE(this.depthwiseRegularizer),e},e.className="DepthwiseConv2D",e}(cT);LC.registerClass(yT);var bT=function(t){function e(e){var n=t.call(this,e)||this;if(n.rate=Math.max(Math.min(e.rate,1),0),n.rateScalar=cE(n.rate),n.noiseShape=e.noiseShape,n.seed=e.seed,null!=n.seed)throw new dE("Non-default seed is not implemented in Dropout layer yet: "+n.seed);return n.supportsMasking=!0,n}return QC(e,t),e.prototype.getNoiseShape=function(t){if(null==this.noiseShape)return this.noiseShape;for(var e=t.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?e[r]:this.noiseShape[r]);return n},e.prototype.call=function(t,e){var n=this;return vd(function(){n.invokeCallHook(t,e);var r=KN(t);if(null!=n.noiseShape&&!Rf.arraysEqual(r.shape,n.noiseShape))throw new dE("Non-default noise shape is not implemented in Dropout layer yet: "+JSON.stringify(n.noiseShape));if(0<n.rate&&n.rate<1){var o=null!=e.training&&e.training,i=n.getNoiseShape(r);return SN(function(){return xN(r,n.rateScalar,i,n.seed)},function(){return r},o)}return t})},e.prototype.getConfig=function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.prototype.dispose=function(){var e=t.prototype.dispose.call(this);return this.rateScalar.isDisposed||(this.rateScalar.dispose(),e.numDisposedVariables++),e},e.className="Dropout",e}(a_);LC.registerClass(bT);var wT=function(t){function e(e){var n=t.call(this,e)||this;if(n.activation=null,n.useBias=!0,n.kernel=null,n.bias=null,n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var r=null;null!=e.batchSize&&(r=e.batchSize),n.batchInputShape=[r,e.inputDim]}return n.units=e.units,RE(n.units,"units"),n.activation=KI(e.activation),null!=e.useBias&&(n.useBias=e.useBias),n.kernelInitializer=HN(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.biasInitializer=HN(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelConstraint=VE(e.kernelConstraint),n.biasConstraint=VE(e.biasConstraint),n.kernelRegularizer=JI(e.kernelRegularizer),n.biasRegularizer=JI(e.biasRegularizer),n.activityRegularizer=JI(e.activityRegularizer),n.supportsMasking=!0,n.inputSpec=[{minNDim:2}],n}return QC(e,t),e.prototype.build=function(t){var e,n=(t=$N(t))[t.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(e={},e[-1]=n,e)}],this.built=!0},e.prototype.computeOutputShape=function(t){var e=(t=$N(t)).slice();return e[e.length-1]=this.units,e},e.prototype.call=function(t,e){var n=this;return vd(function(){n.invokeCallHook(t,e);var r=vN(KN(t),n.kernel.read());return null!=n.bias&&(r=wN(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r)),r})},e.prototype.getConfig=function(){var e={units:this.units,activation:qI(this.activation),useBias:this.useBias,kernelInitializer:WN(this.kernelInitializer),biasInitializer:WN(this.biasInitializer),kernelRegularizer:YI(this.kernelRegularizer),biasRegularizer:YI(this.biasRegularizer),activityRegularizer:YI(this.activityRegularizer),kernelConstraint:BE(this.kernelConstraint),biasConstraint:BE(this.biasConstraint)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Dense",e}(a_);LC.registerClass(wT);var xT=function(t){function e(e){var n=t.call(this,e||{})||this;return n.inputSpec=[{minNDim:3}],n}return QC(e,t),e.prototype.computeOutputShape=function(t){for(var e=0,n=(t=$N(t)).slice(1);e<n.length;e++)if(null==n[e])throw new fE('The shape of the input to "Flatten" is not fully defined (got '+t.slice(1)+'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.');return[t[0],rN(t,1)]},e.prototype.call=function(t,e){var n=this;return vd(function(){return n.invokeCallHook(t,e),function(t){if(t.rank<=1)throw new fE("batchFlatten requires a minimum rank of 2. Got rank: "+t.rank+".");var e=[t.shape[0],rN(t.shape,1)];return t.reshape(e)}(KN(t))})},e.className="Flatten",e}(a_);LC.registerClass(xT);var ST=function(t){function e(e){var n=t.call(this,e)||this;return n.supportsMasking=!0,n.activation=KI(e.activation),n}return QC(e,t),e.prototype.call=function(t,e){var n=this;return vd(function(){n.invokeCallHook(t,e);var r=KN(t);return n.activation.apply(r)})},e.prototype.getConfig=function(){var e={activation:qI(this.activation)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Activation",e}(a_);LC.registerClass(ST);var CT=function(t){function e(e){var n=t.call(this,e)||this;return n.n=e.n,n.inputSpec=[{ndim:2}],n}return QC(e,t),e.prototype.computeOutputShape=function(t){return[t[0],this.n,t[1]]},e.prototype.call=function(t,e){var n=this;return vd(function(){return function(t,e){return vd(function(){if(2!==t.shape.length)throw new fE("repeat() expects a rank-2 tensor, but received a rank-"+t.shape.length+" tensor.");return mN(lN(t,1),[1,e,1])})}(t=KN(t),n.n)})},e.prototype.getConfig=function(){var e={n:this.n},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="RepeatVector",e}(a_);LC.registerClass(CT);var ET=function(t){function e(e){var n=t.call(this,e)||this;n.targetShape=e.targetShape;for(var r=0;r<n.targetShape.length;++r)n.isUnknown(n.targetShape[r])&&(n.targetShape[r]=null);return n}return QC(e,t),e.prototype.isUnknown=function(t){return t<0||null==t},e.prototype.fixUnknownDimension=function(t,e){for(var n="Total size of new array must be unchanged.",r=e.slice(),o=1,i=null,a=0;a<r.length;++a){var s=r[a];if(this.isUnknown(s)){if(null!==i)throw new fE("Can only specifiy one unknown dimension.");i=a}else o*=s}var u=rN(t);if(null!==i){if(0===o||u%o!=0)throw new fE(n);r[i]=u/o}else if(u!==o)throw new fE(n);return r},e.prototype.computeOutputShape=function(t){for(var e=!1,n=0;n<t.length;++n)if(this.isUnknown(t[n])){e=!0;break}return e?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))},e.prototype.call=function(t,e){var n=this;return vd(function(){n.invokeCallHook(t,e);var r=KN(t),o=r.shape,i=o.slice(0,1).concat(n.fixUnknownDimension(o.slice(1),n.targetShape));return r.reshape(i)})},e.prototype.getConfig=function(){var e={targetShape:this.targetShape},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Reshape",e}(a_);LC.registerClass(ET);var NT=function(t){function e(e){var n=t.call(this,e)||this;if(null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+e.dims+" instead.");var r=sN(1,e.dims.length+1);if(!Rf.arraysEqual(e.dims.slice().sort(),r))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return n.dims=e.dims,n.dimsIncludingBatch=[0].concat(n.dims),n.inputSpec=[new e_({ndim:n.dims.length+1})],n}return QC(e,t),e.prototype.computeOutputShape=function(t){var e=(t=$N(t)).slice();return this.dims.forEach(function(n,r){e[r+1]=t[n]}),e},e.prototype.call=function(t,e){return Hx(KN(t),this.dimsIncludingBatch)},e.prototype.getConfig=function(){var e={dims:this.dims},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Permute",e}(a_);LC.registerClass(NT);var _T=function(t){function e(e){var n=t.call(this,e)||this;if(n.embeddings=null,n.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var r=null;null!=e.batchSize&&(r=e.batchSize),n.batchInputShape=null==e.inputLength?[r,null]:[r].concat(wE(e.inputLength))}return n.inputDim=e.inputDim,RE(n.inputDim,"inputDim"),n.outputDim=e.outputDim,RE(n.outputDim,"outputDim"),n.embeddingsInitializer=HN(e.embeddingsInitializer||n.DEFAULT_EMBEDDINGS_INITIALIZER),n.embeddingsRegularizer=JI(e.embeddingsRegularizer),n.activityRegularizer=JI(e.activityRegularizer),n.embeddingsConstraint=VE(e.embeddingsConstraint),n.maskZero=e.maskZero,n.supportsMasking=e.maskZero,n.inputLength=e.inputLength,n}return QC(e,t),e.prototype.build=function(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},e.prototype.warnOnIncompatibleInputShape=function(t){},e.prototype.computeMask=function(t,e){var n=this;return vd(function(){return n.maskZero?(t=KN(t),cx(t,pm(t))):null})},e.prototype.computeOutputShape=function(t){if(t=$N(t),null==this.inputLength)return t.concat([this.outputDim]);var e=wE(this.inputLength);if(e.length!==t.length-1)throw new fE('"inputLength" is '+this.inputLength+", but received input shape has shape "+t);for(var n=0,r=0;r<e.length;++r){var o=e[r],i=t[r+1];if(null!=o&&null!=i&&o!==i)throw new fE('"inputLength" is '+this.inputLength+", but received input shape has shape "+t);null==o&&(e[n]=i),n++}return[t[0]].concat(e,[this.outputDim])},e.prototype.call=function(t,e){var n=this;return vd(function(){n.invokeCallHook(t,e);var r=KN(t);return"int32"!==r.dtype&&(r=uN(r,"int32")),yN(n.embeddings.read(),r.as1D()).reshape($N(n.computeOutputShape(r.shape)))})},e.prototype.getConfig=function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:WN(this.embeddingsInitializer),embeddingsRegularizer:YI(this.embeddingsRegularizer),activityRegularizer:YI(this.activityRegularizer),embeddingsConstraint:BE(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Embedding",e}(a_);LC.registerClass(_T);var IT=function(t){function e(e){var n=t.call(this,e||{})||this;return n.supportsMasking=!0,n}return QC(e,t),e.prototype.mergeFunction=function(t){throw new dE},e.prototype.computeElementwiseOpOutputShape=function(t,e){if(null==t||null==e)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(0===e.length)return t;for(var n=t.slice(0,t.length-e.length),r=0;r<e.length;++r){var o=t[t.length-e.length+r],i=e[r];if(null==o||null==i||o<0||i<0)n.push(null);else if(1===o)n.push(i);else if(1===i)n.push(o);else{if(o!==i)throw new fE("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));n.push(o)}}return n},e.prototype.build=function(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[$N(t)]),(t=t).length<2)throw new fE("A merge layer should be called on an Array of at least 2 inputs. Got "+t.length+" input(s).");for(var e=[],n=0,r=t;n<r.length;n++)null!=(a=r[n])&&null!==a[0]&&e.push(a[0]);if((e=IE(e)).length>1)throw new fE("Can not merge tensors with different batch sizes. Got tensors with shapes: "+JSON.stringify(t)+".");for(var o=null==t[0]?null:t[0].slice(1),i=1;i<t.length;++i){var a=null==t[i]?null:t[i].slice(1);o=this.computeElementwiseOpOutputShape(o,a)}var s=t.map(function(t){return t.length});this.reshapeRequired=-1!==t.indexOf(null)||1!==IE(s).length},e.prototype.call=function(t,e){var n=this;return vd(function(){if(t=t,n.reshapeRequired){var e=[],r=t.map(function(t){return t.rank});if(-1===r.indexOf(null)){for(var o=aN(r),i=0,a=t;i<a.length;i++){for(var s=(h=a[i]).rank,u=0;u<o-s;++u)h=lN(h,1);e.push(h)}return n.mergeFunction(e)}for(var l=!1,c=0,p=t;c<p.length;c++){var h;if(null==(s=(h=p[c]).rank)){var f=h.shape,d=f[0],m=f.slice(1).concat([d]),g=h.reshape([d].concat(rN(f.slice(1))));g=(g=Hx(g,[1,0])).reshape(m),e.push(g),l=!0}else if(s>1){var v=sN(1,s).concat([0]);e.push(Hx(h,v)),l=!0}else e.push(h)}var y=n.mergeFunction(e),b=y.rank;if(l)if(null==b){var w=y.shape;m=[d=w[w.length-1]].concat(w.slice(0,w.length-1)),y=Hx(y.reshape([-1,d]),[1,0]).reshape(m)}else b>1&&(v=[b-1].concat(sN(0,b-1)),y=Hx(y,v));return y}return n.mergeFunction(t)})},e.prototype.computeOutputShape=function(t){var e;e=null==(t=t)[0]?null:t[0].slice(1);for(var n=1;n<t.length;++n){var r=null==t[n]?null:t[n].slice(1);e=this.computeElementwiseOpOutputShape(e,r)}for(var o=[],i=0,a=t;i<a.length;i++)null!=(r=a[i])&&null!==r[0]&&o.push(r[0]);return 1===(o=IE(o)).length?o.concat(e):[null].concat(e)},e.prototype.computeMask=function(t,e){return vd(function(){if(null==e)return null;if(!Array.isArray(e))throw new fE("`mask` should be an Array");if(!Array.isArray(t))throw new fE("`inputs` should be an Array");if(e.length!==t.length)throw new fE("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths ("+t.length+" vs "+e.length+")");if(e.every(function(t){return null==t}))return null;for(var n=(e=e.map(function(t){return null==t?t:Hy(t,0)}))[0],r=1;r<e.length-1;++r)n=Dx(n,e[r]);return n})},e}(a_),TT=function(t){function e(e){return t.call(this,e)||this}return QC(e,t),e.prototype.mergeFunction=function(t){return vd(function(){for(var e=t[0].clone(),n=1;n<t.length;++n)e=hx(e,t[n]);return e})},e.className="Add",e}(IT);LC.registerClass(TT);var AT=function(t){function e(e){return t.call(this,e)||this}return QC(e,t),e.prototype.mergeFunction=function(t){return vd(function(){for(var e=t[0].clone(),n=1;n<t.length;++n)e=Nx(e,t[n]);return e})},e.className="Multiply",e}(IT);LC.registerClass(AT);var kT=function(t){function e(e){return t.call(this,e)||this}return QC(e,t),e.prototype.mergeFunction=function(t){return vd(function(){for(var e=t[0].clone(),n=1;n<t.length;++n)e=hx(e,t[n]);return Nx(cE(1/t.length),e)})},e.className="Average",e}(IT);LC.registerClass(kT);var RT=function(t){function e(e){return t.call(this,e)||this}return QC(e,t),e.prototype.mergeFunction=function(t){return vd(function(){for(var e=t[0],n=1;n<t.length;++n)e=bx(e,t[n]);return e})},e.className="Maximum",e}(IT);LC.registerClass(RT);var OT=function(t){function e(e){return t.call(this,e)||this}return QC(e,t),e.prototype.mergeFunction=function(t){return vd(function(){for(var e=t[0],n=1;n<t.length;++n)e=xx(e,t[n]);return e})},e.className="Minimum",e}(IT);LC.registerClass(OT);var DT=function(t){function e(e){var n=t.call(this,e)||this;return n.DEFAULT_AXIS=-1,null==e&&(e={}),n.axis=null==e.axis?n.DEFAULT_AXIS:e.axis,n.supportsMasking=!0,n.reshapeRequired=!1,n}return QC(e,t),e.prototype.build=function(t){if(!Array.isArray(t)||!Array.isArray(t[0])||1===t.length)throw new fE("A `Concatenate` layer should be called on a list of at least 2 inputs");for(var e=!0,n=0,r=t=t;n<r.length;n++)if(null!=(c=r[n])){e=!1;break}if(!e){for(var o=[],i=0;i<t.length;++i){var a=t[i].slice();a.splice(this.axis,1);for(var s=!1,u=0,l=o;u<l.length;u++){var c=l[u];if(Rf.arraysEqual(c,a)){s=!0;break}}s||o.push(a)}if(o.length>1)throw new fE("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}},e.prototype.mergeFunction=function(t){var e=this;return vd(function(){return fN(t,e.axis)})},e.prototype.computeOutputShape=function(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new fE("A `Concatenate` layer should be called on a list of inputs.");for(var e=t,n=e[0].slice(),r=this.axis<0?n.length+this.axis:this.axis,o=0,i=e.slice(1);o<i.length;o++){var a=i[o];if(null==n[r]||null==a[r]){n[r]=null;break}n[r]+=a[r]}return n},e.prototype.computeMask=function(t,e){var n=this;if(null==e)return null;if(!Array.isArray(e))throw new fE("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new fE("`inputs` should be an array for Concatenate");if(e.length!==t.length)throw new fE("Mismatch in the length of mask ("+e.length+") and the legnth of inputs ("+t.length+")");return vd(function(){var r=!0;if(e.forEach(function(t){null==t||(r=!1)}),r)return null;for(var o=[],i=0;i<t.length;++i)o.push(null==e[i]?cm(t[i]).asType("bool"):e[i].rank<t[i].rank?Hy(e[i],-1):e[i]);var a=Sy(o,n.axis);return Ww(a,-1,!1)})},e.prototype.getConfig=function(){var e={axis:this.axis},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Concatenate",e}(IT);function MT(t,e){for(;t<0;)t+=e;return t}LC.registerClass(DT);var PT=function(t){function e(e){var n=t.call(this,e)||this;return n.axes=e.axes,n.normalize=null!=e.normalize&&e.normalize,n.supportsMasking=!0,n.reshapeRequired=!1,n}return QC(e,t),e.prototype.build=function(t){Rf.assert(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var e=t[0],n=t[1];if(e.length>3||n.length>3)throw new dE("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(e,n);if(e[r[0]]!==n[r[1]])throw new fE("Dimension incompatibility: "+e[r[0]]+" !== "+n[r[1]])},e.prototype.mergeFunction=function(t){if(2!==t.length)throw new fE("A `Dot` layer must be called on exactly 2 inputs, but received "+t.length+" input(s).");var e,n=t[0],r=t[1];return e=Array.isArray(this.axes)?this.axes.map(function(e,n){return MT(e,t[n].shape.length)}):[MT(this.axes,n.shape.length),MT(this.axes,r.shape.length)],this.normalize&&(n=w_(n,e[0]),r=w_(r,e[1])),function(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new dE("batchDot is not implemented for tensors of 4D or higher rank yet");if(Rf.assert(t.shape.length>=2,function(){return"batchDot requires the rank of x to be >= 2, but got "+t.shape.length}),Rf.assert(t.shape.length>=2,function(){return"batchDot requires the rank of y to be >= 2, but got "+e.shape.length}),"number"==typeof n&&(n=[n,n]),"complex64"===t.dtype||"complex64"===e.dtype)throw new dE("batchDot is not implemented for complex64-type Tensors yet.");var r=t.shape.length,o=e.shape.length;null==n&&(n=[r-1,o-2]);var i=n;return vd(function(){var n,a;if(r>o){n=r-o;for(var s=[],u=0;u<n;++u)s.push(1);e=e.reshape(e.shape.concat(s))}else if(o>r){for(n=o-r,s=[],u=0;u<n;++u)s.push(1);t=t.reshape(t.shape.concat(s))}else n=0;if(a=2===t.shape.length&&2===e.shape.length?i[0]===i[1]?t.mulStrict(e).sum(i[0]):t.transpose([1,0]).mulStrict(e).sum(i[1]):t.matMul(e,i[0]!==t.shape.length-1,i[1]===e.shape.length-1),n>0){var l,c=[];for(u=l=r>o?r+o-3:r-1;u<l+n;++u)c.push(u);a=a.squeeze(c)}return 1===a.shape.length&&(a=a.expandDims(1)),a})}(n,r,e)},e.prototype.interpretAxes=function(t,e){return Array.isArray(this.axes)?this.axes:[MT(this.axes,t.length),MT(this.axes,e.length)]},e.prototype.computeOutputShape=function(t){Rf.assert(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var e=t[0].slice(),n=t[1].slice();if(e.length>3||n.length>3)throw new dE("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(e,n);e.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);var o=e.concat(n);return 1===o.length&&o.push(1),o},e.prototype.computeMask=function(t,e){return null},e.prototype.getConfig=function(){var e={axes:this.axes,normalize:this.normalize},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Dot",e}(IT);function LT(t,e,n,r,o,i){var a;if(void 0===i&&(i=.001),2===t.rank)a=nw(t,e,n,r,o,i);else if(3===t.rank)a=rw(t,e,n,r,o,i);else{if(4!==t.rank)throw new dE("batchNormalization is not implemented for array of rank "+t.rank+" yet");a=ow(t,e,n,r,o,i)}return a}LC.registerClass(PT);var FT=function(t){function e(e){var n=this;return null==e&&(e={}),(n=t.call(this,e)||this).supportsMasking=!0,n.axis=null==e.axis?-1:e.axis,n.momentum=null==e.momentum?.99:e.momentum,n.epsilon=null==e.epsilon?.001:e.epsilon,n.center=null==e.center||e.center,n.scale=null==e.scale||e.scale,n.betaInitializer=HN(e.betaInitializer||"zeros"),n.gammaInitializer=HN(e.gammaInitializer||"ones"),n.movingMeanInitializer=HN(e.movingMeanInitializer||"zeros"),n.movingVarianceInitializer=HN(e.movingVarianceInitializer||"ones"),n.betaConstraint=VE(e.betaConstraint),n.gammaConstraint=VE(e.gammaConstraint),n.betaRegularizer=JI(e.betaRegularizer),n.gammaRegularizer=JI(e.gammaRegularizer),n}return QC(e,t),e.prototype.build=function(t){var e;t=$N(t);var n=this.axis>=0?this.axis:this.axis+t.length,r=t[n];if(null==r)throw new fE("Axis "+n+" of input tensor should have a defined dimension but the layer received an input with shape "+JSON.stringify(t)+".");this.inputSpec=[new e_({ndim:t.length,axes:(e={},e[n]=r,e)})];var o=[r];this.scale&&(this.gamma=this.addWeight("gamma",o,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",o,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",o,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",o,null,this.movingVarianceInitializer,null,!1),this.built=!0},e.prototype.call=function(t,e){var n=this;return vd(function(){var r=null!=e.training&&e.training,o=KN(t),i=o.shape,a=i.length,s=sN(0,a),u=n.axis>=0?n.axis:n.axis+a;s.splice(u,1);var l=gE(1,a);l[u]=i[u];var c=s.slice();c.sort();var p=!Rf.arraysEqual(c,sN(0,a).slice(0,a-1));if(!r)return function(){if(p){var t=n.movingMean.read().reshape(l),e=n.movingVariance.read().reshape(l),r=n.center?n.beta.read().reshape(l):null,i=n.scale?n.gamma.read().reshape(l):null;return LT(o,t,e,r,i,n.epsilon)}return LT(o,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var h=function(t,e,n,r,o){return void 0===o&&(o=.001),Rf.arraysEqual(r.slice().sort(),sN(0,t.rank-1))?function(t,e,n,r,o){return void 0===o&&(o=.001),vd(function(){var i=Yw(t,r),a=i.mean,s=i.variance;return[LT(t,a,s,n,e,o),a,s]})}(t,e,n,r,o):function(t,e,n,r,o){return void 0===o&&(o=.001),vd(function(){for(var i=Yw(t,r),a=i.mean,s=i.variance,u=[],l=0,c=sN(0,t.rank);l<c.length;l++){var p=c[l];-1!==r.indexOf(p)?u.push(1):u.push(t.shape[p])}var h=a.reshape(u),f=s.reshape(u),d=null==e?null:e.reshape(u),m=null==n?null:n.reshape(u);return[LT(t,h,f,m,d,o),a,s]})}(t,e,n,r,o)}(o,n.gamma.read(),n.beta.read(),s,n.epsilon),f=h[0],d=h[2],m=function(t,e,n){vd(function(){var r=cE(1).sub(cE(n)),o=t.read(),i=o.sub(e).mul(r);t.write(o.sub(i))})};return m(n.movingMean,h[1],n.momentum),m(n.movingVariance,d,n.momentum),f})},e.prototype.getConfig=function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:WN(this.betaInitializer),gammaInitializer:WN(this.gammaInitializer),movingMeanInitializer:WN(this.movingMeanInitializer),movingVarianceInitializer:WN(this.movingVarianceInitializer),betaRegularizer:YI(this.betaRegularizer),gammaRegularizer:YI(this.gammaRegularizer),betaConstraint:BE(this.betaConstraint),gammaConstraint:BE(this.gammaConstraint)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="BatchNormalization",e}(a_);LC.registerClass(FT);var zT=function(t){function e(e){var n=this;if(null==e&&(e={}),(n=t.call(this,e)||this).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)n.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)n.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new fE("ZeroPadding2D expects padding to be a length-2 array, but received a length-"+e.padding.length+" array.");var r=void 0,o=void 0;if("number"==typeof e.padding[0])r=[e.padding[0],e.padding[0]],o=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new fE("ZeroPadding2D expects height padding to be a length-2 array, but received a length-"+e.padding[0].length+" array.");if(r=e.padding[0],2!==e.padding[1].length)throw new fE("ZeroPadding2D expects width padding to be a length-2 array, but received a length-"+e.padding[1].length+" array.");o=e.padding[1]}n.padding=[r,o]}return n.inputSpec=[new e_({ndim:4})],n}return QC(e,t),e.prototype.computeOutputShape=function(t){return t=$N(t),"channelsFirst"===this.dataFormat?[t[0],t[1],null!=t[2]&&t[2]>=0?t[2]+this.padding[0][0]+this.padding[0][1]:null,null!=t[3]&&t[3]>=0?t[3]+this.padding[1][0]+this.padding[1][1]:null]:[t[0],null!=t[1]&&t[1]>=0?t[1]+this.padding[0][0]+this.padding[0][1]:null,null!=t[2]&&t[2]>=0?t[2]+this.padding[1][0]+this.padding[1][1]:null,t[3]]},e.prototype.call=function(t,e){var n=this;return vd(function(){return function(t,e,n){return vd(function(){if(4!==t.rank)throw new fE("temporalPadding expects input tensor to be 4-D, but received a "+t.rank+"-D tensor.");if(null==e&&(e=[[1,1],[1,1]]),2!==e.length||2!==e[0].length||2!==e[1].length)throw new fE("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new fE("Unknown data format: "+n+". Supported data formats are 'channelsLast' and 'channelsFirst.");return $y(t,"channelsFirst"===n?[[0,0],[0,0],e[0],e[1]]:[[0,0],e[0],e[1],[0,0]])})}(KN(t),n.padding,n.dataFormat)})},e.prototype.getConfig=function(){var e={padding:this.padding,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="ZeroPadding2D",e}(a_);function BT(t,e,n,r,o,i){return vd(function(){var a;KE(o),AE(HE,"PoolMode",i),$E(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==o&&(o="channelsLast"),null==i&&(i="max"),t=lT(t,o);var s="same"===r?"same":"valid";return a="max"===i?Mw(t,e,n,s):Pw(t,e,n,s),"channelsFirst"===o&&(a=Hx(a,[0,3,1,2])),a})}LC.registerClass(zT);var UT=function(t){function e(e){var n=this;if(null==e.poolSize&&(e.poolSize=2),n=t.call(this,e)||this,"number"==typeof e.poolSize)n.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new fE("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.poolSize));n.poolSize=e.poolSize}if(RE(n.poolSize,"poolSize"),null==e.strides)n.strides=n.poolSize;else if("number"==typeof e.strides)n.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new fE("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.strides));n.strides=e.strides}return RE(n.strides,"strides"),n.padding=null==e.padding?"valid":e.padding,$E(n.padding),n.inputSpec=[new e_({ndim:3})],n}return QC(e,t),e.prototype.computeOutputShape=function(t){var e=sT((t=$N(t))[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]},e.prototype.call=function(t,e){var n=this;return vd(function(){n.invokeCallHook(t,e),t=lN(KN(t),2);var r=n.poolingFunction(KN(t),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return ob(r,[2])})},e.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e}(a_),VT=function(t){function e(e){return t.call(this,e)||this}return QC(e,t),e.prototype.poolingFunction=function(t,e,n,r,o){return KE(o),$E(r),BT(t,e,n,r,o,"max")},e.className="MaxPooling1D",e}(UT);LC.registerClass(VT);var jT=function(t){function e(e){return t.call(this,e)||this}return QC(e,t),e.prototype.poolingFunction=function(t,e,n,r,o){return KE(o),$E(r),BT(t,e,n,r,o,"avg")},e.className="AveragePooling1D",e}(UT);LC.registerClass(jT);var WT=function(t){function e(e){var n=this;if(null==e.poolSize&&(e.poolSize=[2,2]),(n=t.call(this,e)||this).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)n.strides=n.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new fE("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+e.strides.length+".");n.strides=e.strides}else n.strides=[e.strides,e.strides];return RE(n.poolSize,"poolSize"),RE(n.strides,"strides"),n.padding=null==e.padding?"valid":e.padding,n.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,KE(n.dataFormat),$E(n.padding),n.inputSpec=[new e_({ndim:4})],n}return QC(e,t),e.prototype.computeOutputShape=function(t){t=$N(t);var e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2];return e=sT(e,this.poolSize[0],this.padding,this.strides[0]),n=sT(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n]:[t[0],e,n,t[3]]},e.prototype.call=function(t,e){var n=this;return vd(function(){return n.invokeCallHook(t,e),n.poolingFunction(KN(t),n.poolSize,n.strides,n.padding,n.dataFormat)})},e.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e}(a_),HT=function(t){function e(e){return t.call(this,e)||this}return QC(e,t),e.prototype.poolingFunction=function(t,e,n,r,o){return KE(o),$E(r),BT(t,e,n,r,o,"max")},e.className="MaxPooling2D",e}(WT);LC.registerClass(HT);var qT=function(t){function e(e){return t.call(this,e)||this}return QC(e,t),e.prototype.poolingFunction=function(t,e,n,r,o){return KE(o),$E(r),BT(t,e,n,r,o,"avg")},e.className="AveragePooling2D",e}(WT);LC.registerClass(qT);var GT=function(t){function e(e){var n=t.call(this,e)||this;return n.inputSpec=[new e_({ndim:3})],n}return QC(e,t),e.prototype.computeOutputShape=function(t){return[t[0],t[2]]},e.prototype.call=function(t,e){throw new dE},e}(a_),KT=function(t){function e(e){return t.call(this,e||{})||this}return QC(e,t),e.prototype.call=function(t,e){return vd(function(){var e=KN(t);return Xw(e,1)})},e.className="GlobalAveragePooling1D",e}(GT);LC.registerClass(KT);var $T=function(t){function e(e){return t.call(this,e||{})||this}return QC(e,t),e.prototype.call=function(t,e){return vd(function(){var e=KN(t);return $w(e,1)})},e.className="GlobalMaxPooling1D",e}(GT);LC.registerClass($T);var XT=function(t){function e(e){var n=t.call(this,e)||this;return n.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,KE(n.dataFormat),n.inputSpec=[new e_({ndim:4})],n}return QC(e,t),e.prototype.computeOutputShape=function(t){return t=t,"channelsLast"===this.dataFormat?[t[0],t[3]]:[t[0],t[1]]},e.prototype.call=function(t,e){throw new dE},e.prototype.getConfig=function(){var e={dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e}(a_),ZT=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.call=function(t,e){var n=this;return vd(function(){var e=KN(t);return Xw(e,"channelsLast"===n.dataFormat?[1,2]:[2,3])})},e.className="GlobalAveragePooling2D",e}(XT);LC.registerClass(ZT);var YT=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.call=function(t,e){var n=this;return vd(function(){var e=KN(t);return $w(e,"channelsLast"===n.dataFormat?[1,2]:[2,3])})},e.className="GlobalMaxPooling2D",e}(XT);function QT(t,e,n,r){if(Array.isArray(t)){if(null!=e||null!=n)throw new fE("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=t.slice(t.length-r,t.length),t=t.slice(0,t.length-r)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function o(t){return null==t||Array.isArray(t)?t:[t]}return{inputs:t,initialState:e=o(e),constants:n=o(n)}}function JT(t,e,n,r,o,i,a,s){return void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===s&&(s=!1),vd(function(){var u=e.shape.length;if(u<3)throw new fE("Input should be at least 3D, but is "+u+"D.");var l=[1,0].concat(sN(2,u));if(e=Hx(e,l),null!=i)throw new dE("The rnn() functoin of the deeplearn.js backend does not support constants yet.");a&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=o&&((o=o.asType("bool").asType("float32")).rank===u-1&&(o=Hy(o,-1)),o=Hx(o,l)),r&&(e=Iw(e,0),null!=o&&(o=Iw(o,0)));var c,p,h=[],f=n,d=e.shape[0],m=ub(e);null!=o&&(p=ub(o));for(var g,v=function(e){var n=m[e],r=vd(function(){return t(n,f)});if(null==o)c=r[0],f=r[1];else{var i=vd(function(){var t=p[e],n=cm(t).sub(t);return{output:r[0].mul(t).addStrict(f[0].mul(n)),newStates:f.map(function(e,o){return r[1][o].mul(t).addStrict(e.mul(n))})}});c=i.output,f=i.newStates}s&&h.push(c)},y=0;y<d;++y)v(y);return s&&(g=ib(h,1)),[c,g,f]})}LC.registerClass(YT);var tA=function(t){function e(e){var n,r=t.call(this,e)||this;if(null==e.cell)throw new fE("cell property is missing for the constructor of RNN.");if(null==(n=Array.isArray(e.cell)?new uA({cells:e.cell}):e.cell).stateSize)throw new fE("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=n,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new e_({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return QC(e,t),e.prototype.getStates=function(){return null==this.states_?sN(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(function(t){return null}):this.states_},e.prototype.setStates=function(t){this.states_=t},e.prototype.computeOutputShape=function(t){qN(t)&&(t=t[0]),t=t;var e=this.cell.stateSize;Array.isArray(e)||(e=[e]);var n,r=e[0];if(n=this.returnSequences?[t[0],t[1],r]:[t[0],r],this.returnState){for(var o=[],i=0,a=e;i<a.length;i++)o.push([t[0],a[i]]);return[n].concat(o)}return n},e.prototype.computeMask=function(t,e){var n=this;return vd(function(){Array.isArray(e)&&(e=e[0]);var t=n.returnSequences?e:null;if(n.returnState){var r=n.states.map(function(t){return null});return[t].concat(r)}return t})},Object.defineProperty(e.prototype,"states",{get:function(){if(null==this.states_){for(var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,e=[],n=0;n<t;++n)e.push(null);return e}return this.states_},set:function(t){this.states_=t},enumerable:!0,configurable:!0}),e.prototype.build=function(t){if(null!=this.numConstants)throw new dE("Constants support is not implemented in RNN yet.");qN(t)&&(t=t[0]),t=t,this.inputSpec[0]=new e_({shape:[this.stateful?t[0]:null,null,t[t.length-1]]});var e,n=[t[0]].concat(t.slice(2));if(this.cell.build(n),e=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!Rf.arraysEqual(this.stateSpec.map(function(t){return t.shape[t.shape.length-1]}),e))throw new fE("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec="+this.stateSpec+"; However cell.stateSize is "+this.cell.stateSize)}else this.stateSpec=e.map(function(t){return new e_({shape:[null,t]})});this.stateful&&this.resetStates()},e.prototype.resetStates=function(t,e){var n=this;void 0===e&&(e=!1),vd(function(){if(!n.stateful)throw new pE("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=n.inputSpec[0].shape[0];if(null==r)throw new fE("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==n.states_)n.states_=Array.isArray(n.cell.stateSize)?n.cell.stateSize.map(function(t){return am([r,t])}):[am([r,n.cell.stateSize])];else if(null==t)bd(n.states_),null!=n.keptStates&&(bd(n.keptStates),n.keptStates=[]),Array.isArray(n.cell.stateSize)?n.states_=n.cell.stateSize.map(function(t){return am([r,t])}):n.states_[0]=am([r,n.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==n.states_.length)throw new fE("Layer "+n.name+" expects "+n.states_.length+" state(s), but it received "+t.length+" state value(s). Input received: "+t);!0===e?n.keptStates.push(n.states_.slice()):bd(n.states_);for(var o=0;o<n.states_.length;++o){var i=t[o],a=Array.isArray(n.cell.stateSize)?n.cell.stateSize[o]:n.cell.stateSize,s=[r,a];if(!Rf.arraysEqual(i.shape,s))throw new fE("State "+o+" is incompatible with layer "+n.name+": expected shape="+s+", received shape="+i.shape);n.states_[o]=i}}n.states_.forEach(function(t){return yd(t)})})},e.prototype.apply=function(e,n){var r=null==n?null:n.initialState,o=null==n?null:n.constants;null==n&&(n={});var i=QT(e,r,o,this.numConstants);e=i.inputs,o=i.constants;var a=[],s=[];if(null!=(r=i.initialState)){n.initialState=r,a=a.concat(r),this.stateSpec=[];for(var u=0,l=r;u<l.length;u++)this.stateSpec.push(new e_({shape:l[u].shape}));s=s.concat(this.stateSpec)}if(null!=o&&(n.constants=o,a=a.concat(o),this.numConstants=o.length),a[0]instanceof n_){var c=[e].concat(a),p=this.inputSpec.concat(s),h=this.inputSpec;this.inputSpec=p;var f=t.prototype.apply.call(this,c,n);return this.inputSpec=h,f}return t.prototype.apply.call(this,e,n)},e.prototype.call=function(t,e){var n=this;return vd(function(){var r=null==e?null:e.mask,o=null==e?null:e.training,i=null==e?null:e.initialState;t=KN(t),null==i&&(i=n.stateful?n.states_:n.getInitialState(t));var a=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(i.length!==a)throw new fE("RNN Layer has "+a+" state(s) but was passed "+i.length+" initial state(s).");n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:o},u=JT(function(t,e){var r=n.cell.call([t].concat(e),s);return[r[0],r.slice(1)]},t,i,n.goBackwards,r,null,n.unroll,n.returnSequences),l=u[0],c=u[1],p=u[2];n.stateful&&n.resetStates(p,o);var h=n.returnSequences?c:l;return n.returnState?[h].concat(p):h})},e.prototype.getInitialState=function(t){var e=this;return vd(function(){var n=am(t.shape);return n=lN(n=Qw(n,[1,2])),Array.isArray(e.cell.stateSize)?e.cell.stateSize.map(function(t){return t>1?mN(n,[1,t]):n}):e.cell.stateSize>1?[mN(n,[1,e.cell.stateSize])]:[n]})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(e){t.prototype.setFastWeightInitDuringBuild.call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)},e.prototype.getConfig=function(){var e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(e.numConstants=this.numConstants);var n=this.cell.getConfig();e.cell={className:this.cell.getClassName(),config:n};var r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="RNN",e}(a_);LC.registerClass(tA);var eA=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e}(a_),nA=function(t){function e(e){var n=t.call(this,e)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=e.units,RE(n.units,"units"),n.activation=KI(null==e.activation?n.DEFAULT_ACTIVATION:e.activation),n.useBias=null==e.useBias||e.useBias,n.kernelInitializer=HN(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=HN(e.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=HN(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=JI(e.kernelRegularizer),n.recurrentRegularizer=JI(e.recurrentRegularizer),n.biasRegularizer=JI(e.biasRegularizer),n.kernelConstraint=VE(e.kernelConstraint),n.recurrentConstraint=VE(e.recurrentConstraint),n.biasConstraint=VE(e.biasConstraint),n.dropout=iN([1,aN([0,null==e.dropout?0:e.dropout])]),n.recurrentDropout=iN([1,aN([0,null==e.recurrentDropout?0:e.recurrentDropout])]),n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return QC(e,t),e.prototype.build=function(t){t=$N(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.bias=this.useBias?this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0},e.prototype.call=function(t,e){var n=this;return vd(function(){if(2!==(t=t).length)throw new fE("SimpleRNNCell expects 2 input Tensors, got "+t.length+".");var r=t[1];t=t[0];var o,i=null!=e.training&&e.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=lA(function(){return cm(t)},n.dropout,i)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=lA(function(){return cm(r)},n.recurrentDropout,i));var a=n.dropoutMask,s=n.recurrentDropoutMask;o=vN(null!=a?Nx(t,a):t,n.kernel.read()),null!=n.bias&&(o=wN(o,n.bias.read())),null!=s&&(r=Nx(r,s));var u=hx(o,vN(r,n.recurrentKernel.read()));return null!=n.activation&&(u=n.activation.apply(u)),[u,u]})},e.prototype.getConfig=function(){var e={units:this.units,activation:qI(this.activation),useBias:this.useBias,kernelInitializer:WN(this.kernelInitializer),recurrentInitializer:WN(this.recurrentInitializer),biasInitializer:WN(this.biasInitializer),kernelRegularizer:YI(this.kernelRegularizer),recurrentRegularizer:YI(this.recurrentRegularizer),biasRegularizer:YI(this.biasRegularizer),activityRegularizer:YI(this.activityRegularizer),kernelConstraint:BE(this.kernelConstraint),recurrentConstraint:BE(this.recurrentConstraint),biasConstraint:BE(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="SimpleRNNCell",e}(eA);LC.registerClass(nA);var rA=function(t){function e(e){return e.cell=new nA(e),t.call(this,e)||this}return QC(e,t),e.prototype.call=function(e,n){var r=this;return vd(function(){return null!=r.cell.dropoutMask&&(bd(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(bd(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t.prototype.call.call(r,e,{mask:null==n?null:n.mask,training:null==n?null:n.training,initialState:null==n?null:n.initialState})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:qI(this.activation),useBias:this.useBias,kernelInitializer:WN(this.kernelInitializer),recurrentInitializer:WN(this.recurrentInitializer),biasInitializer:WN(this.biasInitializer),kernelRegularizer:YI(this.kernelRegularizer),recurrentRegularizer:YI(this.recurrentRegularizer),biasRegularizer:YI(this.biasRegularizer),activityRegularizer:YI(this.activityRegularizer),kernelConstraint:BE(this.kernelConstraint),recurrentConstraint:BE(this.recurrentConstraint),biasConstraint:BE(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=t.prototype.getConfig.call(this);return delete n.cell,Object.assign(e,n),e},e.className="SimpleRNN",e}(tA);LC.registerClass(rA);var oA=function(t){function e(e){var n=t.call(this,e)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=e.units,RE(n.units,"units"),n.activation=KI(void 0===e.activation?n.DEFAULT_ACTIVATION:e.activation),n.recurrentActivation=KI(void 0===e.recurrentActivation?n.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),n.useBias=null==e.useBias||e.useBias,n.kernelInitializer=HN(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=HN(e.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=HN(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=JI(e.kernelRegularizer),n.recurrentRegularizer=JI(e.recurrentRegularizer),n.biasRegularizer=JI(e.biasRegularizer),n.kernelConstraint=VE(e.kernelConstraint),n.recurrentConstraint=VE(e.recurrentConstraint),n.biasConstraint=VE(e.biasConstraint),n.dropout=iN([1,aN([0,null==e.dropout?0:e.dropout])]),n.recurrentDropout=iN([1,aN([0,null==e.recurrentDropout?0:e.recurrentDropout])]),n.implementation=e.implementation,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return QC(e,t),e.prototype.build=function(t){var e=(t=$N(t))[t.length-1];this.kernel=this.addWeight("kernel",[e,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.bias=this.useBias?this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0},e.prototype.call=function(t,e){var n=this;return vd(function(){if(2!==(t=t).length)throw new fE("GRUCell expects 2 input Tensors (inputs, h, c), got "+t.length+".");var r=null!=e.training&&e.training,o=t[1];t=t[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=lA(function(){return cm(t)},n.dropout,r,3)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=lA(function(){return cm(o)},n.recurrentDropout,r,3));var i,a,s,u=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(t=Nx(t,n.dropoutMask[0]));var l=vN(t,n.kernel.read());n.useBias&&(l=wN(l,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(o=Nx(o,u[0]));var c=n.recurrentKernel.read(),p=Iy(c,[2*n.units,n.units],c.rank-1),h=p[1],f=vN(o,p[0]),d=Iy(l,3,l.rank-1),m=d[0],g=d[1],v=d[2],y=Iy(f,2,f.rank-1),b=y[1];i=n.recurrentActivation.apply(hx(m,y[0])),a=n.recurrentActivation.apply(hx(g,b));var w=vN(Nx(a,o),h);s=n.activation.apply(hx(v,w));var x=hx(Nx(i,o),Nx(hx(cE(1),Rb(i)),s));return[x,x]})},e.prototype.getConfig=function(){var e={units:this.units,activation:qI(this.activation),recurrentActivation:qI(this.recurrentActivation),useBias:this.useBias,kernelInitializer:WN(this.kernelInitializer),recurrentInitializer:WN(this.recurrentInitializer),biasInitializer:WN(this.biasInitializer),kernelRegularizer:YI(this.kernelRegularizer),recurrentRegularizer:YI(this.recurrentRegularizer),biasRegularizer:YI(this.biasRegularizer),activityRegularizer:YI(this.activityRegularizer),kernelConstraint:BE(this.kernelConstraint),recurrentConstraint:BE(this.recurrentConstraint),biasConstraint:BE(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="GRUCell",e}(eA);LC.registerClass(oA);var iA=function(t){function e(e){return 0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new oA(e),t.call(this,e)||this}return QC(e,t),e.prototype.call=function(e,n){var r=this;return vd(function(){return null!=r.cell.dropoutMask&&(bd(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(bd(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t.prototype.call.call(r,e,{mask:null==n?null:n.mask,training:null==n?null:n.training,initialState:null==n?null:n.initialState})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:qI(this.activation),recurrentActivation:qI(this.recurrentActivation),useBias:this.useBias,kernelInitializer:WN(this.kernelInitializer),recurrentInitializer:WN(this.recurrentInitializer),biasInitializer:WN(this.biasInitializer),kernelRegularizer:YI(this.kernelRegularizer),recurrentRegularizer:YI(this.recurrentRegularizer),biasRegularizer:YI(this.biasRegularizer),activityRegularizer:YI(this.activityRegularizer),kernelConstraint:BE(this.kernelConstraint),recurrentConstraint:BE(this.recurrentConstraint),biasConstraint:BE(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=t.prototype.getConfig.call(this);return delete n.cell,Object.assign(e,n),e},e.fromConfig=function(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)},e.className="GRU",e}(tA);LC.registerClass(iA);var aA=function(t){function e(e){var n=t.call(this,e)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=e.units,RE(n.units,"units"),n.activation=KI(void 0===e.activation?n.DEFAULT_ACTIVATION:e.activation),n.recurrentActivation=KI(void 0===e.recurrentActivation?n.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),n.useBias=null==e.useBias||e.useBias,n.kernelInitializer=HN(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=HN(e.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=HN(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.unitForgetBias=e.unitForgetBias,n.kernelRegularizer=JI(e.kernelRegularizer),n.recurrentRegularizer=JI(e.recurrentRegularizer),n.biasRegularizer=JI(e.biasRegularizer),n.kernelConstraint=VE(e.kernelConstraint),n.recurrentConstraint=VE(e.recurrentConstraint),n.biasConstraint=VE(e.biasConstraint),n.dropout=iN([1,aN([0,null==e.dropout?0:e.dropout])]),n.recurrentDropout=iN([1,aN([0,null==e.recurrentDropout?0:e.recurrentDropout])]),n.implementation=e.implementation,n.stateSize=[n.units,n.units],n.dropoutMask=null,n.recurrentDropoutMask=null,n}return QC(e,t),e.prototype.build=function(t){var e,n,r=(t=$N(t))[t.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var o=this.biasInitializer,i=this.units;n=new((e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return QC(e,t),e.prototype.apply=function(t,e){var n=o.apply([i]),r=(new IN).apply([i]),a=o.apply([2*i]);return dN(dN(n,r),a)},e}(NN)).className="CustomInit",e)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},e.prototype.call=function(t,e){var n=this;return vd(function(){var r=null!=e.training&&e.training;if(3!==(t=t).length)throw new fE("LSTMCell expects 3 input Tensors (inputs, h, c), got "+t.length+".");var o=t[1],i=t[2];t=t[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=lA(function(){return cm(t)},n.dropout,r,4)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=lA(function(){return cm(o)},n.recurrentDropout,r,4));var a,s,u,l,c=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(t=Nx(t,n.dropoutMask[0]));var p=vN(t,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(o=Nx(o,c[0])),p=hx(p,vN(o,n.recurrentKernel.read())),n.useBias&&(p=wN(p,n.bias.read()));var h=Iy(p,4,p.rank-1),f=h[1],d=h[2],m=h[3];a=n.recurrentActivation.apply(h[0]),s=n.recurrentActivation.apply(f),u=hx(Nx(s,i),Nx(a,n.activation.apply(d))),l=n.recurrentActivation.apply(m);var g=Nx(l,n.activation.apply(u));return[g,g,u]})},e.prototype.getConfig=function(){var e={units:this.units,activation:qI(this.activation),recurrentActivation:qI(this.recurrentActivation),useBias:this.useBias,kernelInitializer:WN(this.kernelInitializer),recurrentInitializer:WN(this.recurrentInitializer),biasInitializer:WN(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:YI(this.kernelRegularizer),recurrentRegularizer:YI(this.recurrentRegularizer),biasRegularizer:YI(this.biasRegularizer),activityRegularizer:YI(this.activityRegularizer),kernelConstraint:BE(this.kernelConstraint),recurrentConstraint:BE(this.recurrentConstraint),biasConstraint:BE(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="LSTMCell",e}(eA);LC.registerClass(aA);var sA=function(t){function e(e){return 0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new aA(e),t.call(this,e)||this}return QC(e,t),e.prototype.call=function(e,n){var r=this;return vd(function(){return null!=r.cell.dropoutMask&&(bd(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(bd(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t.prototype.call.call(r,e,{mask:null==n?null:n.mask,training:null==n?null:n.training,initialState:null==n?null:n.initialState})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unitForgetBias",{get:function(){return this.cell.unitForgetBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:qI(this.activation),recurrentActivation:qI(this.recurrentActivation),useBias:this.useBias,kernelInitializer:WN(this.kernelInitializer),recurrentInitializer:WN(this.recurrentInitializer),biasInitializer:WN(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:YI(this.kernelRegularizer),recurrentRegularizer:YI(this.recurrentRegularizer),biasRegularizer:YI(this.biasRegularizer),activityRegularizer:YI(this.activityRegularizer),kernelConstraint:BE(this.kernelConstraint),recurrentConstraint:BE(this.recurrentConstraint),biasConstraint:BE(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=t.prototype.getConfig.call(this);return delete n.cell,Object.assign(e,n),e},e.fromConfig=function(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)},e.className="LSTM",e}(tA);LC.registerClass(sA);var uA=function(t){function e(e){var n=t.call(this,e)||this;return n.cells=e.cells,n}return QC(e,t),Object.defineProperty(e.prototype,"stateSize",{get:function(){for(var t=[],e=0,n=this.cells.slice().reverse();e<n.length;e++){var r=n[e];Array.isArray(r.stateSize)?t.push.apply(t,r.stateSize):t.push(r.stateSize)}return t},enumerable:!0,configurable:!0}),e.prototype.call=function(t,e){var n=this;return vd(function(){for(var r=(t=t).slice(1),o=[],i=0,a=n.cells.slice().reverse();i<a.length;i++){var s=a[i];Array.isArray(s.stateSize)?o.push(r.splice(0,s.stateSize.length)):o.push(r.splice(0,1))}o.reverse();for(var u,l=[],c=0;c<n.cells.length;++c)s=n.cells[c],r=o[c],u=0===c?[t[0]].concat(r):[u[0]].concat(r),u=s.call(u,e),l.push(u.slice(1));r=[];for(var p=0,h=l.slice().reverse();p<h.length;p++)r.push.apply(r,h[p]);return[u[0]].concat(r)})},e.prototype.build=function(t){var e;qN(t)&&(t=t[0]),t=t;for(var n=0,r=this.cells;n<r.length;n++){var o=r[n];o.build(t),e=Array.isArray(o.stateSize)?o.stateSize[0]:o.stateSize,t=[t[0],e]}this.built=!0},e.prototype.getConfig=function(){for(var e=[],n=0,r=this.cells;n<r.length;n++){var o=r[n];e.push({className:this.getClassName(),config:o.getConfig()})}var i={cells:e},a=t.prototype.getConfig.call(this);return Object.assign(i,a),i},e.fromConfig=function(t,e,n){void 0===n&&(n={});for(var r=[],o=0,i=e.cells;o<i.length;o++)r.push(tI(i[o],n));return new t({cells:r})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){if(!this.trainable)return[];for(var t=[],e=0,n=this.cells;e<n.length;e++)t.push.apply(t,n[e].trainableWeights);return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){for(var t=[],e=0,n=this.cells;e<n.length;e++){var r=n[e];t.push.apply(t,r.nonTrainableWeights)}if(!this.trainable){for(var o=[],i=0,a=this.cells;i<a.length;i++)o.push.apply(o,(r=a[i]).trainableWeights);return o.concat(t)}return t},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){for(var t=[],e=0,n=this.cells;e<n.length;e++)t.push.apply(t,n[e].weights);return QN(t)},e.prototype.setWeights=function(t){for(var e=[],n=0,r=this.cells;n<r.length;n++)for(var o=r[n],i=t.splice(o.weights.length),a=0;a<o.weights.length;++a)e.push([o.weights[a],i[a]]);JN(e)},e.className="StackedRNNCells",e}(eA);function lA(t,e,n,r){function o(){return xN(t(),cE(e))}if(void 0===n&&(n=null),void 0===r&&(r=1),r>1){for(var i=[],a=0;a<r;a++)i.push(SN(o,t,n));return i.forEach(function(t){return yd(t)}),i}return yd(SN(o,t,n))}LC.registerClass(uA);var cA=function(t){function e(e){var n=t.call(this,e)||this;return n.layer=e.layer,n}return QC(e,t),e.prototype.build=function(t){this.built=!0},Object.defineProperty(e.prototype,"trainable",{get:function(){return null!=this.layer&&this.layer.trainable},set:function(t){null!=this.layer&&(this.layer.trainable=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.layer.getWeights()},e.prototype.setWeights=function(t){this.layer.setWeights(t)},e.prototype.getConfig=function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.prototype.setFastWeightInitDuringBuild=function(e){t.prototype.setFastWeightInitDuringBuild.call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)},e.fromConfig=function(t,e,n){void 0===n&&(n={});var r=tI(e.layer,n);delete e.layer;var o={layer:r};return Object.assign(o,e),new t(o)},e}(a_),pA=function(t){function e(e){var n=t.call(this,e)||this;return n.supportsMasking=!0,n}return QC(e,t),e.prototype.build=function(e){if((e=$N(e)).length<3)throw new fE("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(e));this.inputSpec=[{shape:e}];var n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),t.prototype.build.call(this,e)},e.prototype.computeOutputShape=function(t){var e=[(t=$N(t))[0]].concat(t.slice(2)),n=this.layer.computeOutputShape(e);return[n[0],t[1]].concat(n.slice(1))},e.prototype.call=function(t,e){var n=this;return vd(function(){return JT(function(t,r){return[KN(n.layer.call(t,e)),[]]},t=KN(t),[],!1,null,null,!1,!0)[1]})},e.className="TimeDistributed",e}(cA);LC.registerClass(pA);var hA="concat",fA=function(t){function e(e){var n=t.call(this,e)||this,r=e.layer.getConfig(),o={};o.className=e.layer.getClassName(),o.config=r,n.forwardLayer=tI(o),r.goBackwards=!0!==r.goBackwards;var i={};if(i.className=e.layer.getClassName(),i.config=r,n.backwardLayer=tI(i),n.forwardLayer.name="forward_"+n.forwardLayer.name,n.backwardLayer.name="backward_"+n.backwardLayer.name,n.mergeMode=void 0===e.mergeMode?hA:e.mergeMode,AE(qE,"BidirectionalMergeMode",n.mergeMode),e.weights)throw new dE("weights support is not implemented for Bidirectional layer yet.");return n._stateful=e.layer.stateful,n.returnSequences=e.layer.returnSequences,n.returnState=e.layer.returnState,n.supportsMasking=!0,n._trainable=!0,n.inputSpec=e.layer.inputSpec,n.numConstants=null,n}return QC(e,t),Object.defineProperty(e.prototype,"trainable",{get:function(){return this._trainable},set:function(t){this._trainable=t,null!=this.forwardLayer&&(this.forwardLayer.trainable=t),null!=this.backwardLayer&&(this.backwardLayer.trainable=t)},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},e.prototype.setWeights=function(t){var e=Math.floor(t.length/2);this.forwardLayer.setWeights(t.slice(0,e)),this.backwardLayer.setWeights(t.slice(e))},e.prototype.computeOutputShape=function(t){var e,n,r,o=this.forwardLayer.computeOutputShape(t);return Array.isArray(o)&&Array.isArray(o[0])||(o=[o]),o=o,this.returnState?(r=o.slice(1),e=o[0]):e=o[0],e=e,"concat"===this.mergeMode?(e[e.length-1]*=2,n=[e]):n=null==this.mergeMode?[e,e.slice()]:[e],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[e].concat(r).concat(r.slice()):bE(n)},e.prototype.apply=function(e,n){var r=null==n?null:n.initialState,o=null==n?null:n.constants;null==n&&(n={});var i=QT(e,r,o,this.numConstants);if(e=i.inputs,r=i.initialState,o=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==o)return t.prototype.apply.call(this,e,n);var a=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new fE("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=r,a.push.apply(a,r);var l=r.map(function(t){return new e_({shape:t.shape})});this.forwardLayer.stateSpec=l.slice(0,u/2),this.backwardLayer.stateSpec=l.slice(u/2),s.push.apply(s,l)}if(null!=o)throw new dE("Support for constants in Bidirectional layers is not implemented yet.");for(var c=a[0]instanceof n_,p=0,h=a;p<h.length;p++)if(h[p]instanceof n_!==c)throw new fE("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(c){var f=[e].concat(a),d=this.inputSpec.concat(s),m=this.inputSpec;this.inputSpec=d;var g=t.prototype.apply.call(this,f,n);return this.inputSpec=m,g}return t.prototype.apply.call(this,e,n)},e.prototype.call=function(t,e){var n=this;return vd(function(){if(null!=e.mask)throw new dE("The support for masking is not implemented for Bidirectional layers yet.");var r,o,i,a,s=e.initialState;if(null==s)r=n.forwardLayer.call(t,e),o=n.backwardLayer.call(t,e);else{var u=s.slice(0,s.length/2),l=s.slice(s.length/2);r=n.forwardLayer.call(t,Object.assign(e,{initialState:u})),o=n.backwardLayer.call(t,Object.assign(e,{initialState:l}))}return n.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(o.slice(1))),r=r[0],o=o[0]),n.returnSequences&&(o=Iw(o,1)),"concat"===n.mergeMode?a=fN([r,o]):"sum"===n.mergeMode?a=hx(r,o):"ave"===n.mergeMode?a=Nx(cE(.5),hx(r,o)):"mul"===n.mergeMode?a=Nx(r,o):null==n.mergeMode&&(a=[r,o]),n.returnState?null==n.mergeMode?a.concat(i):[a].concat(i):a})},e.prototype.resetStates=function(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},e.prototype.build=function(t){var e=this;YE(this.forwardLayer.name,function(){e.forwardLayer.build(t)}),YE(this.backwardLayer.name,function(){e.backwardLayer.build(t)}),this.built=!0},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(e){t.prototype.setFastWeightInitDuringBuild.call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)},e.prototype.getConfig=function(){var e={mergeMode:this.mergeMode},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.fromConfig=function(t,e){var n=tI(e.layer);if(delete e.layer,null!=e.numConstants)throw new dE("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=e;return r.layer=n,new t(r)},e.className="Bidirectional",e}(cA);function dA(t){return new jT(t)}function mA(t){return new qT(t)}function gA(t){return new $T(t)}function vA(t){return new YT(t)}function yA(t){return new VT(t)}function bA(t){return new HT(t)}LC.registerClass(fA);var wA=Object.freeze({inputLayer:function(t){return new s_(t)},elu:function(t){return new rT(t)},reLU:function(t){return new tT(t)},leakyReLU:function(t){return new eT(t)},prelu:function(t){return new nT(t)},softmax:function(t){return new iT(t)},thresholdedReLU:function(t){return new oT(t)},conv1d:function(t){return new mT(t)},conv2d:function(t){return new hT(t)},conv2dTranspose:function(t){return new fT(t)},separableConv2d:function(t){return new dT(t)},cropping2D:function(t){return new gT(t)},upSampling2d:function(t){return new vT(t)},depthwiseConv2d:function(t){return new yT(t)},activation:function(t){return new ST(t)},dense:function(t){return new wT(t)},dropout:function(t){return new bT(t)},flatten:function(t){return new xT(t)},repeatVector:function(t){return new CT(t)},reshape:function(t){return new ET(t)},permute:function(t){return new NT(t)},embedding:function(t){return new _T(t)},add:function(t){return new TT(t)},average:function(t){return new kT(t)},concatenate:function(t){return new DT(t)},maximum:function(t){return new RT(t)},minimum:function(t){return new OT(t)},multiply:function(t){return new AT(t)},dot:function(t){return new PT(t)},batchNormalization:function(t){return new FT(t)},zeroPadding2d:function(t){return new zT(t)},averagePooling1d:dA,avgPool1d:function(t){return dA(t)},avgPooling1d:function(t){return dA(t)},averagePooling2d:mA,avgPool2d:function(t){return mA(t)},avgPooling2d:function(t){return mA(t)},globalAveragePooling1d:function(t){return new KT(t)},globalAveragePooling2d:function(t){return new ZT(t)},globalMaxPooling1d:gA,globalMaxPooling2d:vA,maxPooling1d:yA,maxPooling2d:bA,gru:function(t){return new iA(t)},gruCell:function(t){return new oA(t)},lstm:function(t){return new sA(t)},lstmCell:function(t){return new aA(t)},simpleRNN:function(t){return new rA(t)},simpleRNNCell:function(t){return new nA(t)},rnn:function(t){return new tA(t)},stackedRNNCells:function(t){return new uA(t)},bidirectional:function(t){return new fA(t)},timeDistributed:function(t){return new pA(t)},globalMaxPool1d:gA,globalMaxPool2d:vA,maxPool1d:yA,maxPool2d:bA,Layer:a_,RNN:tA,RNNCell:eA,input:function(t){return u_(t)}});Object.freeze({binaryAccuracy:function(t,e){return L_(t,e)},binaryCrossentropy:function(t,e){return U_(t,e)},sparseCategoricalAccuracy:function(t,e){return V_(t,e)},categoricalAccuracy:function(t,e){return F_(t,e)},categoricalCrossentropy:function(t,e){return $_(t,e)},precision:function(t,e){return B_(t,e)},recall:function(t,e){return function(t,e){return vd(function(){var n=cE(0),r=z_(t,e),o=function(t,e){return vd(function(){var n=cE(1),r=cE(0);return Dx(t.equal(n),e.equal(r)).sum().cast("float32")})}(t,e),i=r.add(o);return Fx(nx(i,n),r.div(i),n).cast("float32")})}(t,e)},cosineProximity:function(t,e){return M_(t,e)},meanAbsoluteError:function(t,e){return S_(t,e)},meanAbsolutePercentageError:function(t,e){return C_(t,e)},MAPE:function(t,e){return C_(t,e)},mape:function(t,e){return C_(t,e)},meanSquaredError:function(t,e){return x_(t,e)},MSE:function(t,e){return x_(t,e)},mse:function(t,e){return x_(t,e)}}),Object.freeze({modelFromJSON:function(t,e){return eE(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l;return nE(this,function(c){switch(c.label){case 0:return"modelTopology"in t||(t={modelTopology:t}),null!=(n=(t=t).modelTopology).model_config&&(n=n.model_config),r=nI(n),o=tI(r,e),null==t.weightsManifest?[3,2]:[4,AC.loadWeights(t.weightsManifest,t.pathPrefix,o.weights.map(function(t){return t.originalName}))];case 1:for(i=c.sent(),a={},s=0,u=o.weights;s<u.length;s++)a[(l=u[s]).originalName]=i[l.originalName];o.loadWeights(a),bd(i),c.label=2;case 2:return[2,o]}})})}}),Object.freeze({l1l2:function(t){return new XI(t)},l1:function(t){return function(t){return new XI({l1:null!=t?t.l1:null,l2:0})}(t)},l2:function(t){return function(t){return new XI({l2:null!=t?t.l2:null,l1:0})}(t)}}),function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.model=null,e}QC(e,t),e.prototype.setModel=function(t){if(!(t instanceof AI))throw new Error("model must be a LayersModel, not some other Container");this.model=t}}(p_);var xA,SA=function(){return(SA=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function CA(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function EA(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function NA(t,e,n,r){var o=e.inputParams[t];if(o&&void 0!==o.inputIndexStart){var i=o.inputIndexStart,a=0===o.inputIndexEnd?void 0:void 0===o.inputIndexEnd?i+1:o.inputIndexEnd;if("tensor"===o.type)return _A(e.inputNames[o.inputIndexStart],n,r);if("tensors"===o.type)return e.inputNames.slice(i,a).map(function(t){return _A(t,n,r)});var s=Array.prototype.slice.call(_A(e.inputNames.slice(i)[0],n,r).dataSync());return"number"===o.type?s[0]:s}var u=e.attrParams[t];return u&&u.value}function _A(t,e,n){var r=AA(t),o=r[0],i=r[1],a=n.currentContextIds.find(function(t){return!!e[TA(o,t)]});return void 0!==a?e[TA(o,a)][i]:void 0}function IA(t,e){var n=AA(t),r=n[1];return[TA(n[0],e&&e.currentContextId),r]}function TA(t,e){return e?t+"-"+e:t}function AA(t){var e=t.lastIndexOf(":");return-1===e?[t,0]:[t.substring(0,e),Number(t.substring(e+1))]}function kA(t,e){for(var n=[],r=0;r<t.length;r+=e)n.push(t.slice(r,r+e));return n}!function(t){!function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"}(t.DataType||(t.DataType={})),function(t){!function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"}(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))}(t.SaverDef||(t.SaverDef={}))}(xA||(xA={}));var RA=Object.freeze({json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),OA=Object.freeze({json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),DA=Object.freeze({json:[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"}]}]}),MA=Object.freeze({json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]}]}),PA=Object.freeze({json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]}]}),LA=Object.freeze({json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),FA=Object.freeze({json:[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]}]}),zA=Object.freeze({json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]}),BA=Object.freeze({json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}]}),UA=Object.freeze({json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),VA=Object.freeze({json:[{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),jA=Object.freeze({json:[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]}),WA=Object.freeze({json:[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]}]}),HA=Object.freeze({json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]}),qA=Object.freeze({json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]}),GA=Object.freeze({json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]}]}),KA=["Switch","Merge","Enter","Exit","NextIteration"],$A=["NonMaxSuppressionV2","NonMaxSuppressionV3","Where"],XA=function(){function t(){var t=[].concat.apply([],[RA,OA,DA,MA,PA,LA,FA,UA,BA,zA,VA,jA,WA,HA,qA,GA].map(function(t){return t.json}));this.opMappers=t.reduce(function(t,e){return t[e.tfOpName]=e,t},{})}return Object.defineProperty(t,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),t.prototype.isControlFlow=function(t){return KA.some(function(e){return e===t.op})},t.prototype.isDynamicShape=function(t){return $A.some(function(e){return e===t.op})},t.prototype.transformGraph=function(t){var e=this,n=!1,r=!1,o=[],i=[],a=t.node.reduce(function(t,a){return t[a.name]=e.mapNode(a),e.isControlFlow(a)&&(n=!0),e.isDynamicShape(a)&&(r=!0),"Placeholder"===a.op&&o.push(t[a.name]),"Const"===a.op&&i.push(t[a.name]),t},{}),s=[],u=[];return Object.keys(a).forEach(function(t){var e=a[t];e.inputNames.forEach(function(t){var n=IA(t)[0];e.inputs.push(a[n]),a[n].children.push(e)}),0===e.inputs.length&&s.push(e)}),Object.keys(a).forEach(function(t){var e=a[t];0===e.children.length&&u.push(e)}),{nodes:a,inputs:s,outputs:u,weights:i,placeholders:o,withControlFlow:n,withDynamicShape:r}},t.prototype.mapNode=function(t){var e=this,n=this.opMappers[t.op];if(void 0===n)throw new Error("Tensorflow Op is not supported: "+t.op);var r={name:t.name,op:t.op,category:n.category,inputNames:(t.input||[]).map(function(t){return t.startsWith("^")?t.substr(1):t}),inputs:[],children:[],inputParams:{},attrParams:{}};return null==t.attr&&(t.attr={}),null!=n.inputs&&(r.inputParams=n.inputs.reduce(function(t,e){return t[e.name]={type:e.type,inputIndexStart:e.start,inputIndexEnd:e.end},t},{})),null!=n.attrs&&(r.attrParams=n.attrs.reduce(function(n,r){var o=r.type,i=void 0;switch(r.type){case"string":void 0===(i=e.getStringParam(t.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(i=e.getStringParam(t.attr,r.tfDeprecatedName,r.defaultValue));break;case"number":void 0===(i=e.getNumberParam(t.attr,r.tfName,r.defaultValue||0))&&r.tfDeprecatedName&&(i=e.getNumberParam(t.attr,r.tfDeprecatedName,r.defaultValue));break;case"number[]":void 0===(i=e.getNumericArrayParam(t.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(i=e.getNumericArrayParam(t.attr,r.tfDeprecatedName,r.defaultValue));break;case"bool":void 0===(i=e.getBoolParam(t.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(i=e.getBoolParam(t.attr,r.tfDeprecatedName,r.defaultValue));break;case"shape":void 0===(i=e.getTensorShapeParam(t.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(i=e.getTensorShapeParam(t.attr,r.tfDeprecatedName,r.defaultValue));break;case"dtype":void 0===(i=e.getDtypeParam(t.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(i=e.getDtypeParam(t.attr,r.tfDeprecatedName,r.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+r.type+" for op: "+t.op)}return n[r.name]={value:i,type:o},n},{})),r},t.prototype.decodeBase64=function(t){if("undefined"!=typeof atob)return atob(t);if("undefined"!=typeof Buffer)return new Buffer(t,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")},t.prototype.getStringParam=function(t,e,n,r){void 0===r&&(r=!1);var o=t[e];if(void 0!==o){var i=Array.isArray(o.s)?String.fromCharCode.apply(null,o.s):this.decodeBase64(o.s);return r?i:i.toLowerCase()}return n},t.prototype.getBoolParam=function(t,e,n){var r=t[e];return r?r.b:n},t.prototype.getNumberParam=function(t,e,n){var r=t[e]||{},o=r.i?r.i:r.f?r.f:n;return"number"==typeof o?o:parseInt(o,10)},t.prototype.getDtypeParam=function(t,e,n){var r=t[e];if(r&&r.type){var o=r.type;switch("string"==typeof r.type&&(o=xA.DataType[r.type]),o){case xA.DataType.DT_FLOAT:return"float32";case xA.DataType.DT_INT32:return"int32";case xA.DataType.DT_BOOL:return"bool";default:return n}}return n},t.prototype.getTensorShapeParam=function(t,e,n){var r=t[e];if(r&&r.shape){if(r.shape.unknownRank)return;if(null!=r.shape.dim)return r.shape.dim.map(function(t){return"number"==typeof t.size?t.size:parseInt(t.size,10)})}return n},t.prototype.getNumericArrayParam=function(t,e,n){var r=t[e];return r?(r.list.f&&r.list.f.length?r.list.f:r.list.i).map(function(t){return"number"==typeof t?t:parseInt(t,10)}):n},t}(),ZA=function(t,e,n){switch(t.op){case"BiasAdd":case"Add":return[hx(NA("a",t,e,n),NA("b",t,e,n))];case"AddN":return[fx(NA("tensors",t,e,n))];case"FloorMod":case"Mod":return[Cx(NA("a",t,e,n),NA("b",t,e,n))];case"Mul":return[Nx(NA("a",t,e,n),NA("b",t,e,n))];case"RealDiv":case"Div":return[gx(NA("a",t,e,n),NA("b",t,e,n))];case"FloorDiv":return[yx(NA("a",t,e,n),NA("b",t,e,n))];case"Sub":return[Rx(NA("a",t,e,n),NA("b",t,e,n))];case"Minimum":return[xx(NA("a",t,e,n),NA("b",t,e,n))];case"Maximum":return[bx(NA("a",t,e,n),NA("b",t,e,n))];case"Pow":return[Ix(NA("a",t,e,n),NA("b",t,e,n))];case"SquaredDifference":return[Ax(NA("a",t,e,n),NA("b",t,e,n))];default:throw TypeError("Node type "+t.op+" is not implemented")}},YA=function(t,e,n){switch(t.op){case"Abs":return[fb(NA("x",t,e,n))];case"Acos":return[db(NA("x",t,e,n))];case"Acosh":return[mb(NA("x",t,e,n))];case"Asin":return[gb(NA("x",t,e,n))];case"Asinh":return[vb(NA("x",t,e,n))];case"Atan":return[yb(NA("x",t,e,n))];case"Atan2":return[mx(NA("x",t,e,n),NA("y",t,e,n))];case"Atanh":return[bb(NA("x",t,e,n))];case"Ceil":return[wb(NA("x",t,e,n))];case"Cos":return[Sb(NA("x",t,e,n))];case"Cosh":return[Cb(NA("x",t,e,n))];case"Elu":return[Bx(NA("x",t,e,n))];case"Erf":return[Eb(NA("x",t,e,n))];case"Exp":return[Nb(NA("x",t,e,n))];case"Expm1":return[_b(NA("x",t,e,n))];case"Floor":return[Ib(NA("x",t,e,n))];case"Log":return[Tb(NA("x",t,e,n))];case"Log1p":return[Ab(NA("x",t,e,n))];case"Neg":return[Rb(NA("x",t,e,n))];case"Reciprocal":return[Ob(NA("x",t,e,n))];case"Relu":return[jx(NA("x",t,e,n))];case"Round":return[Db(NA("x",t,e,n))];case"Selu":return[Wx(NA("x",t,e,n))];case"Sigmoid":return[Pb(NA("x",t,e,n))];case"Sin":return[Fb(NA("x",t,e,n))];case"Sign":return[Lb(NA("x",t,e,n))];case"Sinh":return[zb(NA("x",t,e,n))];case"Softplus":return[Bb(NA("x",t,e,n))];case"Sqrt":return[Ub(NA("x",t,e,n))];case"Square":return[Vb(NA("x",t,e,n))];case"Tanh":return[Hb(NA("x",t,e,n))];case"Tan":return[Wb(NA("x",t,e,n))];case"Relu6":case"ClipByValue":return[xb(NA("x",t,e,n),NA("clipValueMin",t,e,n),NA("clipValueMax",t,e,n))];case"Rsqrt":return[Mb(_A(t.inputNames[0],e,n))];case"Prod":return[Jw(NA("x",t,e,n),NA("axes",t,e,n))];case"LeakyRelu":return[Ux(NA("x",t,e,n),NA("alpha",t,e,n))];default:throw TypeError("Node type "+t.op+" is not implemented")}},QA=function(){function t(e,n,r,o,i,a,s){this.name=e,this.dtype=n,this.maxSize=r,this.elementShape=o,this.identicalElementShapes=i,this.dynamicSize=a,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.id=t.nextId++}return Object.defineProperty(t.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),t.prototype.clearAndClose=function(){this.tensors.forEach(function(t){return t.tensor.dispose()}),this.tensors=[],this.closed_=!0},t.prototype.size=function(){return this.tensors.length},t.prototype.read=function(t){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(t<0||t>=this.tensors.length)throw new Error("Tried to read from index "+t+", but array size is: "+this.tensors.length);var e=this.tensors[t];if(e.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+t+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor},t.prototype.readMany=function(t){var e=this;return t.map(function(t){return e.read(t)})},t.prototype.write=function(t,e){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error("Tried to write to index "+t+", but array is not resizeable and size is: "+this.maxSize);var n=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+t+",\n          because the value dtype is "+e.dtype+", but TensorArray dtype is "+this.dtype+".");if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=e.shape),this.assertShapesMatchAllowUndefinedSize(this.elementShape,e.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+t+"."),n&&n.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+t+", because it has already been read.");if(n&&n.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+t+", because it has already been written.");n.tensor=e,n.written=!0,this.tensors[t]=n},t.prototype.writeMany=function(t,e){var n=this;if(t.length!==e.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,because the index size: "+t.length+" is not the same as tensors size: "+e.length+".");t.forEach(function(t,r){return n.write(t,e[r])})},t.prototype.gather=function(t,e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+e);if(!t){t=[];for(var n=0;n<this.size();n++)t.push(n)}if(0===t.length)return Jd([],[0].concat(this.elementShape));var r=this.readMany(t);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),ib(r,0)},t.prototype.concat=function(t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+t);if(0===this.size())return Jd([],[0].concat(this.elementShape));for(var e=[],n=0;n<this.size();n++)e.push(n);var r=this.readMany(e);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+r[0].shape+")"),Sy(r,0)},t.prototype.scatter=function(t,e){if(e.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+e.dtype);if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+t.length+" vs. "+e.shape[0]);var n=Math.max.apply(Math,t);if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size ("+n+"  vs. "+this.maxSize+")");this.writeMany(t,ub(e,0))},t.prototype.split=function(t,e){var n=this;if(e.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+e.dtype);var r=0,o=t.map(function(t){return r+=t});if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        "+r+", and tensor's shape is: "+e.shape);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+t.length+"), and the TensorArray is not marked as dynamically resizeable");var i=0===r?0:e.size/r,a=[];vd(function(){e=e.reshape([1,r,i]);for(var s=0;s<t.length;++s)a[s]=Fw(e,[0,0===s?0:o[s-1],0],[1,t[s],i]).reshape(n.elementShape);return a});for(var s=[],u=0;u<t.length;u++)s[u]=u;this.writeMany(s,a)},t.prototype.assertShapesMatchAllowUndefinedSize=function(t,e,n){void 0===n&&(n=""),Rf.assert(this.shapesEqualAllowUndefinedSize(t,e),function(){return n+" Shapes "+t+" and "+e+" must match"})},t.prototype.shapesEqualAllowUndefinedSize=function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(-1!==t[n]&&-1!==e[n]&&t[n]!==e[n])return!1;return!0},t.nextId=0,t}(),JA=function(t,e,n){switch(t.op){case"Conv1D":var r=NA("stride",t,e,n),o=NA("pad",t,e,n),i=NA("dataFormat",t,e,n).toUpperCase(),a=NA("dilation",t,e,n);return[vw(NA("x",t,e,n),NA("filter",t,e,n),r,o,i,a)];case"Conv2D":r=NA("strides",t,e,n),o=NA("pad",t,e,n),i=NA("dataFormat",t,e,n).toUpperCase();var s=NA("dilations",t,e,n);return[yw(NA("x",t,e,n),NA("filter",t,e,n),[r[1],r[2]],o,i,[s[0],s[1]])];case"Conv2DBackpropInput":case"Conv2dTranspose":var u=NA("outputShape",t,e,n);return r=NA("strides",t,e,n),o=NA("pad",t,e,n),[Cw(NA("x",t,e,n),NA("filter",t,e,n),u,[r[1],r[2]],o)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":return r=NA("strides",t,e,n),o=NA("pad",t,e,n),s=NA("dilations",t,e,n),i=NA("dataFormat",t,e,n).toUpperCase(),[xw(NA("input",t,e,n),NA("filter",t,e,n),[r[1],r[2]],o,i,[s[0],s[1]])];case"AvgPool":r=NA("strides",t,e,n),o=NA("pad",t,e,n);var l=NA("kernelSize",t,e,n);return[Pw(NA("x",t,e,n),[l[1],l[2]],[r[1],r[2]],o)];case"MaxPool":return r=NA("strides",t,e,n),o=NA("pad",t,e,n),l=NA("kernelSize",t,e,n),[Mw(NA("x",t,e,n),[l[1],l[2]],[r[1],r[2]],o)];default:throw TypeError("Node type "+t.op+" is not implemented")}},tk=function(t,e,n){switch(t.op){case"Fill":var r=NA("shape",t,e,n),o=NA("dtype",t,e,n);return[sm(r,NA("value",t,e,n),o)];case"LinSpace":var i=NA("start",t,e,n);return[um(i,NA("stop",t,e,n),NA("num",t,e,n))];case"OneHot":var a=NA("indices",t,e,n),s=NA("depth",t,e,n),u=NA("onValue",t,e,n),l=NA("offValue",t,e,n);return[Ky(a,s,u,l)];case"Ones":return[im(NA("shape",t,e,n),NA("dtype",t,e,n))];case"OnesLike":return[cm(NA("x",t,e,n))];case"RandomUniform":return[eb(NA("shape",t,e,n),NA("minval",t,e,n),NA("maxval",t,e,n),NA("dtype",t,e,n))];case"Range":return[lm(i=NA("start",t,e,n),NA("stop",t,e,n),NA("step",t,e,n),NA("dtype",t,e,n))];case"TruncatedNormal":r=NA("shape",t,e,n);var c=NA("mean",t,e,n),p=NA("stdDev",t,e,n),h=NA("seed",t,e,n);return[sb(r,c,p,NA("dtype",t,e,n),h)];case"Zeros":return[am(NA("shape",t,e,n),NA("dtype",t,e,n))];case"ZerosLike":return[pm(NA("x",t,e,n))];default:throw TypeError("Node type "+t.op+" is not implemented")}},ek=function(t,e,n){switch(t.op){case"TopKV2":var r=NA("x",t,e,n),o=NA("k",t,e,n),i=NA("sorted",t,e,n),a=nS(r,o,i);return[a.values,a.indices];default:throw TypeError("Node type "+t.op+" is not implemented")}},nk=function(t,e,n){switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":var r=NA("default",t,e,n);return[_A(t.name,e,n)||r];case"Placeholder":return[_A(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[NA("x",t,e,n).clone()];case"Shape":return[em(NA("x",t,e,n).shape,"int32")];case"ShapeN":return NA("x",t,e,n).map(function(t){return em(t.shape)});case"Size":return[tm(NA("x",t,e,n).size,"int32")];case"Rank":return[tm(NA("x",t,e,n).rank,"int32")];case"NoOp":return[];case"Print":var o=NA("x",t,e,n),i=NA("data",t,e,n),a=NA("message",t,e,n),s=NA("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(a);for(var u=0;u<i.length;u++)console.log(Array.prototype.slice.call(i[u].dataSync()).slice(0,s));return[o];default:throw TypeError("Node type "+t.op+" is not implemented")}},rk=function(t,e,n){switch(t.op){case"ResizeBilinear":var r=NA("images",t,e,n),o=NA("size",t,e,n),i=NA("alignCorners",t,e,n);return[kS.resizeBilinear(r,[o[0],o[1]],i)];case"ResizeNearestNeighbor":return r=NA("images",t,e,n),o=NA("size",t,e,n),i=NA("alignCorners",t,e,n),[kS.resizeNearestNeighbor(r,[o[0],o[1]],i)];case"CropAndResize":var a=NA("image",t,e,n),s=NA("boxes",t,e,n),u=NA("boxInd",t,e,n),l=NA("cropSize",t,e,n),c=NA("method",t,e,n),p=NA("extrapolationValue",t,e,n);return[kS.cropAndResize(a,s,u,l,c,p)];default:throw TypeError("Node type "+t.op+" is not implemented")}},ok=function(t,e,n){switch(t.op){case"Equal":return[tx(NA("a",t,e,n),NA("b",t,e,n))];case"NotEqual":return[cx(NA("a",t,e,n),NA("b",t,e,n))];case"Greater":return[nx(NA("a",t,e,n),NA("b",t,e,n))];case"GreaterEqual":return[rx(NA("a",t,e,n),NA("b",t,e,n))];case"Less":return[ax(NA("a",t,e,n),NA("b",t,e,n))];case"LessEqual":return[sx(NA("a",t,e,n),NA("b",t,e,n))];case"LogicalAnd":return[Dx(NA("a",t,e,n),NA("b",t,e,n))];case"LogicalNot":return[Mx(NA("a",t,e,n))];case"LogicalOr":return[Px(NA("a",t,e,n),NA("b",t,e,n))];case"Select":return[Fx(NA("condition",t,e,n),NA("a",t,e,n),NA("b",t,e,n))];default:throw TypeError("Node type "+t.op+" is not implemented")}},ik=function(t,e,n){switch(t.op){case"BatchMatMul":case"MatMul":return[Ew(NA("a",t,e,n),NA("b",t,e,n),NA("transposeA",t,e,n),NA("transposeB",t,e,n))];case"Transpose":return[Hx(NA("x",t,e,n),NA("perm",t,e,n))];default:throw TypeError("Node type "+t.op+" is not implemented")}},ak=function(t,e,n){switch(t.op){case"FusedBatchNorm":case"FusedBatchNormV2":return[ew(NA("x",t,e,n),NA("mean",t,e,n),NA("variance",t,e,n),NA("offset",t,e,n),NA("scale",t,e,n),NA("epsilon",t,e,n))];case"LRN":return[qx(NA("x",t,e,n),NA("radius",t,e,n),NA("bias",t,e,n),NA("alpha",t,e,n),NA("beta",t,e,n))];case"Softmax":return[$d(NA("x",t,e,n))];case"LogSoftmax":return[Xd(NA("x",t,e,n))];case"SparseToDense":return[lS(NA("sparseIndices",t,e,n),NA("outputShape",t,e,n),NA("sparseValues",t,e,n),NA("defaultValue",t,e,n))];default:throw TypeError("Node type "+t.op+" is not implemented")}},sk=function(t,e,n){switch(t.op){case"Max":var r=NA("axis",t,e,n),o=NA("keepDims",t,e,n);return[$w(NA("x",t,e,n),r,o)];case"Mean":return r=NA("axis",t,e,n),o=NA("keepDims",t,e,n),[Xw(NA("x",t,e,n),r,o)];case"Min":return r=NA("axis",t,e,n),o=NA("keepDims",t,e,n),[Zw(NA("x",t,e,n),r,o)];case"Sum":return r=NA("axis",t,e,n),o=NA("keepDims",t,e,n),[Qw(NA("x",t,e,n),r,o)];case"All":return r=NA("axis",t,e,n),o=NA("keepDims",t,e,n),[Ww(NA("x",t,e,n),r,o)];case"Any":return r=NA("axis",t,e,n),o=NA("keepDims",t,e,n),[Hw(NA("x",t,e,n),r,o)];case"ArgMax":return r=NA("axis",t,e,n),[qw(NA("x",t,e,n),r)];case"ArgMin":return r=NA("axis",t,e,n),[Gw(NA("x",t,e,n),r)];case"Prod":return r=NA("axis",t,e,n),o=NA("keepDims",t,e,n),[Jw(NA("x",t,e,n),r,o)];default:throw TypeError("Node type "+t.op+" is not implemented")}},uk=function(t,e,n){switch(t.op){case"ConcatV2":case"Concat":var r=NA("axis",t,e,n),o=NA("tensors",t,e,n);return[Sy(o,r)];case"GatherV2":case"Gather":r=NA("axis",t,e,n);var i=NA("x",t,e,n),a=NA("indices",t,e,n);return[Zx(i,a.asType("int32"),r)];case"ReverseV2":case"Reverse":return r=NA("axis",t,e,n),i=NA("x",t,e,n),[Iw(i,r)];case"Slice":var s=NA("begin",t,e,n),u=NA("size",t,e,n);return[Fw(NA("x",t,e,n),s,u)];case"StridedSlice":s=NA("begin",t,e,n);var l=NA("end",t,e,n),c=NA("strides",t,e,n),p=NA("beginMask",t,e,n),h=NA("endMask",t,e,n),f=NA("ellipsisMask",t,e,n),d=NA("newAxisMask",t,e,n),m=NA("shrinkAxisMask",t,e,n),g=NA("x",t,e,n);if(1===s.length&&g.shape.length>1)for(var v=1;v<g.shape.length;v++)s.push(0),l.push(g.shape[v]),c.push(c[0]);return[eS(g,s,l,c,p,h,f,d,m)];case"Pack":return vd(function(){var r=NA("axis",t,e,n),o=NA("tensors",t,e,n),i=o[0].shape,a=o[0].squeeze().shape,s=o.map(function(t){var e=Rf.arraysEqual(t.shape,i);if(!e&&!Rf.arraysEqual(t.squeeze().shape,a))throw new Error("the input tensors shape does not match");return e?t:t.reshape(i)});return[ib(s,r)]});case"Unpack":return vd(function(){var r=NA("axis",t,e,n),o=NA("tensor",t,e,n);return ub(o,r)});case"Tile":var y=NA("reps",t,e,n);return[ab(NA("x",t,e,n),y)];case"Split":case"SplitV":r=NA("axis",t,e,n);var b=NA("numOrSizeSplits",t,e,n);return Iy(NA("x",t,e,n),b,r);case"ScatterNd":a=NA("indices",t,e,n);var w=NA("values",t,e,n),x=NA("shape",t,e,n);return[rS(a,w,x)];case"GatherNd":var S=NA("x",t,e,n);return a=NA("indices",t,e,n),[cS(S,a)];case"SparseToDense":a=NA("sparseIndices",t,e,n),x=NA("outputShape",t,e,n);var C=NA("sparseValues",t,e,n),E=NA("defaultValue",t,e,n);return[lS(a,C,x,C.dtype===E.dtype?E:E.asType(C.dtype))];default:throw TypeError("Node type "+t.op+" is not implemented")}},lk=function(t,e,n){switch(t.op){case"FFT":return[oS(NA("x",t,e,n))];case"IFFT":return[iS(NA("x",t,e,n))];case"RFFT":return[aS(NA("x",t,e,n))];case"IRFFT":return[sS(NA("x",t,e,n))];default:throw TypeError("Node type "+t.op+" is not implemented")}},ck=function(t,e,n){switch(t.op){case"Cast":return[Uy(NA("x",t,e,n),NA("dtype",t,e,n))];case"ExpandDims":var r=NA("axis",t,e,n);return[Hy(NA("x",t,e,n),r)];case"Squeeze":return r=NA("axis",t,e,n),[ob(NA("x",t,e,n),r)];case"Reshape":return[nb(NA("x",t,e,n),NA("shape",t,e,n))];case"PadV2":case"Pad":return[$y(NA("x",t,e,n),kA(NA("padding",t,e,n),2),NA("constantValue",t,e,n))];case"SpaceToBatchND":var o=NA("blockShape",t,e,n),i=kA(NA("paddings",t,e,n),2);return[rb(NA("x",t,e,n),o,i)];case"BatchToSpaceND":o=NA("blockShape",t,e,n);var a=kA(NA("crops",t,e,n),2);return[By(NA("x",t,e,n),o,a)];case"DepthToSpace":var s=NA("blockSize",t,e,n),u=NA("dataFormat",t,e,n).toUpperCase();return[Wy(NA("x",t,e,n),s,u)];default:throw TypeError("Node type "+t.op+" is not implemented")}};function pk(t,e,n){var r=function(t,e,n){switch(t.category){case"arithmetic":return ZA(t,e,n);case"basic_math":return YA(t,e,n);case"control":return function(t,e,n){return CA(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,p,h,f,d,m,g,v,y,b,w,x,S,C,E,N,_,I,T,A,k,R,O,D,M,P,L;return EA(this,function(F){switch(F.label){case 0:switch(t.op){case"LoopCond":return[3,1];case"Switch":return[3,2];case"Merge":return[3,4];case"Enter":return[3,5];case"Exit":return[3,6];case"NextIteration":return[3,7];case"TensorArrayV3":return[3,8];case"TensorArrayWriteV3":return[3,9];case"TensorArrayReadV3":return[3,10];case"TensorArrayGatherV3":return[3,11];case"TensorArrayScatterV3":return[3,12];case"TensorArrayConcatV3":return[3,13];case"TensorArraySplitV3":return[3,14];case"TensorArraySizeV3":return[3,15];case"TensorArrayCloseV3":return[3,16]}return[3,17];case 1:return[2,[NA("pred",t,e,n).clone()]];case 2:return r=NA("pred",t,e,n),o=NA("data",t,e,n),[4,r.data()];case 3:return[2,F.sent()[0]?[void 0,o.clone()]:[o.clone(),void 0]];case 4:return[2,(i=t.inputNames.find(function(t){return void 0!==_A(t,e,n)}))?[_A(i,e,n).clone()]:void 0];case 5:return a=NA("frameName",t,e,n),s=NA("tensor",t,e,n),n.enterFrame(a),[2,[s.clone()]];case 6:return u=NA("tensor",t,e,n),n.exitFrame(),[2,[u.clone()]];case 7:return l=NA("tensor",t,e,n),n.nextIteration(),[2,[l.clone()]];case 8:return c=NA("size",t,e,n),p=NA("dtype",t,e,n),h=NA("elementShape",t,e,n),f=NA("dynamicSize",t,e,n),d=NA("clearAfterRead",t,e,n),m=NA("identicalElementShapes",t,e,n),g=NA("name",t,e,n),v=new QA(g,p,c,h,m,f,d),n.addTensorArray(v),[2,[tm(v.id),tm(1)]];case 9:return y=NA("tensorArrayId",t,e,n),b=NA("index",t,e,n),w=NA("tensor",t,e,n),n.getTensorArray(y).write(b,w),[2,[tm(1)]];case 10:return x=NA("tensorArrayId",t,e,n),S=NA("index",t,e,n),[2,[n.getTensorArray(x).read(S)]];case 11:return C=NA("tensorArrayId",t,e,n),E=NA("indices",t,e,n),N=NA("dtype",t,e,n),[2,[n.getTensorArray(C).gather(E,N)]];case 12:return _=NA("tensorArrayId",t,e,n),I=NA("indices",t,e,n),T=NA("tensor",t,e,n),n.getTensorArray(_).scatter(I,T),[2,[tm(1)]];case 13:return A=NA("tensorArrayId",t,e,n),k=n.getTensorArray(A),R=NA("dtype",t,e,n),[2,[k.concat(R)]];case 14:return O=NA("tensorArrayId",t,e,n),D=NA("tensor",t,e,n),M=NA("lengths",t,e,n),n.getTensorArray(O).split(M,D),[2,[tm(1)]];case 15:return P=NA("tensorArrayId",t,e,n),[2,[tm(n.getTensorArray(P).size(),"int32")]];case 16:return L=NA("tensorArrayId",t,e,n),n.getTensorArray(L).clearAndClose(),[2,[]];case 17:throw TypeError("Node type "+t.op+" is not implemented")}})})}(t,e,n);case"convolution":return JA(t,e,n);case"creation":return tk(t,e,n);case"dynamic":return function(t,e,n){return CA(this,void 0,void 0,function(){var r,o,i,a,s;return EA(this,function(u){switch(u.label){case 0:switch(t.op){case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":return[3,1];case"Where":return[3,3];case"ListDiff":return[3,5]}return[3,7];case 1:return r=NA("boxes",t,e,n),o=NA("scores",t,e,n),i=NA("maxOutputSize",t,e,n),a=NA("iouThreshold",t,e,n),s=NA("scoreThreshold",t,e,n),[4,kS.nonMaxSuppressionAsync(r,o,i,a,s)];case 2:return[2,[u.sent()]];case 3:return[4,zx(NA("condition",t,e,n))];case 4:return[2,[u.sent()]];case 5:return[4,lb(NA("x",t,e,n),NA("y",t,e,n))];case 6:return[2,u.sent()];case 7:throw TypeError("Node type "+t.op+" is not implemented")}})})}(t,e,n);case"evaluation":return ek(t,e,n);case"image":return rk(t,e,n);case"graph":return nk(t,e,n);case"logical":return ok(t,e,n);case"matrices":return ik(t,e,n);case"normalization":return ak(t,e,n);case"reduction":return sk(t,e,n);case"slice_join":return uk(t,e,n);case"spectral":return lk(t,e,n);case"transformation":return ck(t,e,n);default:throw TypeError("Node type "+t.op+" is not implemented")}}(t,e,n);return r instanceof Promise?r.then(function(t){return[].concat(t)}):[].concat(r)}var hk=function(){function t(t,e){this.weightMap=t,this.tensorArrayMap=e,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return t.prototype.newFrame=function(t,e){return{id:t,frameName:e,iterationId:0}},Object.defineProperty(t.prototype,"currentContext",{get:function(){return this.contexts},set:function(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),t.prototype.generateCurrentContextIds=function(){for(var t=[],e=0;e<this.contexts.length-1;e++){var n=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(n))}t.push(""),this._currentContextIds=t},t.prototype.contextIdforContexts=function(t){return t?t.map(function(t){return 0===t.id&&0===t.iterationId?"":t.frameName+"-"+t.iterationId}).join("/"):""},t.prototype.enterFrame=function(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},t.prototype.exitFrame=function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},t.prototype.nextIteration=function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},t.prototype.getWeight=function(t){return this.weightMap[t]},t.prototype.addTensorArray=function(t){this.tensorArrayMap[t.id]=t},t.prototype.getTensorArray=function(t){return this.tensorArrayMap[t]},t}(),fk=function(){function t(t){this.graph=t,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this.placeholders=t.placeholders,this._outputs=t.outputs,this.compile()}return Object.defineProperty(t.prototype,"weightMap",{get:function(){return this._weightMap},set:function(t){var e=Object.keys(t).map(function(e){return t[e].map(function(t){return t.id})});this.weightIds=[].concat.apply([],e),this._weightMap=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputs",{get:function(){return this.placeholders.map(function(t){return{name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputs",{get:function(){return this._outputs.map(function(t){return{name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputNodes",{get:function(){return this.placeholders.map(function(t){return t.name})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputNodes",{get:function(){return this.outputs.map(function(t){return t.name})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isControlFlowModel",{get:function(){return this.graph.withControlFlow},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDynamicShapeModel",{get:function(){return this.graph.withDynamicShape},enumerable:!0,configurable:!0}),t.prototype.compile=function(t){if(!this.graph.withControlFlow&&!this.graph.withDynamicShape){var e=[],n=t||this.graph.placeholders,r=n.map(function(t){return t.name}).sort().join(this.SEPERATOR);if(!this.compiledMap.get(r)){for(var o=n.concat(this.graph.weights),i={};o.length>0;){var a=o.pop();i[a.name]=!0,e.push(a),a.children.forEach(function(t){!i[t.name]&&t.inputNames.every(function(t){var e=IA(t)[0];return i[e]})&&o.push(t)})}this.compiledMap.set(r,e)}}},t.prototype.execute=function(t,e,n){var r=this;void 0===e&&(e=!0);var o=Object.keys(t).sort();this.checkInput(t,e),this.checkInputShapeAndType(t,e),this.compile(o.map(function(t){return r.graph.nodes[t]}));var i=this.calculateOutputs(n);this.checkOutput(this.compiledMap.get(o.join(this.SEPERATOR)),i);var a={};return vd(function(){for(var e=new hk(r._weightMap,a),n=SA({},r.weightMap,t),s=r.getFrozenTensorIds(n),u={},l=r.compiledMap.get(o.join(r.SEPERATOR)),c=0;c<l.length;c++){var p=l[c];if(n[p.name]||(n[p.name]=pk(p,n,e),r.checkTensorForDisposal(p.name,p,n,e,s,i,u)),i.every(function(t){return!!n[t]}))break}return r.findOutputs(n,e,i)})},t.prototype.getFrozenTensorIds=function(t){var e=[].concat.apply([],Object.keys(t).map(function(e){return t[e]}).map(function(t){return t.map(function(t){return t.id})}));return new Set(e)},t.prototype.checkTensorForDisposal=function(t,e,n,r,o,i,a){"control"!==e.category&&-1===i.indexOf(t)&&(n[t].forEach(function(t){null!=t&&(a[t.id]=(a[t.id]||0)+e.children.length)}),e.inputs.forEach(function(t){if("control"!==t.category){var e=function(t,e,n){return e[TA(t,r.currentContextId)]}(t.name,n);null!=e&&e.forEach(function(t){if(t&&!o.has(t.id)){var e=a[t.id];1===e?(t.dispose(),delete a[t.id]):null!=e&&a[t.id]--}})}}))},t.prototype.executeAsync=function(t,e){return CA(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l=this;return EA(this,function(c){switch(c.label){case 0:return this.checkInput(t,!1),this.checkInputShapeAndType(t,!1),n=new hk(this._weightMap,{}),r=this.calculateOutputs(e),[4,this.executeWithControlFlow(t,n,r)];case 1:return o=c.sent(),i=this.findOutputs(o,n,e),a=Object.keys(i).map(function(t){return i[t].id}),s=Object.keys(t).map(function(e){return t[e].map(function(t){return t.id})}),u=[].concat.apply([],s),Object.keys(o).forEach(function(t){o[t].forEach(function(t){t&&!t.isDisposed&&-1===a.indexOf(t.id)&&-1===u.indexOf(t.id)&&-1===l.weightIds.indexOf(t.id)&&t.dispose()})}),[2,i]}})})},t.prototype.executeWithControlFlow=function(t,e,n){return CA(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,p=this;return EA(this,function(h){switch(h.label){case 0:r=Object.keys(t),o=r.map(function(t){return p.graph.nodes[t]}),i=o.concat(this.graph.weights).map(function(t){return{node:t,contexts:e.currentContext}}),a=SA({},this.weightMap,t),s={},u=this.getFrozenTensorIds(a),l={},h.label=1;case 1:return i.length>0?(c=this.processStack(o,i,e,a,l,u,n,s),[4,Promise.all(c)]):[3,3];case 2:return h.sent(),[3,1];case 3:return[2,a]}})})},t.prototype.processStack=function(t,e,n,r,o,i,a,s){for(var u=this,l=[],c=function(){var c=e.pop();n.currentContext=c.contexts;var h="";if("Enter"===c.node.op&&NA("isConstant",c.node,r,n)&&(h=IA(c.node.name,n)[0]),-1===t.indexOf(c.node)){var f=pk(c.node,r,n);h||(h=IA(c.node.name,n)[0]);var d=n.currentContext;f instanceof Promise?l.push(f.then(function(t){return r[h]=t,n.currentContext=d,u.checkTensorForDisposal(h,c.node,r,n,i,a,s),u.processChildNodes(c.node,e,n,r,o),t})):(r[h]=f,p.checkTensorForDisposal(h,c.node,r,n,i,a,s),p.processChildNodes(c.node,e,n,r,o))}else p.processChildNodes(c.node,e,n,r,o)},p=this;e.length>0;)c();return l},t.prototype.processChildNodes=function(t,e,n,r,o){t.children.forEach(function(t){var i=IA(t.name,n)[0];o[i]||("Merge"===t.op?t.inputNames.some(function(t){return!!_A(t,r,n)})&&(o[i]=!0,e.push({contexts:n.currentContext,node:t})):t.inputNames.every(function(t){return!!_A(t,r,n)})&&(o[i]=!0,e.push({contexts:n.currentContext,node:t})))})},t.prototype.calculateOutputs=function(t){return!t||t instanceof Array||(t=[t]),t||this.graph.outputs.map(function(t){return t.name})},t.prototype.findOutputs=function(t,e,n){return this.calculateOutputs(n).reduce(function(n,r){return n[r]=_A(r,t,e),n},{})},t.prototype.dispose=function(){var t=this;Object.keys(this.weightMap).forEach(function(e){return t.weightMap[e].forEach(function(t){return t.dispose()})})},t.prototype.checkInputShapeAndType=function(t,e){void 0===e&&(e=!0),this.placeholders.forEach(function(n){var r=t[n.name];if(e||r){var o=r[0];if(n.attrParams.shape&&n.attrParams.shape.value){var i=n.attrParams.shape.value,a=i.length===o.shape.length&&o.shape.every(function(t,e){return-1===i[e]||i[e]===t});Rf.assert(a,function(){return"The shape of dict['"+n.name+"'] provided in model.execute(dict) must be ["+i+"], but was ["+o.shape+"]"})}n.attrParams.dtype&&n.attrParams.dtype.value&&Rf.assert(o.dtype===n.attrParams.dtype.value,function(){return"The dtype of dict['"+n.name+"'] provided in model.execute(dict) must be "+n.attrParams.dtype.value+", but was "+o.dtype})}})},t.prototype.checkInput=function(t,e){var n=this;void 0===e&&(e=!0);var r=Object.keys(t),o=[],i=[];this.inputNodes.forEach(function(t){-1===r.indexOf(t)&&o.push(t)}),r.forEach(function(t){-1===n.inputNodes.indexOf(t)&&i.push(t)});var a=i.filter(function(t){return!n.graph.nodes[t]});if(o.length>0&&e)throw new Error("The dict provided in model.execute(dict) has the keys ["+r+"], but is missing the required keys: ["+o+"].");if(i.length>0&&e)throw new Error("The dict provided in model.execute(dict) has unused keys: ["+i+"]. Please provide only the following keys: ["+this.inputNodes+"].");if(a.length>0)throw new Error("The dict provided in model.execute(dict) has keys: ["+a+"] not part of model graph.")},t.prototype.checkOutput=function(t,e){var n=t.map(function(t){return t.name}),r=[];if(e.forEach(function(t){var e=AA(t)[0];-1===n.indexOf(e)&&r.push(e)}),r.length>0)throw new Error("The following outputs are not generated by the execution: ["+r+"].")},t}();!function(){function t(t,e){void 0===e&&(e={}),this.modelUrl=t,this.loadOptions=e,this.version="n/a",null==e&&(this.loadOptions={})}Object.defineProperty(t.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),t.prototype.findIOHandler=function(){var t=this.modelUrl;if(null!=t.load)this.handler=t;else if(null!=this.loadOptions.requestInit)this.handler=AC.browserHTTPRequest(t,this.loadOptions);else{var e=AC.getLoadHandlers(t,this.loadOptions.onProgress);if(0===e.length)e.push(AC.browserHTTPRequest(t,this.loadOptions));else if(e.length>1)throw new Error("Found more than one ("+e.length+") load handlers for URL '"+[t]+"'");this.handler=e[0]}},t.prototype.load=function(){return CA(this,void 0,void 0,function(){var t,e,n;return EA(this,function(r){switch(r.label){case 0:if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,this.handler.load()];case 1:return t=r.sent(),this.version=(e=t.modelTopology).versions.producer+"."+e.versions.minConsumer,n=AC.decodeWeights(t.weightData,t.weightSpecs),this.executor=new fk(XA.Instance.transformGraph(e)),this.executor.weightMap=this.convertTensorMapToTensorsMap(n),[2,!0]}})})},t.prototype.predict=function(t,e){return this.execute_(t,!0,this.outputNodes)},t.prototype.constructTensorMap=function(t){var e=t instanceof Vf?[t]:t;if(e.length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has "+this.inputNodes.length+" placeholders, while there are "+e.length+" input tensors.");return this.inputNodes.reduce(function(t,n,r){return t[n]=e[r],t},{})},t.prototype.execute=function(t,e){return this.execute_(t,!1,e)},t.prototype.execute_=function(t,e,n){if(void 0===e&&(e=!0),n=n||this.outputNodes,(t instanceof Vf||Array.isArray(t))&&(t=this.constructTensorMap(t)),this.executor.isControlFlowModel||this.executor.isDynamicShapeModel)throw new Error("The model contains control flow or dynamic shape ops, please use executeAsync method");var r=this.executor.execute(this.convertTensorMapToTensorsMap(t),e,n),o=Object.keys(r);return Array.isArray(n)&&n.length>1?n.map(function(t){return r[t]}):r[o[0]]},t.prototype.executeAsync=function(t,e){return CA(this,void 0,void 0,function(){var n,r;return EA(this,function(o){switch(o.label){case 0:if(!this.executor.isControlFlowModel&&!this.executor.isDynamicShapeModel)throw new Error("The model does not contain control flow or dynamic shape ops, please use execute method for better performance.");return e=e||this.outputNodes,(t instanceof Vf||Array.isArray(t))&&(t=this.constructTensorMap(t)),[4,this.executor.executeAsync(this.convertTensorMapToTensorsMap(t),e)];case 1:return n=o.sent(),r=Object.keys(n),[2,Array.isArray(e)&&e.length>1?e.map(function(t){return n[t]}):n[r[0]]]}})})},t.prototype.convertTensorMapToTensorsMap=function(t){return Object.keys(t).reduce(function(e,n){return e[n]=[t[n]],e},{})},t.prototype.dispose=function(){this.executor.dispose()}}();var dk=function(t,e){return(dk=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function mk(t,e){function n(){this.constructor=t}dk(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function gk(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function vk(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var yk="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function bk(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function wk(t,e){return t(e={exports:{}},e.exports),e.exports}var xk=wk(function(t){!function(t,e,n){function r(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var n=new function(t){var e,n=this,r=(e=4022871197,function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1),r=null}(t),o=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+1.1102230246251565e-16*(2097152*i()|0)},i.quick=i,o&&("object"==typeof o&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.alea=o}(0,t)}),Sk=wk(function(t){!function(t,e,n){function r(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var n=new function(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.xor128=o}(0,t)}),Ck=wk(function(t){!function(t,e,n){function r(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var n=new function(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.xorwow=o}(0,t)}),Ek=wk(function(t){!function(t,e,n){function r(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var n=new function(t){var e=this;e.next=function(){var t,n,r=e.x,o=e.i;return t=r[o],n=(t^=t>>>7)^t<<24,n^=(t=r[o+1&7])^t>>>10,n^=(t=r[o+3&7])^t>>>3,n^=(t=r[o+4&7])^t<<7,t=r[o+7&7],n^=(t^=t<<13)^t<<9,r[o]=n,e.i=o+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.x&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.xorshift7=o}(0,t)}),Nk=wk(function(t){!function(t,e,n){function r(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var n=new function(t){var e=this;e.next=function(){var t,n,r=e.w,o=e.X,i=e.i;return e.w=r=r+1640531527|0,n=o[i+34&127],t=o[i=i+1&127],n^=n<<13,t^=t<<17,n=o[i]=(n^=n>>>15)^(t^=t>>>12),e.i=i,n+(r^r>>>16)|0},function(t,e){var n,r,o,i,a,s=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),o=0,i=-32;i<u;++i)e&&(r^=e.charCodeAt((i+32)%e.length)),0===i&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=0==(n=s[127&i]^=r+(a=a+1640531527|0))?o+1:0);for(o>=128&&(s[127&(e&&e.length||0)]=-1),o=127,i=512;i>0;--i)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,s[o]=(r^=r>>>15)^(n^=n>>>12);t.w=a,t.X=s,t.i=o}(e,t)}(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.X&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.xor4096=o}(0,t)}),_k=wk(function(t){!function(t,e,n){function r(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var n=new function(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,o=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^o,e.a=o-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.tychei=o}(0,t)}),Ik=wk(function(t){!function(e,r){var o,i=(0,eval)("this"),a=256,s=6,u="random",l=r.pow(a,s),c=r.pow(2,52),p=2*c,h=a-1;function f(t,n,f){var v=[],y=m(function t(e,n){var r,o=[],i=typeof e;if(n&&"object"==i)for(r in e)try{o.push(t(e[r],n-1))}catch(t){}return o.length?o:"string"==i?e:e+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[t,g(e)]:null==t?function(){try{var t;return o&&(t=o.randomBytes)?t=t(a):(t=new Uint8Array(a),(i.crypto||i.msCrypto).getRandomValues(t)),g(t)}catch(t){var n=i.navigator,r=n&&n.plugins;return[+new Date,i,r,i.screen,g(e)]}}():t,3),v),b=new function(t){var e,n=t.length,r=this,o=0,i=r.i=r.j=0,s=r.S=[];for(n||(t=[n++]);o<a;)s[o]=o++;for(o=0;o<a;o++)s[o]=s[i=h&i+t[o%n]+(e=s[o])],s[i]=e;(r.g=function(t){for(var e,n=0,o=r.i,i=r.j,s=r.S;t--;)e=s[o=h&o+1],n=n*a+s[h&(s[o]=s[i=h&i+e])+(s[i]=e)];return r.i=o,r.j=i,n})(a)}(v),w=function(){for(var t=b.g(s),e=l,n=0;t<c;)t=(t+n)*a,e*=a,n=b.g(1);for(;t>=p;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|b.g(4)},w.quick=function(){return b.g(4)/4294967296},w.double=w,m(g(b.S),e),(n.pass||f||function(t,e,n,o){return o&&(o.S&&d(o,b),t.state=function(){return d(b,{})}),n?(r[u]=t,e):t})(w,y,"global"in n?n.global:this==r,n.state)}function d(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function m(t,e){for(var n,r=t+"",o=0;o<r.length;)e[h&o]=h&(n^=19*e[h&o])+r.charCodeAt(o++);return g(e)}function g(t){return String.fromCharCode.apply(0,t)}if(r["seed"+u]=f,m(r.random(),e),t.exports){t.exports=f;try{o=n(!function(){var t=new Error("Cannot find module 'crypto'");throw t.code="MODULE_NOT_FOUND",t}())}catch(t){}}}([],Math)});Ik.alea=xk,Ik.xor128=Sk,Ik.xorwow=Ck,Ik.xorshift7=Ek,Ik.xor4096=Nk,Ik.tychei=_k;var Tk=Ik.alea,Ak=wk(function(t,e){function n(t){for(var e=t.length,n=0,r=0;e>0;)r=Math.random()*e|0,n=t[--e],t[e]=t[r],t[r]=n}function r(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function o(t,e){if(void 0===e&&(e=[]),null==e&&(e=[]),Array.isArray(t)||l(t))for(var n=0;n<t.length;++n)o(t[n],e);else e.push(t);return e}function i(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function a(t){return t%1==0}function s(t,e){var n=e.length;return r((t=null==t?e.map(function(t,e){return e}):[].concat(t)).every(function(t){return t>=-n&&t<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+t}),r(t.every(function(t){return a(t)}),function(){return"All values in axis param must be integers but got axis "+t}),t.map(function(t){return t<0?n+t:t})}function u(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function l(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function c(t){return"string"==typeof t||t instanceof String}function p(t){return"boolean"==typeof t}function h(t){return"number"==typeof t}function f(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error("Unknown data type "+e)}Object.defineProperty(e,"__esModule",{value:!0}),e.shuffle=n,e.clamp=function(t,e,n){return Math.max(t,Math.min(e,n))},e.nearestLargerEven=function(t){return t%2==0?t:t+1},e.sum=function(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return e},e.randUniform=function(t,e){var n=Math.random();return e*n+(1-n)*t},e.distSquared=function(t,e){for(var n=0,r=0;r<t.length;r++){var o=Number(t[r])-Number(e[r]);n+=o*o}return n},e.assert=r,e.assertShapesMatch=function(t,e,n){void 0===n&&(n=""),r(i(t,e),function(){return n+" Shapes "+t+" and "+e+" must match"})},e.assertNonNull=function(t){r(null!=t,function(){return"The input to the tensor constructor must be a non-null value."})},e.flatten=o,e.sizeFromShape=function(t){if(0===t.length)return 1;for(var e=t[0],n=1;n<t.length;n++)e*=t[n];return e},e.isScalarShape=function(t){return 0===t.length},e.arraysEqual=i,e.isInt=a,e.tanh=function(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var e=Math.exp(2*t);return(e-1)/(e+1)},e.sizeToSquarishShape=function(t){var e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]},e.createShuffledIndices=function(t){for(var e=new Uint32Array(t),r=0;r<t;++r)e[r]=r;return n(e),e},e.rightPad=function(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)},e.repeatedTry=function(t,e,n){return void 0===e&&(e=function(t){return 0}),new Promise(function(r,o){var i=0,a=function(){if(t())r();else{var s=e(++i);null!=n&&i>=n?o():setTimeout(a,s)}};a()})},e.inferFromImplicitShape=function(t,e){for(var n=1,r=-1,o=0;o<t.length;++o)if(t[o]>=0)n*=t[o];else if(-1===t[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(t[o]<0)throw Error("Shapes can not be < 0. Found "+t[o]+" at dim "+o);if(-1===r){if(e>0&&e!==n)throw Error("Size("+e+") must match the product of shape "+t);return t}if(0===n)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(e%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+n);var i=t.slice();return i[r]=e/n,i},e.parseAxisParam=s,e.squeezeShape=function(t,e){for(var n=[],r=[],o=null==e?null:s(e,t).sort(),i=0,a=0;a<t.length;++a){if(null!=o){if(o[i]===a&&1!==t[a])throw new Error("Can't squeeze axis "+a+" since its dim '"+t[a]+"' is not 1");(null==o[i]||o[i]>a)&&1===t[a]&&(n.push(t[a]),r.push(a)),o[i]<=a&&i++}1!==t[a]&&(n.push(t[a]),r.push(a))}return{newShape:n,keptDims:r}},e.getTypedArrayFromDType=function(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error("Unknown data type "+t);n=new Uint8Array(e)}return n},e.getArrayFromDType=function(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error("Unknown data type "+t);n=new Array(e)}return n},e.checkComputationForErrors=function(t,e,n){if("float32"===e)for(var r=0;r<t.length;r++){var o=t[r];if(isNaN(o)||!isFinite(o))throw Error("The result of the '"+n+"' is "+o+".")}},e.checkConversionForErrors=u,e.hasEncodingLoss=function(t,e){return!("complex64"===e||"float32"===e&&"complex64"!==t||"int32"===e&&"float32"!==t&&"complex64"!==t||"bool"===e&&"bool"===t)},e.isTypedArray=l,e.bytesPerElement=function(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)},e.bytesFromStringArray=function(t){if(null==t)return 0;var e=0;return t.forEach(function(t){return e+=2*t.length}),e},e.isString=c,e.isBoolean=p,e.isNumber=h,e.inferDtype=function t(e){return Array.isArray(e)?t(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":h(e)?"float32":c(e)?"string":p(e)?"bool":"float32"},e.isFunction=function(t){return!!(t&&t.constructor&&t.call&&t.apply)},e.nearestDivisor=function(t,e){for(var n=e;n<t;++n)if(t%n==0)return n;return t},e.computeStrides=function(t){var e=t.length;if(e<2)return[];var n=new Array(e-1);n[e-2]=t[e-1];for(var r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n},e.toTypedArray=function(t,e,n){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=o(t)),n&&u(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){for(var r=new Uint8Array(t.length),i=0;i<r.length;++i)0!==Math.round(t[i])&&(r[i]=1);return r}throw new Error("Unknown data type "+e)},e.toNestedArray=function(t,e){if(0===t.length)return e[0];var n=t.reduce(function(t,e){return t*e});if(0===n)return[];if(n!==e.length)throw new Error("["+t+"] does not match the input size.");return function t(e,n,r){var o=new Array;if(1===n.length)for(var i=n[0],a=0;a<i;a++)o[a]=r[e+a];else{i=n[0];var s=n.slice(1),u=s.reduce(function(t,e){return t*e});for(a=0;a<i;a++)o[a]=t(e+a*u,s,r)}return o}(0,t,e)},e.makeOnesTypedArray=function(t,e){for(var n=f(t,e),r=0;r<n.length;r++)n[r]=1;return n},e.makeZerosTypedArray=f,e.now=function(){if("undefined"!=typeof performance)return performance.now();if("undefined"!=typeof process){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")},e.assertNonNegativeIntegerDimensions=function(t){t.forEach(function(e){r(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."})})}});bk(Ak);var kk=Ak.isTypedArray,Rk=wk(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=7;function r(t,e){var r;return r=Array.isArray(t)?parseFloat(t[0].toFixed(n))+" + "+parseFloat(t[1].toFixed(n))+"j":Ak.isString(t)?"'"+t+"'":parseFloat(t.toFixed(n)).toString(),Ak.rightPad(r,e)}function o(t){for(var e=[],n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}e.tensorToString=function(t,e,n,i){var a=Ak.computeStrides(e),s=function(t,e,n,i){var a=Ak.sizeFromShape(e),s=i[i.length-1],u=new Array(s).fill(0),l=e.length,c="complex64"===n?o(t):t;if(l>1)for(var p=0;p<a/s;p++)for(var h=p*s,f=0;f<s;f++)u[f]=Math.max(u[f],r(c[h+f],0).length);return u}(t,e,n,a),u=e.length,l=function t(e,n,i,a,s,u){void 0===u&&(u=!0);var l="complex64"===i?2:1,c=n[0],p=n.length;if(0===p)return"complex64"===i?[r(o(e)[0],0)]:[e[0].toString()];if(1===p){if(c>20){var h=Array.from(e.slice(0,3*l)),f=Array.from(e.slice(c-3*l,c));return"complex64"===i&&(h=o(h),f=o(f)),["["+h.map(function(t,e){return r(t,s[e])}).join(", ")+", ..., "+f.map(function(t,e){return r(t,s[c-3+e])}).join(", ")+"]"]}return["["+("complex64"===i?o(e):Array.from(e)).map(function(t,e){return r(t,s[e])}).join(", ")+"]"]}var d=n.slice(1),m=a.slice(1),g=a[0]*l,v=[];if(c>20){for(var y=0;y<3;y++)v.push.apply(v,t(e.slice(b=y*g,b+g),d,i,m,s,!1));for(v.push("..."),y=c-3;y<c;y++)v.push.apply(v,t(e.slice(b=y*g,b+g),d,i,m,s,y===c-1))}else for(y=0;y<c;y++){var b;v.push.apply(v,t(e.slice(b=y*g,b+g),d,i,m,s,y===c-1))}var w=2===p?",":"";for(v[0]="["+v[0]+w,y=1;y<v.length-1;y++)v[y]=" "+v[y]+w;var x=",\n";for(y=2;y<p;y++)x+="\n";return v[v.length-1]=" "+v[v.length-1]+"]"+(u?"":x),v}(t,e,n,a,s),c=["Tensor"];return i&&(c.push("  dtype: "+n),c.push("  rank: "+u),c.push("  shape: ["+e+"]"),c.push("  values:")),c.push(l.map(function(t){return"    "+t}).join("\n")),c.join("\n")}});bk(Rk);var Ok=wk(function(t,e){var n,r=yk&&yk.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),o=yk&&yk.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},i=yk&&yk.__generator||function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var a=Ak,s=function(){function t(t,e,n){var r=this;if(this.dtype=e,this.shape=t.slice(),this.size=Ak.sizeFromShape(t),null!=n){var o=n.length;Ak.assert(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+r.size+"'."})}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Ak.getArrayFromDType(e,Ak.sizeFromShape(this.shape)),this.strides=a.computeStrides(t)}return t.prototype.set=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),Ak.assert(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+e.rank+")"});var o=this.locToIndex(n);this.values[o]=t},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];0===t.length&&(t=[0]);for(var n=t[t.length-1],r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return this.values[n]},t.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},t.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return p.make(this.shape,{values:this.values},this.dtype)},t}();e.TensorBuffer=s;var u=null,l=null,c=null;e.setTensorTracker=function(t){u=t},e.setOpHandler=function(t){l=t},e.setDeprecationWarningFn=function(t){c=t};var p=function(){function t(t,e,n,r,o){this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=Ak.sizeFromShape(t),this.strides=a.computeStrides(t),this.dataId=null!=r?r:{},this.id=u().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",u().registerTensor(this,o),null!=n&&u().write(this.dataId,n)}return t.make=function(e,n,r,o){return new t(e,r,n.values,n.dataId,o)},t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),Ak.assert(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},t.prototype.as3D=function(t,e,n){return this.throwIfDisposed(),this.reshape([t,e,n])},t.prototype.as4D=function(t,e,n,r){return this.throwIfDisposed(),this.reshape([t,e,n,r])},t.prototype.as5D=function(t,e,n,r,o){return this.throwIfDisposed(),this.reshape([t,e,n,r,o])},t.prototype.asType=function(t){return this.throwIfDisposed(),l.cast(this,t)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return o(this,void 0,void 0,function(){var t;return i(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,l.buffer(this.shape,this.dtype,t)]}})})},t.prototype.bufferSync=function(){return l.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return o(this,void 0,void 0,function(){var t;return i(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,a.toNestedArray(this.shape,t)]}})})},t.prototype.arraySync=function(){return a.toNestedArray(this.shape,this.dataSync())},t.prototype.data=function(){return o(this,void 0,void 0,function(){return i(this,function(t){return this.throwIfDisposed(),[2,u().read(this.dataId)]})})},t.prototype.dataSync=function(){return this.throwIfDisposed(),u().readSync(this.dataId)},t.prototype.dispose=function(){this.isDisposed||(u().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(t){return void 0===t&&(t=!1),l.print(this,t)},t.prototype.reshape=function(t){return this.throwIfDisposed(),l.reshape(this,t)},t.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},t.prototype.expandDims=function(t){return void 0===t&&(t=0),l.expandDims(this,t)},t.prototype.cumsum=function(t,e,n){return void 0===t&&(t=0),void 0===e&&(e=!1),void 0===n&&(n=!1),l.cumsum(this,t,e,n)},t.prototype.squeeze=function(t){return this.throwIfDisposed(),l.squeeze(this,t)},t.prototype.clone=function(){return this.throwIfDisposed(),l.clone(this)},t.prototype.oneHot=function(t,e,n){return this.throwIfDisposed(),l.oneHot(this,t,e,n)},t.prototype.toString=function(t){void 0===t&&(t=!1);var e=this.dataSync();return Rk.tensorToString(e,this.shape,this.dtype,t)},t.prototype.tile=function(t){return this.throwIfDisposed(),l.tile(this,t)},t.prototype.gather=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),l.gather(this,t,e)},t.prototype.matMul=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=!1),this.throwIfDisposed(),l.matMul(this,t,e,n)},t.prototype.dot=function(t){return this.throwIfDisposed(),l.dot(this,t)},t.prototype.norm=function(t,e,n){return void 0===t&&(t="euclidean"),void 0===e&&(e=null),void 0===n&&(n=!1),this.throwIfDisposed(),l.norm(this,t,e,n)},t.prototype.slice=function(t,e){return this.throwIfDisposed(),l.slice(this,t,e)},t.prototype.reverse=function(t){return this.throwIfDisposed(),l.reverse(this,t)},t.prototype.concat=function(e,n){return void 0===n&&(n=0),this.throwIfDisposed(),e instanceof t&&(e=[e]),l.concat([this].concat(e),n)},t.prototype.split=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),l.split(this,t,e)},t.prototype.stack=function(t,e){return void 0===e&&(e=0),l.stack([this,t],e)},t.prototype.unstack=function(t){return void 0===t&&(t=0),l.unstack(this,t)},t.prototype.pad=function(t,e){return void 0===e&&(e=0),l.pad(this,t,e)},t.prototype.batchNormalization=function(t,e,n,r,o){return void 0===n&&(n=.001),c("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,o,r,n)},t.prototype.batchNorm=function(t,e,n,r,o){return void 0===o&&(o=.001),this.throwIfDisposed(),l.batchNorm(this,t,e,n,r,o)},t.prototype.all=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),l.all(this,t,e)},t.prototype.any=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),l.any(this,t,e)},t.prototype.logSumExp=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),l.logSumExp(this,t,e)},t.prototype.sum=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),l.sum(this,t,e)},t.prototype.prod=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),l.prod(this,t,e)},t.prototype.mean=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),l.mean(this,t,e)},t.prototype.min=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),l.min(this,t,e)},t.prototype.max=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),l.max(this,t,e)},t.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),l.argMin(this,t)},t.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),l.argMax(this,t)},t.prototype.cast=function(t){return this.throwIfDisposed(),l.cast(this,t)},t.prototype.add=function(t){return this.throwIfDisposed(),l.add(this,t)},t.prototype.addStrict=function(t){return this.throwIfDisposed(),l.addStrict(this,t)},t.prototype.atan2=function(t){return this.throwIfDisposed(),l.atan2(this,t)},t.prototype.sub=function(t){return this.throwIfDisposed(),l.sub(this,t)},t.prototype.subStrict=function(t){return this.throwIfDisposed(),l.subStrict(this,t)},t.prototype.pow=function(t){return this.throwIfDisposed(),l.pow(this,t)},t.prototype.powStrict=function(t){return this.throwIfDisposed(),l.powStrict(this,t)},t.prototype.mul=function(t){return this.throwIfDisposed(),l.mul(this,t)},t.prototype.mulStrict=function(t){return this.throwIfDisposed(),l.mulStrict(this,t)},t.prototype.div=function(t){return this.throwIfDisposed(),l.div(this,t)},t.prototype.floorDiv=function(t){return this.throwIfDisposed(),l.floorDiv(this,t)},t.prototype.divStrict=function(t){return this.throwIfDisposed(),l.divStrict(this,t)},t.prototype.minimum=function(t){return this.throwIfDisposed(),l.minimum(this,t)},t.prototype.minimumStrict=function(t){return this.throwIfDisposed(),l.minimumStrict(this,t)},t.prototype.maximum=function(t){return this.throwIfDisposed(),l.maximum(this,t)},t.prototype.maximumStrict=function(t){return this.throwIfDisposed(),l.maximumStrict(this,t)},t.prototype.mod=function(t){return this.throwIfDisposed(),l.mod(this,t)},t.prototype.modStrict=function(t){return this.throwIfDisposed(),l.modStrict(this,t)},t.prototype.squaredDifference=function(t){return this.throwIfDisposed(),l.squaredDifference(this,t)},t.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),l.squaredDifferenceStrict(this,t)},t.prototype.transpose=function(t){return this.throwIfDisposed(),l.transpose(this,t)},t.prototype.notEqual=function(t){return this.throwIfDisposed(),l.notEqual(this,t)},t.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),l.notEqualStrict(this,t)},t.prototype.less=function(t){return this.throwIfDisposed(),l.less(this,t)},t.prototype.lessStrict=function(t){return this.throwIfDisposed(),l.lessStrict(this,t)},t.prototype.equal=function(t){return this.throwIfDisposed(),l.equal(this,t)},t.prototype.equalStrict=function(t){return this.throwIfDisposed(),l.equalStrict(this,t)},t.prototype.lessEqual=function(t){return this.throwIfDisposed(),l.lessEqual(this,t)},t.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),l.lessEqualStrict(this,t)},t.prototype.greater=function(t){return this.throwIfDisposed(),l.greater(this,t)},t.prototype.greaterStrict=function(t){return this.throwIfDisposed(),l.greaterStrict(this,t)},t.prototype.greaterEqual=function(t){return this.throwIfDisposed(),l.greaterEqual(this,t)},t.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),l.greaterEqualStrict(this,t)},t.prototype.logicalAnd=function(t){return this.throwIfDisposed(),l.logicalAnd(this,t)},t.prototype.logicalOr=function(t){return this.throwIfDisposed(),l.logicalOr(this,t)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),l.logicalNot(this)},t.prototype.logicalXor=function(t){return this.throwIfDisposed(),l.logicalXor(this,t)},t.prototype.where=function(t,e){return this.throwIfDisposed(),l.where(t,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),l.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),l.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),l.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),l.sign(this)},t.prototype.exp=function(){return this.throwIfDisposed(),l.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),l.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),l.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),l.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),l.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),l.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),l.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),l.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),l.abs(this)},t.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),l.clipByValue(this,t,e)},t.prototype.relu=function(){return this.throwIfDisposed(),l.relu(this)},t.prototype.elu=function(){return this.throwIfDisposed(),l.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),l.selu(this)},t.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),l.leakyRelu(this,t)},t.prototype.prelu=function(t){return this.throwIfDisposed(),l.prelu(this,t)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),l.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),l.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),l.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),l.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),l.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),l.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),l.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),l.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),l.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),l.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),l.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),l.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),l.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),l.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),l.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),l.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),l.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),l.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),l.round(this)},t.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),l.step(this,t)},t.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),l.softmax(this,t)},t.prototype.logSoftmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),l.logSoftmax(this,t)},t.prototype.resizeBilinear=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),l.image.resizeBilinear(this,t,e)},t.prototype.resizeNearestNeighbor=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),l.image.resizeNearestNeighbor(this,t,e)},t.prototype.conv1d=function(t,e,n,r,o,i){return void 0===r&&(r="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),l.conv1d(this,t,e,n,r,o,i)},t.prototype.conv2d=function(t,e,n,r,o,i){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),l.conv2d(this,t,e,n,r,o,i)},t.prototype.conv2dTranspose=function(t,e,n,r,o){return this.throwIfDisposed(),l.conv2dTranspose(this,t,e,n,r,o)},t.prototype.depthwiseConv2D=function(t,e,n,r,o,i){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),l.depthwiseConv2d(this,t,e,n,r,o,i)},t.prototype.separableConv2d=function(t,e,n,r,o,i){return void 0===o&&(o=[1,1]),void 0===i&&(i="NHWC"),this.throwIfDisposed(),l.separableConv2d(this,t,e,n,r,o,i)},t.prototype.avgPool=function(t,e,n,r){return this.throwIfDisposed(),l.avgPool(this,t,e,n,r)},t.prototype.maxPool=function(t,e,n,r){return this.throwIfDisposed(),l.maxPool(this,t,e,n,r)},t.prototype.localResponseNormalization=function(t,e,n,r){return void 0===t&&(t=5),void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=.5),l.localResponseNormalization(this,t,e,n,r)},t.prototype.pool=function(t,e,n,r,o){return this.throwIfDisposed(),l.pool(this,t,e,n,r,o)},t.prototype.variable=function(t,e,n){return void 0===t&&(t=!0),this.throwIfDisposed(),h.variable(this,t,e,n)},t.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),l.unsortedSegmentSum(this,t,e)},t.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),l.batchToSpaceND(this,t,e)},t.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),l.spaceToBatchND(this,t,e)},t.prototype.topk=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=!0),this.throwIfDisposed(),l.topk(this,t,e)},t.prototype.stridedSlice=function(t,e,n,r,o,i,a,s){return void 0===r&&(r=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),this.throwIfDisposed(),l.stridedSlice(this,t,e,n,r,o,i,a,s)},t.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),l.depthToSpace(this,t,e)},t.prototype.fft=function(){return this.throwIfDisposed(),l.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),l.spectral.ifft(this)},t.prototype.rfft=function(){return this.throwIfDisposed(),l.spectral.rfft(this)},t.prototype.irfft=function(){return this.throwIfDisposed(),l.spectral.irfft(this)},t}();e.Tensor=p,Object.defineProperty(p,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.dataId&&null!=t.shape&&null!=t.dtype}});var h=function(t){function e(e,n,r){void 0===n&&(n=!0);var o=t.call(this,e.shape,e.dtype,null,e.dataId)||this;o.trainable=n,o.name=r,null==o.name&&(o.name=u().nextVariableId().toString());try{u().registerVariable(o)}catch(t){throw u().disposeTensor(o),t}return o}return r(e,t),e.variable=function(t,n,r,o){return void 0===n&&(n=!0),null!=o&&o!==t.dtype&&(t=t.asType(o)),new e(t,n,r)},e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!Ak.arraysEqual(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");u().disposeTensor(this),this.dataId=t.dataId,u().registerTensor(this)},e}(p);e.Variable=h,Object.defineProperty(h,Symbol.hasInstance,{value:function(t){return t instanceof p&&null!=t.assign&&t.assign instanceof Function}}),e.variable=h.variable});bk(Ok);var Dk=wk(function(t,e){var n,r,o,i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(e.Rank||(e.Rank={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(n||(n={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(r||(r={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(o||(o={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(i||(i={}));var a={float32:o,int32:n,bool:r,complex64:i};function s(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error("Can not upcast "+t+" with "+e)}return a[t][e]}e.upcastType=s,e.sumOutType=function(t){return s(t,"int32")}});bk(Dk);var Mk=wk(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.makeTypesMatch=function(t,e){if(t.dtype===e.dtype)return[t,e];var n=Dk.upcastType(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]},e.assertTypesMatch=function(t,e){Ak.assert(t.dtype===e.dtype,function(){return"The dtypes of the first("+t.dtype+") and second("+e.dtype+") input must match"})},e.isTensorInList=function(t,e){for(var n=0;n<e.length;n++)if(e[n].id===t.id)return!0;return!1},e.flattenNameArrayMap=function(t,e){var n=[];if(t instanceof Ok.Tensor)n.push(t);else for(var r=t,o=0;o<e.length;o++)n.push(r[e[o]]);return n},e.unflattenToNameArrayMap=function(t,e){if(t.length!==e.length)throw new Error("Cannot unflatten Tensor[], keys and arrays are not of same length.");for(var n={},r=0;r<t.length;r++)n[t[r]]=e[r];return n},e.getTensorsInContainer=function(t){var e=[];return function t(e,n,r){if(null!=e)if(e instanceof Ok.Tensor)n.push(e);else if(o=e,Array.isArray(o)||"object"==typeof o){var o,i=e;for(var a in i){var s=i[a];r.has(s)||(r.add(s),t(s,n,r))}}}(t,e,new Set),e}});bk(Mk);var Pk=Mk.isTensorInList,Lk=Mk.getTensorsInContainer,Fk=function(t){return t instanceof Buffer},zk=wk(function(t){t.exports="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}),Bk=wk(function(t){try{if("function"!=typeof Uk.inherits)throw"";t.exports=Uk.inherits}catch($f){t.exports=zk}}),Uk=wk(function(t,e){var n=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),n={},r=0;r<e.length;r++)n[e[r]]=Object.getOwnPropertyDescriptor(t,e[r]);return n},r=/%[sdj%]/g;e.format=function(t){if(!g(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(a(arguments[n]));return e.join(" ")}n=1;for(var o=arguments,i=o.length,s=String(t).replace(r,function(t){if("%%"===t)return"%";if(n>=i)return t;switch(t){case"%s":return String(o[n++]);case"%d":return Number(o[n++]);case"%j":try{return JSON.stringify(o[n++])}catch(t){return"[Circular]"}default:return t}}),u=o[n];n<i;u=o[++n])d(u)||!b(u)?s+=" "+u:s+=" "+a(u);return s},e.deprecate=function(t,n){if("undefined"!=typeof process&&!0===process.noDeprecation)return t;if("undefined"==typeof process)return function(){return e.deprecate(t,n).apply(this,arguments)};var r=!1;return function(){if(!r){if(process.throwDeprecation)throw new Error(n);process.traceDeprecation?console.trace(n):console.error(n),r=!0}return t.apply(this,arguments)}};var o,i={};function a(t,n){var r={seen:[],stylize:u};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),f(n)?r.showHidden=n:n&&e._extend(r,n),v(r.showHidden)&&(r.showHidden=!1),v(r.depth)&&(r.depth=2),v(r.colors)&&(r.colors=!1),v(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=s),l(r,t,r.depth)}function s(t,e){var n=a.styles[e];return n?"\x1b["+a.colors[n][0]+"m"+t+"\x1b["+a.colors[n][1]+"m":t}function u(t,e){return t}function l(t,n,r){if(t.customInspect&&n&&S(n.inspect)&&n.inspect!==e.inspect&&(!n.constructor||n.constructor.prototype!==n)){var o=n.inspect(r,t);return g(o)||(o=l(t,o,r)),o}var i=function(t,e){if(v(e))return t.stylize("undefined","undefined");if(g(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}return m(e)?t.stylize(""+e,"number"):f(e)?t.stylize(""+e,"boolean"):d(e)?t.stylize("null","null"):void 0}(t,n);if(i)return i;var a=Object.keys(n),s=function(t){var e={};return a.forEach(function(t,n){e[t]=!0}),e}();if(t.showHidden&&(a=Object.getOwnPropertyNames(n)),x(n)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return c(n);if(0===a.length){if(S(n))return t.stylize("[Function"+(n.name?": "+n.name:"")+"]","special");if(y(n))return t.stylize(RegExp.prototype.toString.call(n),"regexp");if(w(n))return t.stylize(Date.prototype.toString.call(n),"date");if(x(n))return c(n)}var u,b="",C=!1,E=["{","}"];return h(n)&&(C=!0,E=["[","]"]),S(n)&&(b=" [Function"+(n.name?": "+n.name:"")+"]"),y(n)&&(b=" "+RegExp.prototype.toString.call(n)),w(n)&&(b=" "+Date.prototype.toUTCString.call(n)),x(n)&&(b=" "+c(n)),0!==a.length||C&&0!=n.length?r<0?y(n)?t.stylize(RegExp.prototype.toString.call(n),"regexp"):t.stylize("[Object]","special"):(t.seen.push(n),u=C?function(t,e,n,r,o){for(var i=[],a=0,s=e.length;a<s;++a)_(e,String(a))?i.push(p(t,e,n,r,String(a),!0)):i.push("");return o.forEach(function(o){o.match(/^\d+$/)||i.push(p(t,e,n,r,o,!0))}),i}(t,n,r,s,a):a.map(function(e){return p(t,n,r,s,e,C)}),t.seen.pop(),function(t,e,n){return t.reduce(function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1]:n[0]+e+" "+t.join(", ")+" "+n[1]}(u,b,E)):E[0]+b+E[1]}function c(t){return"["+Error.prototype.toString.call(t)+"]"}function p(t,e,n,r,o,i){var a,s,u;if((u=Object.getOwnPropertyDescriptor(e,o)||{value:e[o]}).get?s=t.stylize(u.set?"[Getter/Setter]":"[Getter]","special"):u.set&&(s=t.stylize("[Setter]","special")),_(r,o)||(a="["+o+"]"),s||(t.seen.indexOf(u.value)<0?(s=d(n)?l(t,u.value,null):l(t,u.value,n-1)).indexOf("\n")>-1&&(s=i?s.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+s.split("\n").map(function(t){return"   "+t}).join("\n")):s=t.stylize("[Circular]","special")),v(a)){if(i&&o.match(/^\d+$/))return s;(a=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=t.stylize(a,"string"))}return a+": "+s}function h(t){return Array.isArray(t)}function f(t){return"boolean"==typeof t}function d(t){return null===t}function m(t){return"number"==typeof t}function g(t){return"string"==typeof t}function v(t){return void 0===t}function y(t){return b(t)&&"[object RegExp]"===C(t)}function b(t){return"object"==typeof t&&null!==t}function w(t){return b(t)&&"[object Date]"===C(t)}function x(t){return b(t)&&("[object Error]"===C(t)||t instanceof Error)}function S(t){return"function"==typeof t}function C(t){return Object.prototype.toString.call(t)}function E(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(v(o)&&(o=process.env.NODE_DEBUG||""),t=t.toUpperCase(),!i[t])if(new RegExp("\\b"+t+"\\b","i").test(o)){var n=process.pid;i[t]=function(){var r=e.format.apply(e,arguments);console.error("%s %d: %s",t,n,r)}}else i[t]=function(){};return i[t]},e.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=h,e.isBoolean=f,e.isNull=d,e.isNullOrUndefined=function(t){return null==t},e.isNumber=m,e.isString=g,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=v,e.isRegExp=y,e.isObject=b,e.isDate=w,e.isError=x,e.isFunction=S,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=Fk;var N=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function _(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){var t,n;console.log("%s - %s",(n=[E((t=new Date).getHours()),E(t.getMinutes()),E(t.getSeconds())].join(":"),[t.getDate(),N[t.getMonth()],n].join(" ")),e.format.apply(e,arguments))},e.inherits=Bk,e._extend=function(t,e){if(!e||!b(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t};var I="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function T(t,e){if(!t){var n=new Error("Promise was rejected with a falsy value");n.reason=t,t=n}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(I&&t[I]){var e;if("function"!=typeof(e=t[I]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,I,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,n,r=new Promise(function(t,r){e=t,n=r}),o=[],i=0;i<arguments.length;i++)o.push(arguments[i]);o.push(function(t,r){t?n(t):e(r)});try{t.apply(this,o)}catch(t){n(t)}return r}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),I&&Object.defineProperty(e,I,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,n(t))},e.promisify.custom=I,e.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function e(){for(var e=[],n=0;n<arguments.length;n++)e.push(arguments[n]);var r=e.pop();if("function"!=typeof r)throw new TypeError("The last argument must be of type Function");var o=this,i=function(){return r.apply(o,arguments)};t.apply(this,e).then(function(t){process.nextTick(i,null,t)},function(t){process.nextTick(T,t,i)})}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),Object.defineProperties(e,n(t)),e}}),Vk=Uk.isPrimitive;function jk(t,e,n,r){if(void 0===n&&(n=new Map),void 0===r&&(r=new Set),null==t)return null;if(r.has(t))throw new Error("Circular references are not supported.");if(n.has(t))return n.get(t);var o=e(t);if(o.recurse&&null!==o.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(o.recurse){if(qk(t)){var i=Array.isArray(t)?[]:{};for(var a in r.add(t),t){var s=jk(t[a],e,n,r);i[a]=s}return r.delete(t),i}throw new Error("Can't recurse into non-iterable type: "+t)}return n.set(t,o.value),o.value}function Wk(t){return null===t?null:qk(t[0])?{value:null,recurse:!0}:{value:t,recurse:!1}}function Hk(t,e){return gk(this,void 0,void 0,function(){var n,r,o,i,a,s;return vk(this,function(u){switch(u.label){case 0:n=new Map,jk(t,e,n),r=0,o=Array.from(n.keys()),u.label=1;case 1:return r<o.length?(a=n.get(i=o[r]))instanceof Promise?[4,a]:[3,3]:[3,4];case 2:s=u.sent(),n.set(i,s),u.label=3;case 3:return r++,[3,1];case 4:return[2,jk(t,e,n)]}})})}function qk(t){return null!=t&&(Array.isArray(t)||"object"==typeof t&&!(t instanceof Vf))}var Gk=function(){function t(t){if(this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return t.prototype.wrap=function(t){for(;t<0;)t+=this.doubledCapacity;return t%this.doubledCapacity},t.prototype.get=function(t){if(t<0)throw new RangeError("Can't get item at a negative index.");return this.data[t%this.capacity]},t.prototype.set=function(t,e){if(t<0)throw new RangeError("Can't set item at a negative index.");this.data[t%this.capacity]=e},t.prototype.length=function(){var t=this.end-this.begin;return t<0&&(t=this.doubledCapacity+t),t},t.prototype.isFull=function(){return this.length()===this.capacity},t.prototype.isEmpty=function(){return 0===this.length()},t.prototype.push=function(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,t),this.end=this.wrap(this.end+1)},t.prototype.pushAll=function(t){for(var e=0,n=t;e<n.length;e++)this.push(n[e])},t.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var t=this.get(this.end);return this.set(this.end,void 0),t},t.prototype.unshift=function(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,t)},t.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),t},t.prototype.shuffleExcise=function(t){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.wrap(this.begin+t),n=this.get(e);return this.set(e,this.pop()),n},t}(),Kk=function(t){function e(){return t.call(this,e.INITIAL_CAPACITY)||this}return mk(e,t),e.prototype.isFull=function(){return!1},e.prototype.push=function(e){t.prototype.isFull.call(this)&&this.expand(),t.prototype.push.call(this,e)},e.prototype.unshift=function(e){t.prototype.isFull.call(this)&&this.expand(),t.prototype.unshift.call(this,e)},e.prototype.expand=function(){for(var t=2*this.capacity,e=new Array(t),n=this.length(),r=0;r<n;r++)e[r]=this.get(this.wrap(this.begin+r));this.data=e,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n},e.INITIAL_CAPACITY=32,e}(Gk);function $k(t){return new tR(t)}function Xk(t,e){return new pR(t,e)}var Zk,Yk,Qk=function(){function t(){}return t.prototype.collect=function(t,e){return void 0===t&&(t=1e3),void 0===e&&(e=100),gk(this,void 0,void 0,function(){var n,r,o,i;return vk(this,function(a){switch(a.label){case 0:return n=e>0?this.prefetch(e):this,r=[],o=0,[4,n.next()];case 1:i=a.sent(),a.label=2;case 2:return i.done?[3,4]:(r.push(i.value),++o>=t?[2,r]:[4,n.next()]);case 3:return i=a.sent(),[3,2];case 4:return[2,r]}})})},t.prototype.resolveFully=function(){return gk(this,void 0,void 0,function(){var t;return vk(this,function(e){switch(e.label){case 0:return[4,this.next()];case 1:t=e.sent(),e.label=2;case 2:return t.done?[3,4]:[4,this.next()];case 3:return t=e.sent(),[3,2];case 4:return[2]}})})},t.prototype.resolveWhile=function(t){return gk(this,void 0,void 0,function(){var e,n;return vk(this,function(r){switch(r.label){case 0:return[4,this.next()];case 1:e=r.sent(),n=t(e.value),r.label=2;case 2:return e.done||!n?[3,4]:[4,this.next()];case 3:return e=r.sent(),n=t(e.value),[3,2];case 4:return[2]}})})},t.prototype.handleErrors=function(t){return new sR(this,t)},t.prototype.filter=function(t){return new iR(this,t)},t.prototype.map=function(t){return new aR(this,t)},t.prototype.mapAsync=function(t){return new uR(this,t)},t.prototype.serialMapAsync=function(t){return new uR(this,t).serial()},t.prototype.flatmap=function(t){return new cR(this,t)},t.prototype.forEachAsync=function(t){return gk(this,void 0,void 0,function(){return vk(this,function(e){return[2,this.map(t).resolveFully()]})})},t.prototype.serialForEach=function(t){return gk(this,void 0,void 0,function(){return vk(this,function(e){return[2,this.serialMapAsync(t).resolveWhile(function(t){return!0===t})]})})},t.prototype.rowMajorBatch=function(t,e){return void 0===e&&(e=!0),new oR(this,t,e)},t.prototype.columnMajorBatch=function(t,e,n){return void 0===e&&(e=!0),void 0===n&&(n=Wk),this.rowMajorBatch(t,e).map(function(t){return function(t,e){return void 0===e&&(e=Wk),function t(e,n,r){void 0===r&&(r=new Set);var o=e[0];if(r.has(o))throw new Error("Circular references are not supported.");var i=n(e);if(i.recurse&&null!==i.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(i.recurse){if(qk(o)){var a=Array.isArray(o)?[]:{};r.add(o);var s=function(o){var i=t(e.map(function(t){return t[o]}),n,r);a[o]=i};for(var u in o)s(u);return r.delete(o),a}throw new Error("Can't recurse into non-iterable type: "+o)}return i.value}(t,e)}(t,n)})},t.prototype.concatenate=function(t,e){return new pR(function(t){return new Jk(t)}([this,t]),e)},t.prototype.take=function(t){return t<0||null==t?this:new rR(this,t)},t.prototype.skip=function(t){return t<0||null==t?this:new nR(this,t)},t.prototype.prefetch=function(t){return new hR(this,t)},t.prototype.shuffle=function(t,e){return new fR(this,t,e)},t.prototype.serial=function(){return new eR(this)},t}(),Jk=function(t){function e(e){var n=t.call(this)||this;return n.items=e,n.trav=0,n}return mk(e,t),e.prototype.summary=function(){return"Array of "+this.items.length+" items"},e.prototype.next=function(){return gk(this,void 0,void 0,function(){var t,e;return vk(this,function(n){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(e=(t=this.items[this.trav])instanceof Vf?Vy(t):t,this.trav++,[2,{value:e,done:!1}])})})},e}(Qk),tR=function(t){function e(e){var n=t.call(this)||this;return n.nextFn=e,n}return mk(e,t),e.prototype.summary=function(){return"Function call"},e.prototype.next=function(){return gk(this,void 0,void 0,function(){return vk(this,function(t){try{return[2,this.nextFn()]}catch(t){throw t.message="Error thrown while iterating through a dataset: "+t.message,t}return[2]})})},e}(Qk),eR=function(t){function e(e){var n=t.call(this)||this;return n.upstream=e,n.lastRead=Promise.resolve({value:null,done:!1}),n}return mk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Serial"},e.prototype.next=function(){return gk(this,void 0,void 0,function(){var t=this;return vk(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return gk(this,void 0,void 0,function(){return vk(this,function(t){return[2,this.upstream.next()]})})},e}(Qk),nR=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.maxCount=n,r.count=0,r.lastRead=Promise.resolve({value:null,done:!1}),r}return mk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Skip"},e.prototype.next=function(){return gk(this,void 0,void 0,function(){var t=this;return vk(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return gk(this,void 0,void 0,function(){var t;return vk(this,function(e){switch(e.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return(t=e.sent()).done?[2,t]:(bd(t.value),[3,0]);case 2:return[2,this.upstream.next()]}})})},e}(Qk),rR=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.maxCount=n,r.count=0,r}return mk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Take"},e.prototype.next=function(){return gk(this,void 0,void 0,function(){return vk(this,function(t){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]})})},e}(Qk),oR=function(t){function e(e,n,r){void 0===r&&(r=!0);var o=t.call(this)||this;return o.upstream=e,o.batchSize=n,o.enableSmallLastBatch=r,o.lastRead=Promise.resolve({value:null,done:!1}),o}return mk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> RowMajorBatch"},e.prototype.next=function(){return gk(this,void 0,void 0,function(){var t=this;return vk(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return gk(this,void 0,void 0,function(){var t,e;return vk(this,function(n){switch(n.label){case 0:t=[],n.label=1;case 1:return t.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return(e=n.sent()).done?this.enableSmallLastBatch&&t.length>0?[2,{value:t,done:!1}]:[2,{value:null,done:!0}]:(t.push(e.value),[3,1]);case 3:return[2,{value:t,done:!1}]}})})},e}(Qk),iR=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.predicate=n,r.lastRead=Promise.resolve({value:null,done:!1}),r}return mk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Filter"},e.prototype.next=function(){return gk(this,void 0,void 0,function(){var t=this;return vk(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return gk(this,void 0,void 0,function(){var t;return vk(this,function(e){switch(e.label){case 0:return[4,this.upstream.next()];case 1:return(t=e.sent()).done||this.predicate(t.value)?[2,t]:(bd(t.value),[3,0]);case 2:return[2]}})})},e}(Qk),aR=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.transform=n,r}return mk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Map"},e.prototype.next=function(){return gk(this,void 0,void 0,function(){var t,e,n,r,o,i,a;return vk(this,function(s){switch(s.label){case 0:return[4,this.upstream.next()];case 1:if((t=s.sent()).done)return[2,{value:null,done:!0}];for(e=Lk(t.value),n=this.transform(t.value),r=Lk(n),o=0,i=e;o<i.length;o++)Pk(a=i[o],r)||a.dispose();return[2,{value:n,done:!1}]}})})},e}(Qk),sR=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.handler=n,r.count=0,r.lastRead=Promise.resolve({value:null,done:!1}),r}return mk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> handleErrors"},e.prototype.next=function(){return gk(this,void 0,void 0,function(){var t=this;return vk(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return gk(this,void 0,void 0,function(){var t;return vk(this,function(e){switch(e.label){case 0:e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,e.sent()];case 3:return t=e.sent(),this.handler(t)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}})})},e}(Qk),uR=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.transform=n,r}return mk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> AsyncMap"},e.prototype.next=function(){return gk(this,void 0,void 0,function(){var t,e,n,r,o,i,a;return vk(this,function(s){switch(s.label){case 0:return[4,this.upstream.next()];case 1:return(t=s.sent()).done?[2,{value:null,done:!0}]:(e=Lk(t.value),[4,this.transform(t.value)]);case 2:for(n=s.sent(),r=Lk(n),o=0,i=e;o<i.length;o++)Pk(a=i[o],r)||a.dispose();return[2,{value:n,done:!1}]}})})},e}(Qk),lR=function(t){function e(){var e=t.call(this)||this;return e.outputQueue=new Kk,e.lastRead=Promise.resolve({value:null,done:!1}),e}return mk(e,t),e.prototype.next=function(){return gk(this,void 0,void 0,function(){var t=this;return vk(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return gk(this,void 0,void 0,function(){return vk(this,function(t){switch(t.label){case 0:return 0!==this.outputQueue.length()?[3,2]:[4,this.pump()];case 1:return t.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}})})},e}(Qk),cR=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.transform=n,r}return mk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Flatmap"},e.prototype.pump=function(){return gk(this,void 0,void 0,function(){var t,e,n,r,o,i,a;return vk(this,function(s){switch(s.label){case 0:return[4,this.upstream.next()];case 1:if((t=s.sent()).done)return[2,!1];for(e=Lk(t.value),n=this.transform(t.value),r=Lk(n),this.outputQueue.pushAll(n),o=0,i=e;o<i.length;o++)Pk(a=i[o],r)||a.dispose();return[2,!0]}})})},e}(lR),pR=function(t){function e(e,n){var r=t.call(this)||this;return r.baseErrorHandler=n,r.lastRead=null,r.iterator=null,r.moreIterators=e,r}return mk(e,t),e.prototype.summary=function(){return"TODO: fill in upstream of chained summaries -> Chained"},e.prototype.next=function(){return gk(this,void 0,void 0,function(){return vk(this,function(t){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]})})},e.prototype.readFromChain=function(t){return gk(this,void 0,void 0,function(){var e,n;return vk(this,function(r){switch(r.label){case 0:return[4,t];case 1:return r.sent(),null!=this.iterator?[3,3]:[4,this.moreIterators.next()];case 2:if((e=r.sent()).done)return[2,{value:null,done:!0}];this.iterator=e.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),r.label=3;case 3:return[4,this.iterator.next()];case 4:return(n=r.sent()).done?(this.iterator=null,[2,this.readFromChain(t)]):[2,n]}})})},e}(Qk);(Yk=Zk||(Zk={}))[Yk.FAIL=0]="FAIL",Yk[Yk.SHORTEST=1]="SHORTEST",Yk[Yk.LONGEST=2]="LONGEST",function(t){function e(e,n){void 0===n&&(n=Zk.FAIL);var r=t.call(this)||this;return r.iterators=e,r.mismatchMode=n,r.count=0,r.currentPromise=null,r}mk(e,t),e.prototype.summary=function(){return"{TODO: fill in upstream of zip summaries} -> Zip"},e.prototype.nextState=function(t){return gk(this,void 0,void 0,function(){function e(t){return t instanceof Qk?{value:t.next().then(function(t){return n++,t.done&&r++,t.value}),recurse:!1}:{value:null,recurse:!0}}var n,r,o;return vk(this,function(i){switch(i.label){case 0:return[4,t];case 1:return i.sent(),n=0,r=0,[4,Hk(this.iterators,e)];case 2:if(o=i.sent(),n===r)return[2,{value:null,done:!0}];if(r>0)switch(this.mismatchMode){case Zk.FAIL:throw new Error("Zipped streams should have the same length. Mismatched at element "+this.count+".");case Zk.SHORTEST:return[2,{value:null,done:!0}]}return this.count++,[2,{value:o,done:!1}]}})})},e.prototype.next=function(){return gk(this,void 0,void 0,function(){return vk(this,function(t){switch(t.label){case 0:return this.currentPromise=this.nextState(this.currentPromise),[4,this.currentPromise];case 1:return[2,t.sent()]}})})}}(Qk);var hR=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.bufferSize=n,r.buffer=new Gk(n),r}return mk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Prefetch"},e.prototype.refill=function(){for(;!this.buffer.isFull();){var t=this.upstream.next();this.buffer.push(t)}},e.prototype.next=function(){return this.refill(),this.buffer.shift()},e}(Qk),fR=function(t){function e(e,n,r){var o=t.call(this,e,n)||this;return o.upstream=e,o.windowSize=n,o.upstreamExhausted=!1,o.random=Tk(r||Rf.now().toString()),o.lastRead=Promise.resolve({value:null,done:!1}),o}return mk(e,t),e.prototype.next=function(){return gk(this,void 0,void 0,function(){var t=this;return vk(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.randomInt=function(t){return Math.floor(this.random()*t)},e.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},e.prototype.serialNext=function(){return gk(this,void 0,void 0,function(){var t,e;return vk(this,function(n){switch(n.label){case 0:this.upstreamExhausted||this.refill(),n.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(t=this.chooseIndex(),[4,this.buffer.shuffleExcise(t)]);case 2:return(e=n.sent()).done?(this.upstreamExhausted=!0,[3,1]):(this.refill(),[2,e]);case 3:return[2,{value:null,done:!0}]}})})},e}(hR),dR=function(){function t(){this.size=null}return t.prototype.batch=function(t,e){var n=this;void 0===e&&(e=!0);var r=this;return Rf.assert(t>0,function(){return"batchSize needs to be positive, but it is\n      "+t}),mR(function(){return gk(n,void 0,void 0,function(){return vk(this,function(n){switch(n.label){case 0:return[4,r.iterator()];case 1:return[2,n.sent().columnMajorBatch(t,e,gR)]}})})},this.size===1/0||null==this.size?this.size:e?Math.ceil(this.size/t):Math.floor(this.size/t))},t.prototype.concatenate=function(t){var e=this,n=this;return mR(function(){return gk(e,void 0,void 0,function(){var e,r;return vk(this,function(o){switch(o.label){case 0:return[4,n.iterator()];case 1:return r=(e=o.sent()).concatenate,[4,t.iterator()];case 2:return[2,r.apply(e,[o.sent()])]}})})},this.size===1/0||t.size===1/0?1/0:null!=this.size&&null!=t.size?this.size+t.size:null)},t.prototype.filter=function(t){var e=this,n=this;return mR(function(){return gk(e,void 0,void 0,function(){return vk(this,function(e){switch(e.label){case 0:return[4,n.iterator()];case 1:return[2,e.sent().filter(function(e){return vd(function(){return t(e)})})]}})})},this.size===1/0?1/0:null)},t.prototype.forEachAsync=function(t){return gk(this,void 0,void 0,function(){return vk(this,function(e){switch(e.label){case 0:return[4,this.iterator()];case 1:return[2,e.sent().forEachAsync(t)]}})})},t.prototype.forEach=function(t){return gk(this,void 0,void 0,function(){return vk(this,function(e){return dd("dataset.forEach() is deprecated and will be removed. Please use dataset.forEachAsync() instead"),[2,this.forEachAsync(t)]})})},t.prototype.map=function(t){var e=this,n=this;return mR(function(){return gk(e,void 0,void 0,function(){return vk(this,function(e){switch(e.label){case 0:return[4,n.iterator()];case 1:return[2,e.sent().map(function(e){return vd(function(){return t(e)})})]}})})},this.size)},t.prototype.mapAsync=function(t){var e=this,n=this;return mR(function(){return gk(e,void 0,void 0,function(){return vk(this,function(e){switch(e.label){case 0:return[4,n.iterator()];case 1:return[2,e.sent().mapAsync(t)]}})})},this.size)},t.prototype.prefetch=function(t){var e=this;if(null==t)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var n=this;return mR(function(){return gk(e,void 0,void 0,function(){return vk(this,function(e){switch(e.label){case 0:return[4,n.iterator()];case 1:return[2,e.sent().prefetch(t)]}})})},this.size)},t.prototype.repeat=function(t){var e=this,n=this;return mR(function(){return gk(e,void 0,void 0,function(){var e=this;return vk(this,function(r){return[2,Xk($k(function(){return gk(e,void 0,void 0,function(){var t;return vk(this,function(e){switch(e.label){case 0:return t={},[4,n.iterator()];case 1:return[2,(t.value=e.sent(),t.done=!1,t)]}})})}).take(t))]})})},null!=this.size&&t>0?this.size*t:0===t?0:null!=this.size&&(void 0===t||t<0)?1/0:null)},t.prototype.skip=function(t){var e=this,n=this;return mR(function(){return gk(e,void 0,void 0,function(){return vk(this,function(e){switch(e.label){case 0:return[4,n.iterator()];case 1:return[2,e.sent().skip(t)]}})})},null!=this.size&&t>=0&&this.size>=t?this.size-t:null!=this.size&&(this.size<t||void 0===t||t<0)?0:null)},t.prototype.shuffle=function(t,e,n){var r=this;if(void 0===n&&(n=!0),null==t||t<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size ("+this.size+" elements)");var o=this,i=Tk(e||Rf.now().toString());return mR(function(){return gk(r,void 0,void 0,function(){var e;return vk(this,function(r){switch(r.label){case 0:return e=i.int32(),n&&(e+=i.int32()),[4,o.iterator()];case 1:return[2,r.sent().shuffle(t,e.toString())]}})})},this.size)},t.prototype.take=function(t){var e=this,n=this;return mR(function(){return gk(e,void 0,void 0,function(){return vk(this,function(e){switch(e.label){case 0:return[4,n.iterator()];case 1:return[2,e.sent().take(t)]}})})},null!=this.size&&this.size>t?t:null!=this.size&&this.size<=t?this.size:null)},t.prototype.toArray=function(){return gk(this,void 0,void 0,function(){return vk(this,function(t){switch(t.label){case 0:return[4,this.iterator()];case 1:return[2,t.sent().collect()]}})})},t.MAX_BUFFER_SIZE=1e4,t}();function mR(t,e){return void 0===e&&(e=null),new(function(n){function r(){var t=null!==n&&n.apply(this,arguments)||this;return t.size=e,t}return mk(r,n),r.prototype.iterator=function(){return gk(this,void 0,void 0,function(){return vk(this,function(e){return[2,t()]})})},r}(dR))}function gR(t){return null===t?null:function(t){return null==t||Vk(t)||Array.isArray(t)||"object"==typeof t&&t instanceof Vf||kk(t)}(t[0])?{value:vR(t),recurse:!1}:{value:null,recurse:!0}}function vR(t){if(0===t.length)throw new Error("Can't make a batch of zero elements.");return t[0]instanceof Vf?ib(t):Jd(t)}var yR=function(t){function e(e){var n=t.call(this)||this;return n.input=e,n}return mk(e,t),e.prototype.iterator=function(){return gk(this,void 0,void 0,function(){return vk(this,function(t){switch(t.label){case 0:return[4,this.input.iterator()];case 1:return[2,t.sent().decodeUTF8().split("\n")]}})})},e}(dR),bR=Symbol("out"),wR=Symbol("field"),xR=Symbol("quote"),SR=Symbol("quoteafterquote"),CR=Symbol("quoteinquote"),ER=(function(t){function e(e,n){var r=t.call(this)||this;return r.input=e,r.hasHeader=!0,r.fullColumnNames=null,r.columnNamesValidated=!1,r.columnConfigs=null,r.configuredColumnsOnly=!1,r.delimiter=",",r.base=new yR(e),n||(n={}),r.hasHeader=!1!==n.hasHeader,r.fullColumnNames=n.columnNames,r.columnConfigs=n.columnConfigs,r.configuredColumnsOnly=n.configuredColumnsOnly,r.delimiter=n.delimiter?n.delimiter:",",r}mk(e,t),e.prototype.columnNames=function(){return gk(this,void 0,void 0,function(){return vk(this,function(t){switch(t.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:t.sent(),t.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}})})},e.prototype.setColumnNames=function(){return gk(this,void 0,void 0,function(){var t,e,n,r,o,i,a=this;return vk(this,function(s){switch(s.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(t=s.sent(),!this.fullColumnNames&&!t)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&t&&Rf.assert(t.length===this.fullColumnNames.length,function(){return"The length of provided columnNames ("+a.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."}),this.fullColumnNames||(this.fullColumnNames=t),e=this.fullColumnNames.reduce(function(t,e){return t[e]=t[e]+1||1,t},{}),n=Object.keys(e).filter(function(t){return e[t]>1}),Rf.assert(0===n.length,function(){return"Duplicate column names found: "+n.toString()}),this.columnConfigs)for(r=0,o=Object.keys(this.columnConfigs);r<o.length;r++)if(-1===this.fullColumnNames.indexOf(i=o[r]))throw new Error('The key "'+i+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").");return this.columnNamesValidated=!0,[2]}})})},e.prototype.maybeReadHeaderLine=function(){return gk(this,void 0,void 0,function(){var t;return vk(this,function(e){switch(e.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return[4,e.sent().next()];case 2:if((t=e.sent()).done)throw new Error("No data was found for CSV parsing.");return[2,t.value.split(this.delimiter)];case 3:return[2,null]}})})},e.prototype.iterator=function(){return gk(this,void 0,void 0,function(){var t,e=this;return vk(this,function(n){switch(n.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:n.sent(),n.label=2;case 2:return[4,this.base.iterator()];case 3:return t=n.sent(),this.hasHeader&&(t=t.skip(1)),[2,t.map(function(t){return e.makeDataElement(t)})]}})})},e.prototype.makeDataElement=function(t){for(var e=this.parseRow(t),n={},r={},o=0;o<this.fullColumnNames.length;o++){var i=this.fullColumnNames[o],a=this.columnConfigs?this.columnConfigs[i]:null;if(!this.configuredColumnsOnly||a){var s=e[o],u=null;if(""===s)if(a&&void 0!==a.default)u=a.default;else{if(a&&(a.required||a.isLabel))throw new Error("Required column "+i+" is empty in this line: "+t);u=void 0}else{var l=Number(s);if(isNaN(l))u=a&&"bool"===a.dtype?this.getBoolean(s):s;else if(a&&a.dtype)switch(a.dtype){case"float32":u=l;break;case"int32":u=Math.floor(l);break;case"bool":u=this.getBoolean(s);break;default:u=l}else u=l}a&&a.isLabel?r[i]=u:n[i]=u}}return 0===Object.keys(r).length?n:{xs:n,ys:r}},e.prototype.getBoolean=function(t){return"1"===t||"true"===t.toLowerCase()?1:0},e.prototype.parseRow=function(t){for(var e=[],n=0,r=t.length,o=wR,i=0;i<r;i++)switch(o){case bR:switch(t.charAt(i)){case'"':n=i+1,o=xR;break;case this.delimiter:e.push(""),o=bR,n=i+1;break;default:o=wR,n=i}break;case wR:switch(t.charAt(i)){case this.delimiter:e.push(t.substring(n,i)),o=bR,n=i+1}break;case xR:switch(t.charAt(i)){case'"':o=SR}break;case SR:switch(t.charAt(i)){case this.delimiter:e.push(t.substring(n,i-1)),o=bR,n=i+1;break;case'"':o=xR;break;default:o=CR}break;case CR:switch(t.charAt(i)){case'"':o=xR}}return e.push(o===SR?t.substring(n,r-1):t.substring(n)),e}}(dR),function(){}),NR=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return mk(e,t),e.prototype.split=function(t){return new _R(this,t)},e}(Qk),_R=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.impl=new IR(e,n),r}return mk(e,t),e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return gk(this,void 0,void 0,function(){return vk(this,function(t){return[2,this.impl.next()]})})},e}(NR),IR=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.separator=n,r.carryover="",r}return mk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Split('"+this.separator+"')"},e.prototype.pump=function(){return gk(this,void 0,void 0,function(){var t,e,n,r;return vk(this,function(o){switch(o.label){case 0:return[4,this.upstream.next()];case 1:if((t=o.sent()).done)return""===this.carryover?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);for((e=t.value.split(this.separator))[0]=this.carryover+e[0],n=0,r=e.slice(0,-1);n<r.length;n++)this.outputQueue.push(r[n]);return this.carryover=e[e.length-1],[2,!0]}})})},e}(lR),TR=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return mk(e,t),e.prototype.decodeUTF8=function(){return new AR(this)},e}(Qk),AR=function(t){function e(e){var n=t.call(this)||this;return n.upstream=e,n.impl=new kR(e),n}return mk(e,t),e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return gk(this,void 0,void 0,function(){return vk(this,function(t){return[2,this.impl.next()]})})},e}(NR),kR=function(t){function e(e){var r=t.call(this)||this;if(r.upstream=e,md.get("IS_BROWSER"))r.decoder=new TextDecoder("utf-8");else{var o=n(1).StringDecoder;r.decoder=new o("utf8")}return r}return mk(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Utf8"},e.prototype.pump=function(){return gk(this,void 0,void 0,function(){var t,e,n;return vk(this,function(r){switch(r.label){case 0:return[4,this.upstream.next()];case 1:return(t=r.sent()).done?[2,!1]:(e=t.value,n=md.get("IS_BROWSER")?this.decoder.decode(e,{stream:!0}):this.decoder.write(Buffer.from(e.buffer)),this.outputQueue.push(n),[2,!0])}})})},e}(lR),RR=function(t){function e(e,n){void 0===n&&(n={});var r=t.call(this)||this;return r.file=e,r.options=n,Rf.assert(e instanceof Uint8Array||!!md.get("IS_BROWSER")&&(e instanceof File||e instanceof Blob),function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."}),r.offset=n.offset||0,r.chunkSize=n.chunkSize||1048576,r}return mk(e,t),e.prototype.summary=function(){return"FileChunks "+this.file},e.prototype.next=function(){return gk(this,void 0,void 0,function(){var t,e,n=this;return vk(this,function(r){switch(r.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(t=new Promise(function(t,e){var r=n.offset+n.chunkSize;if(n.file instanceof Uint8Array)t(new Uint8Array(n.file.slice(n.offset,r)));else{var o=new FileReader;o.onload=function(n){var r=o.result;if(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),!(r instanceof Uint8Array))return e(new TypeError("FileReader returned unknown type."));t(r)},o.onabort=function(t){return e(new Error("Aborted"))},o.onerror=function(t){return e(new Error(t.type))};var i=n.file.slice(n.offset,r);o.readAsArrayBuffer(i)}n.offset=r}),e={},[4,t]);case 1:return[2,(e.value=r.sent(),e.done=!1,e)]}})})},e}(TR);function OR(t,e){return void 0===e&&(e={}),gk(this,void 0,void 0,function(){var r,o,i,a;return vk(this,function(s){switch(s.label){case 0:return md.get("IS_BROWSER")?[4,fetch(t)]:[3,5];case 1:return(r=s.sent()).ok?[4,r.blob()]:[3,3];case 2:return o=s.sent(),[2,new RR(o,e)];case 3:throw new Error(r.statusText);case 4:return[3,9];case 5:if(i=n(2),"string"!=typeof t)throw new Error("URL must be a string. Request objects are not supported in the node.js environment yet.");return[4,i(t)];case 6:return(r=s.sent()).ok?[4,r.buffer()]:[3,8];case 7:return a=s.sent(),[2,new RR(a,e)];case 8:throw new Error(r.statusText);case 9:return[2]}})})}function DR(t){return"string"==typeof t&&"file://"===t.substr(0,7)}var MR=function(t){function e(e,n){void 0===n&&(n={});var r=t.call(this)||this;return r.input=e,r.options=n,r}return mk(e,t),e.prototype.iterator=function(){return gk(this,void 0,void 0,function(){var t;return vk(this,function(e){return DR(this.input)&&md.get("IS_NODE")&&(t=n(3),this.input=t.readFileSync(this.input.substr(7))),[2,new RR(this.input,this.options)]})})},e}(ER);!function(t){function e(e,n){void 0===n&&(n={});var r=t.call(this)||this;return r.url=e,r.fileOptions=n,r}mk(e,t),e.prototype.iterator=function(){return gk(this,void 0,void 0,function(){return vk(this,function(t){return DR(this.url)?[2,new MR(this.url,this.fileOptions).iterator()]:[2,OR(this.url,this.fileOptions)]})})}}(ER);var PR=new class{constructor(t){this.numClasses=t}addExample(t,e){const n=vd(()=>Ky(em([e]).toInt(),this.numClasses));if(null==this.xs)this.xs=yd(t),this.ys=yd(n);else{const e=this.xs;this.xs=yd(e.concat(t,0));const r=this.ys;this.ys=yd(r.concat(n,0)),e.dispose(),r.dispose(),n.dispose()}}}(2),LR=function(){function t(){this.showCat=!1,this.face1Img=document.getElementById("face1"),this.imgF1=OC.fromPixels(this.face1Img).toFloat().expandDims(0),this.face2Img=document.getElementById("face2"),this.imgF2=OC.fromPixels(this.face2Img).toFloat().expandDims(0),this.stopImg=document.getElementById("stop1"),this.imgS1=OC.fromPixels(this.stopImg).toFloat().expandDims(0),this.stop2Img=document.getElementById("stop2"),this.imgS2=OC.fromPixels(this.stop2Img).toFloat().expandDims(0)}return t.prototype.ngOnInit=function(){this.loadTruncatedMobileNet()},t.prototype.loadTruncatedMobileNet=function(){return u(this,void 0,void 0,function(){var t,e;return l(this,function(n){switch(n.label){case 0:return[4,OI("https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_0.25_224/model.json")];case 1:return t=n.sent(),e=t.getLayer("conv_pw_13_relu"),this.truncatedMnet=new AI({inputs:t.inputs,outputs:e.output}),console.log("model loaded"),[2]}})})},t.prototype.train=function(){return u(this,void 0,void 0,function(){var t,e,n=this;return l(this,function(r){if(vd(function(){PR.addExample(n.truncatedMnet.predict(n.imgF1),0),PR.addExample(n.truncatedMnet.predict(n.imgF2),0),PR.addExample(n.truncatedMnet.predict(n.imgS1),1),PR.addExample(n.truncatedMnet.predict(n.imgS2),1)}),null==PR.xs)throw new Error("Add some examples before training!");var o;if(console.log(this.imgW),this.model=(o={layers:[wA.flatten({inputShape:this.truncatedMnet.outputs[0].shape.slice(1)}),wA.dense({units:100,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),wA.dense({units:2,kernelInitializer:"varianceScaling",useBias:!1,activation:"softmax"})]},new RI(o)),t=XC.adam(1e-5),this.model.compile({optimizer:t,loss:"categoricalCrossentropy"}),!((e=Math.floor(1*PR.xs.shape[0]))>0))throw new Error("Batch size is 0 or NaN. Please choose a non-zero fraction.");return this.model.fit(PR.xs,PR.ys,{batchSize:e,epochs:200}),[2]})})},t.prototype.predict=function(){return u(this,void 0,void 0,function(){var t,e,n=this;return l(this,function(r){switch(r.label){case 0:return[4,(t=vd(function(){var t=document.getElementById("cam");console.log("input",t);var e=OC.fromPixels(t).expandDims(0),r=n.truncatedMnet.predict(e);return n.model.predict(r).as1D().argMax()})).data()];case 1:return e=r.sent()[0],t.dispose(),console.log(e),e>0?this.showCat=!0:0==e&&(this.showCat=!1),[3,0];case 2:return[2]}})})},t}(),FR=mo({encapsulation:0,styles:[[""]],data:{}});function zR(t){return ta(0,[(t()(),Wo(0,0,null,null,3,"div",[],null,null,null,null,null)),(t()(),Wo(1,0,null,null,1,"p",[],null,null,null,null,null)),(t()(),Yi(-1,null,["congradulations! you find a cat."])),(t()(),Wo(3,0,null,null,0,"img",[["height","224"],["src","../../assets/cat.jpg"],["width","224"]],null,null,null,null,null))],null,null)}function BR(t){return ta(0,[(t()(),Wo(0,0,null,null,1,"button",[["class","actionBtn"]],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.train()&&r),r},null,null)),(t()(),Yi(-1,null,["train"])),(t()(),Wo(2,0,null,null,0,"br",[],null,null,null,null,null)),(t()(),Wo(3,0,null,null,0,"img",[["height","224"],["id","cam"],["width","224"]],[[8,"src",4]],null,null,null,null)),(t()(),Wo(4,0,null,null,0,"br",[],null,null,null,null,null)),(t()(),Wo(5,0,null,null,1,"button",[["class","actionBtn"]],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.predict()&&r),r},null,null)),(t()(),Yi(-1,null,["predict"])),(t()(),jo(16777216,null,null,1,null,zR)),ki(8,16384,null,0,Is,[xr,dn],{ngIf:[0,"ngIf"]},null)],function(t,e){t(e,8,0,e.component.showCat)},function(t,e){t(e,3,0,e.component.imgW.imageAsDataUrl)})}var UR=mo({encapsulation:0,styles:[[""]],data:{}});function VR(t){return ta(0,[(t()(),Wo(0,0,null,null,1,"webcam",[],null,[[null,"imageCapture"],[null,"cameraSwitched"],[null,"initError"]],function(t,e,n){var r=!0,o=t.component;return"imageCapture"===e&&(r=!1!==o.handleImage(n)&&r),"cameraSwitched"===e&&(r=!1!==o.cameraWasSwitched(n)&&r),"initError"===e&&(r=!1!==o.handleInitError(n)&&r),r},Ph,Dh)),ki(1,4374528,null,0,Oh,[],{width:[0,"width"],height:[1,"height"],videoOptions:[2,"videoOptions"],allowCameraSwitch:[3,"allowCameraSwitch"],imageQuality:[4,"imageQuality"],trigger:[5,"trigger"],switchCamera:[6,"switchCamera"]},{imageCapture:"imageCapture",initError:"initError",cameraSwitched:"cameraSwitched"})],function(t,e){var n=e.component;t(e,1,0,224,224,n.videoOptions,n.allowCameraSwitch,1,n.triggerObservable,n.nextWebcamObservable)},null)}function jR(t){return ta(0,[(t()(),Wo(0,0,null,null,1,"h4",[],null,null,null,null,null)),(t()(),Yi(-1,null,["Messages:"]))],null,null)}function WR(t){return ta(0,[(t()(),Wo(0,0,null,null,3,"ul",[],null,null,null,null,null)),(t()(),Wo(1,0,null,null,2,"li",[],null,null,null,null,null)),(t()(),Yi(2,null,["",""])),(e=0,n=ks,r=[],Ri(-1,e|=16,null,0,n,n,r))],null,function(t,e){t(e,2,0,function(t,e,n,r){if(Qt.isWrapped(r)){r=Qt.unwrap(r);var o=t.def.nodes[2].bindingIndex+0,i=Qt.unwrap(t.oldValues[o]);t.oldValues[o]=new Qt(i)}return r}(e,0,0,function(t,e){var n=t.def.nodes[3];if(1&n.flags){var r=eo(t,n.nodeIndex);return n.element.template?r.template:r.renderElement}if(2&n.flags)return to(t,n.nodeIndex).renderText;if(20240&n.flags)return no(t,n.nodeIndex).instance;throw new Error("Illegal state: read nodeValue for node index 3")}(e).transform(e.context.$implicit)))});var e,n,r}function HR(t){return ta(0,[(t()(),Wo(0,0,null,null,8,"div",[["style","text-align:center"]],null,null,null,null,null)),(t()(),Wo(1,0,null,null,1,"h1",[],null,null,null,null,null)),(t()(),Yi(-1,null,[" Show me your hand and I will give you a cat. "])),(t()(),Wo(3,0,null,null,5,"div",[],null,null,null,null,null)),(t()(),jo(16777216,null,null,1,null,VR)),ki(5,16384,null,0,Is,[xr,dn],{ngIf:[0,"ngIf"]},null),(t()(),Wo(6,0,null,null,0,"br",[],null,null,null,null,null)),(t()(),Wo(7,0,null,null,1,"button",[["class","actionBtn"]],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.triggerSnapshot()&&r),r},null,null)),(t()(),Yi(-1,null,["Take A Snapshot"])),(t()(),jo(16777216,null,null,1,null,jR)),ki(10,16384,null,0,Is,[xr,dn],{ngIf:[0,"ngIf"]},null),(t()(),jo(16777216,null,null,1,null,WR)),ki(12,278528,null,0,Ns,[xr,dn,Vr],{ngForOf:[0,"ngForOf"]},null),(t()(),Wo(13,0,null,null,0,"img",[["height","224"],["id","face1"],["src","../../assets/facec.jpg"],["style","display: none;"],["width","224"]],null,null,null,null,null)),(t()(),Wo(14,0,null,null,0,"img",[["height","224"],["id","face2"],["src","../../assets/face.jpg"],["width","224"]],null,null,null,null,null)),(t()(),Wo(15,0,null,null,0,"img",[["height","224"],["id","stop1"],["src","../../assets/stop2.jpg"],["style","display: none;"],["width","224"]],null,null,null,null,null)),(t()(),Wo(16,0,null,null,0,"img",[["height","224"],["id","stop2"],["src","../../assets/stop.jpg"],["width","224"]],null,null,null,null,null)),(t()(),Wo(17,0,null,null,1,"app-mnet",[],null,null,null,BR,FR)),ki(18,114688,null,0,LR,[],{imgW:[0,"imgW"]},null)],function(t,e){var n=e.component;t(e,5,0,n.showWebcam),t(e,10,0,n.errors.length>0),t(e,12,0,n.errors),t(e,18,0,n.webcamImage)},null)}function qR(t){return ta(0,[(t()(),Wo(0,0,null,null,1,"app-root",[],null,null,null,HR,UR)),ki(1,114688,null,0,ls,[],null,null)],function(t,e){t(e,1,0)},null)}var GR=si("app-root",ls,qR,{},{},[]),KR=function(){return function(){}}(),$R=function(){return function(){}}(),XR=is(ss,[ls],function(t){return function(t){for(var e={},n=[],r=!1,o=0;o<t.length;o++){var i=t[o];i.token===xe&&!0===i.value&&(r=!0),1073741824&i.flags&&n.push(i.token),i.index=o,e[po(i.token)]=i}return{factory:null,providersByKey:e,providers:t,modules:n,isRoot:r}}([Qo(512,Ie,Te,[[8,[kh,GR]],[3,Ie],ke]),Qo(5120,Kr,Zr,[[3,Kr]]),Qo(4608,Ss,Cs,[Kr,[2,xs]]),Qo(5120,kn,Rn,[]),Qo(5120,Vr,$r,[]),Qo(5120,jr,Xr,[]),Qo(4608,Il,Tl,[Os]),Qo(6144,Ue,null,[Il]),Qo(4608,wl,Sl,[]),Qo(5120,Ku,function(t,e,n,r,o,i,a,s){return[new yl(t,e,n),new _l(r),new Cl(o,i,a,s)]},[Os,Yn,Mn,Os,Os,wl,Ln,[2,xl]]),Qo(4608,$u,$u,[Ku,Yn]),Qo(135680,Yu,Yu,[Os]),Qo(4608,ol,ol,[$u,Yu]),Qo(6144,Pe,null,[ol]),Qo(6144,Zu,null,[Yu]),Qo(4608,ir,ir,[Yn]),Qo(5120,Gc,Sh,[nh]),Qo(4608,lh,lh,[]),Qo(6144,sh,null,[lh]),Qo(135680,ch,ch,[nh,yn,Hn,se,sh]),Qo(4608,uh,uh,[]),Qo(5120,ph,vh,[nh,Ms,hh]),Qo(5120,_h,Nh,[Ch]),Qo(5120,Pn,function(t){return[t]},[_h]),Qo(1073742336,Rs,Rs,[]),Qo(1073742336,KR,KR,[]),Qo(1024,Nn,Ll,[]),Qo(1024,lr,function(){return[mh()]},[]),Qo(512,Ch,Ch,[se]),Qo(1024,Tn,function(t,e){return[(n=t,Hu("probe",Gu),Hu("coreTokens",i({},qu,(n||[]).reduce(function(t,e){return t[e.name]=e.token,t},{}))),function(){return Gu}),Eh(e)];var n},[[2,lr],Ch]),Qo(512,An,An,[[2,Tn]]),Qo(131584,dr,dr,[Yn,Ln,se,Nn,Ie,An]),Qo(1073742336,Yr,Yr,[dr]),Qo(1073742336,Fl,Fl,[[3,Fl]]),Qo(1024,fh,bh,[[3,nh]]),Qo(512,Ec,Nc,[]),Qo(512,oh,oh,[]),Qo(256,hh,{},[]),Qo(1024,hs,yh,[cs,[2,fs],hh]),Qo(512,ds,ds,[hs]),Qo(512,Hn,Hn,[]),Qo(512,yn,br,[Hn,[2,vr]]),Qo(1024,Xp,function(){return[[]]},[]),Qo(1024,nh,xh,[dr,Ec,oh,ds,se,yn,Hn,Xp,hh,[2,Yp],[2,Kp]]),Qo(1073742336,gh,gh,[[2,fh],[2,nh]]),Qo(1073742336,$R,$R,[]),Qo(1073742336,ss,ss,[]),Qo(256,xe,!0,[])])});(function(){if(We)throw new Error("Cannot enable prod mode after platform setup.");je=!1})(),Pl().bootstrapModuleFactory(XR).catch(function(t){return console.error(t)})}},[[0,0]]]);